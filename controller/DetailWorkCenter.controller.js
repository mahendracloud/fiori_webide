sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","ugiaiwui/mdg/aiw/request/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","ugiaiwui/mdg/aiw/library/js/ClassUtils","sap/ui/core/message/Message","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider"],function(e,t,a,r,s,l,i,n,o,c,u){"use strict";return e.extend("ugiaiwui.mdg.aiw.request.controller.DetailWorkCenter",{formatter:r,oAttach:[],oFileUpload:"",charFlag:"",codeFlag:"",pSelectDialog:undefined,wcSelectDialog:undefined,wcCatSelectDialog:undefined,uSelectDialog:undefined,stdSelectDialog:undefined,prSelectDialog:undefined,isItemPress:"",classType:"",_class:"",defaultCharArr:[],charValueArr:[],lArray:[],singleVal:"",charValue:"",cPath:"",sPath:"",resultArr:[],system:false,codeFlag:"",onInit:function(){this._oView=this.getView();this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this._oView));var e=this._oComponent.getModel();e.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(e);var t=this._oComponent.getModel("NewModel");this.getView().setModel(t,"valueHelp");var a=this._oComponent.getModel("NewModel2");this.getView().setModel(a,"valueHelp2");var r=this.getView().getModel("ApprovalModel");this.getView().setModel(r,"ApprModel");this.getRouter().getRoute("wcDetail").attachPatternMatched(this._onRouteMatched,this);var s=new sap.ui.model.json.JSONModel;var l={visible:false};s.setData(l);this.getView().setModel(s,"aVisModel");var i=new sap.ui.model.json.JSONModel;var n={enable:false,wcEnable:false,plEnable:false,wcatEnable:false};i.setData(n);this.getView().setModel(i,"aEnModel");this.BusyDialog=new sap.m.BusyDialog;this.getClassType(this);var o=sap.ui.getCore().getMessageManager();this.getView().setModel(o.getMessageModel(),"message");o.registerObject(this.getView(),true)},getClassType:function(e){var t=e.getView().getModel("valueHelp");var a=e.getObTab();var r=new sap.ui.model.Filter("Obtab","EQ",a);var s="/ClassTypeSet";t.read(s,{filters:[r],success:function(t){if(t.results.length>0){e.Classtype=t.results[0].Klart;e.Classtypedesc=t.results[0].Artxt}else{e.Classtype="";e.Classtypedesc=""}},error:function(){e.Classtype="";e.Classtypedesc=""}})},getObTab:function(){var e=sap.ui.getCore().getModel("EAMCRModel");var t="";t=e.getProperty("/0").Obtab;return t},_onRouteMatched:function(e){var a=this;var r=e.getParameter("name");if(r==="wcDetail"){this.currentObj=undefined;var s=decodeURIComponent(e.getParameter("arguments").itemPath);this.action=e.getParameter("arguments").action;this.mode=e.getParameter("arguments").mode;var l=new sap.ui.model.json.JSONModel;var i=sap.ui.getCore().getModel("AIWListWCModel");var n=i.getData();this.currentObj=i.getProperty(s);this.sExistFlag=false;this.oModelUpdateFlag=false;this.attachModelEventHandlers(l);this.wc=e.getParameter("arguments").wc;this.status=e.getParameter("arguments").status;this.plant=e.getParameter("arguments").plant;this.getView().byId("idBtnCheck").setVisible(true);var o=this.getView().createId("clsFrag");this.class=sap.ui.core.Fragment.byId(o,"assignmentTab");var c=this.getView().createId("charFrag");this.char=sap.ui.core.Fragment.byId(c,"characteristicsTab");if(this.mode==="display"){this.class.setVisible(false);this.char.setVisible(false);this.getView().byId("idBtnCheck").setVisible(false);var u=this.getView().getModel("aVisModel").getData();u.visible=true;this.getView().getModel("aVisModel").setData(u);var g=this.getView().getModel("aEnModel").getData();g.enable=false;this.getView().getModel("aEnModel").setData(g);this.getView().byId("cosCenterTable").setVisible(false);for(var d=0;d<n.length;d++){if(n[d].wc===this.wc&&n[d].plant===this.plant){l.setData(this.currentObj);break}}var p=new t;var h=sap.ui.getCore().getModel("AIWAPPROVE").getProperty("/AIWListWCModel"+s);p.setData(h);this.getView().setModel(p,"AIWAPPROVE")}else{var u=this.getView().getModel("aVisModel").getData();u.visible=false;this.getView().getModel("aVisModel").setData(u);this.class.setVisible(true);this.char.setVisible(true);if(this.action==="createWC"){var g=this.getView().getModel("aEnModel").getData();g.enable=true;g.wcEnable=this.currentObj.wc===""?true:false;g.plEnable=this.currentObj.plant===""?true:false;g.wcatEnable=this.currentObj.wcCat===""?true:false;this.getView().getModel("aEnModel").setData(g);this.getView().byId("cosCenterTable").setVisible(true);if(this.currentObj.classItems){var m=new sap.ui.model.json.JSONModel;m.setData(this.currentObj.classItems);this.class.setModel(m)}var w=[],f=[];w=this.currentObj.classItems;this.chData=this.currentObj.characteristics;if(this.chData.length>0){if(w.length>0){for(var v=0;v<this.chData.length;v++){if(w[0].Class===this.chData[v].Class){f.push(this.chData[v])}}}}this.class.setModel(new t(w));this.char.setModel(new t(f));l.setData(this.currentObj)}if(this.action==="changeWC"){var S;if(n.length>0){for(var d=0;d<n.length;d++){if(n[d].wc===this.wc&&n[d].plant===this.plant){S=d;this.sExistFlag=true;break}}}if(this.sExistFlag){this.currentObj=S;l.setData(this.currentObj);if(this.currentObj.classItems){var m=new sap.ui.model.json.JSONModel;m.setData(this.currentObj.classItems);this.class.setModel(m)}var w=[],f=[];w=this.currentObj.classItems;this.chData=this.currentObj.characteristics;if(this.chData.length>0){if(w.length>0){for(var v=0;v<this.chData.length;v++){if(w[0].Class===this.chData[v].Class){f.push(this.chData[v])}}}}this.class.setModel(new t(w));this.char.setModel(new t(f));var g=this.getView().getModel("aEnModel").getData();g.enable=true;g.wcEnable=this.currentObj.wc===""?true:false;g.plEnable=this.currentObj.plant===""?true:false;g.wcatEnable=this.currentObj.wcCat===""?true:false;this.getView().getModel("aEnModel").setData(g);this.getView().byId("cosCenterTable").setVisible(true);l.setData(this.currentObj)}else{this.readWCDetails(this.wc,this.plant)}this.getView().byId("wcDetailPage").setTitle(this.getView().getModel("i18n").getProperty("changeWC"));if(this.status==="true"||this.lockMsg===true){this.disableFields()}else{this.enableFields()}if(sap.ui.getCore().getModel("refreshModel")!==undefined){var C=sap.ui.getCore().getModel("refreshModel");C.setProperty("/refreshSearch",false)}}}if(this.currentObj.mode==="create"){this.getView().byId("wcDetailPage").setTitle(this.getView().getModel("i18n").getProperty("wcMasterTitle"))}else{this.getView().byId("wcDetailPage").setTitle(this.getView().getModel("i18n").getProperty("changeWC"))}this.getView().setModel(l,"wcDetailModel");sap.ui.getCore().setModel(l,"wcDetailModel")}else{return}},disableFields:function(){var e={enable:false};var t=new sap.ui.model.json.JSONModel;t.setData(e);this.getView().setModel(t,"mainView");this.getView().byId("cosCenterTable").setMode("None");this.getView().byId("newCost").setEnabled(false)},enableFields:function(){var e=this;var t={enable:true};var a=new sap.ui.model.json.JSONModel;a.setData(t);this.getView().setModel(a,"mainView");this.getView().byId("cosCenterTable").setMode("Delete");this.getView().byId("newCost").setEnabled(true)},readWCDetails:function(e,t){var a=this;if(this.action==="approveWC"){var r=this.getView().getModel("ApprModel");var s=[new sap.ui.model.Filter("ChangeRequestId","EQ","")]}else{var r=this.getView().getModel();var s=[new sap.ui.model.Filter("Arbpl","EQ",e),new sap.ui.model.Filter("Werks","EQ",t)]}a.BusyDialog.open();r.read("/ChangeRequestSet",{filters:s,urlParameters:{$expand:"Workcenter,WCCapa,WCCost,CrAttachments,Notes,ValueWC,ClassWC"},success:function(e){a.BusyDialog.close();var t=a.getView().getModel("wcDetailModel");if(e.results.length>0){var r=e.results[0].Message;a.lockMsg=false;if(r!==""){a.lockMsg=true;sap.m.MessageToast.show(r,{duration:15e3,animationDuration:15e3})}var s=e.results[0].Workcenter.results[0];a.currentObj=s;if(a.currentObj){a.currentObj.mode="change";a.currentObj.wc=s.Arbpl;a.currentObj.wcDesc=s.Txtmi;a.currentObj.plant=s.Werks;a.currentObj.plantDesc=s.Plantdesc;a.currentObj.wcCat=s.Verwe;a.currentObj.wcCatDesc=s.Ktext;a.currentObj.person=s.Crveran;a.currentObj.personDesc=s.Persresptxt;a.currentObj.usg=s.Planv;a.currentObj.usgDesc=s.UsageTxt;a.currentObj.stdVal=s.Vgwts;a.currentObj.stdValDesc=s.Vgwtx;a.currentObj.ctrlKey=s.Crsteus;a.currentObj.ctrlKeyDesc=s.Steutxt;a.currentObj.wcValueState="None";a.currentObj.wcDescValueState="None";a.currentObj.plantValueState="None";a.currentObj.wcCatValueState="None";a.currentObj.personResValueState="None";a.currentObj.usgValueState="None";a.currentObj.stdValueState="None";a.currentObj.cntrlKeyValueState="None";a.currentObj.wcValueStateTxt="";a.currentObj.wcDescValueStateTxt="";a.currentObj.plantValueStateTxt="";a.currentObj.wcCatValueStateTxt="";a.currentObj.personResValueStateTxt="";a.currentObj.usgValueStateTxt="";a.currentObj.stdValueStateTxt="";a.currentObj.cntrlKeyValueStateTxt="";a.currentObj.cost=[];a.currentObj.capacity=[];a.currentObj.classItems=[];a.currentObj.characteristics=[];var l=e.results[0].WCCost.results;if(l){if(l.length>0){var i=new sap.ui.model.json.JSONModel;i.setData(l);a.currentObj.cost=l}}var n=e.results[0].WCCapa.results;if(n){if(n.length>0){var o=new sap.ui.model.json.JSONModel;o.setData(n);a.currentObj.capacity=n}}var c=e.results[0].ClassWC.results;if(c){if(c.length>0){for(var u=0;u<c.length;u++){c[u].ctEnable=false;c[u].classEnable=false;c[u].ClassTypeDesc=c[u].Artxt;delete c[u].Artxt;c[u].ClassDesc=c[u].Kltxt;delete c[u].Kltxt;delete c[u].Changerequestid;delete c[u].Clint;delete c[u].Service;c[u].classDelEnable=true}if(a.lockMsg===true){for(var u=0;u<c.length;u++){c[u].classDelEnable=false}}var i=new sap.ui.model.json.JSONModel;i.setData(c);a.class.setModel(i);a.currentObj.classItems=c}}var g=e.results[0].ValueWC.results;if(g){if(g.length>0){for(var d=0;d<g.length;d++){g[d].cNameEnable=false;g[d].Textbz=g[d].Atwtb;delete g[d].Ataut;delete g[d].Ataw1;delete g[d].Atawe;delete g[d].Atcod;delete g[d].Atflb;delete g[d].Atflv;delete g[d].Atimb;delete g[d].Atsrt;delete g[d].Atvglart;delete g[d].Atzis;delete g[d].Changerequestid;delete g[d].CharName;delete g[d].Charid;delete g[d].Classtype;delete g[d].Service;delete g[d].Valcnt;g[d].slNo=d+1;g[d].flag=g[d].Class+"-"+g[d].slNo}if(a.lockMsg===true){for(var u=0;u<g.length;u++){g[u].charAddEnable=false;g[u].charClrEnable=false;g[u].charDltEnable=false}}else{for(var p=0;p<g.length;p++){var h=1;for(var m=0;m<g.length;m++){if(p===m){continue}if(g[m].Atnam===g[p].Atnam&&g[m].Class===g[p].Class){h++}}if(h>1){g[p].charDltEnable=true}else{g[p].charDltEnable=false}if(g[p].Atein===true){g[p].charAddEnable=false}}}var w=new sap.ui.model.json.JSONModel;w.setData(g);a.char.setModel(w);a.currentObj.characteristics=g}}}if(a.lockMsg===true){var f=a.getView().getModel("aEnModel").getData();f.enable=false;f.wcEnable=false;f.plEnable=false;f.wcatEnable=false;a.getView().getModel("aEnModel").setData(f);a.getView().byId("cosCenterTable").setVisible(true)}else{var f=a.getView().getModel("aEnModel").getData();f.enable=true;f.wcEnable=a.currentObj.wc===""?true:false;f.plEnable=a.currentObj.plant===""?true:false;f.wcatEnable=a.currentObj.wcCat===""?true:false;a.getView().getModel("aEnModel").setData(f);a.getView().byId("cosCenterTable").setVisible(true)}t.setData(a.currentObj);a.getView().setModel(t,"wcDetailModel");a.getView().getModel("wcDetailModel").refresh();sap.ui.getCore().setModel(t,"wcDetailModel")}},error:function(e){a.BusyDialog.close();var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var s=t.join("\n");a.invokeMessage(s)}})},onDonePress:function(e){var t=this;var r=e.getSource().getId();var s=true;var l=this.getView().getModel("wcDetailModel").getProperty("/cost");var i=this.getView().getModel("wcDetailModel");if(this.currentObj.wc===""){s=false;this.currentObj.wcValueState="Error"}if(this.currentObj.wcDesc===""){s=false;this.currentObj.wcDescValueState="Error"}if(this.currentObj.plant===""){s=false;this.currentObj.plantValueState="Error"}if(this.currentObj.wcCat===""){s=false;this.currentObj.wcCatValueState="Error"}if(this.currentObj.person===""){s=false;this.currentObj.personResValueState="Error"}if(this.currentObj.usg===""){s=false;this.currentObj.usgValueState="Error"}if(this.currentObj.stdVal===""){s=false;this.currentObj.stdValueState="Error"}if(!s){i.setData(this.currentObj);var n=this.getView().getModel("i18n").getProperty("MANDMSG");this.createMessagePopover(n,"Error");return}var o=false;if(l&&l.length>0){for(var c=0;c<l.length;c++){if(l[c].CrKostl===""&&l[c].CrKokrs!==""){l[c].ccState="Error";o=true}}var u=new sap.ui.model.json.JSONModel;u.setData(l);this.getView().getModel("wcDetailModel").setProperty("/cost",l);if(o){var g=this.getView().getModel("i18n").getProperty("CC_ERR");t.createMessagePopover(g,"Error");return}}var d=this.currentObj;if(t.class.getModel()){var p=t.class.getModel().getData();if(p){d.classItems=[];for(var h=0;h<p.length;h++){d.classItems.push(p[h])}i.setData(d)}}if(this.chData){var m=this.chData;if(m!==null&&m!==undefined){d.characteristics=[];for(var w=0;w<m.length;w++){d.characteristics.push(m[w])}}i.setData(d)}if(r.indexOf("idBtnCheck")>-1){this.validateCheck();return}this.chData=[];if(this.action==="changeWC"){if(this.oModelUpdateFlag&&!this.sExistFlag){var f=sap.ui.getCore().getModel("AIWListWCModel").getData();f.push(this.getView().getModel("wcDetailModel").getData())}}var v=a.getInstance().getPreviousHash();if(v!==undefined){history.go(-1)}},validateCheck:function(){var e=this;var t=e.getView().getModel("wcDetailModel").getData();var a=sap.ui.getCore().getModel("tempCrTypeModel").getData();var s={ChangeRequestType:a.crtype,CrDescription:a.desc,IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],ClassWC:[],ValueWC:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};var l={Werks:t.plant,Arbpl:t.wc,Txtmi:t.wcDesc,Verwe:t.wcCat,Crveran:t.person,Planv:t.usg,Vgwts:t.stdVal,Crsteus:t.ctrlKey};if(t.hasOwnProperty("Type")){if(t.Type==="X"){l.Type="X"}}s.Workcenter.push(l);if(t.cost){for(var i=0;i<t.cost.length;i++){var n={Werks:t.cost[i].CrKokrs,Arbpl:t.wc,CrKostl:t.cost[i].CrKostl,Costcentxt:t.cost[i].Costcentxt,CrLstar:t.cost[i].CrLstar,Forn1:t.cost[i].Forn1,ActvttypeTxt:t.cost[i].ActvttypeTxt,Frmltxt:t.cost[i].Frmltxt,Begda:r._formatDate(t.cost[i].Begda),Endda:r._formatDate(t.cost[i].Endda)};s.WCCost.push(n)}}var o=t.classItems;if(o){if(o.length>0){for(var c=0;c<o.length;c++){var u={Arbpl:t.wc,Werks:t.plant,Classtype:o[c].Classtype,Class:o[c].Class};s.ClassWC.push(u)}}}var g=t.characteristics;if(g){if(g.length>0){for(var d=0;d<g.length;d++){var p={Arbpl:t.wc,Werks:t.plant,Atnam:g[d].Atnam,Textbez:g[d].Textbez,Atwrt:g[d].Atwrt,Class:g[d].Class};s.ValueWC.push(p)}}}this.getView().byId("wcDetailPage").setBusy(true);var h=this.getView().getModel();h.create("/ChangeRequestSet",s,{success:function(t){e.getView().byId("wcDetailPage").setBusy(false);var a=t;var s=[];for(var l=0;l<a.Messages.results.length;l++){s.push({type:r.getMessageType(a.Messages.results[l].Type),title:a.Messages.results[l].Message})}e.createMessagePopover(s,"")},error:function(t){e.getView().byId("wcDetailPage").setBusy(false);var a=[],r=[];if(JSON.parse(t.responseText).error.innererror.errordetails===undefined||JSON.parse(t.responseText).error.innererror.errordetails.length===0){a[0]=JSON.parse(t.responseText).error.message.value}else{for(var s=0;s<JSON.parse(t.responseText).error.innererror.errordetails.length;s++){a[s]=JSON.parse(t.responseText).error.innererror.errordetails[s].message}}var l=a.join("\n");sap.m.MessageBox.show(l,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},attachModelEventHandlers:function(e){e.attachPropertyChange(this.handlePropertyChanged,this)},handlePropertyChanged:function(){this.oModelUpdateFlag=true},onPlantVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");if(this.pSearchResults===undefined||this.pSearchResults==={}){this.pSelectDialog=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("PLANT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Search Term 1"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Search Term 2"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Postal Code"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"City"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Name2"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Name"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Company Name"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Addess Version"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Plant"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Description"})]})],items:{path:"/PlantVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{CompanyName}"}),new sap.m.Text({text:"{AddrVersion}"}),new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{PlantName}"})]})},confirm:function(e){t.currentObj.plantValueState="None";t.currentObj.plantValueStateTxt="";t.currentObj.plant=e.getParameter("selectedItem").getCells()[8].getText();t.currentObj.plantDesc=e.getParameter("selectedItem").getCells()[9].getText();a.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("PlantName",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var r="/PlantVHSet";var s=this.getView().getModel("valueHelp");s.read(r,{success:function(e){if(e.results.length>0){t.pSearchResults=e;var a=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{CompanyName}"}),new sap.m.Text({text:"{AddrVersion}"}),new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{PlantName}"})]});var r=new sap.ui.model.json.JSONModel;r.setData(e);t.pSelectDialog.setModel(r);t.pSelectDialog.bindAggregation("items","/results",a)}else{t.pSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var l=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{CompanyName}"}),new sap.m.Text({text:"{AddrVersion}"}),new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{PlantName}"})]});var i=new sap.ui.model.json.JSONModel;i.setData(this.pSearchResults);this.pSelectDialog.setModel(i);this.pSelectDialog.setGrowingThreshold(this.pSearchResults.results.length);this.pSelectDialog.bindAggregation("items","/results",l);var n=this.pSelectDialog.getItems();for(var o=0;o<n.length;o++){n[o].setVisible(true)}}this.pSelectDialog.open()},onWcVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");if(this.wcSearchResults===undefined||this.wcSearchResults==={}){this.wcSelectDialog=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("WORK_CENTER"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Work Center Category"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Plant"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Work Center"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Description"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Language"})]})],items:{path:"/WorkCenterVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"})]})},confirm:function(e){t.currentObj.wcValueState="None";t.currentObj.wcValueStateTxt="";t.currentObj.wc=e.getParameter("selectedItem").getCells()[2].getText();t.currentObj.wcDesc=e.getParameter("selectedItem").getCells()[3].getText();if(t.currentObj.wcDesc){t.currentObj.wcDescValueState="None";t.currentObj.wcDescValueStateTxt=""}a.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Arbpl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ktext",sap.ui.model.FilterOperator.Contains,t)],true)])}}});var r="/WorkCenterVHSet";var s=this.getView().getModel("valueHelp");s.read(r,{success:function(e){if(e.results.length>0){var a=sap.ui.getCore().getModel("AIWListWCModel").getData();if(a.length>0){for(var r=0;r<a.length;r++){var s={Verwe:a[r].wcCat,Werks:a[r].plant,Arbpl:a[r].wc,Ktext:a[r].wcDesc,Spras:e.results[0].Spras};e.results.unshift(s)}}t.wcSearchResults=e;var l=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"})]});var i=new sap.ui.model.json.JSONModel;i.setData(e);t.wcSelectDialog.setModel(i);t.wcSelectDialog.bindAggregation("items","/results",l)}else{t.wcSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var l=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"})]});var i=new sap.ui.model.json.JSONModel;i.setData(this.wcSearchResults);this.wcSelectDialog.setModel(i);this.wcSelectDialog.setGrowingThreshold(this.wcSearchResults.results.length);this.wcSelectDialog.bindAggregation("items","/results",l);var n=this.wcSelectDialog.getItems();for(var o=0;o<n.length;o++){n[o].setVisible(true)}}this.wcSelectDialog.open()},onWcCatVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");if(this.wcCatSearchResults===undefined||this.wcCatSearchResults==={}){this.wcCatSelectDialog=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("WORK_CENTER_CAT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/WorkCentCatVHSet",template:new sap.m.StandardListItem({title:"{Verwe}",description:"{Ktext}"})},confirm:function(e){t.currentObj.wcCatValueState="None";t.currentObj.wcCatValueStateTxt="";t.currentObj.wcCat=e.getParameters().selectedItem.getProperty("title");t.currentObj.wcCatDesc=e.getParameters().selectedItem.getProperty("description");a.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Verwe",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ktext",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var r="/WorkCentCatVHSet";var s=this.getView().getModel("valueHelp");s.read(r,{success:function(e){if(e.results.length>0){t.wcCatSearchResults=e;var a=new sap.m.StandardListItem({title:"{Verwe}",description:"{Ktext}",active:true});var r=new sap.ui.model.json.JSONModel;r.setData(e);t.wcCatSelectDialog.setModel(r);t.wcCatSelectDialog.setGrowingThreshold(e.results.length);t.wcCatSelectDialog.bindAggregation("items","/results",a)}else{t.wcCatSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var l=new sap.m.StandardListItem({title:"{Verwe}",description:"{Ktext}",active:true});var i=new sap.ui.model.json.JSONModel;i.setData(this.wcCatSearchResults);this.wcCatSelectDialog.setModel(i);this.wcCatSelectDialog.setGrowingThreshold(this.wcCatSearchResults.results.length);this.wcCatSelectDialog.bindAggregation("items","/results",l);var n=this.wcCatSelectDialog.getItems();for(var o=0;o<n.length;o++){n[o].setVisible(true)}}this.wcCatSelectDialog.open()},onCtrlKeyVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");if(this.ctrSearchResults===undefined||this.ctrSearchResults==={}){this.ctrSelectDialog=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("CTRL_KEY"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/ControlKeySet",template:new sap.m.StandardListItem({title:"{Steus}",description:"{Txt}"})},confirm:function(e){t.currentObj.cntrlKeyValueState="None";t.currentObj.cntrlKeyValueStateTxt="";t.currentObj.ctrlKey=e.getParameters().selectedItem.getProperty("title");t.currentObj.ctrlKeyDesc=e.getParameters().selectedItem.getProperty("description");a.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Steus",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Txt",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var r="/ControlKeySet";var s=this.getView().getModel("valueHelp");s.read(r,{success:function(e){if(e.results.length>0){t.ctrSearchResults=e;var a=new sap.m.StandardListItem({title:"{Steus}",description:"{Txt}",active:true});var r=new sap.ui.model.json.JSONModel;r.setData(e);t.ctrSelectDialog.setModel(r);t.ctrSelectDialog.setGrowingThreshold(e.results.length);t.ctrSelectDialog.bindAggregation("items","/results",a)}else{t.ctrSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var l=new sap.m.StandardListItem({title:"{Steus}",description:"{Txt}",active:true});var i=new sap.ui.model.json.JSONModel;i.setData(this.ctrSearchResults);this.ctrSelectDialog.setModel(i);this.ctrSelectDialog.setGrowingThreshold(this.ctrSearchResults.results.length);this.ctrSelectDialog.bindAggregation("items","/results",l);var n=this.ctrSelectDialog.getItems();for(var o=0;o<n.length;o++){n[o].setVisible(true)}}this.ctrSelectDialog.open()},onCostCenterVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");var s=new sap.ui.model.json.JSONModel;s=t.getView().getModel("wcDetailModel");var l=s.getProperty("/cost");var i=e.getSource().getBindingContext("wcDetailModel").sPath;t.index=parseInt(i.substr(i.lastIndexOf("/")+1));this.ccSelectDialog=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("CC"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Cost Center"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"CO Area"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Company Code"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"CCtr Category"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Person Responsible"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"User Responsible"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Short Text"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Language"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Valid From"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Valid To"})]})],items:{path:"/CostCenterSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Kostl}"}),new sap.m.Text({text:"{Kokrs}"}),new sap.m.Text({text:"{Bukrs}"}),new sap.m.Text({text:"{Kosar}"}),new sap.m.Text({text:"{Verak}"}),new sap.m.Text({text:"{VerakUser}"}),new sap.m.Text({text:"{Mctxt}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:{parts:[{path:"Datab"}],formatter:r.dateFormat}}),new sap.m.Text({text:{parts:[{path:"Datbi"}],formatter:r.dateFormat}})]})},confirm:function(e){l[t.index].CrKostl=e.getParameter("selectedItem").getCells()[0].getText();l[t.index].Costcentxt=e.getParameter("selectedItem").getCells()[6].getText();l[t.index].ccState="None";a.setProperty("/cost",l)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Kostl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Mctxt",sap.ui.model.FilterOperator.Contains,t)],false)])}e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Kostl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Mctxt",sap.ui.model.FilterOperator.Contains,t)],false)])}});var n="/CostCenterSet";var o=this.getView().getModel("valueHelp");o.read(n,{success:function(e){if(e.results.length>0){t.ccSearchResults=e;var a=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Kostl}"}),new sap.m.Text({text:"{Kokrs}"}),new sap.m.Text({text:"{Bukrs}"}),new sap.m.Text({text:"{Kosar}"}),new sap.m.Text({text:"{Verak}"}),new sap.m.Text({text:"{VerakUser}"}),new sap.m.Text({text:"{Mctxt}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:{parts:[{path:"Datab"}],formatter:t.formatter.dateFormat}}),new sap.m.Text({text:{parts:[{path:"Datbi"}],formatter:t.formatter.dateFormat}})]});var r=new sap.ui.model.json.JSONModel;r.setData(e);t.ccSelectDialog.setModel(r);t.ccSelectDialog.bindAggregation("items","/results",a)}else{t.ccSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}});this.ccSelectDialog.open()},onActTypeVH:function(e){this.actTypeVH("actType",e)},actTypeVH:function(e,t){var a=this;var r=a.getView().getModel("wcDetailModel");var s=new sap.ui.model.json.JSONModel;s=a.getView().getModel("wcDetailModel");var l=s.getProperty("/cost");var i=t.getSource().getBindingContext("wcDetailModel").sPath;a.index=parseInt(i.substr(i.lastIndexOf("/")+1));if(this.actSearchResults===undefined){this.actSelectDialog=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("ACT_TYPE"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/WCActivitySet",template:new sap.m.StandardListItem({title:"{Lstar}",description:"{Ktext}"})},confirm:function(e){l[a.index].aState="None";l[a.index].CrLstar=e.getParameters().selectedItem.getProperty("title");l[a.index].ActvttypeTxt=e.getParameters().selectedItem.getProperty("description");r.setProperty("/cost",l)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Lstar",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ktext",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var n="/WCActivitySet";var o=[new sap.ui.model.Filter("Kokrs","EQ",l[a.index].CrKokrs),new sap.ui.model.Filter("Kostl","EQ",l[a.index].CrKostl)];var c=this.getView().getModel("valueHelp2");c.read(n,{filters:o,success:function(e){if(e.results.length>0){a.actSearchResults=e;var t=new sap.m.StandardListItem({title:"{Lstar}",description:"{Ktext}",active:true});var r=new sap.ui.model.json.JSONModel;r.setData(e);a.actSelectDialog.setModel(r);a.actSelectDialog.bindAggregation("items","/results",t)}else{a.actSelectDialog.setNoDataText(a.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var u=new sap.ui.model.json.JSONModel;u.setData(this.actSearchResults);this.actSelectDialog.setModel(u);var g=this.actSelectDialog.getItems();for(var d=0;d<g.length;d++){g[d].setVisible(true)}}this.actSelectDialog.open()},onFormulaKeyVH:function(e){this.formulaKeyVH("formKey",e)},formulaKeyVH:function(e,t){var a=this;var r=a.getView().getModel("wcDetailModel");var s=new sap.ui.model.json.JSONModel;s=a.getView().getModel("wcDetailModel");var l=s.getProperty("/cost");var i=t.getSource().getBindingContext("wcDetailModel").sPath;a.index=parseInt(i.substr(i.lastIndexOf("/")+1));if(this.fSearchResults===undefined){this.fSelectDialog=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("FORM_KEY"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/FormKeyCostingSet",template:new sap.m.StandardListItem({title:"{Ident}",description:"{Txt}"})},confirm:function(e){l[a.index].fState="None";l[a.index].Forn1=e.getParameters().selectedItem.getProperty("title");l[a.index].Frmltxt=e.getParameters().selectedItem.getProperty("description");r.setProperty("/cost",l)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Ident",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Txt",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var n="/FormKeyCostingSet";var o=this.getView().getModel("valueHelp");o.read(n,{success:function(e){if(e.results.length>0){a.fSearchResults=e;var t=new sap.m.StandardListItem({title:"{Ident}",description:"{Txt}",active:true});var r=new sap.ui.model.json.JSONModel;r.setData(e);a.fSelectDialog.setModel(r);a.fSelectDialog.bindAggregation("items","/results",t)}else{a.fSelectDialog.setNoDataText(a.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var c=new sap.ui.model.json.JSONModel;c.setData(this.fSearchResults);this.fSelectDialog.setModel(c);var u=this.fSelectDialog.getItems();for(var g=0;g<u.length;g++){u[g].setVisible(true)}}this.fSelectDialog.open()},onWCUsageVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");if(this.uSearchResults===undefined||this.uSearchResults==={}){this.uSelectDialog=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("USAGE"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/WCUsageVHSet",template:new sap.m.StandardListItem({title:"{PLANV}",description:"{TXT}"})},confirm:function(e){t.currentObj.usgValueState="None";t.currentObj.usgValueStateTxt="";t.currentObj.usg=e.getParameters().selectedItem.getProperty("title");t.currentObj.usgDesc=e.getParameters().selectedItem.getProperty("description");a.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("PLANV",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("TXT",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var r="/WCUsageVHSet";var s=this.getView().getModel("valueHelp");s.read(r,{success:function(e){if(e.results.length>0){t.uSearchResults=e;var a=new sap.m.StandardListItem({title:"{PLANV}",description:"{TXT}",active:true});var r=new sap.ui.model.json.JSONModel;r.setData(e);t.uSelectDialog.setModel(r);t.uSelectDialog.setGrowingThreshold(e.results.length);t.uSelectDialog.bindAggregation("items","/results",a)}else{t.uSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var l=new sap.m.StandardListItem({title:"{PLANV}",description:"{TXT}",active:true});var i=new sap.ui.model.json.JSONModel;i.setData(this.uSearchResults);this.uSelectDialog.setModel(i);this.uSelectDialog.setGrowingThreshold(this.uSearchResults.results.length);this.uSelectDialog.bindAggregation("items","/results",l);var n=this.uSelectDialog.getItems();for(var o=0;o<n.length;o++){n[o].setVisible(true)}}this.uSelectDialog.open()},onStdValVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");if(this.stdSearchResults===undefined||this.stdSearchResults==={}){this.stdSelectDialog=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("STD_VALUE_KEY"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/StandardValueKeySet",template:new sap.m.StandardListItem({title:"{Vgwts}",description:"{Txt}"})},confirm:function(e){t.currentObj.stdValueState="None";t.currentObj.stdValueStateTxt="";t.currentObj.stdVal=e.getParameters().selectedItem.getProperty("title");t.currentObj.stdValDesc=e.getParameters().selectedItem.getProperty("description");a.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Vgwts",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Txt",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var r="/StandardValueKeySet";var s=this.getView().getModel("valueHelp");s.read(r,{success:function(e){if(e.results.length>0){t.stdSearchResults=e;var a=new sap.m.StandardListItem({title:"{Vgwts}",description:"{Txt}",active:true});var r=new sap.ui.model.json.JSONModel;r.setData(e);t.stdSelectDialog.setModel(r);t.stdSelectDialog.setGrowingThreshold(e.results.length);t.stdSelectDialog.bindAggregation("items","/results",a)}else{t.stdSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var l=new sap.m.StandardListItem({title:"{Vgwts}",description:"{Txt}",active:true});var i=new sap.ui.model.json.JSONModel;i.setData(this.stdSearchResults);this.stdSelectDialog.setModel(i);this.stdSelectDialog.setGrowingThreshold(this.stdSearchResults.results.length);this.stdSelectDialog.bindAggregation("items","/results",l);var n=this.stdSelectDialog.getItems();for(var o=0;o<n.length;o++){n[o].setVisible(true)}}this.stdSelectDialog.open()},onPerRespVH:function(e){var t=this;var a=t.getView().getModel("wcDetailModel");var r=t.currentObj.plant;var s=new sap.ui.model.Filter("Werks","EQ",r);if(this.prSearchResults===undefined||this.prSearchResults==={}){this.prSelectDialog=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("PERSON_RESP"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Plant"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Person Responsible"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Name"})]})],items:{path:"/PersonRespVHSet",filters:s,template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Veran}"}),new sap.m.Text({text:"{Ktext}"})]})},confirm:function(e){t.currentObj.personResValueState="None";t.currentObj.personResValueStateTxt="";t.currentObj.person=e.getParameter("selectedItem").getCells()[1].getText();t.currentObj.personDesc=e.getParameter("selectedItem").getCells()[2].getText();a.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Veran",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ktext",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var l="/PersonRespVHSet";var i=this.getView().getModel("valueHelp");i.read(l,{filters:[s],success:function(e){if(e.results.length>0){t.prSearchResults=e;var a=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Veran}"}),new sap.m.Text({text:"{Ktext}"})]});var r=new sap.ui.model.json.JSONModel;r.setData(e);t.prSelectDialog.setModel(r);t.prSelectDialog.setGrowingThreshold(e.results.length);t.prSelectDialog.bindAggregation("items","/results",a)}else{t.prSelectDialog.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var n=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Veran}"}),new sap.m.Text({text:"{Ktext}"})]});var o=new sap.ui.model.json.JSONModel;o.setData(this.prSearchResults);this.prSelectDialog.setModel(o);this.prSelectDialog.setGrowingThreshold(this.prSearchResults.results.length);this.prSelectDialog.bindAggregation("items","/results",n);var c=this.prSelectDialog.getItems();for(var u=0;u<c.length;u++){c[u].setVisible(true)}}this.prSelectDialog.open()},onLiveChange:function(e){if(e.getSource().getValue()===" "){e.getSource().setValue("")}e.getSource().setValueState("None")},onWCChange:function(e){var t=e.getSource().getValue();var a;var r=e.getSource().mBindingInfos.value.binding;if(r!==undefined&&r!==null){a=r.sPath}else{a=e.getSource().mBindingInfos.value.parts[0].path}a=a.substring(1);switch(a){case"wc":this._workCenter(t,e);break;case"plant":this._plant(t,e);break;case"wcCat":this._workCenterCategory(t,e);break;case"person":this._personResponsible(t,e);break;case"usg":this._usage(t,e);break;case"stdVal":this._standardValueKey(t,e);break;case"ctrlKey":this._controlKey(t,e);break}},_plant:function(e,t){var a=e.toUpperCase();var r=this;var s=r.getView().getModel("wcDetailModel");var l=a.replace(/^[ ]+|[ ]+$/g,"");if(l!==""){var i="/PlantVHSet";var n=new sap.ui.model.Filter("Plant","EQ",a);var o=this.getView().getModel("valueHelp");o.read(i,{filters:[n],success:function(e){if(e.results.length>0){r.currentObj.plantDesc=e.results[0].PlantName;r.currentObj.plant=l;s.setData(r.currentObj)}else{r.currentObj.plantValueState="Error";r.currentObj.plantDesc="";r.currentObj.plantValueStateTxt="Invalid Entry";s.setData(r.currentObj)}},error:function(e){r.currentObj.plantValueState="Error";var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.plantValueStateTxt=a;s.setData(r.currentObj)}})}else{r.currentObj.plant=l;s.setData(r.currentObj)}},_workCenter:function(e){var t=e.toUpperCase();var a=this;var r=a.getView().getModel("wcDetailModel");var s=t.replace(/^[ ]+|[ ]+$/g,"");if(s!==""){var l="/WorkCenterVHSet";var i=new sap.ui.model.Filter("Arbpl","EQ",t);var n=this.getView().getModel("valueHelp");var o=false;var c=sap.ui.getCore().getModel("AIWListWCModel").getData();if(c.length>0){for(var u=0;u<c.length;u++){if(c[u].wc===t){a.currentObj.wc=s;a.currentObj.wcDesc=c[u].Ktext;r.setData(a.currentObj);o=true}}}if(o===true){return}else{n.read(l,{filters:[i],success:function(e){if(e.results.length>0){a.currentObj.wc=s;a.currentObj.wcDesc=e.results[0].Ktext;r.setData(a.currentObj)}else{a.currentObj.wcValueState="Error";a.currentObj.wcValueStateTxt="Invalid Entry";r.setData(a.currentObj)}},error:function(e){a.currentObj.wcValueState="Error";var t=JSON.parse(e.responseText);var s=t.error.message.value;a.currentObj.wcValueStateTxt=s;r.setData(a.currentObj)}})}}else{a.currentObj.wc=s;r.setData(a.currentObj)}},_workCenterCategory:function(e){var t=e.toUpperCase();var a=this;var r=a.getView().getModel("wcDetailModel");var s=t.replace(/^[ ]+|[ ]+$/g,"");if(s!==""){var l="/WorkCentCatVHSet";var i=new sap.ui.model.Filter("Verwe","EQ",t);var n=this.getView().getModel("valueHelp");n.read(l,{filters:[i],success:function(e){if(e.results.length>0){a.currentObj.wcCatDesc=e.results[0].Ktext;a.currentObj.wcCat=s;r.setData(a.currentObj)}else{a.currentObj.wcCatValueState="Error";a.currentObj.wcCatDesc="";a.currentObj.wcCatValueStateTxt="Invalid Entry";r.setData(a.currentObj)}},error:function(e){a.currentObj.wcCatValueState="Error";var t=JSON.parse(e.responseText);var s=t.error.message.value;a.currentObj.wcCatValueStateTxt=s;r.setData(a.currentObj)}})}else{a.currentObj.wcCat=s;r.setData(a.currentObj)}},_personResponsible:function(e){var t=e.toUpperCase();var a=this;var r=a.getView().getModel("wcDetailModel");var s=a.currentObj.plant;var l=t.replace(/^[ ]+|[ ]+$/g,"");if(l!==""){var i="/PersonRespVHSet";var n=[new sap.ui.model.Filter("Werks","EQ",s),new sap.ui.model.Filter("Veran","EQ",t)];var o=this.getView().getModel("valueHelp");o.read(i,{filters:n,success:function(e){if(e.results.length>0){a.currentObj.personDesc=e.results[0].Ktext;a.currentObj.person=l;r.setData(a.currentObj)}else{a.currentObj.personResValueState="Error";a.currentObj.personDesc="";a.currentObj.personResValueStateTxt="Invalid Entry";r.setData(a.currentObj)}},error:function(e){a.currentObj.personResValueState="Error";var t=JSON.parse(e.responseText);var s=t.error.message.value;a.currentObj.personResValueStateTxt=s;r.setData(a.currentObj)}})}else{a.currentObj.person=l;r.setData(a.currentObj)}},_usage:function(e){var t=e.toUpperCase();var a=this;var r=a.getView().getModel("wcDetailModel");var s=t.replace(/^[ ]+|[ ]+$/g,"");if(s!==""){var l="/WCUsageVHSet";var i=new sap.ui.model.Filter("PLANV","EQ",t);var n=this.getView().getModel("valueHelp");n.read(l,{filters:[i],success:function(e){if(e.results.length>0){a.currentObj.usgDesc=e.results[0].TXT;a.currentObj.usg=s;r.setData(a.currentObj)}else{a.currentObj.usgValueState="Error";a.currentObj.usgDesc="";a.currentObj.usgValueStateTxt="Invalid Entry";r.setData(a.currentObj)}},error:function(e){a.currentObj.usgValueState="Error";var t=JSON.parse(e.responseText);var s=t.error.message.value;a.currentObj.usgValueStateTxt=s;r.setData(a.currentObj)}})}else{a.currentObj.usg=s;r.setData(a.currentObj)}},_controlKey:function(e){var t=e.toUpperCase();var a=this;var r=a.getView().getModel("wcDetailModel");var s=t.replace(/^[ ]+|[ ]+$/g,"");if(s!==""){var l="/ControlKeySet";var i=new sap.ui.model.Filter("Steus","EQ",t);var n=this.getView().getModel("valueHelp");n.read(l,{filters:[i],success:function(e){if(e.results.length>0){a.currentObj.ctrlKeyDesc=e.results[0].Txt;a.currentObj.ctrlKey=s;r.setData(a.currentObj)}else{a.currentObj.cntrlKeyValueState="Error";a.currentObj.ctrlKeyDesc="";a.currentObj.cntrlKeyValueStateTxt="Invalid Entry";r.setData(a.currentObj)}},error:function(e){a.currentObj.cntrlKeyValueState="Error";var t=JSON.parse(e.responseText);var s=t.error.message.value;a.currentObj.cntrlKeyValueStateTxt=s;r.setData(a.currentObj)}})}else{a.currentObj.ctrlKey=s;r.setData(a.currentObj)}},_standardValueKey:function(e){var t=e.toUpperCase();var a=this;var r=a.getView().getModel("wcDetailModel");var s=t.replace(/^[ ]+|[ ]+$/g,"");if(s!==""){var l="/StandardValueKeySet";var i=new sap.ui.model.Filter("Vgwts","EQ",t);var n=this.getView().getModel("valueHelp");n.read(l,{filters:[i],success:function(e){if(e.results.length>0){a.currentObj.stdValDesc=e.results[0].Txt;a.currentObj.stdVal=s;r.setData(a.currentObj)}else{a.currentObj.stdValueState="Error";a.currentObj.stdValDesc="";a.currentObj.stdValueStateTxt="Invalid Entry";r.setData(a.currentObj)}},error:function(e){a.currentObj.stdValueState="Error";var t=JSON.parse(e.responseText);var s=t.error.message.value;a.currentObj.stdValueStateTxt=s;r.setData(a.currentObj)}})}else{a.currentObj.stdVal=s;r.setData(a.currentObj)}},onCostChange:function(e){var t=this.getView().getModel("wcDetailModel");var a=t.getProperty("/cost");var r=e.getSource();var s=r.sId;var l=e.getParameters().value;var i=e.getSource().getBindingContext("wcDetailModel").sPath;var n=parseInt(i.substr(i.lastIndexOf("/")+1));var o=this;var c=this.getView().getModel("valueHelp2");var u;if(s.indexOf("costCenter")>-1){if(l!==""){var g=l.toUpperCase();var d=g.replace(/^[ ]+|[ ]+$/g,"");if(d!==""){var p="/CostCenterSet";u=new sap.ui.model.Filter("Kostl","EQ",g);c.read(p,{filters:[u],success:function(e){if(e.results.length>0){a[n].ccState="None";a[n].CrKostl=l.toUpperCase();a[n].Costcentxt=e.results[0].Mctxt;t.setProperty("/cost",a)}else{a[n].ccState="Error";t.setProperty("/cost",a)}},error:function(){a[n].ccState="Error";t.setProperty("/cost",a)}})}}else{a[n].ccState="Error";o.getView().getModel("wcDetailModel").setProperty("/cost",a)}}if(s.indexOf("actType")>-1){if(l!==""){var g=l.toUpperCase();var d=g.replace(/^[ ]+|[ ]+$/g,"");if(d!==""){var p="/WCActivitySet";var h=[new sap.ui.model.Filter("Kokrs","EQ",a[n].CrKokrs),new sap.ui.model.Filter("Kostl","EQ",a[n].CrKostl),new sap.ui.model.Filter("Lstar","EQ",g)];c.read(p,{filters:h,success:function(e){if(e.results.length>0){a[n].aState="None";a[n].CrLstar=l.toUpperCase();a[n].ActvttypeTxt=e.results[0].Ktext;t.setProperty("/cost",a)}else{a[n].aState="Error";t.setProperty("/cost",a)}},error:function(){a[n].aState="Error";o.getView().getModel("wcDetailModel").setProperty("/cost",a)}})}}else{a[n].aState="None";a[n].ActvttypeTxt="";o.getView().getModel("wcDetailModel").setProperty("/cost",a)}}if(s.indexOf("formKey")>-1){if(l!==""){var g=l.toUpperCase();var d=g.replace(/^[ ]+|[ ]+$/g,"");if(d!==""){var p="/FormKeyCostingSet";u=new sap.ui.model.Filter("Ident","EQ",g);c.read(p,{filters:[u],success:function(e){if(e.results.length>0){a[n].fState="None";a[n].Forn1=l.toUpperCase();a[n].Frmltxt=e.results[0].Txt;t.setProperty("/cost",a)}else{a[n].fState="Error";t.setProperty("/cost",a)}},error:function(){a[n].fState="Error";t.setProperty("/cost",a)}})}}else{a[n].fState="None";a[n].Frmltxt="";o.getView().getModel("wcDetailModel").setProperty("/cost",a)}}},onWCDescChange:function(){var e=this.getView().getModel("wcDetailModel");this.currentObj.wcDescValueState="None";e.setData(this.currentObj)},handleCostRowAdd:function(){var e=this;var t=e.getView().getModel("wcDetailModel");var a=t.getData();var r=new sap.ui.model.json.JSONModel;var s=e.getView().getModel("wcDetailModel").getProperty("/cost");if(s){r.setData(s)}var l=this.getView().getModel();var i=this.currentObj.plant;var n={};if(i!==""){l.read("/DerviceWCcostdefaultvalSet('"+i+"')",{success:function(a){n.Kokrs=a.Kokrs;n.Bezei=a.Bezei;if(s===undefined||s===null){var l=[{CrKokrs:n.Kokrs,Bezei:n.Bezei,CrKostl:"",Costcentxt:"",CrLstar:"",Forn1:"",ActvttypeTxt:"",Frmltxt:"",ccState:"None",aState:"None",fState:"None",Begda:new Date,Endda:new Date("December 31, 9999 23:59:59")}];r.setData(l);t.setProperty("/cost",l)}else{var i={CrKokrs:n.Kokrs,Bezei:n.Bezei,CrKostl:"",Costcentxt:"",CrLstar:"",Forn1:"",ActvttypeTxt:"",Frmltxt:"",ccState:"None",aState:"None",fState:"None",Begda:null,Endda:new Date("December 31, 9999 23:59:59")};s.push(i);r.setData(s);t.setProperty("/cost",s)}e.getView().setModel(t,"wcDetailModel");sap.ui.getCore().setModel(t,"wcDetailModel");e.getView().getModel("wcDetailModel").refresh()},error:function(t){var a=[];if(JSON.parse(t.responseText).error.innererror.errordetails===undefined||JSON.parse(t.responseText).error.innererror.errordetails.length===0){a[0]=JSON.parse(t.responseText).error.message.value}else{for(var r=0;r<JSON.parse(t.responseText).error.innererror.errordetails.length;r++){a[r]=JSON.parse(t.responseText).error.innererror.errordetails[r].message}}var s=a.join("\n");e.invokeMessage(s)}})}},handleCostRowDelete:function(e){var t=e.getParameter("listItem").getBindingContext("wcDetailModel").sPath;var a=parseInt(t.substr(t.lastIndexOf("/")+1));var r=this.getView().getModel("wcDetailModel");if(r.getProperty("/cost").length>0){r.getProperty("/cost").splice(a,1)}this.getView().getModel("wcDetailModel").refresh();this.getView().setModel(r,"wcDetailModel")},onCCStartDateChange:function(e){var t=e.getSource();var a=t.getDateValue();var r=t.getBindingInfo("dateValue").binding.getContext().getPath();var s=t.getBindingInfo("dateValue").binding.getModel();var l=r.split("/")[2];if(l>0){var i=parseInt(l)-1;var n="/cost/"+i;s.getProperty(n).Endda=new Date(a.getTime()-24*60*60*1e3);s.refresh()}},onCCEndDateChange:function(e){var t=e.getSource();var a=t.getDateValue();var r=t.getBindingInfo("dateValue").binding.getContext().getPath();var s=t.getBindingInfo("dateValue").binding.getModel();var l=r.split("/")[2];var i=t.getBindingInfo("dateValue").binding.getModel().getData().cost.length;if(l<i-1){var n=parseInt(l)+1;var o="/cost/"+n;var c=s.getProperty(o).Begda;if(c!==null){s.getProperty(r).Endda=new Date(c.getTime()-24*60*60*1e3);s.refresh()}}},invokeMessage:function(e){g.createMessagePopover(e,"Error")},wcCapacityPress:function(e){this._showWcCapacityDetail(e.getSource())},_showWcCapacityDetail:function(e){var t=e.oBindingContexts.wcDetailModel.sPath;this.getRouter().navTo("wccapacity",{itemPath:encodeURIComponent(t)})},wcCostingPress:function(e){this._showWcCostingDetail(e.getSource())},_showWcCostingDetail:function(e){var t=e.oBindingContexts.wcDetailModel.sPath;this.getRouter().navTo("wccosting",{itemPath:encodeURIComponent(t)})},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var a=[];var r,s=this._getMessagePopover();if(typeof e==="string"){a.push({type:t,title:e,message:e})}else if(Array.isArray(e)){a=e;for(var l=0;l<a.length;l++){a[l].message=a[l].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var l=0;l<a.length;l++){r=new o({message:a[l].message,type:a[l].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(r)}s.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(a.length+"")},onAfterRendering:function(){this.attachRequest()},attachRequest:function(){var e=this.getView().createId("clsFrag");var t=this.getView().createId("charFrag");var a=sap.ui.core.Fragment.byId(e,"type");var r=sap.ui.core.Fragment.byId(e,"class");var s=sap.ui.core.Fragment.byId(e,"status");var l=sap.ui.core.Fragment.byId(t,"charName");var i=sap.ui.core.Fragment.byId(t,"charValue");var o=sap.ui.core.Fragment.byId(t,"charValueAdd");var c=sap.ui.core.Fragment.byId(t,"charValueClear");var u=sap.ui.core.Fragment.byId(t,"charValueDelete");var g=this;o.attachPress(function(e){n.handleSelCharAdd(e)});c.attachPress(function(e){n.handleCharClear(e)});u.attachPress(function(e){n.charRowDeletePress(e)});i.attachChange(function(e){g.onChange(e)})},valueHelpSelect:function(e){var t=this.getObTab();var a=e.getSource().getId().split("tskL--");a=a[1];if(e.getSource().getId().indexOf("type")>-1){n.valueHelpClassSelect("type",this,t,e)}else if(e.getSource().getId().indexOf("class")>-1){n.valueHelpClassSelect("class",this,t,e)}else if(e.getSource().getId().indexOf("status")>-1){n.valueHelpClassSelect("status",this,t,e)}else if(e.getSource().getId().indexOf("charName")>-1){n.valueHelpCharSelect("charName",this,t,e)}else if(e.getSource().getId().indexOf("charValue")>-1){var r=e.getSource().getParent().getBindingContext().getPath();n.valueHelpCharSelect("charValue",this,t,e,r)}},onChange:function(e){var t=this.getObTab();var a=e.getSource().getId().split("tskL--");a=a[1];if(e.getSource().getId().indexOf("type")>-1){n.onClassChange("type",this,t,e)}else if(e.getSource().getId().indexOf("class")>-1){n.onClassChange("class",this,t,e)}else if(e.getSource().getId().indexOf("status")>-1){n.onClassChange("status",this,t,e)}else if(e.getSource().getId().indexOf("charName")>-1){n.onCharChange("charName",this,e)}else if(e.getSource().getId().indexOf("charValue")>-1){n.onCharChange("charValue",this,e)}},onCharChange:function(e){var t=this.getObTab(this.oModelName);var a=e.getSource().getId().split("tskL--");a=a[1];if(e.getSource().getId().indexOf("charValueAdd")>-1){n.handleSelCharAdd("charValueAdd",this,t,e)}else if(e.getSource().getId().indexOf("charValueClear")>-1){n.handleCharClear("charValueClear",this,t,e)}else if(e.getSource().getId().indexOf("status")>-1){n.onClassChange("status",this,t,e)}else if(e.getSource().getId().indexOf("charName")>-1){n.onCharChange("charName",this,e)}},onControlAreaVH:function(e){c.ControlAreaVH(this,e)},onControlAreaChange:function(e){c.ControlAreaChange(this,e)},handleClassRowAdd:function(){var e=this.getObTab();n.classRowAddPress(this,e)},handleCharRowAdd:function(){n.charRowAddPress(this)},handleCharRowDelete:function(e){var t=this.getObTab();n.charRowDeletePress(e,this,t)},handleClassRowDelete:function(e){n.classRowDeletePress(e,this)},onClassSelect:function(e){n.classSelectPress(e,this)},onSelect:function(e){n.selectPress(e,this)}})});