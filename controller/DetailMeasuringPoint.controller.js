sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","ugiaiwui/mdg/aiw/request/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider","sap/ui/core/message/Message","sap/m/BusyDialog","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV"],function(e,t,a,r,s,i,o,n,l,g,d,u){"use strict";return e.extend("ugiaiwui.mdg.aiw.request.controller.DetailMeasuringPoint",{formatter:r,detailFlag:true,oAttach:[],oFileUpload:"",charFlag:"",codeFlag:"",objSelectDialog:undefined,eSelectDialog:undefined,fSelectDialog:undefined,msTypSelectDialog:undefined,cSelectDialog:undefined,cgSelectDialog:undefined,classType:"",_class:"",defaultCharArr:[],charValueArr:[],lArray:[],singleVal:"",charValue:"",cPath:"",sPath:"",resultArr:[],system:false,onInit:function(){this._oView=this.getView();this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()));this.getRouter().getRoute("detailMspt").attachPatternMatched(this._onRouteMatched,this);var e=this._oComponent.getModel();e.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(e);var a=this._oComponent.getModel("NewModel");this.getView().setModel(a,"valueHelp");var r=this._oComponent.getModel("NewModel2");this.getView().setModel(r,"valueHelp2");this.oAttach=[];this.resultArr=[];this.oModelUpdateFlag=false;this.oModelName="AIWMSPT";var s=this.getView().createId("clsFrag");var i=this.getView().createId("charFrag");var o=this.getView().createId("lamFrag");this.class=sap.ui.core.Fragment.byId(s,"assignmentTab");this.char=sap.ui.core.Fragment.byId(i,"characteristicsTab");this.lam=sap.ui.core.Fragment.byId(o,"lamSimpleForm");var n=this.getView().createId("lamAprvFrag");this.lamAprvSF=sap.ui.core.Fragment.byId(n,"lamSimpleForm");var l={titleName:this.getOwnerComponent().getModel("i18n").getProperty("createMsptTitle"),visible:false,enabled:true};var d={createVisible:true,approveVisible:false,approveVisibleLin:false};this.getView().setModel(new t(l),"mainView");this.getView().setModel(new t(d),"ApproveModel");this.isLam();this.getClassType(this);var u=sap.ui.getCore().getMessageManager();this.getView().setModel(u.getMessageModel(),"message");u.registerObject(this.getView(),true);this.BusyDialog=new g},isLam:function(){var e=this;var t=this.getView().getModel("valueHelp");t.read("/LAM_switchSet('')",{success:function(t,a){e.lamSwitch=t.lam_switch;var r=e.getView().getModel(e.oModelName);if(e.viewName==="Approve"){e.lam.setVisible(false);e.lamAprvSF.setModel(r,"AIWLAM")}else if(r.getData().Mptyp==="L"&&e.lamSwitch==="X"){e.lam.setVisible(true);e.lam.setModel(r,"AIWLAM")}else{e.lam.setVisible(false)}},error:function(e){}})},onInactiveSelect:function(e){var t=e.getSource().getModel(this.oModelName).getData();t.Deact=e.getSource().getSelected()},_onRouteMatched:function(e){var a=this;var r=e.getParameter("name");if(r==="detailMspt"){var s=sap.ui.getCore().getModel("ClassAttachRequest");var i=s.getData();if(i.attachMsptFlag){this.attachRequest();i.attachMsptFlag=false;s.setData(i)}this.rowIndex=decodeURIComponent(e.getParameter("arguments").Path);this.viewName=e.getParameter("arguments").ViewName;this.oModelUpdateFlag=false;var o=[],n=[],l;var g=true;var d=this.getView().getModel("mainView");var u=this.getView().getModel("ApproveModel");var p=d.getData();var c=u.getData();var m=new t;p.enabled=true;this.getView().byId("idBtnCheck").setVisible(true);if(sap.ui.getCore().getModel("refreshModel")!==undefined){var M=sap.ui.getCore().getModel("refreshModel");M.setProperty("/refreshSearch",false)}if(this.viewName==="CreateMspt"){m.setData(sap.ui.getCore().getModel(this.oModelName).getProperty(this.rowIndex));this.oAttach=[];this.getView().setModel(m,this.oModelName);if(m.getData().viewParameter==="change"){if(m.getData().ObtypMs===""||m.getData().ObtypMs===undefined){m.getData().ObtypMsEnabled=true}else{m.getData().ObtypMsEnabled=false}if(m.getData().Equnr===""||m.getData().Equnr===undefined){m.getData().EqunrEnabled=true}else{m.getData().EqunrEnabled=false}if(m.getData().Tplnr===""||m.getData().Tplnr===undefined){m.getData().TplnrEnabled=true}else{m.getData().TplnrEnabled=false}if(m.getData().Tplnr===""||m.getData().Tplnr===undefined){m.getData().TplnrEnabled=true}else{m.getData().TplnrEnabled=false}if(m.getData().Mptyp===""||m.getData().Mptyp===undefined){m.getData().MptypEnabled=true}else{m.getData().MptypEnabled=false}if(m.getData().AtnamMs===""||m.getData().AtnamMs===undefined){m.getData().AtnamMsEnabled=true}else{m.getData().AtnamMsEnabled=false}m.getData().MspointEnabled=false;p.titleName=this.getOwnerComponent().getModel("i18n").getProperty("changeMspt")}else{m.getData().MspointEnabled=true;m.getData().ObtypMsEnabled=true;m.getData().MptypEnabled=true;m.getData().AtnamMsEnabled=true;p.titleName=this.getOwnerComponent().getModel("i18n").getProperty("createMspt")}if(m.getData().Mptyp==="L"&&a.lamSwitch==="X"){this.lam.setVisible(true);this.lam.setModel(m,"AIWLAM")}else{this.lam.setVisible(false)}o=m.getData().classItems;this.chData=m.getData().characteristics;if(this.chData.length>0){if(o.length>0){for(var T=0;T<this.chData.length;T++){if(o[0].Class===this.chData[T].Class){n.push(this.chData[T])}}}}l=m.getData().charNewButton}if(this.viewName==="ChangeMspt"){var f=e.getParameter("arguments").CrStatus;var h=e.getParameter("arguments").Mspt;p.titleName=this.getOwnerComponent().getModel("i18n").getProperty("changeMspt");if(f==="true"){g=false;l=false;p.enabled=false}this.sExistFlag=false;var C;var v=sap.ui.getCore().getModel(this.oModelName).getData();if(v.length>0){for(var S=0;S<v.length;S++){if(v[S].Mspoint===h){C=S;this.sExistFlag=true;break}}}if(this.sExistFlag){o=v[C].classItems;this.chData=v[C].characteristics;if(this.chData.length>0){if(o.length>0){for(var T=0;T<this.chData.length;T++){if(o[0].Class===this.chData[T].Class){n.push(this.chData[T])}}}}l=v[C].charNewButton;v[C].MspointEnabled=false;v[C].ObtypMsEnabled=false;v[C].EqunrEnabled=false;v[C].TplnrEnabled=false;v[C].MptypEnabled=false;v[C].AtnamMsEnabled=false;this.getView().setModel(new t(v[C]),this.oModelName);if(v[C].Mptyp==="L"&&a.lamSwitch==="X"){this.lam.setVisible(true)}else{this.lam.setVisible(false)}}else{this.readMeasuringPointData(h,f)}}if(this.viewName==="Approve"){this.getView().byId("idBtnCheck").setVisible(false);m.setData(sap.ui.getCore().getModel(this.oModelName).getProperty(this.rowIndex));m.getData().MspointEnabled=false;m.getData().ObtypMsEnabled=false;m.getData().EqunrEnabled=false;m.getData().TplnrEnabled=false;m.getData().MptypEnabled=false;m.getData().AtnamMsEnabled=false;this.getView().setModel(m,this.oModelName);var b=new t;var D=sap.ui.getCore().getModel("AIWAPPROVE").getProperty("/AIWMSPT"+this.rowIndex);b.setData(D);this.getView().setModel(b,"AIWAPPROVE");p.titleName=this.getOwnerComponent().getModel("i18n").getProperty("approveMspt");p.enabled=false;c.createVisible=false;c.approveVisible=true;c.approveVisibleLin=false;this.lam.setVisible(c.createVisible);this.lamAprvSF.setModel(m,"AIWLAM")}var y=this.getView().createId("clsFrag");var x=sap.ui.core.Fragment.byId(y,"newHeader");x.setEnabled(g);this.class.setModel(new t(o));this.char.setModel(new t(n));this.class.setVisible(c.createVisible);this.char.setVisible(c.createVisible);if(this.viewName==="Approve"){var I=this.getView().createId("lamAprvFrag");var E=sap.ui.core.Fragment.byId(I,"idPanelLinDataAprv");if(this.lamSwitch==="X"){E.setVisible(true);c.approveVisibleLin=true}else{E.setVisible(false);c.approveVisibleLin=false}}d.setData(p);u.setData(c)}else{return}},attachModelEventHandlers:function(e){e.attachPropertyChange(this.handlePropertyChanged,this)},handlePropertyChanged:function(){this.oModelUpdateFlag=true},valueHelpFunSelect:function(e){var t=e.getSource().getBindingInfo("value").binding.sPath;if(t.indexOf("/ObtypMs")!==-1){o.valueHelpMeasPointObj(e.getSource().getModel(this.oModelName).getData(),this)}else if(t.indexOf("/Equnr")!==-1){o.valueHelpFunEquipment(e,this)}else if(t.indexOf("/Tplnr")!==-1){o.valueHelpFunFloc(e,this)}else if(t.indexOf("/Mptyp")!==-1){o.valueHelpFunMsptCat(e.getSource().getModel(this.oModelName).getData(),this)}else if(t.indexOf("/AtnamMs")!==-1){o.valueHelpFunChar(e.getSource().getModel(this.oModelName).getData(),this)}else if(t.indexOf("/Codgr")!==-1){o.valueHelpFunCodeGrp(e.getSource().getModel(this.oModelName).getData(),this)}else if(t.indexOf("/Decim")!==-1){o.valueHelpDecimalPlace(e.getSource().getModel(this.oModelName).getData(),this)}},measPointObjChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().ObtypMs;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().ObtypMs="";e.getSource().getModel(t.oModelName).getData().Txt=""}e.getSource().setValueState("None")},onMeasPointObjChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().ObtypMs;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().ObtypMs="";e.getSource().getModel(t.oModelName).getData().Txt=""}else{e.getSource().getModel(t.oModelName).getData().ObtypMs=a.toUpperCase();o._changeMeasPointObject(e.getSource().getModel(t.oModelName).getData(),t)}},measPontCatChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().Mptyp;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().Mptyp="";e.getSource().getModel(t.oModelName).getData().Mpttx=""}e.getSource().setValueState("None")},onmeasPointCatChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().Mptyp;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().Mptyp="";e.getSource().getModel(t.oModelName).getData().Mpttx=""}else{e.getSource().getModel(t.oModelName).getData().Mptyp=a.toUpperCase();o._changeMeasPointCategory(e.getSource().getModel(t.oModelName).getData(),t)}},charNameChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().AtnamMs;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().AtnamMs="";e.getSource().getModel(t.oModelName).getData().Atbez=""}e.getSource().setValueState("None")},onCharNameChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().AtnamMs;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().AtnamMs="";e.getSource().getModel(t.oModelName).getData().Atbez=""}else{e.getSource().getModel(t.oModelName).getData().AtnamMs=a.toUpperCase();o._changeCharacteristicName(e.getSource().getModel(t.oModelName).getData(),t)}},onDeciPlaceChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().Decim;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().Decim=""}else{e.getSource().getModel(t.oModelName).getData().Decim=a.toUpperCase();o._changeDecimalPlace(e.getSource().getModel(t.oModelName).getData(),t)}},codeGrpChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().Codgr;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().Codgr="";e.getSource().getModel(t.oModelName).getData().Codgrtxt=""}e.getSource().setValueState("None")},onCodeGrpChange:function(e){var t=this;var a=e.getSource().getModel(t.oModelName).getData().Codgr;if(a===""||a===undefined){e.getSource().getModel(t.oModelName).getData().Codgr="";e.getSource().getModel(t.oModelName).getData().CodgrVS="None";e.getSource().getModel(t.oModelName).getData().CodgrVST="";e.getSource().getModel(t.oModelName).getData().Codgrtxt=""}else{e.getSource().getModel(t.oModelName).getData().Codgr=a.toUpperCase();o._changeCodeGroup(e.getSource().getModel(t.oModelName).getData(),t)}},onValCodeSelect:function(e){var t=this;var a=e.getParameters().selected;e.getSource().getModel(t.oModelName).getData().AtnamMsVS="None";e.getSource().getModel(t.oModelName).getData().CodgrVS="None";if(a){e.getSource().getModel(t.oModelName).getData().Cdsuf=true}else{e.getSource().getModel(t.oModelName).getData().Cdsuf=false}},onCounterSelect:function(e){var t=this;var a=e.getParameters().selected;e.getSource().getModel(t.oModelName).getData().AtnamMsVS="None";e.getSource().getModel(t.oModelName).getData().CodgrVS="None";e.getSource().getModel(t.oModelName).getData().Desir="";e.getSource().getModel(t.oModelName).getData().Cjumc="";e.getSource().getModel(t.oModelName).getData().Pyeac="";if(a){e.getSource().getModel(t.oModelName).getData().Indct=true;e.getSource().getModel(t.oModelName).getData().countEnable=true;e.getSource().getModel(t.oModelName).getData().tEnable=false;e.getSource().getModel(t.oModelName).getData().Cdsuf=false}else{e.getSource().getModel(t.oModelName).getData().Indct=false;e.getSource().getModel(t.oModelName).getData().countEnable=false;e.getSource().getModel(t.oModelName).getData().tEnable=true}},onDonePress:function(e){var t=this;t.doneFlag=true;var r=t.getView().getModel("i18n").getResourceBundle();var s=e.getSource().getId();if(t.viewName==="CreateMspt"||t.oModelUpdateFlag===true){t.handleValueState("Pttxt","PttxtVS",e);t.handleValueState("ObtypMs","ObtypMsVS",e);t.handleValueState("Mptyp","MptypVS",e);var i=e.getSource().getModel(t.oModelName).getData().EqunrInpVis;if(i){t.handleValueState("Equnr","EqunrVS",e)}var o=e.getSource().getModel(t.oModelName).getData().TplnrInpVis;if(o){t.handleValueState("Tplnr","TplnrVS",e)}var n=e.getSource().getModel(t.oModelName).getData().tEnable;if(n){var l=e.getSource().getModel(t.oModelName).getData().DesirVS;if(l==="Error"){t.doneFlag=false;t.invokeMessage(r.getText("msptTargetExdMand"));return}}if(t.doneFlag){var g;var d=e.getSource().getModel(t.oModelName).getData().AtnamMs;var u=e.getSource().getModel(t.oModelName).getData().Codgr;if(e.getSource().getModel(t.oModelName).getData().Indct===true&&(d===""||d===undefined)){g=t.getView().getModel("i18n").getProperty("MCOUNTER_CHAR_ERR");t.invokeMessage(g);return}if(e.getSource().getModel(t.oModelName).getData().Cdsuf===true&&(u===""||u===undefined)){g=t.getView().getModel("i18n").getProperty("VCODE_ERR");t.invokeMessage(g);return}if((d===""||d===undefined)&&(u===""||u===undefined)){g=t.getView().getModel("i18n").getProperty("CHAR_CODE_ERR");t.invokeMessage(g);return}}}if(t.doneFlag===false){var p=t.getView().getModel("i18n").getProperty("MANDMSG");t.invokeMessage(p);return}else{var c=t.getView().getModel(t.oModelName);var m=c.getData();if(t.class.getModel()){var M=t.class.getModel().getData();if(M){m.classItems=[];for(var T=0;T<M.length;T++){m.classItems.push(M[T])}c.setData(m)}}if(this.chData){var f=this.chData;if(f!==null&&f!==undefined){m.characteristics=[];for(var h=0;h<f.length;h++){m.characteristics.push(f[h])}}c.setData(m)}if(s.indexOf("idBtnCheck")>-1){this.validateCheck();return}this.chData=[];if(t.oModelUpdateFlag&&!t.sExistFlag){var C=sap.ui.getCore().getModel(t.oModelName).getData();t.getView().getModel(t.oModelName).getData().viewParameter="change";C.push(t.getView().getModel(t.oModelName).getData())}sap.ui.getCore().getModel(t.oModelName).refresh();t.currentFragment=undefined;t.rowIndex=undefined;var v=a.getInstance().getPreviousHash();if(v!==undefined){history.go(-1)}else{t.getRouter().navTo("main",{},true)}}},validateCheck:function(){var e=this;var t=e.getView().getModel(e.oModelName).getData();var a=sap.ui.getCore().getModel("AIWFLOC").getData();var s=sap.ui.getCore().getModel("AIWEQUI").getData();var i=sap.ui.getCore().getModel("tempCrTypeModel").getData();var o={ChangeRequestType:i.crtype,CrDescription:i.desc,IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLAddrI:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqAddrI:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};if(a.length>0){for(var n=0;n<a.length;n++){var l={Tplnr:a[n].Functionallocation,Txtmi:a[n].Flocdescription,TplkzFlc:a[n].Strucindicator,Tplxt:a[n].StrucIndicatorDesc,EditMask:a[n].EditMask,Hierarchy:a[n].Hierarchy,Fltyp:a[n].Floccategory,Flttx:a[n].FlocCategoryDesc,Swerk:a[n].Maintplant,Plantname:a[n].MaintplantDesc,StorFloc:a[n].Location,Locationdesc:a[n].Locationdesc,Abckzfloc:a[n].Abckz,Abctx:a[n].Abctx,Bukrsfloc:a[n].Bukrs,Butxt:a[n].Butxt,City:a[n].City,KostFloc:a[n].Kostl,KokrFloc:a[n].Kokrs,Contareaname:a[n].Mctxt,PlntFloc:a[n].Werks,Planningplantdes:a[n].Planningplantdes,Ingrp:a[n].Ingrp,Plannergrpdesc:a[n].Innam,Arbplfloc:a[n].Arbpl,Wergwfloc:a[n].WcWerks,Gewrkfloc:a[n].MainArbpl,MainWcPlant:a[n].MainWerks,Tplma:a[n].SupFunctionallocation,Supflocdesc:a[n].SupFlocdescription,BeberFl:a[n].BeberFl,Fing:a[n].Fing,Tele:a[n].Tele,Submtiflo:a[n].ConstrType,Constdesc:a[n].ConstructionDesc,Eqart:a[n].TechnicalObjectTyp,Eartx:a[n].Description,Stattext:a[n].Stattext,StsmFloc:a[n].StsmEqui,Statproftxt:a[n].StsmEquiDesc,UstwFloc:a[n].UstwEqui,UswoFloc:a[n].UswoEqui,UstaFloc:a[n].UstaEqui,Adrnri:a[n].Adrnri,Deact:a[n].Deact};o.FuncLoc.push(l);var g={Funcloc:a[n].Functionallocation,Title:a[n].TitleCode,Name1:a[n].Name1,Name2:a[n].Name2,Name3:a[n].Name3,Name4:a[n].Name4,Sort1:a[n].Sort1,Sort2:a[n].Sort2,NameCo:a[n].NameCo,PostCod1:a[n].PostCod1,City1:a[n].City1,Building:a[n].Building,Floor:a[n].Floor,Roomnum:a[n].Roomnum,Strsuppl1:a[n].Strsuppl1,Strsuppl2:a[n].Strsuppl2,Strsuppl3:a[n].Strsuppl3,Location:a[n].AddrLocation,RPostafl:a[n].RefPosta,Landx:a[n].Landx,TimeZone:a[n].TimeZone,RPostFl:a[n].Region,Regiotxt:a[n].RegionDesc};o.FLAddr.push(g);var d=a[n].intlAddr;if(d){for(var u=0;u<d.length;u++){o.FLAddrI.push(d[u])}}if(e.AltLblDerv==="2"&&a[n].altlbl){for(var p=0;p<a[n].altlbl.length;p++){var c={Funcloc:a[n].Functionallocation,AltAlkey:a[n].altlbl[p].AltAlkey,AltStrno:a[n].altlbl[p].AltStrno,AltTplkz:a[n].altlbl[p].AltTplkz};o.FLALTLBEL.push(c)}}if(a[n].Floccategory==="L"&&a[n].lam){var m={Funcloc:a[n].Functionallocation,Lrpid:a[n].lam.Lrpid,Strtptatr:a[n].lam.Strtptatr,Endptatr:a[n].lam.Endptatr,Length:a[n].lam.Length,LinUnit:a[n].lam.LinUnit,Startmrkr:a[n].lam.Startmrkr,Endmrkr:a[n].lam.Endmrkr,Mrkdisst:a[n].lam.Mrkdisst,Mrkdisend:a[n].lam.Mrkdisend,MrkrUnit:a[n].lam.MrkrUnit};o.FLLAM.push(m)}var M=a[n].classItems;if(M){if(M.length>0){for(var T=0;T<M.length;T++){var f={Funcloc:a[n].Functionallocation,Classtype:M[T].Classtype,Class:M[T].Class,Clstatus1:M[T].Clstatus1};o.FLClass.push(f)}}}var h=a[n].characteristics;if(h){if(h.length>0){for(var C=0;C<h.length;C++){var v={Funcloc:a[n].Functionallocation,Atnam:h[C].Atnam,Textbez:h[C].Textbez,Atwrt:h[C].Atwrt,Class:h[C].Class};o.FLVal.push(v)}}}}}if(s.length>0){for(var S=0;S<s.length;S++){var b={Herst:s[S].Herst,Equnr:s[S].Equnr,Txtmi:s[S].Eqktx,Swerk:s[S].Maintplant,Name1:s[S].MaintplantDesc,TplnEilo:s[S].Tplnr,Flocdescription:s[S].Pltxt,Eqtyp:s[S].EquipmentCatogory,Etytx:s[S].EquipCatgDescription,Eqart:s[S].TechnicalObjectTyp,Eartx:s[S].Description,Typbz:s[S].Typbz,SubmEeqz:s[S].ConstrType,Constdesc:s[S].ConstructionDesc,BukrEilo:s[S].Bukrs,Butxt:s[S].Butxt,HequEeqz:s[S].SuperordinateEquip,SuperordEqDes:s[S].SuperordinateEquipDesc,TidnEeqz:s[S].TechIdNum,KostEilo:s[S].Kostl,KokrEilo:s[S].Kokrs,Contareaname:s[S].Mctxt,StorEilo:s[S].Location,Locationdesc:s[S].Locationdesc,AbckEilo:s[S].Abckz,Abctx:s[S].Abctx,PplaEeqz:s[S].Werks,Planningplantdes:s[S].Planningplantdes,IngrEeqz:s[S].Ingrp,Plannergrpdesc:s[S].Innam,Serge:s[S].Serge,MapaEeqz:s[S].MapaEeqz,Stattext:s[S].Stattext,StsmEqui:s[S].StsmEqui,Statproftxt:s[S].StsmEquiDesc,UstwEqui:s[S].UstwEqui,UswoEqui:s[S].UswoEqui,UstaEqui:s[S].UstaEqui,Deact:s[S].Deact,Answt:s[S].Answt,Ansdt:e._formatDate(s[S].Ansdt),Waers:s[S].Waers,ArbpEilo:s[S].Arbpl,WorkCenterPlant:s[S].WcWerks,ArbpEeqz:s[S].MainArbpl,MainWcPlant:s[S].MainWerks,BebeEilo:s[S].BeberFl,Fing:s[S].Fing,Tele:s[S].Tele,HeqnEeqz:s[S].EquipPosition,Adrnri:s[S].Adrnri,Funcid:s[S].Funcid,Frcfit:s[S].Frcfit,Frcrmv:s[S].Frcrmv};o.Equipment.push(b);var D={Equi:s[S].Equnr,PlanvPrt:s[S].PlanvPrt,SteufPrt:s[S].SteufPrt,KtschPrt:s[S].KtschPrt,Ewformprt:s[S].Ewformprt,SteufRef:s[S].SteufRef,KtschRef:s[S].KtschRef,EwformRef:s[S].EwformRef};o.EqPRT.push(D);if(s[S].EquipmentCatogory==="L"&&s[S].lam){var y={Equi:s[S].Equnr,Lrpid:s[S].lam.Lrpid,Strtptatr:s[S].lam.Strtptatr,Endptatr:s[S].lam.Endptatr,Length:s[S].lam.Length,LinUnit:s[S].lam.LinUnit,Startmrkr:s[S].lam.Startmrkr,Endmrkr:s[S].lam.Endmrkr,Mrkdisst:s[S].lam.Mrkdisst,Mrkdisend:s[S].lam.Mrkdisend,MrkrUnit:s[S].lam.MrkrUnit};o.EqLAM.push(y)}var x={Equi:s[S].Equnr,Title:s[S].TitleCode,Name1:s[S].Name1,Name2:s[S].Name2,Name3:s[S].Name3,Name4:s[S].Name4,Sort1:s[S].Sort1,Sort2:s[S].Sort2,NameCo:s[S].NameCo,PostCod1:s[S].PostCod1,City1:s[S].City1,Building:s[S].Building,Floor:s[S].Floor,Roomnum:s[S].Roomnum,Strsuppl1:s[S].Strsuppl1,Strsuppl2:s[S].Strsuppl2,Strsuppl3:s[S].Strsuppl3,Location:s[S].AddrLocation,RefPosta:s[S].RefPosta,Landx:s[S].Landx,TimeZone:s[S].TimeZone,RfePost:s[S].Region,Regiotxt:s[S].RegionDesc};o.EqAddr.push(x);var I=s[S].intlAddr;if(I){for(var u=0;u<I.length;u++){o.EqAddrI.push(I[u])}}var E=s[S].classItems;if(E){if(E.length>0){for(var P=0;P<E.length;P++){var A={Equi:s[S].Equnr,Classtype:E[P].Classtype,Class:E[P].Class,Clstatus1:E[P].Clstatus1};o.EqClass.push(A)}}}var F=s[S].characteristics;if(F){if(F.length>0){for(var w=0;w<F.length;w++){var R={Equi:s[S].Equnr,Atnam:F[w].Atnam,Textbez:F[w].Textbez,Atwrt:F[w].Atwrt,Class:F[w].Class};o.EqVal.push(R)}}}}}var V={Point:t.Mspoint,Equnr:t.Equnr,Eqktx:t.Eqktx,Tplnr:t.Tplnr,Floctxt:t.Pltxt,Mptyp:t.Mptyp,Mpttx:t.Mpttx,Codgr:t.Codgr,Codgrtxt:t.Codgrtxt,ObtypMs:t.ObtypMs,Objtypetxt:t.Txt,AtnamMs:t.AtnamMs,Atbez:t.Atbez,Indct:t.Indct,Cdsuf:t.Cdsuf,Cjumc:t.Cjumc,Desir:t.Desir,Pyeac:t.Pyeac,Mrmin:t.Mrmin,Mrmax:t.Mrmax,Pttxt:t.Pttxt,Psort:t.Psort,Inact:t.Inact,Mseh6:t.Mseh6,Msehl:t.Msehl,Decim:t.Decim.toString(),Locas:t.Locas,Maktx:t.Maktx,Begru:t.Begru,Begtx:t.Begtx,Expon:t.Expon,Mrngu:t.Mrngu,Dstxt:t.Dstxt,Indrv:t.Indrv,Indtr:t.readTransfSel,Trans:t.readTransfs};o.MSPoint.push(V);if(t.Mptyp==="L"&&t.lam){var N={Mspoint:t.Mspoint,Lrpid:t.lam.Lrpid,Strtptatr:t.lam.Strtptatr,Endptatr:t.lam.Endptatr,Length:t.lam.Length,LinUnit:t.lam.LinUnit,Startmrkr:t.lam.Startmrkr,Endmrkr:t.lam.Endmrkr,Mrkdisst:t.lam.Mrkdisst,Mrkdisend:t.lam.Mrkdisend,MrkrUnit:t.lam.MrkrUnit};o.MSLAM.push(N)}var q=t.classItems;if(q){if(q.length>0){for(var L=0;L<q.length;L++){var k={Mspoint:t.Mspoint,Classtype:q[L].Classtype,Class:q[L].Class,Clstatus1:q[L].Clstatus1};o.MSClass.push(k)}}}var O=t.characteristics;if(O){if(O.length>0){for(var B=0;B<O.length;B++){var H={Mspoint:t.Mspoint,Atnam:O[B].Atnam,Textbez:O[B].Textbez,Atwrt:O[B].Atwrt,Class:O[B].Class};o.MSVal.push(H)}}}if(o.FLAddrI.length>0){o.FLAddrI=$.map(o.FLAddrI,function(e){return $.extend(true,{},e)});for(var B=0;B<o.FLAddrI.length>0;B++){delete o.FLAddrI[B].AdNationEnable;delete o.FLAddrI[B].City1iVS;delete o.FLAddrI[B].StreetiVS}}if(o.EqAddrI.length>0){o.EqAddrI=$.map(o.EqAddrI,function(e){return $.extend(true,{},e)});for(var B=0;B<o.EqAddrI.length>0;B++){delete o.EqAddrI[B].AdNationEnable;delete o.EqAddrI[B].City1iVS;delete o.EqAddrI[B].StreetiVS}}this.getView().byId("msptPage").setBusy(true);var U=this.getView().getModel();U.create("/ChangeRequestSet",o,{success:function(t){e.getView().byId("msptPage").setBusy(false);var a=t;var s=[];for(var i=0;i<a.Messages.results.length;i++){s.push({type:r.getMessageType(a.Messages.results[i].Type),title:a.Messages.results[i].Message})}e.createMessagePopover(s,"")},error:function(t){e.getView().byId("msptPage").setBusy(false);var a=[],r=[];if(JSON.parse(t.responseText).error.innererror.errordetails===undefined||JSON.parse(t.responseText).error.innererror.errordetails.length===0){a[0]=JSON.parse(t.responseText).error.message.value}else{for(var s=0;s<JSON.parse(t.responseText).error.innererror.errordetails.length;s++){a[s]=JSON.parse(t.responseText).error.innererror.errordetails[s].message}}var i=a.join("\n");sap.m.MessageBox.show(i,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var a=[];var r,s=this._getMessagePopover();if(typeof e==="string"){a.push({type:t,title:e,message:e})}else if(Array.isArray(e)){a=e;for(var i=0;i<a.length;i++){a[i].message=a[i].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var i=0;i<a.length;i++){r=new l({message:a[i].message,type:a[i].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(r)}s.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(a.length+"")},onTargetValueChange:function(){var e=this;var t=e.getView().getModel("i18n").getResourceBundle();var a=this.getView().getModel("AIWMSPT");var r=a.getData();if(r.Desir!==""&&r.Mrmax!==""&&r.Mrmin!==""){if(parseInt(r.Desir)<=parseInt(r.Mrmax)&&parseInt(r.Desir)>=parseInt(r.Mrmin)){r.DesirVS="None";r.DesirVST=""}else{r.DesirVS="Error";r.DesirVST=t.getText("msptTargetExdMand")}}else if(r.Desir!==""&&r.Mrmax!==""){if(parseInt(r.Desir)<=parseInt(r.Mrmax)){r.DesirVS="None";r.DesirVST=""}else{r.DesirVS="Error";r.DesirVST=t.getText("msptTargetExdMand")}}else if(r.Desir!==""&&r.Mrmin!==""){if(parseInt(r.Desir)>=parseInt(r.Mrmin)){r.DesirVS="None";r.DesirVST=""}else{r.DesirVS="Error";r.DesirVST=t.getText("msptTargetExdMand")}}else{r.DesirVS="None";r.DesirVST=""}a.setData(r)},onMeasReadTransPress:function(){if(!this.dlgMSPTTransfer){this.dlgMSPTTransfer=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.MeasPointTransfer",this);this.getView().addDependent(this.dlgMSPTTransfer)}var e=this.getView().getModel("AIWMSPT");var t=e.getData();sap.ui.getCore().byId("lowerRange").setText(t.Mrmin);sap.ui.getCore().byId("upperRange").setText(t.Mrmax);sap.ui.getCore().byId("measRangeLimit").setText(t.Mseh6);sap.ui.getCore().byId("transSuppl").setSelected(false);sap.ui.getCore().byId("readingTrans").setText();sap.ui.getCore().byId("validFrom").setText();sap.ui.getCore().byId("timeMain").setText("00:00:00");sap.ui.getCore().byId("measPosition").setText();sap.ui.getCore().byId("mpDesc").setText();sap.ui.getCore().byId("RTfloc").setText();sap.ui.getCore().byId("RTflocdesc").setText();sap.ui.getCore().byId("RTequi").setText();sap.ui.getCore().byId("RTequidesc").setText();if(t.readTransfSel){sap.ui.getCore().byId("transSuppl").setSelected(true)}if(t.RT){if(t.RT.readTransf){sap.ui.getCore().byId("readingTrans").setText(t.RT.readTransf)}if(t.RT.RTValidFrom){sap.ui.getCore().byId("validFrom").setText(t.RT.RTValidFrom)}if(t.RT.RTTime){sap.ui.getCore().byId("timeMain").setText(t.RT.RTTime)}if(t.RT.RTMeasPos){sap.ui.getCore().byId("measPosition").setText(t.RT.RTMeasPos)}if(t.RT.RTMpDesc){sap.ui.getCore().byId("mpDesc").setText(t.RT.RTMpDesc)}if(t.RT.RTFloc){sap.ui.getCore().byId("RTfloc").setText(t.RT.RTFloc)}if(t.RT.RTFlocDesc){sap.ui.getCore().byId("RTflocdesc").setText(t.RT.RTFlocDesc)}if(t.RT.RTEqui){sap.ui.getCore().byId("RTequi").setText(t.RT.RTEqui)}if(t.RT.RTEquiDesc){sap.ui.getCore().byId("RTequidesc").setText(t.RT.RTEquiDesc)}}if(sap.ui.getCore().byId("RTfloc").getText()===""&&sap.ui.getCore().byId("RTequi").getText()!==""){sap.ui.getCore().byId("RTequi").setVisible(true);sap.ui.getCore().byId("RTequidesc").setVisible(true);sap.ui.getCore().byId("RTfloc").setVisible(false);sap.ui.getCore().byId("RTflocdesc").setVisible(false)}else{sap.ui.getCore().byId("RTequi").setVisible(false);sap.ui.getCore().byId("RTequidesc").setVisible(false);sap.ui.getCore().byId("RTfloc").setVisible(true);sap.ui.getCore().byId("RTflocdesc").setVisible(true)}this.dlgMSPTTransfer.open()},onTransferOKPress:function(){var e=this.getView().getModel("AIWMSPT");var t=e.getData();t.readTransfSel=true;t.readTransf=sap.ui.getCore().byId("readingTrans").getText();t.RT={};t.RT.readTransf=sap.ui.getCore().byId("readingTrans").getText();t.RT.RTValidFrom=sap.ui.getCore().byId("validFrom").getText();t.RT.RTTime=sap.ui.getCore().byId("timeMain").getText();t.RT.RTMeasPos=sap.ui.getCore().byId("measPosition").getText();t.RT.RTMpDesc=sap.ui.getCore().byId("mpDesc").getText();t.RT.RTFloc=sap.ui.getCore().byId("RTfloc").getText();t.RT.RTFlocDesc=sap.ui.getCore().byId("RTflocdesc").getText();t.RT.RTEqui=sap.ui.getCore().byId("RTequi").getText();t.RT.RTEquiDesc=sap.ui.getCore().byId("RTequidesc").getText();e.setData(t);this.dlgMSPTTransfer.close()},onTransferCancelPress:function(){this.dlgMSPTTransfer.close()},onTransferChange:function(e){var t=e.getSource().getKey();e.getSource().getParent().setSelectedKey(t);switch(t){case"structure":this.onStructurePress();break;case"History":this.onHistoryPress();break;case"propAssign":this.onProposeAssignmentPress();break;case"AssignManual":this.onAssignManuallyPress();break;case"cancel":this.onCancelTransferPress();break}},onHistoryPress:function(){var e=this;if(!this.dlgHistory){this.dlgHistory=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.History",this);this.getView().addDependent(this.dlgHistory)}this.readTransferData("HISTORY")},onHistoryClosePress:function(){this.dlgHistory.close()},readTransferData:function(e){var a=this;var s=this.getView().getModel("AIWMSPT");var i=s.getData();var o=this.getView().getModel();var n="/MSPointSet";var l={Equnr:i.Equnr,Tplnr:i.Tplnr,Mptyp:i.Mptyp,Pttxt:i.Pttxt,ObtypMs:i.ObtypMs,AtnamMs:i.AtnamMs,Mseh6:i.Mseh6,Decim:i.Decim,Indct:i.Indct,Point:i.Mspoint,Trans:sap.ui.getCore().byId("readingTrans").getText(),Action:e,MspHier_N:[],DataOrigin:[],MSPTAssign:[],History_N:[]};var d={Trans:sap.ui.getCore().byId("readingTrans").getText(),Datlo:r._formatDate(sap.ui.getCore().byId("validFrom").getText()),Timlo:r._timeConvert(sap.ui.getCore().byId("timeMain").getText()),Psort:sap.ui.getCore().byId("measPosition").getText(),Pttxt:sap.ui.getCore().byId("mpDesc").getText(),Tplnr:sap.ui.getCore().byId("RTfloc").getText(),Pltxt:sap.ui.getCore().byId("RTflocdesc").getText(),Equnr:sap.ui.getCore().byId("RTequi").getText(),Eqktx:sap.ui.getCore().byId("RTequidesc").getText()};l.DataOrigin.push(d);var u=new g;u.open();o.create(n,l,{success:function(r){u.close();if(e==="HISTORY"){var s=r.History_N.results;if(r.Equnr!==""){sap.ui.getCore().byId("measPointObject").setText(r.Equnr);sap.ui.getCore().byId("measPointObjectDesc").setText(r.Eqktx)}else if(r.Tplnr!==""){sap.ui.getCore().byId("measPointObject").setText(r.Tplnr);sap.ui.getCore().byId("measPointObjectDesc").setText(r.Floctxt)}sap.ui.getCore().byId("mspt").setText(r.Point);sap.ui.getCore().byId("msptDesc").setText(r.Pttxt);sap.ui.getCore().byId("measPos").setText(r.Psort);sap.ui.getCore().byId("delFlag").setText(r.LvormMs);sap.ui.getCore().byId("charName").setText(r.AtnamMs);sap.ui.getCore().byId("mpInactive").setText(r.Inact);var i=sap.ui.getCore().byId("itemDetails");var o=new t(s);i.setModel(o);if(s.length>0){sap.ui.getCore().byId("export").setEnabled(true)}else{sap.ui.getCore().byId("export").setEnabled(false)}a.dlgHistory.open()}},error:function(e){u.close();var t=[],a=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var s=t.join("\n");sap.m.MessageBox.show(s,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},OnExportPress:sap.m.Table.prototype.exportData||function(){var e=sap.ui.getCore().byId("itemDetails").getModel();var t=new d({exportType:new u({separatorChar:"\t",mimeType:"application/vnd.ms-excel",charset:"utf-8",fileExtension:"xls"}),models:e,rows:{path:"/"},columns:[{name:"Valid From",template:{content:"{path:'Datlo', formatter:'.formatter.dateFormat'}"}},{name:"Time",template:{content:"{path:'Timlo', formatter:'.formatter.getTime'}"}},{name:"Valid To",template:{content:"{path:'Dathi', formatter:'.formatter.dateFormat'}"}},{name:"Time",template:{content:"{path:'Timhi', formatter:'.formatter.getTime'}"}},{name:"Reversal Indicator",template:{content:"{Cancl}"}},{name:"MeasPoint Object",template:{content:"{Mpobk}"}},{name:"Description",template:{content:"{Mpobt}"}},{name:"Measurment Position",template:{content:"{Psort}"}},{name:"Reading Transfer",template:{content:"{Trans}"}},{name:"Description",template:{content:"{Pttxt}"}},{name:"MeasPoint Inactive",template:{content:"{Inact}"}},{name:"Deletion Flag",template:{content:"{Lvorm}"}},{name:"Characteristic Name",template:{content:"{Atnam}"}},{name:"Created On",template:{content:"{path:'Datlo', formatter:'.formatter.dateFormat'}"}},{name:"Created By",template:{content:"{Namcr}"}}]});t.saveFile().catch(function(e){}).then(function(){t.destroy()})},onAssignManuallyPress:function(){if(!this.dlgAssignManually){this.dlgAssignManually=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.ManualAssign",this);this.getView().addDependent(this.dlgAssignManually)}this.dlgAssignManually.open();sap.ui.getCore().byId("msptInp").setValue();var e=(new Date).toISOString();var t=new Date(e.slice(0,10));var a=e.slice(11,19);sap.ui.getCore().byId("validFromManual").setDateValue(t);sap.ui.getCore().byId("manualFromTime").setValue(a);var r=new Date("December 31, 9999 23:59:59");var s=r.getHours();var i=r.getMinutes();var o=r.getSeconds();var n=s.toString()+":"+i.toString()+":"+o.toString();sap.ui.getCore().byId("validToManual").setDateValue(r);sap.ui.getCore().byId("manualToTime").setValue(n)},onMeasPointHelp:function(e){var t=this;var a=e.getSource();var r=new sap.m.TableSelectDialog({title:t.getView().getModel("i18n").getProperty("MEASPOINT_TXT"),noDataText:t.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Measuring Point"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Meas. Position"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Description"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"MeasPt Category"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Counter"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Functional Location"})]})],items:{path:"/MSPT_FL_VHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Point}"}),new sap.m.Text({text:"{Psort}"}),new sap.m.Text({text:"{Pttxt}"}),new sap.m.Text({text:"{Mptyp}"}),new sap.m.Text({text:"{Indct}"}),new sap.m.Text({text:"{Tplnr}"})]})},confirm:function(e){a.setValue(e.getParameter("selectedItem").getCells()[0].getText());a.setValueState("None");t.deriveManualAssignData()},search:function(e){var t=e.getParameter("value");if(e.getSource().getBinding("items")){e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Point",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Pttxt",sap.ui.model.FilterOperator.Contains,t)],false)])}}});var s="/MSPT_FL_VHSet";var i=t.getView().getModel("valueHelp");var o=function(e){if(e.results.length>0){var a=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Point}"}),new sap.m.Text({text:"{Psort}"}),new sap.m.Text({text:"{Pttxt}"}),new sap.m.Text({text:"{Mptyp}"}),new sap.m.Text({text:"{Indct}"}),new sap.m.Text({text:"{Tplnr}"})]});var s=new sap.ui.model.json.JSONModel;s.setData(e);r.setModel(s);r.bindAggregation("items","/results",a)}else{r.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}};var n=function(){};t._readData(s,i,o,n());r.open()},onMeasPointAMChange:function(e){var t=this;var a=e.getSource();var r=e.getParameters().newValue;var s=r.toUpperCase();var i="/MSPT_FL_VHSet";var o=this.getView().getModel("valueHelp");var n=[new sap.ui.model.Filter("Point","EQ",s)];o.read(i,{filters:n,success:function(e,r){if(e.results.length>0){a.setValue(e.results[0].Point);a.setValueState("None");t.deriveManualAssignData()}else{a.setValueState("Error");sap.ui.getCore().byId("measPosTxt").setText();sap.ui.getCore().byId("descPos").setText();sap.ui.getCore().byId("funcLoc").setText();sap.ui.getCore().byId("funcLocDesc").setText()}},error:function(e){a.setValueState("Error");var t=JSON.parse(e.response.body);var r=t.error.message.value}})},deriveManualAssignData:function(){var e=this;var t=this.getView().getModel("AIWMSPT");var a=t.getData();var s=a.AtnamMs;var i=sap.ui.getCore().byId("msptInp");var o=sap.ui.getCore().byId("validFromManual");var n=sap.ui.getCore().byId("validToManual");var l=sap.ui.getCore().byId("manualFromTime");var d=sap.ui.getCore().byId("manualToTime");var u=this.getView().getModel();var p="/AssignMANSet";var c=[new sap.ui.model.Filter("Point","EQ",a.Mspoint),new sap.ui.model.Filter("Trans","EQ",i.getValue()),new sap.ui.model.Filter("Atnam","EQ",s),new sap.ui.model.Filter("Datlo","EQ",r._formatDate(o.getDateValue())),new sap.ui.model.Filter("Dathi","EQ",r._formatDate(n.getDateValue())),new sap.ui.model.Filter("Timlo","EQ",r._timeConvert(l.getValue())),new sap.ui.model.Filter("Timhi","EQ",r._timeConvert(d.getValue())),new sap.ui.model.Filter("Indct","EQ",a.Indct),new sap.ui.model.Filter("Equnr","EQ",a.Equnr),new sap.ui.model.Filter("Tplnr","EQ",a.Tplnr)];var m=new g;m.open();u.read(p,{filters:c,success:function(e){m.close();var t=e.results[0];sap.ui.getCore().byId("measPosTxt").setText(t.Psort);sap.ui.getCore().byId("descPos").setText(t.Pttxt);sap.ui.getCore().byId("funcLoc").setText(t.Mpobj);sap.ui.getCore().byId("funcLocDesc").setText(t.Mpobt);if(t.Message!==""){sap.m.MessageBox.show(t.Message,{title:"Warning",icon:sap.m.MessageBox.Icon.WARNING,onClose:function(){}})}},error:function(e){m.close();var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var a=0;a<JSON.parse(e.responseText).error.innererror.errordetails.length;a++){t[a]=JSON.parse(e.responseText).error.innererror.errordetails[a].message}}var r=t.join("\n");sap.m.MessageBox.show(r,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){sap.ui.getCore().byId("msptInp").setValue();sap.ui.getCore().byId("measPosTxt").setText();sap.ui.getCore().byId("descPos").setText();sap.ui.getCore().byId("funcLoc").setText();sap.ui.getCore().byId("funcLocDesc").setText()}})}})},onValidFromChange:function(e){var t=e.getSource().getDateValue();var a=t.getHours().toString();var r=t.getMinutes().toString();var s=t.getSeconds().toString();var i=(a.length>1?a:"0"+a)+":"+(r.length>1?r:"0"+r)+":"+(s.length>1?s:"0"+s);sap.ui.getCore().byId("manualFromTime").setValue(i);if(sap.ui.getCore().byId("msptInp").getValue()!==""){this.deriveManualAssignData()}},onValidToChange:function(e){var t=e.getSource().getDateValue();var a=t.getHours().toString();var r=t.getMinutes().toString();var s=t.getSeconds().toString();var i=(a.length>1?a:"0"+a)+":"+(r.length>1?r:"0"+r)+":"+(s.length>1?s:"0"+s);sap.ui.getCore().byId("manualToTime").setValue(i);if(sap.ui.getCore().byId("msptInp").getValue()!==""){this.deriveManualAssignData()}},onManualOKPress:function(){var e=sap.ui.getCore().byId("msptInp").getValue();var t=sap.ui.getCore().byId("validFromManual").getDateValue();var a=r.dateFormat(t);var s=sap.ui.getCore().byId("manualFromTime").getValue();var i=sap.ui.getCore().byId("measPosTxt").getText();var o=sap.ui.getCore().byId("descPos").getText();var n=sap.ui.getCore().byId("funcLoc").getText();var l=sap.ui.getCore().byId("funcLocDesc").getText();sap.ui.getCore().byId("readingTrans").setText(e);sap.ui.getCore().byId("validFrom").setText(a);sap.ui.getCore().byId("timeMain").setText(s);sap.ui.getCore().byId("measPosition").setText(i);sap.ui.getCore().byId("RTfloc").setText(n);sap.ui.getCore().byId("RTflocdesc").setText(l);this.dlgAssignManually.close()},onManualCancelPress:function(){this.dlgAssignManually.close()},onProposeAssignmentPress:function(){if(!this.dlgRefDateTime){this.dlgRefDateTime=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.ReferenceDateTime",this);this.getView().addDependent(this.dlgRefDateTime)}var e=new Date;sap.ui.getCore().byId("refDate").setDateValue(e);var t=e.getHours();var a=e.getMinutes();var r=e.getSeconds();var s=t.toString()+":"+a.toString()+":"+r.toString();sap.ui.getCore().byId("refTime").setValue(s);this.dlgRefDateTime.open();this.transferFlag="PROP_MSPT"},onCancelTransferPress:function(){var e=sap.ui.getCore().byId("readingTrans").getText();if(e===""){return}if(!this.dlgRefDateTime){this.dlgRefDateTime=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.ReferenceDateTime",this);this.getView().addDependent(this.dlgRefDateTime)}var t=new Date;sap.ui.getCore().byId("refDate").setDateValue(t);var a=t.getHours();var r=t.getMinutes();var s=t.getSeconds();var i=a.toString()+":"+r.toString()+":"+s.toString();sap.ui.getCore().byId("refTime").setValue(i);this.dlgRefDateTime.open();this.transferFlag="CANCEL"},onCancelOKPress:function(){sap.ui.getCore().byId("readingTrans").setText();sap.ui.getCore().byId("validFrom").setText();sap.ui.getCore().byId("timeMain").setText();sap.ui.getCore().byId("measPosition").setText();sap.ui.getCore().byId("measPosition").setText();sap.ui.getCore().byId("RTfloc").setText();sap.ui.getCore().byId("RTflocdesc").setText();var e=this.getView().getModel("AIWMSPT");var t=e.getData();t.RT.readTransf="";t.RT.RTValidFrom="";t.RT.RTTime="";t.RT.RTMeasPos="";t.RT.RTMpDesc="";t.RT.RTFloc="";t.RT.RTFlocDesc="";t.RT.RTEqui="";t.RT.RTEquiDesc="";this.dlgCancel.close();this.transferFlag=""},onCancelCancelPress:function(){this.dlgCancel.close();this.transferFlag=""},onStructurePress:function(){if(!this.dlgRefDateTime){this.dlgRefDateTime=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.ReferenceDateTime",this);this.getView().addDependent(this.dlgRefDateTime)}var e=new Date;sap.ui.getCore().byId("refDate").setDateValue(e);var t=e.getHours();var a=e.getMinutes();var r=e.getSeconds();var s=t.toString()+":"+a.toString()+":"+r.toString();sap.ui.getCore().byId("refTime").setValue(s);this.dlgRefDateTime.open();this.transferFlag="STRUCT"},onRefDateTimeOKPress:function(){this.dlgRefDateTime.close();if(this.transferFlag==="CANCEL"){if(!this.dlgCancel){this.dlgCancel=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.Cancel",this);this.getView().addDependent(this.dlgCancel)}var e=sap.ui.getCore().byId("readingTrans").getText();var t=sap.ui.getCore().byId("validFrom").getText();var a=sap.ui.getCore().byId("timeMain").getText();var s=sap.ui.getCore().byId("measPosition").getText();var i=sap.ui.getCore().byId("mpDesc").getText();var o=sap.ui.getCore().byId("RTfloc").getText();var n=sap.ui.getCore().byId("RTflocdesc").getText();var l=sap.ui.getCore().byId("RTequi").getText();var g=sap.ui.getCore().byId("RTequidesc").getText();sap.ui.getCore().byId("readTransFr").setText(e);sap.ui.getCore().byId("validFromCancel").setText(t);sap.ui.getCore().byId("validTimeCancel").setText(a);sap.ui.getCore().byId("measPosCancel").setText(s);sap.ui.getCore().byId("descCancel").setText(i);sap.ui.getCore().byId("flocCancel").setText(o);sap.ui.getCore().byId("flocDescCancel").setText(n);sap.ui.getCore().byId("equiCancel").setText(l).setVisible(true);sap.ui.getCore().byId("equiDescCancel").setText(g).setVisible(true);if(o===""){sap.ui.getCore().byId("flocCancel").setVisible(false);sap.ui.getCore().byId("flocDescCancel").setVisible(false)}if(l===""){sap.ui.getCore().byId("equiCancel").setVisible(false);sap.ui.getCore().byId("equiDescCancel").setVisible(false)}var d=new Date("December 31, 9999 23:59:59");var u=d.getHours();var p=d.getMinutes();var c=d.getSeconds();var m=u.toString()+":"+p.toString()+":"+c.toString();sap.ui.getCore().byId("validToCancel").setText(r.dateFormat(d));sap.ui.getCore().byId("validToTimeCancel").setText(m);var M=new Date;var M=new Date;var u=M.getHours();var p=M.getMinutes();var c=M.getSeconds();var T=u.toString()+":"+p.toString()+":"+c.toString();sap.ui.getCore().byId("validToNewCancel").setDateValue(M);sap.ui.getCore().byId("validToNewTimeCancel").setValue(T);this.dlgCancel.open()}if(this.transferFlag==="STRUCT"){if(!this.dlgStruct){this.dlgStruct=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.Structure",this);this.getView().addDependent(this.dlgStruct)}this.fetchTableData("STRUCT")}if(this.transferFlag==="PROP_MSPT"){if(!this.dlgPropAssign){this.dlgPropAssign=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.transfer.ProposeAssignment",this);this.getView().addDependent(this.dlgPropAssign)}this.fetchTableData("PROP_MSPT")}},onRefDateTimeCancelPress:function(){this.dlgRefDateTime.close()},onStructClosePress:function(){this.dlgStruct.close()},fetchTableData:function(e){var a=this;var s=sap.ui.getCore().byId("refDate");var i=sap.ui.getCore().byId("refTime");var o=a.getView().getModel(a.oModelName).getData();var n=sap.ui.getCore().getModel("AIWFLOC").getData();var l=sap.ui.getCore().getModel("AIWEQUI").getData();var d=sap.ui.getCore().getModel("AIWMSPT").getData();var u=sap.ui.getCore().getModel("tempCrTypeModel").getData();var p={ChangeRequestType:u.crtype,CrDescription:u.desc,Action:e,Measpoint:o.Mspoint,Trans:sap.ui.getCore().byId("readingTrans").getText(),Datlo:r._formatDate(s.getDateValue()),Timlo:r._timeConvert(i.getValue()),IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLAddrI:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqAddrI:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[],MsptHier_N:[],MsptAssign_N:[],DataOrigin_N:[]};if(n.length>0){for(var c=0;c<n.length;c++){var m={Tplnr:n[c].Functionallocation,Txtmi:n[c].Flocdescription,TplkzFlc:n[c].Strucindicator,Tplxt:n[c].StrucIndicatorDesc,EditMask:n[c].EditMask,Hierarchy:n[c].Hierarchy,Fltyp:n[c].Floccategory,Flttx:n[c].FlocCategoryDesc,Swerk:n[c].Maintplant,Plantname:n[c].MaintplantDesc,StorFloc:n[c].Location,Locationdesc:n[c].Locationdesc,Abckzfloc:n[c].Abckz,Abctx:n[c].Abctx,Bukrsfloc:n[c].Bukrs,Butxt:n[c].Butxt,City:n[c].City,KostFloc:n[c].Kostl,KokrFloc:n[c].Kokrs,Contareaname:n[c].Mctxt,PlntFloc:n[c].Werks,Planningplantdes:n[c].Planningplantdes,Ingrp:n[c].Ingrp,Plannergrpdesc:n[c].Innam,Arbplfloc:n[c].Arbpl,Wergwfloc:n[c].WcWerks,Gewrkfloc:n[c].MainArbpl,MainWcPlant:n[c].MainWerks,Tplma:n[c].SupFunctionallocation,Supflocdesc:n[c].SupFlocdescription,BeberFl:n[c].BeberFl,Fing:n[c].Fing,Tele:n[c].Tele,Submtiflo:n[c].ConstrType,Constdesc:n[c].ConstructionDesc,Eqart:n[c].TechnicalObjectTyp,Eartx:n[c].Description,Stattext:n[c].Stattext,StsmFloc:n[c].StsmEqui,Statproftxt:n[c].StsmEquiDesc,UstwFloc:n[c].UstwEqui,UswoFloc:n[c].UswoEqui,UstaFloc:n[c].UstaEqui,Adrnri:n[c].Adrnri,Deact:n[c].Deact};p.FuncLoc.push(m);var M={Funcloc:n[c].Functionallocation,Title:n[c].TitleCode,Name1:n[c].Name1,Name2:n[c].Name2,Name3:n[c].Name3,Name4:n[c].Name4,Sort1:n[c].Sort1,Sort2:n[c].Sort2,NameCo:n[c].NameCo,PostCod1:n[c].PostCod1,City1:n[c].City1,Building:n[c].Building,Floor:n[c].Floor,Roomnum:n[c].Roomnum,Strsuppl1:n[c].Strsuppl1,Strsuppl2:n[c].Strsuppl2,Strsuppl3:n[c].Strsuppl3,Location:n[c].AddrLocation,RPostafl:n[c].RefPosta,Landx:n[c].Landx,TimeZone:n[c].TimeZone,RPostFl:n[c].Region,Regiotxt:n[c].RegionDesc};p.FLAddr.push(M);var T=n[c].intlAddr;if(T){for(var f=0;f<T.length;f++){p.FLAddrI.push(T[f])}}if(a.AltLblDerv==="2"&&n[c].altlbl){for(var h=0;h<n[c].altlbl.length;h++){var C={Funcloc:n[c].Functionallocation,AltAlkey:n[c].altlbl[h].AltAlkey,AltStrno:n[c].altlbl[h].AltStrno,AltTplkz:n[c].altlbl[h].AltTplkz};p.FLALTLBEL.push(C)}}if(n[c].Floccategory==="L"&&n[c].lam){var v={Funcloc:n[c].Functionallocation,Lrpid:n[c].lam.Lrpid,Strtptatr:n[c].lam.Strtptatr,Endptatr:n[c].lam.Endptatr,Length:n[c].lam.Length,LinUnit:n[c].lam.LinUnit,Startmrkr:n[c].lam.Startmrkr,Endmrkr:n[c].lam.Endmrkr,Mrkdisst:n[c].lam.Mrkdisst,Mrkdisend:n[c].lam.Mrkdisend,MrkrUnit:n[c].lam.MrkrUnit};p.FLLAM.push(v)}var S=n[c].classItems;if(S){if(S.length>0){for(var b=0;b<S.length;b++){var D={Funcloc:n[c].Functionallocation,Classtype:S[b].Classtype,Class:S[b].Class,Clstatus1:S[b].Clstatus1};p.FLClass.push(D)}}}var y=n[c].characteristics;if(y){if(y.length>0){for(var x=0;x<y.length;x++){var I={Funcloc:n[c].Functionallocation,Atnam:y[x].Atnam,Textbez:y[x].Textbez,Atwrt:y[x].Atwrt,Class:y[x].Class};p.FLVal.push(I)}}}}}if(l.length>0){for(var E=0;E<l.length;E++){var P={Herst:l[E].Herst,Equnr:l[E].Equnr,Txtmi:l[E].Eqktx,Swerk:l[E].Maintplant,Name1:l[E].MaintplantDesc,TplnEilo:l[E].Tplnr,Flocdescription:l[E].Pltxt,Eqtyp:l[E].EquipmentCatogory,Etytx:l[E].EquipCatgDescription,Eqart:l[E].TechnicalObjectTyp,Eartx:l[E].Description,Typbz:l[E].Typbz,SubmEeqz:l[E].ConstrType,Constdesc:l[E].ConstructionDesc,BukrEilo:l[E].Bukrs,Butxt:l[E].Butxt,HequEeqz:l[E].SuperordinateEquip,SuperordEqDes:l[E].SuperordinateEquipDesc,TidnEeqz:l[E].TechIdNum,KostEilo:l[E].Kostl,KokrEilo:l[E].Kokrs,Contareaname:l[E].Mctxt,StorEilo:l[E].Location,Locationdesc:l[E].Locationdesc,AbckEilo:l[E].Abckz,Abctx:l[E].Abctx,PplaEeqz:l[E].Werks,Planningplantdes:l[E].Planningplantdes,IngrEeqz:l[E].Ingrp,Plannergrpdesc:l[E].Innam,Serge:l[E].Serge,MapaEeqz:l[E].MapaEeqz,Stattext:l[E].Stattext,StsmEqui:l[E].StsmEqui,Statproftxt:l[E].StsmEquiDesc,UstwEqui:l[E].UstwEqui,UswoEqui:l[E].UswoEqui,UstaEqui:l[E].UstaEqui,Deact:l[E].Deact,Answt:l[E].Answt,Ansdt:a._formatDate(l[E].Ansdt),Waers:l[E].Waers,ArbpEilo:l[E].Arbpl,WorkCenterPlant:l[E].WcWerks,ArbpEeqz:l[E].MainArbpl,MainWcPlant:l[E].MainWerks,BebeEilo:l[E].BeberFl,Fing:l[E].Fing,Tele:l[E].Tele,HeqnEeqz:l[E].EquipPosition,Adrnri:l[E].Adrnri,Funcid:l[E].Funcid,Frcfit:l[E].Frcfit,Frcrmv:l[E].Frcrmv};p.Equipment.push(P);var A={Equi:l[E].Equnr,PlanvPrt:l[E].PlanvPrt,SteufPrt:l[E].SteufPrt,KtschPrt:l[E].KtschPrt,Ewformprt:l[E].Ewformprt,SteufRef:l[E].SteufRef,KtschRef:l[E].KtschRef,EwformRef:l[E].EwformRef};p.EqPRT.push(A);if(l[E].EquipmentCatogory==="L"&&l[E].lam){var F={Equi:l[E].Equnr,Lrpid:l[E].lam.Lrpid,Strtptatr:l[E].lam.Strtptatr,Endptatr:l[E].lam.Endptatr,Length:l[E].lam.Length,LinUnit:l[E].lam.LinUnit,Startmrkr:l[E].lam.Startmrkr,Endmrkr:l[E].lam.Endmrkr,Mrkdisst:l[E].lam.Mrkdisst,Mrkdisend:l[E].lam.Mrkdisend,MrkrUnit:l[E].lam.MrkrUnit};p.EqLAM.push(F)}var w={Equi:l[E].Equnr,Title:l[E].TitleCode,Name1:l[E].Name1,Name2:l[E].Name2,Name3:l[E].Name3,Name4:l[E].Name4,Sort1:l[E].Sort1,Sort2:l[E].Sort2,NameCo:l[E].NameCo,PostCod1:l[E].PostCod1,City1:l[E].City1,Building:l[E].Building,Floor:l[E].Floor,Roomnum:l[E].Roomnum,Strsuppl1:l[E].Strsuppl1,Strsuppl2:l[E].Strsuppl2,Strsuppl3:l[E].Strsuppl3,Location:l[E].AddrLocation,RefPosta:l[E].RefPosta,Landx:l[E].Landx,TimeZone:l[E].TimeZone,RfePost:l[E].Region,Regiotxt:l[E].RegionDesc};p.EqAddr.push(w);var R=l[E].intlAddr;if(R){for(var f=0;f<R.length;f++){p.EqAddrI.push(R[f])}}var V=l[E].classItems;if(V){if(V.length>0){for(var N=0;N<V.length;N++){var q={Equi:l[E].Equnr,Classtype:V[N].Classtype,Class:V[N].Class,Clstatus1:V[N].Clstatus1};p.EqClass.push(q)}}}var L=l[E].characteristics;if(L){if(L.length>0){for(var k=0;k<L.length;k++){var O={Equi:l[E].Equnr,Atnam:L[k].Atnam,Textbez:L[k].Textbez,Atwrt:L[k].Atwrt,Class:L[k].Class};p.EqVal.push(O)}}}}}if(d.length>0){for(var B=0;B<d.length;B++){var H={Point:d[B].Mspoint,Equnr:d[B].Equnr,Eqktx:d[B].Eqktx,Tplnr:d[B].Tplnr,Floctxt:d[B].Pltxt,Mptyp:d[B].Mptyp,Mpttx:d[B].Mpttx,Codgr:d[B].Codgr,Codgrtxt:d[B].Codgrtxt,ObtypMs:d[B].ObtypMs,Objtypetxt:d[B].Txt,AtnamMs:d[B].AtnamMs,Atbez:d[B].Atbez,Indct:d[B].Indct,Cdsuf:d[B].Cdsuf,Cjumc:d[B].Cjumc,Desir:d[B].Desir,Pyeac:d[B].Pyeac,Mrmin:d[B].Mrmin,Mrmax:d[B].Mrmax,Pttxt:d[B].Pttxt,Psort:d[B].Psort,Inact:d[B].Inact,Mseh6:d[B].Mseh6,Msehl:d[B].Msehl,Decim:d[B].Decim.toString(),Locas:d[B].Locas,Maktx:d[B].Maktx,Begru:d[B].Begru,Begtx:d[B].Begtx,Expon:d[B].Expon,Mrngu:d[B].Mrngu,Dstxt:d[B].Dstxt,Indrv:d[B].Indrv,Indtr:d[B].readTransfSel,Trans:d[B].readTransfs};if(d[B].Mspoint===o.Mspoint){H.Trans=sap.ui.getCore().byId("readingTrans").getText()}p.MSPoint.push(H);if(d[B].Mptyp==="L"&&d[B].lam){var U={Mspoint:d[B].Mspoint,Lrpid:d[B].lam.Lrpid,Strtptatr:d[B].lam.Strtptatr,Endptatr:d[B].lam.Endptatr,Length:d[B].lam.Length,LinUnit:d[B].lam.LinUnit,Startmrkr:d[B].lam.Startmrkr,Endmrkr:d[B].lam.Endmrkr,Mrkdisst:d[B].lam.Mrkdisst,Mrkdisend:d[B].lam.Mrkdisend,MrkrUnit:d[B].lam.MrkrUnit};p.MSLAM.push(U)}var W=d[B].classItems;if(W){if(W.length>0){for(var _=0;_<W.length;_++){var z={Mspoint:d[B].Mspoint,Classtype:W[_].Classtype,Class:W[_].Class,Clstatus1:W[_].Clstatus1};p.MSClass.push(z)}}}var K=d[B].characteristics;if(K){if(K.length>0){for(var j=0;j<K.length;j++){var J={Mspoint:d[B].Mspoint,Atnam:K[j].Atnam,Textbez:K[j].Textbez,Atwrt:K[j].Atwrt,Class:K[j].Class};p.MSVal.push(J)}}}}}if(p.FLAddrI.length>0){p.FLAddrI=$.map(p.FLAddrI,function(e){return $.extend(true,{},e)});for(var j=0;j<p.FLAddrI.length>0;j++){delete p.FLAddrI[j].AdNationEnable;delete p.FLAddrI[j].City1iVS;delete p.FLAddrI[j].StreetiVS}}if(p.EqAddrI.length>0){p.EqAddrI=$.map(p.EqAddrI,function(e){return $.extend(true,{},e)});for(var j=0;j<p.EqAddrI.length>0;j++){delete p.EqAddrI[j].AdNationEnable;delete p.EqAddrI[j].City1iVS;delete p.EqAddrI[j].StreetiVS}}var G=new g;G.open();var Q=this.getView().getModel();Q.create("/ChangeRequestSet",p,{success:function(r){G.close();if(e==="STRUCT"){var s=r.MsptHier_N.results;var i=a.getTreeTblData(s);var o=new t(i);var n=sap.ui.getCore().byId("structure");n.setModel(o);a.dlgStruct.open()}if(e==="PROP_MSPT"){var l=r.MsptAssign_N.results;var o=new t(l);var g=sap.ui.getCore().byId("propTab");g.setModel(o);a.dlgPropAssign.open();a.propDataOrigin=l}},error:function(e){G.close();a.getView().byId("msptPage").setBusy(false);var t=[],r=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var s=0;s<JSON.parse(e.responseText).error.innererror.errordetails.length;s++){t[s]=JSON.parse(e.responseText).error.innererror.errordetails[s].message}}var i=t.join("\n");sap.m.MessageBox.show(i,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},getTreeTblData:function(e){var t=[];var a={};if(e){var r;for(var s=0;s<e.length;s++){var i=e[s];r=i;r.IsSelect=false;r.children=[];if(i.ParentKey&&i.ParentKey.length>0){var o=a[i.ParentKey];if(o){o.children.push(r)}}else{t.push(r)}a[r.RowKey]=r}return t}},onProposeOKPress:function(){var e=sap.ui.getCore().byId("propTab");if(e.getSelectedItem()){var t=e.getSelectedItem().getBindingContext().getPath();t=t.split("/")[1];var a=this.propDataOrigin[t];var s=a.Point;var i=r.dateFormat(a.Datlo);var o=r.getTime(a.Timlo);var n=a.Psort;var l=a.Pttxt;var g=a.Tplnr;var d=a.TplnrTxt;var u=a.Equnr;var p=a.EqunrTxt;sap.ui.getCore().byId("readingTrans").setText(s);sap.ui.getCore().byId("validFrom").setText(i);sap.ui.getCore().byId("timeMain").setText(o);sap.ui.getCore().byId("measPosition").setText(n);sap.ui.getCore().byId("mpDesc").setText(l);sap.ui.getCore().byId("RTfloc").setText(g);sap.ui.getCore().byId("RTflocdesc").setText(d);sap.ui.getCore().byId("RTequi").setText(u);sap.ui.getCore().byId("RTequidesc").setText(p);if(u===""){sap.ui.getCore().byId("RTequi").setVisible(false);sap.ui.getCore().byId("RTequidesc").setVisible(false)}if(g===""){sap.ui.getCore().byId("RTfloc").setVisible(false);sap.ui.getCore().byId("RTflocdesc").setVisible(false)}}this.dlgPropAssign.close()},onProposeCancelPress:function(){this.dlgPropAssign.close()}})});