sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/core/routing/History","ugiaiwui/mdg/aiw/request/model/formatter","sap/ui/core/routing/Router","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest","sap/m/BusyDialog","sap/ui/core/message/Message"],function(e,t,a,r,s,i,o,m,l,n){"use strict";return e.extend("ugiaiwui.mdg.aiw.request.controller.ItemBOM",{formatter:s,lastSubItm:"",onInit:function(){this.getRouter().getRoute("itmDetail").attachPatternMatched(this._onObjectMatched,this);this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()));var e=this._oComponent.getModel();e.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(e);var a=this._oComponent.getModel("NewModel");this.getView().setModel(a,"valueHelp");var r=this._oComponent.getModel("NewModel2");this.getView().setModel(r,"valueHelp2");var s={ItmDtlTxt:"",ItmDtlVisible:false,ItmCompVisible:false,CoProdVisible:false,QtyDataVisible:false,AddnlDataVisible:false,StrLocVisible:false,ProdSuplyVisible:false,MrpDataVisible:false,PurDataVisible:false,ItmTxtVisible:false,DocAssgnVisible:false,varsizeitmdataVisible:false,PurDataApprFieldsVis:false,ItmTxtApprFieldsVis:false};var i=new t(s);this.getView().setModel(i,"VisibleModel");var o=sap.ui.getCore().getMessageManager();this.getView().setModel(o.getMessageModel(),"message");o.registerObject(this.getView(),true);this.BusyDialog=new l;this.BusyDialog.close()},_onObjectMatched:function(e){var a=e.getParameter("name");if(a==="itmDetail"){var r=sap.ui.getCore().getModel("BOMDetailModel");this.lastSubItm=0;this.sFragmentName=e.getParameter("arguments").sFragmentName;this.sCrStatus=e.getParameter("arguments").sCrStatus;this.mode=e.getParameter("arguments").mode;var s=decodeURIComponent(e.getParameter("arguments").itemPath);var i=s.substring(s.lastIndexOf("/")+1);this.currentObj=r.getData();var o=new t([]);var m=new t([]);var l=this.getView().getModel("VisibleModel");var n=l.getData();var g=new t;var u={};var d=new t(this.currentObj);this.getView().setModel(d,"BOMModel");if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="SearchMaterialBom"||this.sFragmentName==="changeMbom"){o.setData(this.currentObj.matItem[i]);m.setData(this.currentObj.matSubItem);u={titleName:this.getView().getModel("i18n").getProperty("MBOM_ITM_DET")};if(this.sFragmentName==="SearchMaterialBom"||this.sFragmentName==="changeMbom"){this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag}}if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="SearchEquipmentBom"||this.sFragmentName==="changeEbom"){o.setData(this.currentObj.eqItem[i]);m.setData(this.currentObj.eqSubItem);u={titleName:this.getView().getModel("i18n").getProperty("EBOM_ITM_DET")};if(this.sFragmentName==="SearchEquipmentBom"||this.sFragmentName==="changeEbom"){this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag}}if(this.sFragmentName==="CreateFLBom"||this.sFragmentName==="SearchFLBom"||this.sFragmentName==="changeFlbom"){o.setData(this.currentObj.flItem[i]);m.setData(this.currentObj.flSubItem);u={titleName:this.getView().getModel("i18n").getProperty("FLBOM_ITM_DET")};if(this.sFragmentName==="SearchFLBom"||this.sFragmentName==="changeFlbom"){this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag}}if(this.sFragmentName==="CreateWBSBom"||this.sFragmentName==="SearchWBSBom"||this.sFragmentName==="changeWbsbom"){o.setData(this.currentObj.wbsItem[i]);m.setData(this.currentObj.wbsSubItem);u={titleName:this.getView().getModel("i18n").getProperty("WBSBOM_ITM_DET")};if(this.sFragmentName==="SearchWBSBom"||this.sFragmentName==="changeWbsbom"){this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag}}this.getView().setModel(o,"itemDetailModel");this.getView().setModel(m,"subitemModel");this.attachModelEventHandlers(o);this.attachModelEventHandlers(m);g.setData(u);this.getView().setModel(g,"applicationModel");var c=this.getView().getModel("subitemModel").getData();var p=this.getView().getModel("itemDetailModel").getData();var I=[];var h=new t;for(var b=0;b<c.length;b++){if(c[b].Posnr===p.Bomitmpos){var f={};f.Posnr=c[b].Posnr;f.Bomitmnod=c[b].Posnr;f.Bomsubno=c[b].Bomsubno;f.Ebort=c[b].Ebort;f.Upmng=c[b].Upmng;f.Uptxt=c[b].Uptxt;f.subqtyState=c[b].subqtyState;f.intPointEnable=c[b].intPointEnable;f.subQtyEnable=c[b].subQtyEnable;f.subTextEnable=c[b].subTextEnable;I.push(f)}}h.setData(I);this.getView().setModel(h,"tableModel");this.attachModelEventHandlers(h);if(I.length>0){this.lastSubItm=I[I.length-1].Bomsubno}if(this.mode==="request"){n.ItmDtlTxt="";n.ItmDtlVisible=false;n.ItmCompVisible=false;n.CoProdVisible=false;n.QtyDataVisible=false;n.AddnlDataVisible=false;n.StrLocVisible=false;n.ProdSuplyVisible=false;n.MrpDataVisible=false;n.PurDataVisible=false;n.ItmTxtVisible=false;n.DocAssgnVisible=false;n.PurDataApprFieldsVis=false;n.ItmTxtApprFieldsVis=false;n.varsizeitmdataVisible=false;if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="SearchMaterialBom"||this.sFragmentName==="changeMbom"){n.PurDataVisible=this.currentObj.matItem[i].Itemcat==="N"?true:false;n.ItmTxtVisible=this.currentObj.matItem[i].Itemcat==="N"||this.currentObj.matItem[i].Itemcat==="T"?true:false;n.DocAssgnVisible=this.currentObj.matItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.matItem[i].Itemcat==="R"?true:false;if(this.currentObj.matItem[i].Itemcat==="D"||this.currentObj.matItem[i].Itemcat==="T"){this.getView().byId("idPanelSubItm").setVisible(false)}else{this.getView().byId("idPanelSubItm").setVisible(true)}}if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="SearchEquipmentBom"||this.sFragmentName==="changeEbom"){n.PurDataVisible=this.currentObj.eqItem[i].Itemcat==="N"?true:false;n.ItmTxtVisible=this.currentObj.eqItem[i].Itemcat==="N"||this.currentObj.eqItem[i].Itemcat==="T"?true:false;n.DocAssgnVisible=this.currentObj.eqItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.eqItem[i].Itemcat==="R"?true:false;if(this.currentObj.eqItem[i].Itemcat==="D"||this.currentObj.eqItem[i].Itemcat==="T"){this.getView().byId("idPanelSubItm").setVisible(false)}else{this.getView().byId("idPanelSubItm").setVisible(true)}}if(this.sFragmentName==="CreateFLBom"||this.sFragmentName==="SearchFLBom"||this.sFragmentName==="changeFlbom"){n.PurDataVisible=this.currentObj.flItem[i].Itemcat==="N"?true:false;n.ItmTxtVisible=this.currentObj.flItem[i].Itemcat==="N"||this.currentObj.flItem[i].Itemcat==="T"?true:false;n.DocAssgnVisible=this.currentObj.flItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.flItem[i].Itemcat==="R"?true:false;if(this.currentObj.eqItem[i].Itemcat==="D"||this.currentObj.flItem[i].Itemcat==="T"){this.getView().byId("idPanelSubItm").setVisible(false)}else{this.getView().byId("idPanelSubItm").setVisible(true)}}if(this.sFragmentName==="CreateWBSBom"||this.sFragmentName==="SearchWBSBom"||this.sFragmentName==="changeWbsbom"){n.PurDataVisible=this.currentObj.wbsItem[i].Itemcat==="N"?true:false;n.ItmTxtVisible=this.currentObj.wbsItem[i].Itemcat==="N"||this.currentObj.wbsItem[i].Itemcat==="T"?true:false;n.DocAssgnVisible=this.currentObj.wbsItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.wbsItem[i].Itemcat==="R"?true:false;if(this.currentObj.wbsItem[i].Itemcat==="D"||this.currentObj.wbsItem[i].Itemcat==="T"){this.getView().byId("idPanelSubItm").setVisible(false)}else{this.getView().byId("idPanelSubItm").setVisible(true)}}if(p.Itemcat==="N"&&p.Itemcomp===""){p.PGrpReq=true;p.PrcReq=true;p.PrcUnitReq=true;p.MatGrpReq=true;p.ItmTxt1Req=true}else if(p.Itemcat==="D"){p.DocReq=true}else if(p.Itemcat==="R"){p.Size1Req=true;p.NumVarSizReq=true}else if(p.Itemcat==="T"){p.ItmTxt1Req=true}this.getView().getModel("itemDetailModel").refresh()}else{n.ItmDtlVisible=true;n.ItmCompVisible=true;n.QtyDataVisible=true;n.AddnlDataVisible=true;n.MrpDataVisible=true;n.ItmTxtVisible=true;n.ItmTxtApprFieldsVis=true;if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="SearchMaterialBom"||this.sFragmentName==="changeMbom"){n.ItmDtlTxt=this.getResourceBundle().getText("MBOM_ITM_DET");n.RfpntVisible=true;n.PmassmblyVisible=false;n.CoProdVisible=true;n.StrLocVisible=false;n.ProdSuplyVisible=false;n.PurDataVisible=this.currentObj.matItem[i].Itemcat==="N"?true:false;n.PurDataApprFieldsVis=this.currentObj.matItem[i].Itemcat==="N"?true:false;n.DocAssgnVisible=this.currentObj.matItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.matItem[i].Itemcat==="R"?true:false}if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="SearchEquipmentBom"||this.sFragmentName==="changeEbom"){n.ItmDtlTxt=this.getResourceBundle().getText("EBOM_ITM_DET");n.RfpntVisible=false;n.PmassmblyVisible=true;n.CoProdVisible=false;n.StrLocVisible=true;n.ProdSuplyVisible=true;n.PurDataVisible=this.currentObj.eqItem[i].Itemcat==="N"?true:false;n.PurDataApprFieldsVis=this.currentObj.eqItem[i].Itemcat==="N"?true:false;n.DocAssgnVisible=this.currentObj.eqItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.matItem[i].Itemcat==="R"?true:false}if(this.sFragmentName==="CreateFLBom"||this.sFragmentName==="SearchFLBom"||this.sFragmentName==="changeFlbom"){n.ItmDtlTxt=this.getResourceBundle().getText("FLBOM_ITM_DET");n.RfpntVisible=false;n.PmassmblyVisible=true;n.CoProdVisible=false;n.StrLocVisible=false;n.ProdSuplyVisible=false;n.PurDataVisible=this.currentObj.flItem[i].Itemcat==="N"?true:false;n.PurDataApprFieldsVis=this.currentObj.flItem[i].Itemcat==="N"?true:false;n.DocAssgnVisible=this.currentObj.flItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.matItem[i].Itemcat==="R"?true:false}if(this.sFragmentName==="CreateWBSBom"||this.sFragmentName==="SearchWBSBom"||this.sFragmentName==="changeWbsbom"){n.ItmDtlTxt=this.getResourceBundle().getText("WBSBOM_ITM_DET");n.CoProdVisible=true;n.StrLocVisible=true;n.ProdSuplyVisible=true;n.PurDataVisible=this.currentObj.wbsItem[i].Itemcat==="N"?true:false;n.PurDataApprFieldsVis=this.currentObj.flItem[i].Itemcat==="N"?true:false;n.DocAssgnVisible=this.currentObj.wbsItem[i].Itemcat==="D"?true:false;n.varsizeitmdataVisible=this.currentObj.matItem[i].Itemcat==="R"?true:false}}l.setData(n)}else{return}},attachModelEventHandlers:function(e){e.attachPropertyChange(this.handlePropertyChanged,this)},handlePropertyChanged:function(){this.oModelUpdateFlag=true},onStatusCheck:function(e){var t=e.getSource().getBindingInfo("selected").binding.sPath;t=t.split("/")[1];var a=this.getView().getModel("itemDetailModel");var r=a.getData();if(t==="Sanfe"){r.Sanfe=s.revSatusSel(e.getSource().getSelected())}if(t==="Sanin"){r.Sanin=s.revSatusSel(e.getSource().getSelected())}if(t==="Sanko"){r.Sanko=s.revSatusSel(e.getSource().getSelected())}},onPrchseOrgVH:function(e){m.purchaseOrgValueHelp(e,this)},onPrchseOrgChange:function(e){m.purchaseOrgChange(e,this)},onPrchseGrpVH:function(e){m.purchaseGrpValueHelp(e,this)},onPrchseGrpChange:function(e){m.purchaseGrpChange(e,this)},onChangeSimple:function(e){e.getSource().setValueState("None");var t=this.getView().getModel("itemDetailModel");var a=t.getData();if(a.Itemcat==="T"||a.Itemcat==="N"&&a.Itemcomp===""){if(e.getSource().getId().indexOf("itemTextLine1")>-1){var r=e.getSource().getValue();if(r!==""){a.Itmcmpdesc=r;a.ItmcmpdescEnabled=false}else{a.Itmcmpdesc="";a.ItmcmpdescEnabled=true}}}},onCrncyVH:function(e){m.crncyValueHelp(e,this)},onCrncyChange:function(e){m.crncyChange(e,this)},onMatGrpVH:function(e){m.matGrpValueHelp(e,this)},onMatGrpChange:function(e){m.matGrpChange(e,this)},onDocumentVH:function(e){m.documentValueHelp(e,this)},onDocumentChange:function(e){m.documentChange(e,this)},onSizeUnitVH:function(e){m.sizeunitValueHelp(e,this)},onSizeUnitChange:function(e){m.sizeunitChange(e,this)},onFormaulaKeyVH:function(e){m.formulakeyValueHelp(e,this)},onFormaulaKeyChange:function(e){m.formulakeyChange(e,this)},onQtyVarUnitVH:function(e){m.qtyVarUnitValueHelp(e,this)},onQtyVarUnitChange:function(e){m.qtyVarUnitChange(e,this)},onSpareVH:function(e){var t=this;var a={title:this.getView().getModel("i18n").getProperty("SPARE_PART"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/bomspidvhSet",template:new sap.m.StandardListItem({title:"{Erskz}",description:"{Etext}"})},confirm:function(e){var a=t.getView().getModel("itemDetailModel");var r=a.getData();r.Erskz=e.getParameters().selectedItem.getProperty("title");r.Etext=e.getParameters().selectedItem.getProperty("description");a.setData(r)}};var r="/bomspidvhSet";var s=this.getView().getModel("valueHelp");var i=o.getSelectDialog(s,r,[],a,"Erskz","Etext");i.setModel(this.getView().getModel("i18n"),"i18n");i.open()},handleSpareConfirm:function(e){var t=this.getParent().getController();var a=t.getView().getModel("itemDetailModel");var r=a.getData();r.Erskz=e.getParameters().selectedItem.getProperty("title");r.Etext=e.getParameters().selectedItem.getProperty("description");a.setData(r)},onRelVH:function(e){var t=this;var a={title:this.getView().getModel("i18n").getProperty("REL_COST"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/bomcostrelvhSet",template:new sap.m.StandardListItem({title:"{SELKZ}",description:"{STEXT}"})},confirm:function(e){var a=t.getView().getModel("itemDetailModel");var r=a.getData();r.Costgrelv=e.getParameters().selectedItem.getProperty("title");r.Stext=e.getParameters().selectedItem.getProperty("description");a.setData(r)}};var r="/bomcostrelvhSet";var s=this.getView().getModel("valueHelp");var i=o.getSelectDialog(s,r,[],a,"SELKZ","STEXT");i.setModel(this.getView().getModel("i18n"),"i18n");i.open()},handleCostRelConfirm:function(e){var t=this.getParent().getController();var a=t.getView().getModel("itemDetailModel");var r=a.getData();r.Costgrelv=e.getParameters().selectedItem.getProperty("title");r.Stext=e.getParameters().selectedItem.getProperty("description");a.setData(r)},onRelSaleVH:function(e){var t=this;var a={title:this.getView().getModel("i18n").getProperty("REL_SALES"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/bomrelsalesSet",template:new sap.m.StandardListItem({title:"{RVREL}",description:"{BEZEI}"})},confirm:function(e){var a=t.getView().getModel("itemDetailModel");var r=a.getData();r.Rvrel=e.getParameters().selectedItem.getProperty("title");r.Bezei=e.getParameters().selectedItem.getProperty("description");a.setData(r)}};var r="/bomrelsalesSet";var s=this.getView().getModel("valueHelp");var i=o.getSelectDialog(s,r,[],a,"RVREL","BEZEI");i.setModel(this.getView().getModel("i18n"),"i18n");i.open()},handleSaleRelConfirm:function(e){var t=this.getParent().getController();var a=t.getView().getModel("itemDetailModel");var r=a.getData();r.Rvrel=e.getParameters().selectedItem.getProperty("title");r.Bezei=e.getParameters().selectedItem.getProperty("description");a.setData(r)},onLiveChange:function(e){if(e.getSource().getValue()===" "){e.getSource().setValue("")}e.getSource().setValueState("None")},onStatusChange:function(e){var t=e.getSource().getBindingInfo("value").binding.sPath;t=t.split("/")[1];switch(t){case"Erskz":this.handleSpareChange(e);break;case"Costgrelv":this.handleCostRelChange(e);break;case"Rvrel":this.handleSaleRelChange(e);break}},handleSpareChange:function(e){var t=this;var a=e.getParameters().newValue;var r=this.getView().getModel("NewModel");var s=t.getView().getModel("itemDetailModel");var i=s.getData();var o=e.getSource().getId();if(a!=""){var m=a.toUpperCase();var l=[new sap.ui.model.Filter("Erskz","EQ",m)];r.read("/bomspidvhSet",{filters:l,success:function(e){if(e.results.length>0){i.Erskz=e.results[0].Erskz;i.Etext=e.results[0].Etext;sap.ui.getCore().byId(o).setValueState("None")}else{i.Erskz="";i.Etext="";sap.ui.getCore().byId(o).setValueState("Error")}s.setData(i)},error:function(e){var t=JSON.parse(e.response.body);var a=t.error.message.value;sap.ui.getCore().byId(o).setValueStateText(a);sap.ui.getCore().byId(o).setValueState("Error")}})}},handleCostRelChange:function(e){var t=this;var a=e.getParameters().newValue;var r=this.getView().getModel("NewModel");var s=t.getView().getModel("itemDetailModel");var i=s.getData();var o=e.getSource().getId();if(a!=""){var m=m==="0"?" ":a.toUpperCase();var l=[new sap.ui.model.Filter("SELKZ","EQ",m)];r.read("/bomcostrelvhSet",{filters:l,success:function(e){if(e.results.length>0){i.Costgrelv=e.results[0].SELKZ;i.Stext=e.results[0].STEXT;sap.ui.getCore().byId(o).setValueState("None")}else{i.Costgrelv="";i.Stext="";sap.ui.getCore().byId(o).setValueState("Error")}s.setData(i)},error:function(e){var t=JSON.parse(e.response.body);var a=t.error.message.value;sap.ui.getCore().byId(o).setValueStateText(a);sap.ui.getCore().byId(o).setValueState("Error")}})}},handleSaleRelChange:function(e){var t=this;var a=e.getParameters().newValue;var r=this.getView().getModel("NewModel");var s=t.getView().getModel("itemDetailModel");var i=s.getData();var o=e.getSource().getId();if(a!=""){var m=m==="0"?" ":a.toUpperCase();var l=[new sap.ui.model.Filter("RVREL","EQ",m)];r.read("/bomrelsalesSet",{filters:l,success:function(e){if(e.results.length>0){i.Rvrel=e.results[0].RVREL;i.Bezei=e.results[0].BEZEI;sap.ui.getCore().byId(o).setValueState("None")}else{i.Rvrel="";i.Bezei="";sap.ui.getCore().byId(o).setValueState("Error")}s.setData(i)},error:function(e){var t=JSON.parse(e.response.body);var a=t.error.message.value;sap.ui.getCore().byId(o).setValueStateText(a);sap.ui.getCore().byId(o).setValueState("Error")}})}},addSubItem:function(){var e=this.getView().getModel("itemDetailModel");var a=e.getData();var r=this.getView().getModel("subitemModel");var s=[];if(r!==undefined){s=r.getData()}var i=[];var o=new t;for(var m=0;m<s.length;m++){if(s[m].Posnr===a.Bomitmpos){var l={};l.Posnr=s[m].Posnr;l.Bomitmnod=s[m].Posnr;l.Bomsubno=s[m].Bomsubno;l.Ebort=s[m].Ebort;l.Upmng=s[m].Upmng;l.Uptxt=s[m].Uptxt;l.subqtyState=s[m].subqtyState;i.push(l)}}if(i!==null&&i.length!==0){var n=i.length;var g=parseInt(i[n-1].Bomsubno);var u=0;if(this.lastSubItm&&this.sFragmentName.indexOf("Search")>-1){u=parseInt(this.lastSubItm)}var d=g>u?g+1:u+1;while(d.toString().length<4){d="0"+d}var c={Bomitmnod:a.Bomitmpos,Posnr:a.Bomitmpos,Bomsubno:d,Ebort:"",Upmng:"",Uptxt:"",subqtyState:"None"};i.push(c);o.setData(i);s.push(c);r.setData(s);this.getView().setModel(o,"tableModel")}else{var c={Bomitmnod:a.Bomitmpos,Posnr:a.Bomitmpos,Bomsubno:"0001",Ebort:"",Upmng:"",Uptxt:"",subqtyState:"None"};i.push(c);o.setData(i);s.push(c);r.setData(s);this.getView().setModel(o,"tableModel")}},handleSubItemDlt:function(e){var t=e.getSource();var a=e.getParameter("listItem").getBindingContext("tableModel").sPath;a=a.substring(a.lastIndexOf("/")+1);var r=t.getModel("tableModel");var s=r.getProperty("/");var i=this.getView().getModel("tableModel").getData();var o=this.getView().getModel("subitemModel");var m=[];if(o!==undefined){m=o.getData()}for(var l=0;l<m.length;l++){if(s[parseInt(a)].Posnr===m[l].Posnr&&s[parseInt(a)].Bomsubno===m[l].Bomsubno){m.splice(l,1)}}o.setData(m);for(var l=0;l<i.length;l++){if(s[parseInt(a)].Posnr===i[l].Posnr&&s[parseInt(a)].Bomsubno===i[l].Bomsubno){i.splice(l,1)}}this.getView().getModel("tableModel").setData(i);if(this.sFragmentName.indexOf("Search")>-1){this.oModelUpdateFlag=true;sap.ui.getCore().setModel({updateFlag:this.oModelUpdateFlag},"oModelUpdateFlag")}},onSubItemChange:function(e){var t=e.getSource().getBindingInfo("value").binding.sPath;var a=e.getParameters().newValue;var r=e.getSource().getBindingContext("tableModel").sPath;var s=parseInt(r.substr(1));var i=this.getView().getModel("subitemModel").getData();var o=this.getView().getModel("tableModel");var m=o.getData();if(t==="Upmng"){if(a!==""){if(isNaN(a)){m[s].Upmng="";m[s].subqtyState="Error";o.setData(m);this.getView().setModel(o,"tableModel");for(var l=0;l<i.length;l++){if(i[l].Bomitmnod===m[s].Bomitmnod&&i[l].Bomsubno===m[s].Bomsubno){i[l].Upmng="";i[l].subqtyState="Error"}}}else{m[s].Upmng=a;m[s].subqtyState="None";o.setData(m);this.getView().setModel(o,"tableModel");for(var l=0;l<i.length;l++){if(i[l].Bomitmnod===m[s].Bomitmnod&&i[l].Bomsubno===m[s].Bomsubno){i[l].Upmng=a;i[l].subqtyState="None"}}}}else{m[s].subqtyState="Error";o.setData(m);this.getView().setModel(o,"tableModel");for(var l=0;l<i.length;l++){if(i[l].Bomitmnod===m[s].Bomitmnod&&i[l].Bomsubno===m[s].Bomsubno){i[l].Upmng="";i[l].subqtyState="Error"}}}}if(t==="Ebort"){if(a!==""){m[s].Ebort=a;o.setData(m);this.getView().setModel(o,"tableModel");for(var l=0;l<i.length;l++){if(i[l].Bomitmnod===m[s].Bomitmnod&&i[l].Bomsubno===m[s].Bomsubno){i[l].Ebort=a}}}}if(t==="Uptxt"){if(a!==""){m[s].Uptxt=a;o.setData(m);this.getView().setModel(o,"tableModel");for(var l=0;l<i.length;l++){if(i[l].Bomitmnod===m[s].Bomitmnod&&i[l].Bomsubno===m[s].Bomsubno){i[l].Uptxt=a}}}}if(this.sFragmentName.indexOf("Search")>-1){this.oModelUpdateFlag=true;sap.ui.getCore().setModel({updateFlag:this.oModelUpdateFlag},"oModelUpdateFlag")}},onItmDonePress:function(e){var t=e.getSource().getId();if(this.mode==="request"&&this.sCrStatus!=="true"){var a=this.getView().getModel("itemDetailModel").getData();var s=false;if(a.PGrpReq===true&&(a.Ekgrp===""||a.PGrpVS==="Error")){a.PGrpVS="Error";s=true}if(a.PrcReq===true){if(a.Preis===""||a.PriceVS==="Error"){a.PriceVS="Error";s=true}if(a.Waers===""||a.CrncyVS==="Error"){a.CrncyVS="Error";s=true}}if(a.PrcUnitReq===true&&(a.Peinh===""||a.PrcUnitVS==="Error")){a.PrcUnitVS="Error";s=true}if(a.MatGrpReq===true&&(a.Matkl===""||a.MatGrpVS==="Error")){a.MatGrpVS="Error";s=true}if(a.ItmTxt1Req===true&&(a.Potx1===""||a.ItmTxt1VS==="Error")){a.ItmTxt1VS="Error";s=true}if(a.DocReq===true&&(a.Bomdocitm===""||a.DocVS==="Error")){a.DocVS="Error";s=true}if(a.Size1Req===true&&(a.Roms1===""||a.Romei==="")){s=true}if(a.NumVarSizReq===true&&a.Roanz===""){s=true}var i=this.getView().getModel("tableModel").getData();var o=0;if(i!==null&&i.length!==0){for(var m=0;m<i.length;m++){o=o+parseInt(i[m].Upmng)}}else{o=a.Itmqty}if(i&&i.length>0){for(var l=0;l<i.length;l++){if(i[l].Upmng===""){i[l].subqtyState="Error";s=true}if(Number(i[l].Upmng)===0){i[l].subqtyState="Error";var n=this.getView().getModel("i18n").getProperty("QTY_ERR");this.createMessagePopover(n,"Error");return}}}if(a.Pmpfe==="+"&&a.Sanfe===false)s=true;if(a.Pmpin==="+"&&a.Sanin===false)s=true;if(a.Pmpko==="+"&&a.Sanko===false)s=true;if(s){this.getView().getModel("itemDetailModel").refresh();var g=this.getView().getModel("i18n").getProperty("MANDMSG");this.createMessagePopover(g,"Error");return}a.Itmqty=o.toString();if(a.Itmqty==="0"){a.itmQtyEnable=true}else if(i.length===0){a.itmQtyEnable=true;a.itmCatEnable=false}else{a.itmQtyEnable=false;a.itmCatEnable=false}if(t.indexOf("idBtnCheck")>-1){this.validateCheck();return}var u=sap.ui.getCore().getModel("refreshModel");u.setProperty("/refresh",false);if(this.sFragmentName==="SearchMaterialBom"||this.sFragmentName==="changeMbom"||this.sFragmentName==="SearchEquipmentBom"||this.sFragmentName==="changeEbom"||this.sFragmentName==="SearchFLBom"||this.sFragmentName==="changeFlbom"||this.sFragmentName==="SearchWBSBom"||this.sFragmentName==="changeWbsbom"){sap.ui.getCore().setModel({updateFlag:this.oModelUpdateFlag},"oModelUpdateFlag")}}else{if(this.sFragmentName.indexOf("Search")>-1){var u=sap.ui.getCore().getModel("refreshModel");u.setProperty("/refresh",false)}}var d=r.getInstance().getPreviousHash();if(d!==undefined){history.go(-1)}},validateCheck:function(){var e=this;var t=sap.ui.getCore().getModel("AIWFLOC").getData();var a=sap.ui.getCore().getModel("AIWEQUI").getData();var r=sap.ui.getCore().getModel("BOMDetailModel").getData();var i=sap.ui.getCore().getModel("tempCrTypeModel").getData();var o={ChangeRequestType:i.crtype,CrDescription:i.desc,IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};if(t.length>0){for(var m=0;m<t.length;m++){var n={Tplnr:t[m].Functionallocation,Txtmi:t[m].Flocdescription,TplkzFlc:t[m].Strucindicator,Tplxt:t[m].StrucIndicatorDesc,EditMask:t[m].EditMask,Hierarchy:t[m].Hierarchy,Fltyp:t[m].Floccategory,Flttx:t[m].FlocCategoryDesc,Swerk:t[m].Maintplant,Plantname:t[m].MaintplantDesc,StorFloc:t[m].Location,Locationdesc:t[m].Locationdesc,Abckzfloc:t[m].Abckz,Abctx:t[m].Abctx,Bukrsfloc:t[m].Bukrs,Butxt:t[m].Butxt,City:t[m].City,KostFloc:t[m].Kostl,KokrFloc:t[m].Kokrs,Contareaname:t[m].Mctxt,PlntFloc:t[m].Werks,Planningplantdes:t[m].Planningplantdes,Ingrp:t[m].Ingrp,Plannergrpdesc:t[m].Innam,Arbplfloc:t[m].Arbpl,Wergwfloc:t[m].WcWerks,Gewrkfloc:t[m].MainArbpl,MainWcPlant:t[m].MainWerks,Tplma:t[m].SupFunctionallocation,Supflocdesc:t[m].SupFlocdescription,BeberFl:t[m].BeberFl,Fing:t[m].Fing,Tele:t[m].Tele,Submtiflo:t[m].ConstrType,Constdesc:t[m].ConstructionDesc,Eqart:t[m].TechnicalObjectTyp,Eartx:t[m].Description,Stattext:t[m].Stattext,StsmFloc:t[m].StsmEqui,Statproftxt:t[m].StsmEquiDesc,UstwFloc:t[m].UstwEqui,UswoFloc:t[m].UswoEqui,UstaFloc:t[m].UstaEqui,Adrnri:t[m].Adrnri,Deact:t[m].Deact};o.FuncLoc.push(n);var g={Funcloc:t[m].Functionallocation,Title:t[m].TitleCode,Name1:t[m].Name1,Name2:t[m].Name2,Name3:t[m].Name3,Name4:t[m].Name4,Sort1:t[m].Sort1,Sort2:t[m].Sort2,NameCo:t[m].NameCo,PostCod1:t[m].PostCod1,City1:t[m].City1,Building:t[m].Building,Floor:t[m].Floor,Roomnum:t[m].Roomnum,Strsuppl1:t[m].Strsuppl1,Strsuppl2:t[m].Strsuppl2,Strsuppl3:t[m].Strsuppl3,Location:t[m].AddrLocation,RPostafl:t[m].RefPosta,Landx:t[m].Landx,TimeZone:t[m].TimeZone,RPostFl:t[m].Region,Regiotxt:t[m].RegionDesc};o.FLAddr.push(g);var u=t[m].intlAddr;if(u.length>0){for(var d=0;d<u.length;d++){o.FLAddrI.push(u[d])}}if(e.AltLblDerv==="2"&&t[m].altlbl.length>0){for(var c=0;c<t[m].altlbl.length;c++){var p={Funcloc:t[m].Functionallocation,AltAlkey:t[m].altlbl[c].AltAlkey,AltStrno:t[m].altlbl[c].AltStrno,AltTplkz:t[m].altlbl[c].AltTplkz};o.FLALTLBEL.push(p)}}if(t[m].Floccategory==="L"){var I={Funcloc:t[m].Functionallocation,Lrpid:t[m].lam.Lrpid,Strtptatr:t[m].lam.Strtptatr,Endptatr:t[m].lam.Endptatr,Length:t[m].lam.Length.toString(),LinUnit:t[m].lam.LinUnit,Startmrkr:t[m].lam.Startmrkr,Endmrkr:t[m].lam.Endmrkr,Mrkdisst:t[m].lam.Mrkdisst,Mrkdisend:t[m].lam.Mrkdisend,MrkrUnit:t[m].lam.MrkrUnit};o.FLLAM.push(I)}var h=t[m].classItems;if(h){if(h.length>0){for(var b=0;b<h.length;b++){var f={Funcloc:t[m].Functionallocation,Classtype:h[b].Classtype,Class:h[b].Class,Clstatus1:h[b].Clstatus1};o.FLClass.push(f)}}}var S=t[m].characteristics;if(S){if(S.length>0){for(var M=0;M<S.length;M++){var v={Funcloc:t[m].Functionallocation,Atnam:S[M].Atnam,Textbez:S[M].Textbez,Atwrt:S[M].Atwrt,Class:S[M].Class};o.FLVal.push(v)}}}}}if(a.length>0){for(var E=0;E<a.length;E++){var B={Herst:a[E].Herst,Equnr:a[E].Equnr,Txtmi:a[E].Eqktx,Swerk:a[E].Maintplant,Name1:a[E].MaintplantDesc,TplnEilo:a[E].Tplnr,Flocdescription:a[E].Pltxt,Eqtyp:a[E].EquipmentCatogory,Etytx:a[E].EquipCatgDescription,Eqart:a[E].TechnicalObjectTyp,Eartx:a[E].Description,Typbz:a[E].Typbz,SubmEeqz:a[E].ConstrType,Constdesc:a[E].ConstructionDesc,BukrEilo:a[E].Bukrs,Butxt:a[E].Butxt,HequEeqz:a[E].SuperordinateEquip,SuperordEqDes:a[E].SuperordinateEquipDesc,TidnEeqz:a[E].TechIdNum,KostEilo:a[E].Kostl,KokrEilo:a[E].Kokrs,Contareaname:a[E].Mctxt,StorEilo:a[E].Location,Locationdesc:a[E].Locationdesc,AbckEilo:a[E].Abckz,Abctx:a[E].Abctx,PplaEeqz:a[E].Werks,Planningplantdes:a[E].Planningplantdes,IngrEeqz:a[E].Ingrp,Plannergrpdesc:a[E].Innam,Serge:a[E].Serge,MapaEeqz:a[E].MapaEeqz,Stattext:a[E].Stattext,StsmEqui:a[E].StsmEqui,Statproftxt:a[E].StsmEquiDesc,UstwEqui:a[E].UstwEqui,UswoEqui:a[E].UswoEqui,UstaEqui:a[E].UstaEqui,Deact:a[E].Deact,Answt:a[E].Answt,Ansdt:e._formatDate(a[E].Ansdt),Waers:a[E].Waers,ArbpEilo:a[E].Arbpl,WorkCenterPlant:a[E].WcWerks,ArbpEeqz:a[E].MainArbpl,MainWcPlant:a[E].MainWerks,BebeEilo:a[E].BeberFl,Fing:a[E].Fing,Tele:a[E].Tele,HeqnEeqz:a[E].EquipPosition,Adrnri:a[E].Adrnri,Funcid:a[E].Funcid,Frcfit:a[E].Frcfit,Frcrmv:a[E].Frcrmv};o.Equipment.push(B);var V={Equi:a[E].Equnr,PlanvPrt:a[E].PlanvPrt,SteufPrt:a[E].SteufPrt,KtschPrt:a[E].KtschPrt,Ewformprt:a[E].Ewformprt,SteufRef:a[E].SteufRef,KtschRef:a[E].KtschRef,EwformRef:a[E].EwformRef};o.EqPRT.push(V);if(a[E].EquipmentCatogory==="L"){var P={Equi:a[E].Equnr,Lrpid:a[E].lam.Lrpid,Strtptatr:a[E].lam.Strtptatr,Endptatr:a[E].lam.Endptatr,Length:a[E].lam.Length.toString(),LinUnit:a[E].lam.LinUnit,Startmrkr:a[E].lam.Startmrkr,Endmrkr:a[E].lam.Endmrkr,Mrkdisst:a[E].lam.Mrkdisst,Mrkdisend:a[E].lam.Mrkdisend,MrkrUnit:a[E].lam.MrkrUnit};o.EqLAM.push(P)}var w={Equi:a[E].Equnr,Title:a[E].TitleCode,Name1:a[E].Name1,Name2:a[E].Name2,Name3:a[E].Name3,Name4:a[E].Name4,Sort1:a[E].Sort1,Sort2:a[E].Sort2,NameCo:a[E].NameCo,PostCod1:a[E].PostCod1,City1:a[E].City1,Building:a[E].Building,Floor:a[E].Floor,Roomnum:a[E].Roomnum,Strsuppl1:a[E].Strsuppl1,Strsuppl2:a[E].Strsuppl2,Strsuppl3:a[E].Strsuppl3,Location:a[E].AddrLocation,RefPosta:a[E].RefPosta,Landx:a[E].Landx,TimeZone:a[E].TimeZone,RfePost:a[E].Region,Regiotxt:a[E].RegionDesc};o.EqAddr.push(w);var R=a[E].intlAddr;if(R.length>0){for(var d=0;d<R.length;d++){o.EqAddrI.push(R[d])}}var D=a[E].classItems;if(D){if(D.length>0){for(var C=0;C<D.length;C++){var F={Equi:a[E].Equnr,Classtype:D[C].Classtype,Class:D[C].Class,Clstatus1:D[C].Clstatus1};o.EqClass.push(F)}}}var q=a[E].characteristics;if(q){if(q.length>0){for(var k=0;k<q.length;k++){var x={Equi:a[E].Equnr,Atnam:q[k].Atnam,Textbez:q[k].Textbez,Atwrt:q[k].Atwrt,Class:q[k].Class};o.EqVal.push(x)}}}}}if(this.sFragmentName.indexOf("MaterialBom")>-1){var y={Matnr:r.Matnr,Stalt:r.Stalt,Stlan:r.Stlan,Werks:r.Werks,Pmbomtech:r.Pmbomtech?r.Pmbomtech:"",PmbomtechTxt:r.PmbomtechTxt?r.PmbomtechTxt:"",Bomstatus:r.Bomstatus,Lngtxt:r.Lngtxt,Txtmi:r.Lngtxt,Validfrom:this._formatDate(r.Validfrom),Baseqty:r.BaseQty,Baseuom:r.BaseUom,Validtoda:this._formatDate(r.Validtoda)};o.MRBHeader.push(y);if(r.matItem){for(var T=0;T<r.matItem.length;T++){var N={Matnr:r.Matnr,Stlan:r.Stlan,Werks:r.Werks,Bomitmpos:r.matItem[T].Bomitmpos,Itemcat:r.matItem[T].Itemcat,Itemcomp:r.matItem[T].Itemcomp,Compdesc:"",Itmqty:r.matItem[T].Itmqty,Itmuom:r.matItem[T].Itmuom,Recurallo:r.matItem[T].Recurallo,Erskz:r.matItem[T].Erskz,Rvrel:r.matItem[T].Rvrel==="0"?"":r.matItem[T].Rvrel,Sanfe:r.matItem[T].Sanfe,Sanin:r.matItem[T].Sanin,Sanko:r.matItem[T].Sanko,Itmcmpdesc:r.matItem[T].Itmcmpdesc,Costgrelv:r.matItem[T].Costgrelv==="0"?"":r.matItem[T].Costgrelv};if(r.bomType==="Change"){N.Bomitmnod=r.matItem[T].Bomitmnod}if(r.matItem[T].Itemcat==="N"){N.Ekorg=r.matItem[T].Ekorg;N.Ekotx=r.matItem[T].Ekotx;N.Ekgrp=r.matItem[T].Ekgrp;N.Eknam=r.matItem[T].Eknam;N.Preis=r.matItem[T].Preis;N.Waers=r.matItem[T].Waers;N.Peinh=r.matItem[T].Peinh;N.Matkl=r.matItem[T].Matkl;N.Wgbez=r.matItem[T].Wgbez;N.Potx1=r.matItem[T].Potx1}else if(r.matItem[T].Itemcat==="D"){N.Bomdocitm=r.matItem[T].Bomdocitm;N.Bomitmdkr=r.matItem[T].Bomitmdkr;N.BomitmdkrTxt=r.matItem[T].BomitmdkrTxt;N.Bomitmdtl=r.matItem[T].Bomitmdtl;N.Bomitmdvr=r.matItem[T].Bomitmdvr}else if(r.matItem[T].Itemcat==="R"){N.Roms1=r.matItem[T].Roms1;N.Romei=r.matItem[T].Romei;N.Roms2=r.matItem[T].Roms2;N.Roms3=r.matItem[T].Roms3;N.Rform=r.matItem[T].Rform;N.Roanz=r.matItem[T].Roanz;N.Romen=r.matItem[T].Romen;N.Rokme=r.matItem[T].Rokme}else if(r.matItem[T].Itemcat==="T"){N.Potx1=r.matItem[T].Potx1}o.MRBItem.push(N)}}if(r.matSubItem){for(var O=0;O<r.matSubItem.length;O++){var L={Matnr:r.Matnr,Stlan:r.Stlan,Werks:r.Werks,Posnr:r.matSubItem[O].Posnr,Bomitmnod:r.matSubItem[O].Bomitmnod,Bomsubno:r.matSubItem[O].Bomsubno,Ebort:r.matSubItem[O].Ebort,Upmng:r.matSubItem[O].Upmng,Uptxt:r.matSubItem[O].Uptxt};o.MRBSBIT.push(L)}}}else if(this.sFragmentName.indexOf("EquipmentBom")>-1){var U={Eqnrbom:r.Eqnrbom,Stlan:r.Stlan,Werks:r.Werks,Bomstatus:r.Bomstatus,Lngtxt:r.Lngtxt,Txtmi:r.Lngtxt,Validfrom:this._formatDate(r.Validfrom),Baseqty:r.BaseQty,Baseuom:r.BaseUom,Validtoda:this._formatDate(r.Validtoda)};o.EBHeader.push(U);if(r.eqItem){for(var T=0;T<r.eqItem.length;T++){var A={Eqnrbom:r.Eqnrbom,Stlan:r.Stlan,Werks:r.Werks,Bomitmpos:r.eqItem[T].Bomitmpos,Itemcat:r.eqItem[T].Itemcat,Itemcomp:r.eqItem[T].Itemcomp,Compdesc:"",Itmqty:r.eqItem[T].Itmqty,Itmuom:r.eqItem[T].Itmuom,Recurallo:r.eqItem[T].Recurallo,Erskz:r.eqItem[T].Erskz,Rvrel:r.eqItem[T].Rvrel==="0"?"":r.eqItem[T].Rvrel,Sanfe:r.eqItem[T].Sanfe,Sanin:r.eqItem[T].Sanin,Sanko:r.eqItem[T].Sanko,Itmcmpdesc:r.eqItem[T].Itmcmpdesc,Costgrelv:r.eqItem[T].Costgrelv==="0"?"":r.eqItem[T].Costgrelv};if(r.bomType==="Change"){A.Bomitmnod=r.eqItem[T].Bomitmnod}if(r.eqItem[T].Itemcat==="N"){A.Ekorg=r.eqItem[T].Ekorg;A.Ekotx=r.eqItem[T].Ekotx;A.Ekgrp=r.eqItem[T].Ekgrp;A.Eknam=r.eqItem[T].Eknam;A.Preis=r.eqItem[T].Preis;A.Waers=r.eqItem[T].Waers;A.Peinh=r.eqItem[T].Peinh;A.Matkl=r.eqItem[T].Matkl;A.Wgbez=r.eqItem[T].Wgbez;A.Potx1=r.eqItem[T].Potx1}else if(r.eqItem[T].Itemcat==="D"){A.Bomdocitm=r.eqItem[T].Bomdocitm;A.Bomitmdkr=r.eqItem[T].Bomitmdkr;A.BomitmdkrTxt=r.eqItem[T].BomitmdkrTxt;A.Bomitmdtl=r.eqItem[T].Bomitmdtl;A.Bomitmdvr=r.eqItem[T].Bomitmdvr}else if(r.eqItem[T].Itemcat==="R"){A.Roms1=r.eqItem[T].Roms1;A.Romei=r.eqItem[T].Romei;A.Roms2=r.eqItem[T].Roms2;A.Roms3=r.eqItem[T].Roms3;A.Rform=r.eqItem[T].Rform;A.Roanz=r.eqItem[T].Roanz;A.Romen=r.eqItem[T].Romen;A.Rokme=r.eqItem[T].Rokme}else if(r.eqItem[T].Itemcat==="T"){A.Potx1=r.eqItem[T].Potx1}o.EBItem.push(A)}}if(r.eqSubItem){for(var O=0;O<r.eqSubItem.length;O++){var W={Eqnrbom:r.Eqnrbom,Stlan:r.Stlan,Werks:r.Werks,Posnr:r.eqSubItem[O].Posnr,Bomitmnod:r.eqSubItem[O].Bomitmnod,Bomsubno:r.eqSubItem[O].Bomsubno,Ebort:r.eqSubItem[O].Ebort,Upmng:r.eqSubItem[O].Upmng,Uptxt:r.eqSubItem[O].Uptxt};o.EBSBIT.push(W)}}}else if(this.sFragmentName.indexOf("FLBom")>-1){var z={Tplnrbom:r.Tplnrbom,Stlan:r.Stlan,Werks:r.Werks,Bomstatus:r.Bomstatus,Lngtxt:r.Lngtxt,Txtmi:r.Lngtxt,Validfrom:this._formatDate(r.Validfrom),Baseqty:r.BaseQty,Baseuom:r.BaseUom,Validtoda:this._formatDate(r.Validtoda)};o.FBHeader.push(z);if(r.flItem){for(var T=0;T<r.flItem.length;T++){var j={Tplnrbom:r.Tplnrbom,Stlan:r.Stlan,Werks:r.Werks,Bomitmpos:r.flItem[T].Bomitmpos,Itemcat:r.flItem[T].Itemcat,Itemcomp:r.flItem[T].Itemcomp,Compdesc:"",Itmqty:r.flItem[T].Itmqty,Itmuom:r.flItem[T].Itmuom,Recurallo:r.flItem[T].Recurallo,Erskz:r.flItem[T].Erskz,Rvrel:r.flItem[T].Rvrel==="0"?"":r.flItem[T].Rvrel,Sanfe:r.flItem[T].Sanfe,Sanin:r.flItem[T].Sanin,Sanko:r.flItem[T].Sanko,Itmcmpdesc:r.flItem[T].Itmcmpdesc,Costgrelv:r.flItem[T].Costgrelv==="0"?"":r.flItem[T].Costgrelv};if(r.bomType==="Change"){j.Bomitmnod=r.flItem[T].Bomitmnod}if(r.flItem[T].Itemcat==="N"){j.Ekorg=r.flItem[T].Ekorg;j.Ekotx=r.flItem[T].Ekotx;j.Ekgrp=r.flItem[T].Ekgrp;j.Eknam=r.flItem[T].Eknam;j.Preis=r.flItem[T].Preis;j.Waers=r.flItem[T].Waers;j.Peinh=r.flItem[T].Peinh;j.Matkl=r.flItem[T].Matkl;j.Wgbez=r.flItem[T].Wgbez;j.Potx1=r.flItem[T].Potx1}else if(r.flItem[T].Itemcat==="D"){j.Bomdocitm=r.flItem[T].Bomdocitm;j.Bomitmdkr=r.flItem[T].Bomitmdkr;j.BomitmdkrTxt=r.flItem[T].BomitmdkrTxt;j.Bomitmdtl=r.flItem[T].Bomitmdtl;j.Bomitmdvr=r.flItem[T].Bomitmdvr}else if(r.flItem[T].Itemcat==="R"){j.Roms1=r.flItem[T].Roms1;j.Romei=r.flItem[T].Romei;j.Roms2=r.flItem[T].Roms2;j.Roms3=r.flItem[T].Roms3;j.Rform=r.flItem[T].Rform;j.Roanz=r.flItem[T].Roanz;j.Romen=r.flItem[T].Romen;j.Rokme=r.flItem[T].Rokme}else if(r.flItem[T].Itemcat==="T"){j.Potx1=r.flItem[T].Potx1}o.FBItem.push(j)}}if(r.flSubItem){for(var O=0;O<r.flSubItem.length;O++){var H={Tplnrbom:r.Tplnrbom,Stlan:r.Stlan,Werks:r.Werks,Posnr:r.flSubItem[O].Posnr,Bomitmnod:r.flSubItem[O].Bomitmnod,Bomsubno:r.flSubItem[O].Bomsubno,Ebort:r.flSubItem[O].Ebort,Upmng:r.flSubItem[O].Upmng,Uptxt:r.flSubItem[O].Uptxt};o.FBSBIT.push(H)}}}else if(this.sFragmentName.indexOf("WBSBom")>-1){var _={WbsExt:r.WbsExt,MatnrWbs:r.Matnr,Stlan:r.Stlan,Werks:r.Werks,Bomstatus:r.Bomstatus,Lngtxt:r.Lngtxt,Txtmi:r.Lngtxt,Validfrom:this._formatDate(r.Validfrom),Baseqty:r.BaseQty,Baseuom:r.BaseUom,Validtoda:this._formatDate(r.Validtoda)};o.WBHeader.push(_);if(r.wbsItem){for(var T=0;T<r.wbsItem.length;T++){var Q={WbsExt:r.WbsExt,MatnrWbs:r.Matnr,Stlan:r.Stlan,Werks:r.Werks,Bomitmpos:r.wbsItem[T].Bomitmpos,Itemcat:r.wbsItem[T].Itemcat,Itemcomp:r.wbsItem[T].Itemcomp,Compdesc:"",Itmqty:r.wbsItem[T].Itmqty,Itmuom:r.wbsItem[T].Itmuom,Recurallo:r.wbsItem[T].Recurallo,Erskz:r.wbsItem[T].Erskz,Rvrel:r.wbsItem[T].Rvrel==="0"?"":r.wbsItem[T].Rvrel,Sanfe:r.wbsItem[T].Sanfe,Sanin:r.wbsItem[T].Sanin,Sanko:r.wbsItem[T].Sanko,Itmcmpdesc:r.wbsItem[T].Itmcmpdesc,Costgrelv:r.wbsItem[T].Costgrelv==="0"?"":r.wbsItem[T].Costgrelv};if(r.bomType==="Change"){Q.Bomitmnod=r.wbsItem[T].Bomitmnod}if(r.wbsItem[T].Itemcat==="N"){Q.Ekorg=r.wbsItem[T].Ekorg;Q.Ekotx=r.wbsItem[T].Ekotx;Q.Ekgrp=r.wbsItem[T].Ekgrp;Q.Eknam=r.wbsItem[T].Eknam;Q.Preis=r.wbsItem[T].Preis;Q.Waers=r.wbsItem[T].Waers;Q.Peinh=r.wbsItem[T].Peinh;Q.Matkl=r.wbsItem[T].Matkl;Q.Wgbez=r.wbsItem[T].Wgbez;Q.Potx1=r.wbsItem[T].Potx1}else if(r.wbsItem[T].Itemcat==="D"){Q.Bomdocitm=r.wbsItem[T].Bomdocitm;Q.Bomitmdkr=r.wbsItem[T].Bomitmdkr;Q.BomitmdkrTxt=r.wbsItem[T].BomitmdkrTxt;Q.Bomitmdtl=r.wbsItem[T].Bomitmdtl;Q.Bomitmdvr=r.wbsItem[T].Bomitmdvr}else if(r.wbsItem[T].Itemcat==="R"){Q.Roms1=r.wbsItem[T].Roms1;Q.Romei=r.wbsItem[T].Romei;Q.Roms2=r.wbsItem[T].Roms2;Q.Roms3=r.wbsItem[T].Roms3;Q.Rform=r.wbsItem[T].Rform;Q.Roanz=r.wbsItem[T].Roanz;Q.Romen=r.wbsItem[T].Romen;Q.Rokme=r.wbsItem[T].Rokme}else if(r.wbsItem[T].Itemcat==="T"){Q.Potx1=r.wbsItem[T].Potx1}o.WBItem.push(Q)}}if(r.wbsSubItem){for(var O=0;O<r.wbsSubItem.length;O++){var G={WbsExt:r.WbsExt,MatnrWbs:r.Matnr,Stlan:r.Stlan,Werks:r.Werks,Posnr:r.wbsSubItem[O].Posnr,Bomitmnod:r.wbsSubItem[O].Bomitmnod,Bomsubno:r.wbsSubItem[O].Bomsubno,Ebort:r.wbsSubItem[O].Ebort,Upmng:r.wbsSubItem[O].Upmng,Uptxt:r.wbsSubItem[O].Uptxt};o.WBSBIT.push(G)}}}var K=new l;K.open();var J=this.getView().getModel();J.create("/ChangeRequestSet",o,{success:function(t){K.close();var a=t;var r=[];for(var i=0;i<a.Messages.results.length;i++){r.push({type:s.getMessageType(a.Messages.results[i].Type),title:a.Messages.results[i].Message})}e.createMessagePopover(r,"")},error:function(e){K.close();var t=[],a=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var s=t.join("\n");sap.m.MessageBox.show(s,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var a=[];var r,s=this._getMessagePopover();if(typeof e==="string"){a.push({type:t,title:e,message:e})}else if(Array.isArray(e)){a=e;for(var i=0;i<a.length;i++){a[i].message=a[i].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var i=0;i<a.length;i++){r=new n({message:a[i].message,type:a[i].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(r)}s.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(a.length+"")},onSizeChange:function(){this.readSizeDetails()},readSizeDetails:function(){var e=this;var t;var a=sap.ui.getCore().getModel("BOMDetailModel").getData();var r=this.getView().getModel("itemDetailModel").getData();var s=this.getView().getModel();var i=a.Stalt?a.Stalt:"";var o=[new sap.ui.model.Filter("Matnr","EQ",a.Matnr),new sap.ui.model.Filter("Werks","EQ",a.Werks),new sap.ui.model.Filter("Stlan","EQ",a.Stlan),new sap.ui.model.Filter("Stalt","EQ",i),new sap.ui.model.Filter("Postp","EQ",r.Itemcat),new sap.ui.model.Filter("Component","EQ",r.Itemcomp),new sap.ui.model.Filter("Menge","EQ",r.Itmqty),new sap.ui.model.Filter("Romei","EQ",r.Romei),new sap.ui.model.Filter("Roms1","EQ",r.Roms1),new sap.ui.model.Filter("Roms2","EQ",r.Roms2),new sap.ui.model.Filter("Roms3","EQ",r.Roms3),new sap.ui.model.Filter("Rform","EQ",r.Rform),new sap.ui.model.Filter("Roanz","EQ",r.Roanz),new sap.ui.model.Filter("Romen","EQ",r.Romen),new sap.ui.model.Filter("Rokme","EQ",r.Rokme)];this.BusyDialog.open();s.read("/DeriveBOMITMSet",{filters:o,success:function(t){e.BusyDialog.close();var a=t.results[0];r.Roms1=a.Roms1;r.Romei=a.Romei;r.Roms2=a.Roms2;r.Roms3=a.Roms3;r.Rform=a.Rform;r.Roanz=a.Roanz;r.Romen=a.Romen;r.Rokme=a.Rokme;e.getView().getModel("itemDetailModel").refresh()},error:function(t){e.BusyDialog.close();var a=[],r=[];if(JSON.parse(t.responseText).error.innererror.errordetails===undefined||JSON.parse(t.responseText).error.innererror.errordetails.length===0){a[0]=JSON.parse(t.responseText).error.message.value}else{for(var s=0;s<JSON.parse(t.responseText).error.innererror.errordetails.length;s++){a[s]=JSON.parse(t.responseText).error.innererror.errordetails[s].message}}var i=a.join("\n");e.createMessagePopover(i,"Error")}})}})});