sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","ugiaiwui/mdg/aiw/request/model/formatter","sap/ui/core/routing/History","sap/ui/core/routing/Router","sap/m/MessageBox","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider","sap/ui/core/message/Message","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest"],function(e,t,a,r,i,o,l,n,s){"use strict";return e.extend("ugiaiwui.mdg.aiw.request.controller.TLOperationDetail",{formatter:a,onInit:function(){var e,a=new t({busy:true,delay:0});this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()));var r=this._oComponent.getModel();r.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(r);var i=this._oComponent.getModel("NewModel");this.getView().setModel(i,"valueHelp");var o=this._oComponent.getModel("NewModel2");this.getView().setModel(o,"valueHelp2");this.getRouter().getRoute("tlOprDetail").attachPatternMatched(this._onObjectMatched,this);e=this.getView().getBusyIndicatorDelay();this.setModel(a,"objectView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){a.setProperty("/delay",e)});var l=sap.ui.getCore().getMessageManager();this.getView().setModel(l.getMessageModel(),"message");l.registerObject(this.getView(),true)},showMessage:function(e){this.createMessagePopover(e,"Error")},_onObjectMatched:function(e){var t=new sap.ui.model.json.JSONModel;var a=sap.ui.getCore().getModel("tlDetailModel");t.setData(a.getProperty(decodeURIComponent(e.getParameter("arguments").itemPath)));this.setModel(t,"oprDetailView");this.itemPath=e.getParameter("arguments").itemPath;var r=e.getParameter("arguments").mainPath;this.mainPath=decodeURIComponent(r).substr(2,4);var i=e.getParameter("arguments").basicPath;this.basicPath=decodeURIComponent(i);this.action=e.getParameter("arguments").action;var o=decodeURIComponent(this.itemPath);var l=this.mainPath+o;this.itmDetailPath=l;var n=new sap.ui.model.json.JSONModel;var s=sap.ui.getCore().getModel("tlDetailModel");this.operationDetail=s.getProperty(o);n.setData(this.operationDetail);this.mode=e.getParameter("arguments").mode;if(this.mode==="display"){this.operationDetail.enable=false;this.operationDetail.WorkEnable=false;this.operationDetail.visible=true}else{this.operationDetail.enable=true;this.operationDetail.visible=false;var p=e.getParameter("arguments").ctrlKey;var u=e.getParameter("arguments").wc;var g=e.getParameter("arguments").wcPlant;this.operationDetail.Steus=p;if(u!=="null"){this.operationDetail.Arbpl=u}if(g!=="null"){this.operationDetail.Werks=g}}this.getView().bindElement({path:decodeURIComponent(e.getParameter("arguments").itemPath),model:"tlOpDetailModel"});if(this.operationDetail.Arbpl!==""){this.operationDetail.wcDtValueState="None"}if(this.operationDetail.Werks!==""){this.operationDetail.opPlantValueState="None"}if(this.operationDetail.Ltxa1!==""){this.operationDetail.opDescValueState="None"}n.setData(this.operationDetail);this.getView().setModel(n,"tlOpDetailModel")},disableFields:function(){var e={enable:false};var t=new sap.ui.model.json.JSONModel;t.setData(e);this.getView().setModel(t,"tlOpDetailModel")},enableFields:function(){var e={enable:true};var t=new sap.ui.model.json.JSONModel;t.setData(e);this.getView().setModel(t,"tlOpDetailModel")},parseFlag:function(e){if(e==="X"){return true}else{return false}},parseQualification:function(e){if(e==="S"||e==="C"||e==="QP"){return true}else{return false}},validateFields:function(){var e=this;var t=true;var a=[];var r=this.getView().getModel("tlOpDetailModel");if(e.operationDetail.Vornr===""||e.operationDetail.Arbpl===""||e.operationDetail.Werks===""||e.operationDetail.Steus===""||e.operationDetail.Ltxa1===""){t=false;if(e.operationDetail.Vornr===""||e.operationDetail.opNumDtValueState==="Error"){e.operationDetail.opNumDtValueState="Error"}if(e.operationDetail.Arbpl===""){e.operationDetail.wcDtValueState="Error"}if(e.operationDetail.Werks===""){e.operationDetail.opPlantValueState="Error"}if(e.operationDetail.Steus===""){e.operationDetail.opCtrlKeyValueState="Error"}if(e.operationDetail.Ltxa1===""){e.operationDetail.opDescValueState="Error"}}if(!t){a.push({type:"Error",title:e.getView().getModel("i18n").getProperty("MANDMSG"),message:e.getView().getModel("i18n").getProperty("MANDMSG")})}if(e.operationDetail.Steus==="PM05"){if(parseInt(e.operationDetail.Arbei)===0||e.operationDetail.Arbei===""){e.operationDetail.ArbeiVS="Error";a.push({type:"Error",title:"Enter Work",message:"Enter Work"});t=false}if(e.operationDetail.Arbeh===""){e.operationDetail.wrkUntValueState="Error";a.push({type:"Error",title:"Enter Work Unit",message:"Enter Work Unit"});t=false}if(parseInt(e.operationDetail.Anzzl)===0||e.operationDetail.Anzzl===""){e.operationDetail.AnzzlVS="Error";a.push({type:"Error",title:"Enter Number",message:"Enter Number"});t=false}if(parseInt(e.operationDetail.Dauno)===0||e.operationDetail.Dauno===""){e.operationDetail.DaunoVS="Error";a.push({type:"Error",title:"Enter Duration",message:"Enter Duration"});t=false}if(e.operationDetail.Daune===""){e.operationDetail.durUntValueState="Error";a.push({type:"Error",title:"Enter Duration Unit",message:"Enter Duration Unit"});t=false}if(e.operationDetail.Indet===""){e.operationDetail.calcKeyValueState="Error";a.push({type:"Error",title:"Enter Calculation Key",message:"Enter Calculation Key"});t=false}if(e.operationDetail.Larnt===""){e.operationDetail.opActTypValueState="Error";a.push({type:"Error",title:"Enter Activity Type",message:"Enter Activity Type"});t=false}if(e.operationDetail.workPerc===""){e.operationDetail.workPercVS="Error";a.push({type:"Error",title:"Enter Work Percentage",message:"Enter Work Percentage"});t=false}if(e.operationDetail.materialGrp===""){e.operationDetail.materialGrpVS="Error";a.push({type:"Error",title:"Enter material group",message:"Enter material group"});t=false}}if(e.operationDetail.Steus==="PM02"||e.operationDetail.Steus==="PM03"){if(e.operationDetail.orderQty===""){e.operationDetail.orderQtyVS="Error";a.push({type:"Error",title:"Enter order quantity",message:"Enter order quantity"});t=false}if(e.operationDetail.ordQtyUnit===""){e.operationDetail.ordQtyUnitVS="Error";a.push({type:"Error",title:"Enter order quantity unit",message:"Enter order quantity unit"});t=false}if(e.operationDetail.netPrice===""){e.operationDetail.netPriceVS="Error";a.push({type:"Error",title:"Enter net price",message:"Enter net price"});t=false}if(e.operationDetail.currency===""){e.operationDetail.currencyVS="Error";a.push({type:"Error",title:"Enter currency",message:"Enter currency"});t=false}if(e.operationDetail.priceUnit===""){e.operationDetail.priceUnitVS="Error";a.push({type:"Error",title:"Enter price unit",message:"Enter price unit"});t=false}if(e.operationDetail.costElement===""){e.operationDetail.costElementVS="Error";a.push({type:"Error",title:"Enter cost element",message:"Enter cost element"});t=false}if(e.operationDetail.materialGrp===""){e.operationDetail.materialGrpVS="Error";a.push({type:"Error",title:"Enter material group",message:"Enter material group"});t=false}if(e.operationDetail.puchGroup===""){e.operationDetail.puchGroupVS="Error";a.push({type:"Error",title:"Enter purchase group",message:"Enter purchase group"});t=false}if(e.operationDetail.purchOrg===""){e.operationDetail.purchOrgVS="Error";a.push({type:"Error",title:"Enter purchase org",message:"Enter purchase org"});t=false}}if(!t){r.setData(e.operationDetail);e.getView().setModel(r,"tlOpDetailModel");e.createMessagePopover(a,"Error")}return t},onCalculate:function(){this.operationDetail=this.getView().getModel("tlOpDetailModel").getData();var e=this.operationDetail.Indet;var t=this.operationDetail.Werks;var a=this.operationDetail.Arbpl;var r=this.operationDetail.Daune;var i=this.operationDetail.Arbei;var o=this.operationDetail.Dauno;var l=this.operationDetail.Arbeh;var n=this.operationDetail.Anzzl;this.calculate(e,t,a,r,i,o,l,n)},calculate:function(e,t,a,r,i,o,l,n){var s=this.getView().getModel("tlOpDetailModel");var p=this;var u=this.getView().getModel("valueHelp");var g=[];if(o===""){o=0+"m"}else{o=parseInt(o)+"m"}if(i===""){i=0+"m"}else{i=parseInt(i)+"m"}var c="/Work2DurationSet(Anzzl="+n+",Dauno="+o+",Indet='"+e+"',Werks='"+t+"',Arbpl='"+a+"',Daune='"+r+"',Arbei="+i+",Arbeh='"+l+"')";u.read(c,{success:function(e){g=e;var t=e.Anzzl;var a=e.Dauno;var r=e.Indet;var i=e.Daune;var o=e.Arbei;var l=e.Arbeh;p.operationDetail.Anzzl=t;p.operationDetail.Dauno=a;p.operationDetail.Indet=r;p.operationDetail.Arbei=o;s.setData(p.operationDetail);p.getView().setModel(s,"tlOpDetailModel")},error:function(e){}})},onCtrlKeyVH:function(e){var t=this;var a=this.getView().getModel("tlOpDetailModel");var r={title:this.getView().getModel("i18n").getProperty("OP_CTRL_KEY"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/ControlKeySet",template:new sap.m.StandardListItem({title:"{Steus}",description:"{Txt}"})},confirm:function(e){t.operationDetail.Steus=e.getParameters().selectedItem.getProperty("title");a.setData(t.operationDetail)}};var i="/ControlKeySet";var o=this.getView().getModel("valueHelp");var n=[new sap.ui.model.Filter("Steus","GE","PM01"),new sap.ui.model.Filter("Steus","LE","PM05")];var s=l.getSelectDialog(o,i,n,r,"Steus","Txt");s.open()},onWCOpVH:function(e){var t=this;var a=this.getView().getModel("tlOpDetailModel");var r;if(r===undefined){var i=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("WC"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Work Center Category"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Plant"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Work Center"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Description"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Language"})]})],items:{path:"/WorkCenterVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"})]})},confirm:function(e){t.operationDetail.wcDtValueState="None";t.operationDetail.Arbpl=e.getParameter("selectedItem").getCells()[2].getText();t.operationDetail.Werks=e.getParameter("selectedItem").getCells()[1].getText();t.operationDetail.Larnt=e.getParameter("selectedItem").getBindingContext().getObject().Lar01;a.setData(t.operationDetail)},search:function(e){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Arbpl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ktext",sap.ui.model.FilterOperator.Contains,t)],false)])}});var o="/WorkCenterVHSet";var l=this.getView().getModel("valueHelp");l.read(o,{success:function(e,a){var o=sap.ui.getCore().getModel("AIWListWCModel").getData();if(o.length>0){for(var l=0;l<o.length;l++){if(o[l].wc){var n={Verwe:o[l].wcCat,Werks:o[l].plant,Arbpl:o[l].wc,Ktext:o[l].wcDesc,Larnt:o[l].Larnt,Spras:e.results[0].Spras};e.results.unshift(n)}}}if(e.results.length>0){r=e;var s=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"})]});var p=new sap.ui.model.json.JSONModel;p.setData(e);i.setModel(p);i.bindAggregation("items","/results",s)}else{i.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var n=new sap.ui.model.json.JSONModel;n.setData(r);i.setModel(n);var s=i.getItems();for(var p=0;p<s.length;p++){s[p].setVisible(true)}}i.open()},onPlantOpVH:function(e){var t=this;var a=this.getView().getModel("tlOpDetailModel");var r={title:this.getView().getModel("i18n").getProperty("PLANT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>PLANT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>SEARCHTERM2}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>SEARCHTERM1}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>POST_CODE}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>CITY}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>Name2}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>Name}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>ADDRESS}"})]})],items:{path:"/PlantVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{AddrVersion}"})]})},confirm:function(e){t.operationDetail.opPlantValueState="None";t.operationDetail.Werks=e.getParameter("selectedItem").getCells()[0].getText();a.setData(t.operationDetail)}};var i="/PlantVHSet";var o=[];var n=this.getView().getModel("valueHelp");var s=[new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{AddrVersion}"})];var p=l.getValueHelp(n,i,s,o,r,"Plant","Name");p.open();p.setModel(t.getView().getModel("i18n"),"i18n")},onActivityTypVH:function(e){var t=this;var a=this.getView().getModel("tlOpDetailModel");var r=t.operationDetail.Werks;var i=t.operationDetail.Arbpl;var o={title:this.getView().getModel("i18n").getProperty("OP_ACT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>ACT_TYP}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>FISCAL_YR}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>Name1}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"CO Area"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>VALID_TO}"})]})],items:{path:"/ActivityTypeSet?$filter=Werks eq '"+r+"' and Arbpl eq '"+i+"'",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Lstar}"}),new sap.m.Text({text:"{Gjahr}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Kokrs}"}),new sap.m.Text({text:"{Datbi}"})]})},confirm:function(e){t.operationDetail.opActTypValueState="None";t.operationDetail.Larnt=e.getParameter("selectedItem").getCells()[0].getText();t.operationDetail.actTypDesc=e.getParameter("selectedItem").getCells()[2].getText();a.setData(t.operationDetail)}};var n=this.getView().getModel("valueHelp");var s="/ActivityTypeSet";var p=[new sap.ui.model.Filter("Werks","EQ",r),new sap.ui.model.Filter("Arbpl","EQ",i)];var u=[new sap.m.Text({text:"{Lstar}"}),new sap.m.Text({text:"{Gjahr}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Kokrs}"}),new sap.m.Text({text:"{Datbi}"})];var g=l.getValueHelp(n,s,u,p,o,"Lstar","Ktext");g.open();g.setModel(t.getView().getModel("i18n"),"i18n")},onDuratnUOMVH:function(e){var t=e.getSource().mBindingInfos.value.binding.sPath;t=t.substring(1);this.workUOMVH(t,e)},onWorkUOMVH:function(e){var t=e.getSource().mBindingInfos.value.binding.sPath;t=t.substring(1);this.workUOMVH(t,e)},workUOMVH:function(e,t){var a=this;var r=this.getView().getModel("tlOpDetailModel");var i;var o=this.getView().getModel("i18n").getProperty("OP_CTRL_KEY");if(e==="Arbeh"){i=a.operationDetail.Arbeh;o=this.getView().getModel("i18n").getProperty("OP_UWORK")}else if(e==="Daune"){i=a.operationDetail.Daune;o=this.getView().getModel("i18n").getProperty("OP_UDURATION")}var n={title:o,noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/TimeUintSet",template:new sap.m.StandardListItem({title:"{Msehi}",description:"{Msehl}"})},confirm:function(t){if(e==="Arbeh"){a.operationDetail.wrkUntValueState="None";a.operationDetail.Arbeh=t.getParameters().selectedItem.getProperty("title")}else if(e==="Daune"){a.operationDetail.durUntValueState="None";a.operationDetail.Daune=t.getParameters().selectedItem.getProperty("title")}r.setData(a.operationDetail);a.onCalculate()}};var s="/TimeUintSet";var p=this.getView().getModel("valueHelp2");var u=l.getSelectDialog(p,s,[],n,"Msehi","Msehl");u.open()},onCalcKeyVH:function(e){var t=this;var a=this.getView().getModel("tlOpDetailModel");var r={title:this.getView().getModel("i18n").getProperty("OP_CALC_KEY"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/DomFixValSet",template:new sap.m.StandardListItem({title:"{DomvalueL}",description:"{Ddtext}"})},confirm:function(e){t.operationDetail.calcKeyValueState="None";t.operationDetail.Indet=e.getParameters().selectedItem.getProperty("title");t.operationDetail.calcKeyDesc=e.getParameters().selectedItem.getProperty("description");a.setData(t.operationDetail);t.onCalculate()}};var i="/DomFixValSet";var o=[new sap.ui.model.Filter("Domname","EQ","INDET")];var n=this.getView().getModel("valueHelp");var s=l.getSelectDialog(n,i,o,r,"DomvalueL","Ddtext");s.open()},onChange:function(e){var t=e.getSource().getValue();var a;var r=e.getSource().mBindingInfos.value.binding;if(r!==undefined&&r!==null){a=r.sPath}else{a=e.getSource().mBindingInfos.value.parts[0].path}a=a.substring(1);switch(a){case"Arbpl":this._mainWc(t,e);break;case"Werks":this._plant(t,e);break;case"Steus":this._ctrlKey(t,e);break;case"Arbeh":this._wrkUnit(t,e);break;case"Daune":this._durUnit(t,e);break;case"Indet":this._calculationKey(t,e);break;case"Larnt":this._activityType(t,e);break}},_mainWc:function(e){var t=this;var a=e;var r=this.getView().getModel("tlOpDetailModel");var i=a.replace(/^[ ]+|[ ]+$/g,"");if(i!==""){var o=this.getView().getModel("valueHelp");var l="/WorkCenterVHSet";var n=[new sap.ui.model.Filter("Arbpl","EQ",a)];o.read(l,{filters:n,success:function(e,a){if(e.results.length>0){t.operationDetail.wcDtValueState="None";t.operationDetail.Arbpl=i;t.operationDetail.Werks=e.results[0].Werks;t.operationDetail.Larnt=e.results[0].Lar01;r.setData(t.operationDetail)}else{t.operationDetail.wcDtValueState="Error";t.operationDetail.Werks="";t.operationDetail.Larnt="";t.operationDetail.wcDtValueStateTxt="Invalid Entry";r.setData(t.operationDetail)}},error:function(e){t.operationDetail.wcDtValueState="Error";var a=JSON.parse(e.responseText);var i=a.error.message.value;t.operationDetail.wcDtValueStateTxt=i;r.setData(t.operationDetail)}})}else{t.operationDetail.Arbpl=i;r.setData(t.operationDetail)}},_plant:function(e,t){var a=this;var r=e;var i=this.getView().getModel("tlOpDetailModel");var o=r.replace(/^[ ]+|[ ]+$/g,"");if(o!==""){var l=this.getView().getModel("valueHelp");var n="/PlantVHSet";var s=[new sap.ui.model.Filter("Plant","EQ",r)];l.read(n,{filters:s,success:function(e,t){if(e.results.length>0){a.operationDetail.opPlantValueState="None";a.operationDetail.Werks=o;i.setData(a.operationDetail)}else{a.operationDetail.opPlantValueState="Error";a.operationDetail.opPlantValueStateTxt="Invalid Entry";i.setData(a.operationDetail)}},error:function(e){a.operationDetail.opPlantValueState="Error";var t=JSON.parse(e.responseText);var r=t.error.message.value;a.operationDetail.opPlantValueStateTxt=r;i.setData(a.operationDetail)}})}else{a.operationDetail.Werks=o;i.setData(a.operationDetail)}},_ctrlKey:function(e){var t=this;var a=e;var a=a.toUpperCase();var r=this.getView().getModel("tlOpDetailModel");var i=a.replace(/^[ ]+|[ ]+$/g,"");if(i!==""){var o=this.getView().getModel("valueHelp");var l="/ControlKeySet";var n=[new sap.ui.model.Filter("Steus","EQ",a),new sap.ui.model.Filter("Steus","GE","PM01"),new sap.ui.model.Filter("Steus","LE","PM05")];o.read(l,{filters:n,success:function(e,a){if(e.results.length>0){t.operationDetail.opCtrlKeyValueState="None";t.operationDetail.Steus=i;r.setData(t.operationDetail)}else{t.operationDetail.opCtrlKeyValueState="Error";t.operationDetail.opCtrlKeyValueStateTxt="Invalid Entry";r.setData(t.operationDetail)}},error:function(e){t.operationDetail.opCtrlKeyValueState="Error";var a=JSON.parse(e.responseText);var i=a.error.message.value;t.operationDetail.opCtrlKeyValueStateTxt=i;r.setData(t.operationDetail)}})}else{t.operationDetail.Steus=i;r.setData(t.operationDetail)}},_wrkUnit:function(e,t){var a=this;var r=e;var i=this.getView().getModel("tlOpDetailModel");r=r.toUpperCase();var o=r.replace(/^[ ]+|[ ]+$/g,"");if(o!==""){var l=this.getView().getModel("valueHelp2");var n="/TimeUintSet";var s=[new sap.ui.model.Filter("Msehi","EQ",r)];l.read(n,{filters:s,success:function(e,t){if(e.results.length>0){a.operationDetail.wrkUntValueState="None";a.operationDetail.Arbeh=o;i.setData(a.operationDetail);a.onCalculate()}else{a.operationDetail.wrkUntValueState="Error";a.operationDetail.wrkUntValueStateTxt="Invalid Entry";i.setData(a.operationDetail)}},error:function(e){a.operationDetail.wrkUntValueState="Error";var t=JSON.parse(e.responseText);var r=t.error.message.value;a.operationDetail.wrkUntValueStateTxt=r;i.setData(a.operationDetail)}})}else{a.operationDetail.Arbeh=o;i.setData(a.operationDetail)}},_durUnit:function(e,t){var a=this;var r=e;var i=this.getView().getModel("tlOpDetailModel");r=r.toUpperCase();var o=r.replace(/^[ ]+|[ ]+$/g,"");if(o!==""){var l=this.getView().getModel("valueHelp2");var n="/TimeUintSet";var s=[new sap.ui.model.Filter("Msehi","EQ",r)];l.read(n,{filters:s,success:function(e,t){if(e.results.length>0){a.operationDetail.durUntValueState="None";a.operationDetail.Daune=o;i.setData(a.operationDetail);a.onCalculate()}else{a.operationDetail.durUntValueState="Error";a.operationDetail.durUntValueStateTxt="Invalid Entry";i.setData(a.operationDetail)}},error:function(e){a.operationDetail.durUntValueState="Error";var t=JSON.parse(e.responseText);var r=t.error.message.value;a.operationDetail.durUntValueStateTxt=r;i.setData(a.operationDetail)}})}else{a.operationDetail.Daune=o;i.setData(a.operationDetail)}},_calculationKey:function(e,t){var a=this;var r=e;var i=this.getView().getModel("tlOpDetailModel");var o=r.replace(/^[ ]+|[ ]+$/g,"");if(o!==""){var l=this.getView().getModel("valueHelp");var n="/DomFixValSet";var s=[new sap.ui.model.Filter("Domname","EQ","INDET"),new sap.ui.model.Filter("DomvalueL","EQ",r)];l.read(n,{filters:s,success:function(e,t){if(e.results.length>0){a.operationDetail.calcKeyValueState="None";a.operationDetail.Indet=o;a.operationDetail.calcKeyDesc=e.results[0].Ddtext;i.setData(a.operationDetail);a.onCalculate()}else{a.operationDetail.calcKeyValueState="Error";a.operationDetail.calcKeyDesc="";a.operationDetail.calcKeyValueStateTxt="Invalid Entry";i.setData(a.operationDetail)}},error:function(e){a.operationDetail.calcKeyValueState="Error";var t=JSON.parse(e.responseText);var r=t.error.message.value;a.operationDetail.calcKeyValueStateTxt=r;i.setData(a.operationDetail)}})}else{a.operationDetail.Indet=o;i.setData(a.operationDetail)}},_activityType:function(e){var t=this;var a=e;var r=this.getView().getModel("tlOpDetailModel");var i=a.replace(/^[ ]+|[ ]+$/g,"");if(i!==""){var o=this.getView().getModel("valueHelp");var l="/ActivityTypeSet";var n=[new sap.ui.model.Filter("Lstar","EQ",a),new sap.ui.model.Filter("Werks","EQ",t.operationDetail.Werks),new sap.ui.model.Filter("Arbpl","EQ",t.operationDetail.Arbpl)];o.read(l,{filters:n,success:function(e,a){if(e.results.length>0){t.operationDetail.opActTypValueState="None";t.operationDetail.Larnt=i;t.operationDetail.actTypDesc=e.resutls[0].Ktext;r.setData(t.operationDetail)}else{t.operationDetail.opActTypValueState="Error";t.operationDetail.actTypDesc="";t.operationDetail.opActTypValueStateTxt="Invalid Entry";r.setData(t.operationDetail)}},error:function(e){t.operationDetail.opActTypValueState="Error";var a=JSON.parse(e.responseText);var i=a.error.message.value;t.operationDetail.opActTypValueStateTxt=i;r.setData(t.operationDetail)}})}else{t.operationDetail.Larnt=i;r.setData(t.operationDetail)}},DescChange:function(){this.operationDetail.opDescValueState="None";this.getView().getModel("tlOpDetailModel").setData(this.operationDetail)},onLiveChange:function(e){if(e.getSource().getValue()===" "){e.getSource().setValue("")}e.getSource().setValueState("None")},onOprDonePress:function(e){if(this.mode!=="display"){var t=e.getSource().getId();var a=this.validateFields();if(!a){return}this.operationDetail.Arbei===""?"0.00":this.operationDetail.Arbei;this.operationDetail.Dauno===""?"0.00":this.operationDetail.Dauno;if(this.operationDetail.Uvorn===""){this.operationDetail.UvornEnable=false}if(t.indexOf("idBtnCheck")>-1){this.validateCheck();return}}window.history.go(-1)},validateCheck:function(e,t){var r=this;var i=sap.ui.getCore().getModel("AIWFLOC").getData();var o=sap.ui.getCore().getModel("AIWEQUI").getData();var l=sap.ui.getCore().getModel("AIWListWCModel").getData();var n=sap.ui.getCore().getModel("tlDetailModel").getData();var s=sap.ui.getCore().getModel("tempCrTypeModel").getData();var p={ChangeRequestType:s.crtype,CrDescription:s.desc,IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};if(i.length>0){for(var u=0;u<i.length;u++){var g={Tplnr:i[u].Functionallocation,Txtmi:i[u].Flocdescription,TplkzFlc:i[u].Strucindicator,Tplxt:i[u].StrucIndicatorDesc,EditMask:i[u].EditMask,Hierarchy:i[u].Hierarchy,Fltyp:i[u].Floccategory,Flttx:i[u].FlocCategoryDesc,Swerk:i[u].Maintplant,Plantname:i[u].MaintplantDesc,StorFloc:i[u].Location,Locationdesc:i[u].Locationdesc,Abckzfloc:i[u].Abckz,Abctx:i[u].Abctx,Bukrsfloc:i[u].Bukrs,Butxt:i[u].Butxt,City:i[u].City,KostFloc:i[u].Kostl,KokrFloc:i[u].Kokrs,Contareaname:i[u].Mctxt,PlntFloc:i[u].Werks,Planningplantdes:i[u].Planningplantdes,Ingrp:i[u].Ingrp,Plannergrpdesc:i[u].Innam,Arbplfloc:i[u].Arbpl,Wergwfloc:i[u].WcWerks,Gewrkfloc:i[u].MainArbpl,MainWcPlant:i[u].MainWerks,Tplma:i[u].SupFunctionallocation,Supflocdesc:i[u].SupFlocdescription,BeberFl:i[u].BeberFl,Fing:i[u].Fing,Tele:i[u].Tele,Submtiflo:i[u].ConstrType,Constdesc:i[u].ConstructionDesc,Eqart:i[u].TechnicalObjectTyp,Eartx:i[u].Description,Stattext:i[u].Stattext,StsmFloc:i[u].StsmEqui,Statproftxt:i[u].StsmEquiDesc,UstwFloc:i[u].UstwEqui,UswoFloc:i[u].UswoEqui,UstaFloc:i[u].UstaEqui,Adrnri:i[u].Adrnri,Deact:i[u].Deact};p.FuncLoc.push(g);var c={Funcloc:i[u].Functionallocation,Title:i[u].TitleCode,Name1:i[u].Name1,Name2:i[u].Name2,Name3:i[u].Name3,Name4:i[u].Name4,Sort1:i[u].Sort1,Sort2:i[u].Sort2,NameCo:i[u].NameCo,PostCod1:i[u].PostCod1,City1:i[u].City1,Building:i[u].Building,Floor:i[u].Floor,Roomnum:i[u].Roomnum,Strsuppl1:i[u].Strsuppl1,Strsuppl2:i[u].Strsuppl2,Strsuppl3:i[u].Strsuppl3,Location:i[u].AddrLocation,RPostafl:i[u].RefPosta,Landx:i[u].Landx,TimeZone:i[u].TimeZone,RPostFl:i[u].Region,Regiotxt:i[u].RegionDesc};p.FLAddr.push(c);var d=i[u].intlAddr;if(d){for(var m=0;m<d.length;m++){p.FLAddrI.push(d[m])}}if(r.AltLblDerv==="2"&&i[u].altlbl){for(var h=0;h<i[u].altlbl.length;h++){var D={Funcloc:i[u].Functionallocation,AltAlkey:i[u].altlbl[h].AltAlkey,AltStrno:i[u].altlbl[h].AltStrno,AltTplkz:i[u].altlbl[h].AltTplkz};p.FLALTLBEL.push(D)}}if(i[u].Floccategory==="L"&&i[u].lam){var v={Funcloc:i[u].Functionallocation,Lrpid:i[u].lam.Lrpid,Strtptatr:i[u].lam.Strtptatr,Endptatr:i[u].lam.Endptatr,Length:i[u].lam.Length.toString(),LinUnit:i[u].lam.LinUnit,Startmrkr:i[u].lam.Startmrkr,Endmrkr:i[u].lam.Endmrkr,Mrkdisst:i[u].lam.Mrkdisst,Mrkdisend:i[u].lam.Mrkdisend,MrkrUnit:i[u].lam.MrkrUnit};p.FLLAM.push(v)}var f=i[u].classItems;if(f){if(f.length>0){for(var C=0;C<f.length;C++){var S={Funcloc:i[u].Functionallocation,Classtype:f[C].Classtype,Class:f[C].Class,Clstatus1:f[C].Clstatus1};p.FLClass.push(S)}}}var w=i[u].characteristics;if(w){if(w.length>0){for(var T=0;T<w.length;T++){var E={Funcloc:i[u].Functionallocation,Atnam:w[T].Atnam,Textbez:w[T].Textbez,Atwrt:w[T].Atwrt,Class:w[T].Class};p.FLVal.push(E)}}}}}if(o.length>0){for(var M=0;M<o.length;M++){var P={Herst:o[M].Herst,Equnr:o[M].Equnr,Txtmi:o[M].Eqktx,Swerk:o[M].Maintplant,Name1:o[M].MaintplantDesc,TplnEilo:o[M].Tplnr,Flocdescription:o[M].Pltxt,Eqtyp:o[M].EquipmentCatogory,Etytx:o[M].EquipCatgDescription,Eqart:o[M].TechnicalObjectTyp,Eartx:o[M].Description,Typbz:o[M].Typbz,SubmEeqz:o[M].ConstrType,Constdesc:o[M].ConstructionDesc,BukrEilo:o[M].Bukrs,Butxt:o[M].Butxt,HequEeqz:o[M].SuperordinateEquip,SuperordEqDes:o[M].SuperordinateEquipDesc,TidnEeqz:o[M].TechIdNum,KostEilo:o[M].Kostl,KokrEilo:o[M].Kokrs,Contareaname:o[M].Mctxt,StorEilo:o[M].Location,Locationdesc:o[M].Locationdesc,AbckEilo:o[M].Abckz,Abctx:o[M].Abctx,PplaEeqz:o[M].Werks,Planningplantdes:o[M].Planningplantdes,IngrEeqz:o[M].Ingrp,Plannergrpdesc:o[M].Innam,Serge:o[M].Serge,MapaEeqz:o[M].MapaEeqz,Stattext:o[M].Stattext,StsmEqui:o[M].StsmEqui,Statproftxt:o[M].StsmEquiDesc,UstwEqui:o[M].UstwEqui,UswoEqui:o[M].UswoEqui,UstaEqui:o[M].UstaEqui,Deact:o[M].Deact,Answt:o[M].Answt,Ansdt:r._formatDate(o[M].Ansdt),Waers:o[M].Waers,ArbpEilo:o[M].Arbpl,WorkCenterPlant:o[M].WcWerks,ArbpEeqz:o[M].MainArbpl,MainWcPlant:o[M].MainWerks,BebeEilo:o[M].BeberFl,Fing:o[M].Fing,Tele:o[M].Tele,HeqnEeqz:o[M].EquipPosition,Adrnri:o[M].Adrnri,Funcid:o[M].Funcid,Frcfit:o[M].Frcfit,Frcrmv:o[M].Frcrmv};p.Equipment.push(P);var V={Equi:o[M].Equnr,PlanvPrt:o[M].PlanvPrt,SteufPrt:o[M].SteufPrt,KtschPrt:o[M].KtschPrt,Ewformprt:o[M].Ewformprt,SteufRef:o[M].SteufRef,KtschRef:o[M].KtschRef,EwformRef:o[M].EwformRef};p.EqPRT.push(V);if(o[M].EquipmentCatogory==="L"&&o[M].lam){var x={Equi:o[M].Equnr,Lrpid:o[M].lam.Lrpid,Strtptatr:o[M].lam.Strtptatr,Endptatr:o[M].lam.Endptatr,Length:o[M].lam.Length.toString(),LinUnit:o[M].lam.LinUnit,Startmrkr:o[M].lam.Startmrkr,Endmrkr:o[M].lam.Endmrkr,Mrkdisst:o[M].lam.Mrkdisst,Mrkdisend:o[M].lam.Mrkdisend,MrkrUnit:o[M].lam.MrkrUnit};p.EqLAM.push(x)}var O={Equi:o[M].Equnr,Title:o[M].TitleCode,Name1:o[M].Name1,Name2:o[M].Name2,Name3:o[M].Name3,Name4:o[M].Name4,Sort1:o[M].Sort1,Sort2:o[M].Sort2,NameCo:o[M].NameCo,PostCod1:o[M].PostCod1,City1:o[M].City1,Building:o[M].Building,Floor:o[M].Floor,Roomnum:o[M].Roomnum,Strsuppl1:o[M].Strsuppl1,Strsuppl2:o[M].Strsuppl2,Strsuppl3:o[M].Strsuppl3,Location:o[M].AddrLocation,RefPosta:o[M].RefPosta,Landx:o[M].Landx,TimeZone:o[M].TimeZone,RfePost:o[M].Region,Regiotxt:o[M].RegionDesc};p.EqAddr.push(O);var y=o[M].intlAddr;if(y){for(var m=0;m<y.length;m++){p.EqAddrI.push(y[m])}}var A=o[M].classItems;if(A){if(A.length>0){for(var b=0;b<A.length;b++){var k={Equi:o[M].Equnr,Classtype:A[b].Classtype,Class:A[b].Class,Clstatus1:A[b].Clstatus1};p.EqClass.push(k)}}}var L=o[M].characteristics;if(L){if(L.length>0){for(var F=0;F<L.length;F++){var I={Equi:o[M].Equnr,Atnam:L[F].Atnam,Textbez:L[F].Textbez,Atwrt:L[F].Atwrt,Class:L[F].Class};p.EqVal.push(I)}}}}}if(l.length>0){for(var H=0;H<l.length;H++){var q={Werks:l[H].plant,Arbpl:l[H].wc,Txtmi:l[H].wcDesc,Verwe:l[H].wcCat,Crveran:l[H].person,Planv:l[H].usg,Vgwts:l[H].stdVal,Crsteus:l[H].ctrlKey};if(l[H].hasOwnProperty("Type")){if(l[H].Type==="X"){q.Type="X"}}p.Workcenter.push(q);if(l[H].cost){for(var W=0;W<l[H].cost.length;W++){var N={Werks:l[H].cost[W].CrKokrs,Arbpl:l[H].wc,CrKostl:l[H].cost[W].CrKostl,Costcentxt:l[H].cost[W].Costcentxt,CrLstar:l[H].cost[W].CrLstar,Forn1:l[H].cost[W].Forn1,ActvttypeTxt:l[H].cost[W].ActvttypeTxt,Frmltxt:l[H].cost[W].Frmltxt};p.WCCost.push(N)}}}}if(this.action.indexOf("GTL")>0){if(n.lHeader.Iwerk!==""){n.lHeader.Werks=n.lHeader.Iwerk}var U={Werks:n.lHeader.Werks,Wcplant:n.lHeader.plant,Statu:n.lHeader.Statu,Tverwe:n.lHeader.tlusg,Ktext:n.lHeader.Ktext,Tarbpl:n.lHeader.wc,Vagrp:n.lHeader.Vagrp,Anlzu:n.lHeader.Anlzu,Tplnal:n.lHeader.Plnal.toString(),Tlgnhdr:n.grp,Strat:n.lHeader.Strat,Slwbez:n.lHeader.insPt,Slwbeztxt:n.lHeader.insPtDesc};p.GTList.push(U);if(n.lOperation&&n.lOperation.length>0){for(var z=0;z<n.lOperation.length;z++){var K={Tlgnhdr:n.grp,Vornr:n.lOperation[z].Vornr,TlArbpl:n.lOperation[z].Arbpl,Werks2gop:n.lOperation[z].Werks,Steus2gop:n.lOperation[z].Steus,Ltxa1:n.lOperation[z].Ltxa1,Arbei:n.lOperation[z].Arbei,Dauno:n.lOperation[z].Dauno,Arbeh:n.lOperation[z].Arbeh,Anzzl:n.lOperation[z].Anzzl,Daune:n.lOperation[z].Daune,Indet:n.lOperation[z].Indet,Tplnal:n.lOperation[z].Plnal.toString(),Larnt:n.lOperation[z].Larnt,Prznt:n.lOperation[z].workPerc,Bmvrg:n.lOperation[z].orderQty,Bmeih:n.lOperation[z].ordQtyUnit,Opreis:n.lOperation[z].netPrice,Owaers:n.lOperation[z].currency,Opeinh:n.lOperation[z].priceUnit,Sakto2gop:n.lOperation[z].costElement,Omatkl:n.lOperation[z].materialGrp,Oekgrp:n.lOperation[z].puchGroup,Ekorg:n.lOperation[z].purchOrg};p.GTOprs.push(K)}}if(n.lComponent&&n.lComponent.length>0){for(var B=0;B<n.lComponent.length;B++){var R={Tlgnhdr:n.grp,Idnrk:n.lComponent[B].Idnrk,Menge:n.lComponent[B].Menge,MeinsGcp:n.lComponent[B].MeinsGcp,Vornr:n.lComponent[B].Vornr,Postp:n.lComponent[B].Postp,Tplnal:n.lComponent[B].Plnal.toString()};p.GTComp.push(R)}}if(n.Class){for(var _=0;_<n.Class.length;_++){if(n.Class[_].Plnal===n.lHeader.Plnal){var G={Tlgnhdr:n.grp,Classtype:n.Class[_].Classtype,Class:n.Class[_].Class,Clstatus1:n.Class[_].Clstatus1,Tplnal:n.Class[_].Plnal.toString()};p.GTClass.push(G)}}}if(n.Char){for(var Q=0;Q<n.Char.length;Q++){for(var z=0;z<n.Class.length;z++){if(n.Class[z].Class===n.Char[Q].Class&&n.Class[z].Plnal===n.lHeader.Plnal&&!n.Char[Q].Plnal){n.Char[Q].Plnal=n.Class[z].Plnal}}if(n.Char[Q].Plnal){var J={Tlgnhdr:n.grp,Atnam:n.Char[Q].Atnam,Textbez:n.Char[Q].Textbez,Atwrt:n.Char[Q].Atwrt,Class:n.Char[Q].Class,Tplnal:n.Char[Q].Plnal.toString()};p.GTVal.push(J)}}}}else if(this.action.indexOf("ETL")>0){if(n.lHeader.Iwerk!==""){n.lHeader.Werks=n.lHeader.Iwerk}var j={Werks:n.lHeader.Werks,Wcplant:n.lHeader.plant,Statu:n.lHeader.Statu,Tverwe:n.lHeader.tlusg,Ktext:n.lHeader.Ktext,Tarbpl:n.lHeader.wc,Vagrp:n.lHeader.Vagrp,Anlzu:n.lHeader.Anlzu,Tplnal:n.lHeader.Plnal.toString(),Tleqhdr:n.grp,Strat:n.lHeader.Strat,Eq2tl:n.lHeader.equipment,Slwbez:n.lHeader.insPt,Slwbeztxt:n.lHeader.insPtDesc};p.ETList.push(j);if(n.lOperation&&n.lOperation.length>0){for(var z=0;z<n.lOperation.length;z++){var $={Tleqhdr:n.grp,Vornr:n.lOperation[z].Vornr,TlArbpl:n.lOperation[z].Arbpl,Werks2eop:n.lOperation[z].Werks,Steus2eop:n.lOperation[z].Steus,Ltxa1:n.lOperation[z].Ltxa1,Arbei:n.lOperation[z].Arbei,Dauno:n.lOperation[z].Dauno,Arbeh:n.lOperation[z].Arbeh,Anzzl:n.lOperation[z].Anzzl,Daune:n.lOperation[z].Daune,Indet:n.lOperation[z].Indet,Tplnal:n.lOperation[z].Plnal.toString(),Larnt:n.lOperation[z].Larnt,Prznt:n.lOperation[z].workPerc,Bmvrg:n.lOperation[z].orderQty,Bmeih:n.lOperation[z].ordQtyUnit,Opreis:n.lOperation[z].netPrice,Owaers:n.lOperation[z].currency,Opeinh:n.lOperation[z].priceUnit,Sakto2eop:n.lOperation[z].costElement,Omatkl:n.lOperation[z].materialGrp,Oekgrp:n.lOperation[z].puchGroup,Ekorg:n.lOperation[z].purchOrg};p.ETOprs.push($)}}if(n.lComponent&&n.lComponent.length>0){for(var B=0;B<n.lComponent.length;B++){var Y={Tleqhdr:n.grp,Idnrk:n.lComponent[B].Idnrk,Menge:n.lComponent[B].Menge,MeinsEcp:n.lComponent[B].MeinsGcp,Vornr:n.lComponent[B].Vornr,Postp:n.lComponent[B].Postp,Tplnal:n.lComponent[B].Plnal.toString()};p.ETComp.push(Y)}}if(n.Class){for(var _=0;_<n.Class.length;_++){if(n.Class[_].Plnal===n.lHeader.Plnal){var X={Tleqhdr:n.grp,Classtype:n.Class[_].Classtype,Class:n.Class[_].Class,Clstatus1:n.Class[_].Clstatus1,Tplnal:n.Class[_].Plnal.toString()};p.ETClass.push(X)}}}if(n.Char){for(var Q=0;Q<n.Char.length;Q++){for(var z=0;z<n.Class.length;z++){if(n.Class[z].Class===n.Char[Q].Class&&n.Class[z].Plnal===n.lHeader.Plnal&&!n.Char[Q].Plnal){n.Char[Q].Plnal=n.Class[z].Plnal}}if(n.Char[Q].Plnal){var Z={Tleqhdr:n.grp,Atnam:n.Char[Q].Atnam,Textbez:n.Char[Q].Textbez,Atwrt:n.Char[Q].Atwrt,Class:n.Char[Q].Class,Tplnal:n.Char[Q].Plnal.toString()};p.ETVal.push(Z)}}}}else if(this.action.indexOf("FTL")>0){if(n.lHeader.Iwerk!==""){n.lHeader.Werks=n.lHeader[W].Iwerk}var ee={Werks:n.lHeader.Werks,Wcplant:n.lHeader.plant,Statu:n.lHeader.Statu,Tverwe:n.lHeader.tlusg,Ktext:n.lHeader.Ktext,Tarbpl:n.lHeader.wc,Vagrp:n.lHeader.Vagrp,Anlzu:n.lHeader.Anlzu,Tplnal:n.lHeader.Plnal.toString(),Tlflhdr:n.grp,Strat:n.lHeader.Strat,Fl2tl:n.lHeader.floc,Slwbez:n.lHeader[W].insPt,Slwbeztxt:n.lHeader[W].insPtDesc};p.FTList.push(ee);if(n.lOperation){for(var z=0;z<n.lOperation.length;z++){var te={Tlflhdr:n.grp,Vornr:n.lOperation[z].Vornr,TlArbpl:n.lOperation[z].Arbpl,Werks2fop:n.lOperation[z].Werks,Steus2fop:n.lOperation[z].Steus,Ltxa1:n.lOperation[z].Ltxa1,Arbei:n.lOperation[z].Arbei,Dauno:n.lOperation[z].Dauno,Arbeh:n.lOperation[z].Arbeh,Anzzl:n.lOperation[z].Anzzl,Daune:n.lOperation[z].Daune,Indet:n.lOperation[z].Indet,Tplnal:n.lOperation[z].Plnal.toString(),Larnt:n.lOperation[z].Larnt,Prznt:n.lOperation[z].workPerc,Bmvrg:n.lOperation[z].orderQty,Bmeih:n.lOperation[z].ordQtyUnit,Opreis:n.lOperation[z].netPrice,Owaers:n.lOperation[z].currency,Opeinh:n.lOperation[z].priceUnit,Sakto2fop:n.lOperation[z].costElement,Omatkl:n.lOperation[z].materialGrp,Oekgrp:n.lOperation[z].puchGroup,Ekorg:n.lOperation[z].purchOrg};p.FTOprs.push(te)}}if(n.lComponent){for(var B=0;B<n.lComponent.length;B++){var ae={Tlflhdr:n.grp,Idnrk:n.lComponent[B].Idnrk,Menge:n.lComponent[B].Menge,MeinsFcp:n.lComponent[B].MeinsGcp,Vornr:n.lComponent[B].Vornr,Postp:n.lComponent[B].Postp,Tplnal:n.lComponent[B].Plnal.toString()};p.FTComp.push(ae)}}if(n.Class){for(var _=0;_<n.Class.length;_++){if(n.Class[_].Plnal===n.lHeader.Plnal){var re={Tlflhdr:n.grp,Classtype:n.Class[_].Classtype,Class:n.Class[_].Class,Clstatus1:n.Class[_].Clstatus1,Tplnal:n.Class[_].Plnal.toString()};p.FTClass.push(re)}}}if(n.Char){for(var Q=0;Q<n.Char.length;Q++){for(var z=0;z<n.Class.length;z++){if(n.Class[z].Class===n.Char[Q].Class&&n.Class[z].Plnal===n.lHeader.Plnal&&!n.Char[Q].Plnal){n.Char[Q].Plnal=n.Class[z].Plnal}}if(n.Char[Q].Plnal){var ie={Tlflhdr:n.grp,Atnam:n.Char[Q].Atnam,Textbez:n.Char[Q].Textbez,Atwrt:n.Char[Q].Atwrt,Class:n.Char[Q].Class,Tplnal:n.Char[Q].Plnal.toString()};p.FTVal.push(ie)}}}}this.getView().byId("tlOpDetailPage").setBusy(true);var oe=this.getView().getModel();oe.create("/ChangeRequestSet",p,{success:function(e){r.getView().byId("tlOpDetailPage").setBusy(false);var t=e;var i=[];for(var o=0;o<t.Messages.results.length;o++){i.push({type:a.getMessageType(t.Messages.results[o].Type),title:t.Messages.results[o].Message})}r.createMessagePopover(i,"")},error:function(e){r.getView().byId("tlOpDetailPage").setBusy(false);var t=[],a=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var i=0;i<JSON.parse(e.responseText).error.innererror.errordetails.length;i++){t[i]=JSON.parse(e.responseText).error.innererror.errordetails[i].message}}var o=t.join("\n");sap.m.MessageBox.show(o,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var a=[];var r,i=this._getMessagePopover();if(typeof e==="string"){a.push({type:t,title:e,message:e})}else if(Array.isArray(e)){a=e;for(var o=0;o<a.length;o++){a[o].message=a[o].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var o=0;o<a.length;o++){r=new n({message:a[o].message,type:a[o].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(r)}i.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(a.length+"")},onOrdQtyUnitVH:function(e){s.UOMVH(e,this)},onOrdQtyUnitChange:function(e){s._UOMchange(e,this)},onCurrencyVH:function(e){s.CurKeyVH(e,this,[])},onCurrencyChange:function(e){s._CurKeychange(e,this,[])},onCostEleVH:function(e){s.CostEleVH(e,this)},onCostEleChange:function(e){s._CostElechange(e,this)},onMatGrpVH:function(e){s.MatGrpVH(e,this)},onMatGrpChange:function(e){s._MatGrpchange(e,this)},onpuchGroupVH:function(e){s.PuchGroupVH(e,this)},onpuchGroupChange:function(e){s._PuchGroupchange(e,this)},onpurchOrgVH:function(e){s.PurchOrgVH(e,this)},onpurchOrgChange:function(e){s._PurchOrgchange(e,this)},onOprEquiVH:function(e){var t=this;var a=t.getView().getModel("valueHelp2");var r=t.getView().getModel("tlOpDetailModel");var i=new sap.m.SelectDialog({title:"{i18n>EQUI_TXT}",noDataText:"{i18n>LOAD}"+"...",confirm:function(e){t.operationDetail.equi=e.getParameters().selectedItem.getProperty("title");t.operationDetail.equiDesc=e.getParameters().selectedItem.getProperty("description");t.operationDetail.equiVS="None";r.setData(t.operationDetail)},search:function(e){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Equnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Eqktu",sap.ui.model.FilterOperator.Contains,t)],false)])}});var o="/EquipPRTSet";a.read(o,{success:function(e,t){var a=sap.ui.getCore().getModel("AIWEQUI").getData();if(a.length>0){for(var r=0;r<a.length;r++){if(a[r].Equnr){var o={Equnr:a[r].Equnr,Eqktu:a[r].Eqktx};e.results.unshift(o)}}}if(e.results.length>0){var l=new sap.m.StandardListItem({title:"{Equnr}",description:"{Eqktu}",active:true});var n=new sap.ui.model.json.JSONModel;n.setData(e);n.isSizeLimit=e.results.length;n.setSizeLimit(e.results.length);i.setModel(n);i.setGrowingThreshold(e.results.length);i.bindAggregation("items","/results",l)}else{i.setNoDataText(i.getModel("i18n").getProperty("NO_DATA"))}}});i.open()},onOprEquiChange:function(e){var t=this;var a=e.getParameters().newValue;var r=a.toUpperCase();var i=t.getView().getModel("tlOpDetailModel");var o=sap.ui.getCore().getModel("AIWEQUI").getData();if(o.length>0){for(var l=0;l<o.length;l++){if(o[l].Equnr===r){t.operationDetail.equi=o[l].Equnr;t.operationDetail.equiDesc=o[l].Eqktx;t.operationDetail.equiVS="None";i.setData(t.operationDetail);return}}}var n="/EquipPRTSet";var s=new sap.ui.model.Filter("Equnr","EQ",r);var p=this.getView().getModel("valueHelp2");p.read(n,{filters:[s],success:function(e){if(e.results.length>0){t.operationDetail.equi=e.results[0].Equnr;t.operationDetail.equiDesc=e.results[0].Eqktu;t.operationDetail.equiVS="None";i.setData(t.operationDetail)}else{t.operationDetail.equiDesc="";t.operationDetail.equiVS="Error";i.setData(t.operationDetail)}},error:function(e){var a=JSON.parse(e.responseText);var r=a.error.message.value;t.operationDetail.equiDesc="";t.operationDetail.equiVS="Error";i.setData(t.operationDetail)}})},onOprFlocVH:function(e){var t=this;var a=t.getView().getModel("valueHelp");var r=t.getView().getModel("tlOpDetailModel");var i=new sap.m.SelectDialog({title:"Functional Location",noDataText:"{i18n>LOAD}"+"...",confirm:function(e){t.operationDetail.floc=e.getParameters().selectedItem.getProperty("title");t.operationDetail.flocDesc=e.getParameters().selectedItem.getProperty("description");t.operationDetail.flocVS="None";r.setData(t.operationDetail)},search:function(e){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Tplnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Pltxt",sap.ui.model.FilterOperator.Contains,t)],false)])}});var o="/FunctionLocationSet";a.read(o,{success:function(e,t){var a=sap.ui.getCore().getModel("AIWFLOC").getData();if(a.length>0){for(var r=0;r<a.length;r++){if(a[r].Functionallocation){var o={Tplnr:a[r].Functionallocation,Pltxt:a[r].Flocdescription};e.results.unshift(o)}}}if(e.results.length>0){var l=new sap.m.StandardListItem({title:"{Tplnr}",description:"{Pltxt}",active:true});var n=new sap.ui.model.json.JSONModel;n.setData(e);n.isSizeLimit=e.results.length;n.setSizeLimit(e.results.length);i.setModel(n);i.setGrowingThreshold(e.results.length);i.bindAggregation("items","/results",l)}else{i.setNoDataText(i.getModel("i18n").getProperty("NO_DATA"))}}});i.open()},onOprFlocChange:function(e){var t=this;var a=e.getParameters().newValue;var r=a.toUpperCase();var i=t.getView().getModel("tlOpDetailModel");var o=sap.ui.getCore().getModel("AIWFLOC").getData();if(o.length>0){for(var l=0;l<o.length;l++){if(o[l].Functionallocation===r){t.operationDetail.floc=o[l].Functionallocation;t.operationDetail.flocDesc=o[l].Flocdescription;t.operationDetail.flocVS="None";i.setData(t.operationDetail);return}}}var n="/FunctionLocationSet";var s=new sap.ui.model.Filter("Tplnr","EQ",r);var p=this.getView().getModel("valueHelp");p.read(n,{filters:[s],success:function(e){if(e.results.length>0){t.operationDetail.floc=e.results[0].Tplnr;t.operationDetail.flocDesc=e.results[0].Pltxt;t.operationDetail.flocVS="None";i.setData(t.operationDetail)}else{t.operationDetail.flocDesc="";t.operationDetail.flocVS="Error";i.setData(t.operationDetail)}},error:function(e){var a=JSON.parse(e.responseText);var r=a.error.message.value;t.operationDetail.flocDesc="";t.operationDetail.flocVS="Error";i.setData(t.operationDetail)}})},onSubOpChange:function(e){var t=e.getSource().getValue();if(t!==""){this.operationDetail.VornrEnable=true;this.operationDetail.opNumDtValueState="Error"}var a="No operation found for the sub-operation "+t;this.createMessagePopover(a,"Error")},onOprNumChange:function(e){if(this.operationDetail.Uvorn!==""){var t=this.operationDetail.Vornr;var a=sap.ui.getCore().getModel("tlDetailModel");var r=a.getData().lOperation;var i=this.itmDetailPath.split("/")[3];var o=false;for(var l=0;l<r.length;l++){if(l.toString()===i){continue}if(t===r[l].Vornr){o=true}}if(o){this.operationDetail.opNumDtValueState="None";this.operationDetail.VornrEnable=false}else{var n="No operation found for the sub-operation "+this.operationDetail.Uvorn;this.createMessagePopover(n,"Error")}}}})});