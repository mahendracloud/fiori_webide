sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","ugiaiwui/mdg/aiw/request/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/BusyDialog","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider","sap/ui/core/message/Message","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest"],function(e,t,r,a,s,n,m,l,i,o){"use strict";return e.extend("ugiaiwui.mdg.aiw.request.controller.DetailBOM",{formatter:a,onInit:function(){this._oView=this.getView();this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this._oView));var e=this._oComponent.getModel();e.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(e);var r=this._oComponent.getModel("NewModel");this.getView().setModel(r,"valueHelp");var a=this._oComponent.getModel("NewModel2");this.getView().setModel(a,"valueHelp2");var s={WBSVisible:true,MATVisible:true,EQVisible:true,FLVisible:true,RECALLOVisible:true,altbomVisible:false,techtypeVisible:false,delflgVisible:false,authgrpVisible:false,TitleDataVisible:false,TitleDataText:"",plnrgrpVisible:false,constTypVisible:false,laboffVisible:false,sizeDimVisible:false,invNumVisible:false,manufVisible:false,modNoVisible:false,manufSerVisible:false,bomAltTxtVisible:false,bomHdrTxtVisible:false,sopTableVisible:false,tabTableVisible:false};var n=new t(s);this.getView().setModel(n,"FieldsVisibleModel");this.getRouter().getRoute("detail").attachPatternMatched(this._onRouteMatched,this);this.BusyDialog=new m;this.BusyDialog.close();this.readSystem();var l=sap.ui.getCore().getMessageManager();this.getView().setModel(l.getMessageModel(),"message");l.registerObject(this.getView(),true)},_onRouteMatched:function(e){var r=e.getParameter("name");if(r==="detail"){this.currentObj=undefined;this.itemPath=e.getParameter("arguments").itemPath;var a=decodeURIComponent(e.getParameter("arguments").itemPath);this.sBOMModelPath=a;this.sFragmentName=e.getParameter("arguments").FragmentName;var s=e.getParameter("arguments").e;var n=e.getParameter("arguments").p;var m=e.getParameter("arguments").u;var l=e.getParameter("arguments").w;this.crstatus=e.getParameter("arguments").cr;this.mode=e.getParameter("arguments").mode;this.fromMat=e.getParameter("arguments").mat;this.uid=e.getParameter("arguments").uid;this.case=e.getParameter("arguments").case;var i=new t;var o={};this.getView().byId("idBtnCheck").setVisible(true);var u=this.getView().getModel("FieldsVisibleModel");var b=u.getData();var c=sap.ui.getCore().getModel("refreshModel");if(c.getProperty("/refresh")===true){this.itemNo=0;this.getView().byId("idBtnCheck").setEnabled(true)}if(this.sFragmentName==="CreateMaterialBom"){b.WBSVisible=false;b.EQVisible=false;b.FLVisible=false;b.MATVisible=true;b.MATCrtVisible=true;b.RECALLOVisible=true;var g=new t;var d=sap.ui.getCore().getModel("AIWListMatModel");this.currentObj=d.getProperty(a);o.headerText=this.getView().getModel("i18n").getProperty("MRO_BOM_TXT");o.tableHeader=this.getView().getModel("i18n").getProperty("MRO_ITEM_OVR");if(this.currentObj.bomType==="Create"){o.titleName=this.getView().getModel("i18n").getProperty("createMbomTitle");this.currentObj.fromDateEnable=true;this.currentObj.crtMatHdrEnable=true;this.currentObj.crtMatHdrBtnEnable=true}else if(this.currentObj.bomType==="Change"){o.titleName=this.getView().getModel("i18n").getProperty("changeMbomTitle");this.currentObj.fromDateEnable=false;this.currentObj.crtMatHdrEnable=false;this.currentObj.crtMatHdrBtnEnable=false}if(this.currentObj.Matnr!==""&&this.currentObj.Werks!==""&&this.currentObj.Stlan!==""){this.currentObj.crtMatEnable=true;this.currentObj.crtMatHdrBtnEnable=false}else{this.currentObj.crtMatEnable=false;this.currentObj.crtMatHdrBtnEnable=true}if(this.mode==="display"){o.titleName=this.getView().getModel("i18n").getProperty("matBomAppHdr");this.currentObj.matEnable=false;this.currentObj.plantEnable=false;this.currentObj.usageEnable=false;this.currentObj.BomstatusEnable=false;this.currentObj.BaseQtyEnable=false;this.currentObj.LngtxtEnable=false;this.currentObj.fromDateEnable=false;this.currentObj.addItemEnable=false;this.currentObj.crtMatEnable=false;this.currentObj.crtMatHdrEnable=false;this.currentObj.crtMatHdrBtnEnable=false;this.currentObj.modeFlag="None";for(var f=0;f<this.currentObj.matItem.length;f++){this.currentObj.matItem[f].itmCatEnable=false;this.currentObj.matItem[f].itmQtyEnable=false;this.currentObj.matItem[f].itmCompEnable=false;this.currentObj.matItem[f].itmUomEnable=false;this.currentObj.matItem[f].reccrAllowEnable=false;this.currentObj.matItem[f].addSubItmEnable=false;this.currentObj.matItem[f].Pmper="-";this.currentObj.matItem[f].Pmpka="-";this.currentObj.matItem[f].Pmprv="-";this.currentObj.matItem[f].Pmpfe="-";this.currentObj.matItem[f].Pmpin="-";this.currentObj.matItem[f].Pmpko="-"}for(var f=0;f<this.currentObj.matSubItem.length;f++){this.currentObj.matSubItem[f].intPointEnable=false;this.currentObj.matSubItem[f].subQtyEnable=false;this.currentObj.matSubItem[f].subTextEnable=false}}g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");if(this.currentObj.bomType==="Change"&&this.currentObj.matItem.length>0){this.sLastItemNum=this.currentObj.matItem[this.currentObj.matItem.length-1].Bomitmpos;this.currentObj.fromDateEnable=false}else{this.sLastItemNum="0000";this.currentObj.fromDateEnable=true}var I=new t;I.setData(this.currentObj.matItem);this.getView().setModel(I,"itemDetailModel");if(this.fromMat&&sap.ui.getCore().getModel("MatNavModel")==="X"){this.readfrombufferBom(this.uid);sap.ui.getCore().setModel(true,"MatNavModel")}}if(this.sFragmentName==="changeMbom"){b.WBSVisible=false;b.EQVisible=false;b.FLVisible=false;b.MATVisible=true;b.MATCrtVisible=true;b.RECALLOVisible=true;o={titleName:this.getView().getModel("i18n").getProperty("changeMbomTitle"),headerText:this.getView().getModel("i18n").getProperty("MRO_BOM_TXT"),tableHeader:this.getView().getModel("i18n").getProperty("MRO_ITEM_OVR")};c.setProperty("/refreshSearch",false);if(this.fromMat&&sap.ui.getCore().getModel("MatNavModel")==="X"){this.readfrombufferBom(this.uid);sap.ui.getCore().setModel(true,"MatNavModel");this.oModelUpdateFlag=true}else if(this.uid&&sap.ui.getCore().getModel("BOMCHNavModel")==="X"){this.readfrombufferBom();sap.ui.getCore().setModel(true,"BOMCHNavModel");this.oModelUpdateFlag=false}else if(c.getProperty("/refresh")===true){this.existFlag=false;var d=sap.ui.getCore().getModel("AIWListMatModel");var p=d.getData();var g=new t;for(var h=0;h<p.length;h++){if(p[h].Matnr===s&&p[h].Werks===n&&p[h].Stlan===m){this.existFlag=true;this.currentObj=p[h];g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");this.attachModelEventHandlers(g);var I=new t;I.setData(this.currentObj.matItem);this.getView().setModel(I,"itemDetailModel");this.attachModelEventHandlers(I);break}}if(!this.existFlag){this.readBomDetails(s,n,m,this.crstatus)}this.oModelUpdateFlag=false}else{this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag;this.getView().getModel("BOMDetailModel").refresh();this.getView().getModel("itemDetailModel").refresh();this.currentObj=this.getView().getModel("BOMDetailModel").getData()}}if(this.sFragmentName==="CreateEquipmentBom"){b.WBSVisible=false;b.EQVisible=true;b.FLVisible=false;b.MATVisible=false;b.MATCrtVisible=false;b.RECALLOVisible=false;var g=new t;var O=sap.ui.getCore().getModel("AIWListEqModel");this.currentObj=O.getProperty(a);o.headerText=this.getView().getModel("i18n").getProperty("E_BOM_TXT");o.tableHeader=this.getView().getModel("i18n").getProperty("E_ITEM_OVR");if(this.currentObj.bomType==="Create"){o.titleName=this.getView().getModel("i18n").getProperty("createEbomTitle");this.currentObj.fromDateEnable=true}else if(this.currentObj.bomType==="Change"){o.titleName=this.getView().getModel("i18n").getProperty("changeEbomTitle");this.currentObj.fromDateEnable=false}this.currentObj.crtMatEnable=false;if(this.mode==="display"){o.titleName=this.getView().getModel("i18n").getProperty("equiBomAppHdr");this.currentObj.equipEnable=false;this.currentObj.plantEnable=false;this.currentObj.usageEnable=false;this.currentObj.BomstatusEnable=false;this.currentObj.BaseQtyEnable=false;this.currentObj.LngtxtEnable=false;this.currentObj.fromDateEnable=false;this.currentObj.addItemEnable=false;this.currentObj.crtMatEnable=false;this.currentObj.modeFlag="None";for(var f=0;f<this.currentObj.eqItem.length;f++){this.currentObj.eqItem[f].itmCatEnable=false;this.currentObj.eqItem[f].itmQtyEnable=false;this.currentObj.eqItem[f].itmCompEnable=false;this.currentObj.eqItem[f].itmUomEnable=false;this.currentObj.eqItem[f].addSubItmEnable=false;this.currentObj.eqItem[f].Pmper="-";this.currentObj.eqItem[f].Pmpka="-";this.currentObj.eqItem[f].Pmprv="-";this.currentObj.eqItem[f].Pmpfe="-";this.currentObj.eqItem[f].Pmpin="-";this.currentObj.eqItem[f].Pmpko="-"}for(var f=0;f<this.currentObj.eqSubItem.length;f++){this.currentObj.eqSubItem[f].intPointEnable=false;this.currentObj.eqSubItem[f].subQtyEnable=false;this.currentObj.eqSubItem[f].subTextEnable=false}}g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");if(this.currentObj.bomType==="Change"&&this.currentObj.eqItem.length>0){this.sLastItemNum=this.currentObj.eqItem[this.currentObj.eqItem.length-1].Bomitmpos}else{this.sLastItemNum="0000"}var I=new t;I.setData(this.currentObj.eqItem);this.getView().setModel(I,"itemDetailModel")}if(this.sFragmentName==="changeEbom"){b.WBSVisible=false;b.EQVisible=true;b.FLVisible=false;b.MATVisible=false;b.MATCrtVisible=false;b.RECALLOVisible=false;o={titleName:this.getView().getModel("i18n").getProperty("changeEbomTitle"),headerText:this.getView().getModel("i18n").getProperty("E_BOM_TXT"),tableHeader:this.getView().getModel("i18n").getProperty("E_ITEM_OVR")};c.setProperty("/refreshSearch",false);if(this.uid&&sap.ui.getCore().getModel("BOMCHNavModel")==="X"){this.readfrombufferBom();sap.ui.getCore().setModel(true,"BOMCHNavModel");this.oModelUpdateFlag=false}else if(c.getProperty("/refresh")===true){this.existFlag=false;var O=sap.ui.getCore().getModel("AIWListEqModel");var M=O.getData();var g=new t;for(var h=0;h<M.length;h++){if(M[h].Eqnrbom===s&&M[h].Werks===n&&M[h].Stlan===m){this.existFlag=true;this.currentObj=M[h];g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");this.attachModelEventHandlers(g);var I=new t;I.setData(this.currentObj.eqItem);this.getView().setModel(I,"itemDetailModel");this.attachModelEventHandlers(I);break}}if(!this.existFlag){this.readBomDetails(s,n,m,this.crstatus)}this.oModelUpdateFlag=false}else{this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag;this.getView().getModel("BOMDetailModel").refresh();this.getView().getModel("itemDetailModel").refresh();this.currentObj=this.getView().getModel("BOMDetailModel").getData()}}if(this.sFragmentName==="CreateFLBom"){b.WBSVisible=false;b.EQVisible=false;b.FLVisible=true;b.MATVisible=false;b.MATCrtVisible=false;b.RECALLOVisible=false;var g=new t;var S=sap.ui.getCore().getModel("AIWListFLModel");this.currentObj=S.getProperty(a);o.headerText=this.getView().getModel("i18n").getProperty("FLOC_BOM_TXT");o.tableHeader=this.getView().getModel("i18n").getProperty("FLOC_ITEM_OVR");if(this.currentObj.bomType==="Create"){o.titleName=this.getView().getModel("i18n").getProperty("createFLbomTitle");this.currentObj.fromDateEnable=true}else if(this.currentObj.bomType==="Change"){o.titleName=this.getView().getModel("i18n").getProperty("changeFLbomTitle");this.currentObj.fromDateEnable=false}this.currentObj.crtMatEnable=false;if(this.mode==="display"){o.titleName=this.getView().getModel("i18n").getProperty("flocBomAppHdr");this.currentObj.FLEnable=false;this.currentObj.plantEnable=false;this.currentObj.usageEnable=false;this.currentObj.BomstatusEnable=false;this.currentObj.BaseQtyEnable=false;this.currentObj.LngtxtEnable=false;this.currentObj.fromDateEnable=false;this.currentObj.addItemEnable=false;this.currentObj.crtMatEnable=false;this.currentObj.modeFlag="None";for(var f=0;f<this.currentObj.flItem.length;f++){this.currentObj.flItem[f].itmCatEnable=false;this.currentObj.flItem[f].itmQtyEnable=false;this.currentObj.flItem[f].itmCompEnable=false;this.currentObj.flItem[f].itmUomEnable=false;this.currentObj.flItem[f].addSubItmEnable=false;this.currentObj.flItem[f].Pmper="-";this.currentObj.flItem[f].Pmpka="-";this.currentObj.flItem[f].Pmprv="-";this.currentObj.flItem[f].Pmpfe="-";this.currentObj.flItem[f].Pmpin="-";this.currentObj.flItem[f].Pmpko="-"}for(var f=0;f<this.currentObj.flSubItem.length;f++){this.currentObj.flSubItem[f].intPointEnable=false;this.currentObj.flSubItem[f].subQtyEnable=false;this.currentObj.flSubItem[f].subTextEnable=false}}g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");if(this.currentObj.bomType==="Change"&&this.currentObj.flItem.length>0){this.sLastItemNum=this.currentObj.flItem[this.currentObj.flItem.length-1].Bomitmpos}else{this.sLastItemNum="0000"}var I=new t;I.setData(this.currentObj.flItem);this.getView().setModel(I,"itemDetailModel")}if(this.sFragmentName==="changeFlbom"){b.WBSVisible=false;b.EQVisible=false;b.FLVisible=true;b.MATVisible=false;b.MATCrtVisible=false;b.RECALLOVisible=false;o={titleName:this.getView().getModel("i18n").getProperty("changeFLbomTitle"),headerText:this.getView().getModel("i18n").getProperty("FLOC_BOM_TXT"),tableHeader:this.getView().getModel("i18n").getProperty("FLOC_ITEM_OVR")};c.setProperty("/refreshSearch",false);if(this.uid&&sap.ui.getCore().getModel("BOMCHNavModel")==="X"){this.readfrombufferBom();sap.ui.getCore().setModel(true,"BOMCHNavModel");this.oModelUpdateFlag=false}else if(c.getProperty("/refresh")===true){this.existFlag=false;var S=sap.ui.getCore().getModel("AIWListFLModel");var B=S.getData();var g=new t;for(var h=0;h<B.length;h++){if(B[h].Tplnrbom===s&&B[h].Werks===n&&B[h].Stlan===m){this.existFlag=true;this.currentObj=B[h];g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");this.attachModelEventHandlers(g);var I=new t;I.setData(this.currentObj.flItem);this.getView().setModel(I,"itemDetailModel");this.attachModelEventHandlers(I);break}}if(!this.existFlag){this.readBomDetails(s,n,m,this.crstatus)}this.oModelUpdateFlag=false}else{this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag;this.getView().getModel("BOMDetailModel").refresh();this.getView().getModel("itemDetailModel").refresh();this.currentObj=this.getView().getModel("BOMDetailModel").getData()}}if(this.sFragmentName==="CreateWBSBom"){b.WBSVisible=true;b.EQVisible=false;b.FLVisible=false;b.MATVisible=true;b.MATCrtVisible=false;b.RECALLOVisible=true;var g=new t;var j=sap.ui.getCore().getModel("AIWListWBSModel");this.currentObj=j.getProperty(a);o.headerText=this.getView().getModel("i18n").getProperty("WBS_BOM_TXT");o.tableHeader=this.getView().getModel("i18n").getProperty("WBS_ITEM_OVR");if(this.currentObj.bomType==="Create"){o.titleName=this.getView().getModel("i18n").getProperty("createWBSbomTitle");this.currentObj.fromDateEnable=true}else if(this.currentObj.bomType==="Change"){o.titleName=this.getView().getModel("i18n").getProperty("changeWBSbomTitle");this.currentObj.fromDateEnable=false}this.currentObj.crtMatEnable=false;this.currentObj.crtMatHdrEnable=false;this.currentObj.crtMatHdrBtnEnable=false;if(this.mode==="display"){o.titleName=this.getView().getModel("i18n").getProperty("wbsBomAppHdr");this.currentObj.wbsEnable=false;this.currentObj.matEnable=false;this.currentObj.plantEnable=false;this.currentObj.usageEnable=false;this.currentObj.BomstatusEnable=false;this.currentObj.BaseQtyEnable=false;this.currentObj.LngtxtEnable=false;this.currentObj.fromDateEnable=false;this.currentObj.addItemEnable=false;this.currentObj.crtMatEnable=false;this.currentObj.crtMatHdrEnable=false;this.currentObj.crtMatHdrBtnEnable=false;this.currentObj.modeFlag="None";for(var f=0;f<this.currentObj.wbsItem.length;f++){this.currentObj.wbsItem[f].itmCatEnable=false;this.currentObj.wbsItem[f].itmQtyEnable=false;this.currentObj.wbsItem[f].itmCompEnable=false;this.currentObj.wbsItem[f].itmUomEnable=false;this.currentObj.wbsItem[f].addSubItmEnable=false;this.currentObj.wbsItem[f].Pmper="-";this.currentObj.wbsItem[f].Pmpka="-";this.currentObj.wbsItem[f].Pmprv="-";this.currentObj.wbsItem[f].Pmpfe="-";this.currentObj.wbsItem[f].Pmpin="-";this.currentObj.wbsItem[f].Pmpko="-"}for(var f=0;f<this.currentObj.wbsSubItem.length;f++){this.currentObj.wbsSubItem[f].intPointEnable=false;this.currentObj.wbsSubItem[f].subQtyEnable=false;this.currentObj.wbsSubItem[f].subTextEnable=false}}g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");if(this.currentObj.bomType==="Change"&&this.currentObj.wbsItem.length>0){this.sLastItemNum=this.currentObj.wbsItem[this.currentObj.wbsItem.length-1].Bomitmpos}else{this.sLastItemNum="0000"}var I=new t;I.setData(this.currentObj.wbsItem);this.getView().setModel(I,"itemDetailModel")}if(this.sFragmentName==="changeWbsbom"){b.WBSVisible=true;b.EQVisible=false;b.FLVisible=false;b.MATVisible=true;b.MATCrtVisible=false;b.crtMatHdrEnable=false;b.RECALLOVisible=true;o={titleName:this.getView().getModel("i18n").getProperty("changeWBSbomTitle"),headerText:this.getView().getModel("i18n").getProperty("WBS_BOM_TXT"),tableHeader:this.getView().getModel("i18n").getProperty("WBS_ITEM_OVR")};c.setProperty("/refreshSearch",false);if(this.uid&&sap.ui.getCore().getModel("BOMCHNavModel")==="X"){this.readfrombufferBom();sap.ui.getCore().setModel(true,"BOMCHNavModel");this.oModelUpdateFlag=false}else if(c.getProperty("/refresh")===true){this.existFlag=false;var j=sap.ui.getCore().getModel("AIWListWBSModel");var E=j.getData();var g=new t;for(var h=0;h<E.length;h++){if(E[h].Matnr===s&&E[h].Werks===n&&E[h].Stlan===m&&E[h].WbsExt===l){this.existFlag=true;this.currentObj=E[h];g.setData(this.currentObj);this.getView().setModel(g,"BOMDetailModel");this.attachModelEventHandlers(g);var I=new t;I.setData(this.currentObj.wbsItem);this.getView().setModel(I,"itemDetailModel");this.attachModelEventHandlers(I);break}}if(!this.existFlag){this.readBomDetails(s,n,m,this.crstatus,l)}this.oModelUpdateFlag=false}else{this.oModelUpdateFlag=sap.ui.getCore().getModel("oModelUpdateFlag").updateFlag;this.getView().getModel("BOMDetailModel").refresh();this.getView().getModel("itemDetailModel").refresh();this.currentObj=this.getView().getModel("BOMDetailModel").getData()}}if(this.mode==="request"){if(this.sFragmentName==="CreateMaterialBom"){b.altbomVisible=true;b.techtypeVisible=true;b.bomAltTxtVisible=true;b.bomHdrTxtVisible=false;this.getView().byId("idBOMAltTextTitle").setText(this.getView().getModel("i18n").getProperty("BOM_ALT_TEXT"))}else{b.altbomVisible=false;b.techtypeVisible=false;b.bomAltTxtVisible=false;b.bomHdrTxtVisible=false;this.getView().byId("idBOMAltTextTitle").setText()}b.delflgVisible=false;b.authgrpVisible=false;b.TitleDataVisible=false;b.TitleDataText="";b.plnrgrpVisible=false;b.constTypVisible=false;b.laboffVisible=false;b.sizeDimVisible=false;b.invNumVisible=false;b.manufVisible=false;b.modNoVisible=false;b.manufSerVisible=false;b.sopTableVisible=true;b.tabTableVisible=false;o.modeFlag="Delete"}else{this.getView().byId("idBtnCheck").setVisible(false);if(this.sFragmentName==="CreateMaterialBom"){b.altbomVisible=true;b.techtypeVisible=true;b.delflgVisible=true;b.authgrpVisible=true;b.TitleDataVisible=true;b.TitleDataText=this.getResourceBundle().getText("APR_MAT_DATA");b.laboffVisible=true;b.sizeDimVisible=true;b.bomAltTxtVisible=true;b.bomHdrTxtVisible=true;this.getView().byId("idBOMAltTextTitle").setText(this.getView().getModel("i18n").getProperty("BOM_ALT_TEXT"));b.plnrgrpVisible=false;b.constTypVisible=false;b.invNumVisible=false;b.manufVisible=false;b.modNoVisible=false;b.manufSerVisible=false}if(this.sFragmentName==="CreateEquipmentBom"){b.delflgVisible=true;b.authgrpVisible=true;b.TitleDataVisible=true;b.TitleDataText=this.getResourceBundle().getText("APR_EQ_DATA");b.laboffVisible=true;b.sizeDimVisible=true;b.bomAltTxtVisible=false;b.bomHdrTxtVisible=false;this.getView().byId("idBOMAltTextTitle").setText();b.invNumVisible=true;b.manufVisible=true;b.modNoVisible=true;b.manufSerVisible=true;b.altbomVisible=false;b.techtypeVisible=false;b.plnrgrpVisible=false;b.constTypVisible=false}if(this.sFragmentName==="CreateFLBom"){b.delflgVisible=true;b.authgrpVisible=true;b.TitleDataVisible=true;b.TitleDataText=this.getResourceBundle().getText("APR_FLOC_DATA");b.plnrgrpVisible=true;b.constTypVisible=true;b.laboffVisible=true;b.altbomVisible=false;b.techtypeVisible=false;b.sizeDimVisible=false;b.bomAltTxtVisible=false;b.bomHdrTxtVisible=false;this.getView().byId("idBOMAltTextTitle").setText();b.invNumVisible=false;b.manufVisible=false;b.modNoVisible=false;b.manufSerVisible=false}if(this.sFragmentName==="CreateWBSBom"){b.delflgVisible=true;b.authgrpVisible=true;b.TitleDataVisible=true;b.TitleDataText=this.getResourceBundle().getText("APR_WBS_DATA");b.laboffVisible=true;b.plnrgrpVisible=false;b.constTypVisible=false;b.altbomVisible=false;b.techtypeVisible=false;b.sizeDimVisible=false;b.bomAltTxtVisible=false;b.bomHdrTxtVisible=false;this.getView().byId("idBOMAltTextTitle").setText();b.invNumVisible=false;b.manufVisible=false;b.modNoVisible=false;b.manufSerVisible=false}b.sopTableVisible=false;b.tabTableVisible=true;o.modeFlag="None"}u.setData(b);i.setData(o);this.getView().setModel(i,"applicationModel")}else{return}},readSystem:function(){var e=this.getView().getModel("valueHelp");var r=this;var a=new t;var s;e.read("/SystemTypeSet",{success:function(e){if(e.results[0].System===true){s={maxlengthMat:40,maxlengthComp:40}}else{s={maxlengthMat:18,maxlengthComp:10}}a.setData(s);r.getView().setModel(a,"maxLengthModel")}})},onMaterialVH:function(e){var t=this;var r=this.getView().getModel("valueHelp");var a=e.getSource().getId();if(a.indexOf("idTBLItems")>-1){this.componentFlag=true;var s=e.getSource().getBindingContext("itemDetailModel").sPath;this.sIndex=parseInt(s.substr(-1))}else{this.componentFlag=false}var n={title:this.getView().getModel("i18n").getProperty("MATERIAL_TXT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/MaterialSHSet",template:new sap.m.StandardListItem({title:"{Matnr}",description:"{Maktx}"})},confirm:function(e){if(t.componentFlag){var r=t.getModel("itemDetailModel");var a=r.getData();a[t.sIndex].Itemcomp=e.getParameters().selectedItem.getProperty("title");a[t.sIndex].Itmcmpdesc=e.getParameters().selectedItem.getProperty("description");a[t.sIndex].itmCompState="None";t.readComponentDetails(t.sIndex,a)}else{var s=t.getModel("BOMDetailModel");t.currentObj.Matnr=e.getParameters().selectedItem.getProperty("title");t.currentObj.MatDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.matValueState="None";s.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"){if(t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}}if(t.sFragmentName==="CreateWBSBom"){if(t.currentObj.WbsExt!==""&&t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}}}};var m="/MaterialSHSet";var i=l.getSelectDialog(r,m,[],n,"Matnr","Maktx");i.setModel(this.getView().getModel("i18n"),"i18n");i.open()},handleMaterialConfirm:function(e){var t=this.getParent().getController();if(t.componentFlag){var r=t.getModel("itemDetailModel");var a=r.getData();a[t.sIndex].Itemcomp=e.getParameters().selectedItem.getProperty("title");a[t.sIndex].Itmcmpdesc=e.getParameters().selectedItem.getProperty("description");a[t.sIndex].itmCompState="None";t.readComponentDetails(t.sIndex,a)}else{var s=t.getModel("BOMDetailModel");t.currentObj.Matnr=e.getParameters().selectedItem.getProperty("title");t.currentObj.MatDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.matValueState="None";s.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"){if(t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}}if(t.sFragmentName==="CreateWBSBom"){if(t.currentObj.WbsExt!==""&&t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}}},onEquipmentVH:function(e){var t=this;var r=this.getView().getModel("valueHelp");var a=o.EquipmentSelectDialog(t);this.getView().addDependent(a);a.setModel(r);a.setModel(this.getView().getModel("i18n"),"i18n");a.open()},handleEquimentConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("BOMDetailModel");t.currentObj.Eqnrbom=e.getParameters().selectedItem.getProperty("title");t.currentObj.EquiDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.equipValueState="None";r.setData(t.currentObj);if(t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}},onFLocVH:function(e){var t=this;var r=this.getView().getModel("valueHelp");var a=o.FLocSelectDialog(t);this.getView().addDependent(a);a.setModel(r);a.setModel(this.getView().getModel("i18n"),"i18n");a.open()},handleFLocConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("BOMDetailModel");t.currentObj.Tplnrbom=e.getParameters().selectedItem.getProperty("title");t.currentObj.FLDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.FLValueState="None";r.setData(t.currentObj);if(t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}},onWbsVH:function(e){var t=this;var r=this.getView().getModel("valueHelp");var a=t.getModel("BOMDetailModel");var s={title:"{i18n>WBS_TXT}",noDataText:"{i18n>LOAD}"+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>DESC_TXT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>WBS_TXT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>SHORTID}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>PROJDEF}"})]})],items:{path:"/WBSElementSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Post1}"}),new sap.m.Text({text:"{Posid}"}),new sap.m.Text({text:"{Poski}"}),new sap.m.Text({text:"{Objnr}"})]})},confirm:function(e){t.currentObj.WbsExt=e.getParameter("selectedItem").getCells()[1].getText();t.currentObj.WbsDesc=e.getParameter("selectedItem").getCells()[0].getText();t.currentObj.wbsValueState="None";a.setData(t.currentObj);if(t.currentObj.Matnr!==""&&t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}};var n="/WBSElementSet";var m=[];var i=[new sap.m.Text({text:"{Post1}"}),new sap.m.Text({text:"{Posid}"}),new sap.m.Text({text:"{Poski}"}),new sap.m.Text({text:"{Objnr}"})];var o=l.getValueHelp(r,n,i,m,s,"Post1","Posid");o.open();o.setModel(this.getView().getModel("i18n"),"i18n")},handleWbsConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("BOMDetailModel");t.currentObj.WbsExt=e.getParameter("selectedItem").getCells()[1].getText();t.currentObj.WbsDesc=e.getParameter("selectedItem").getCells()[0].getText();t.currentObj.wbsValueState="None";r.setData(t.currentObj);if(t.currentObj.Matnr!==""&&t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}},onPlantVH:function(e){var t=this;var r={title:this.getView().getModel("i18n").getProperty("PLANT_TXT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/PlantNameSet",template:new sap.m.StandardListItem({title:"{Werks}",description:"{Name1}"})},confirm:function(e){var r=t.getModel("BOMDetailModel");t.currentObj.Werks=e.getParameters().selectedItem.getProperty("title");t.currentObj.WerksDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.plantValueState="None";r.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"&&t.currentObj.Matnr!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}if(t.sFragmentName==="CreateEquipmentBom"&&t.currentObj.Eqnrbom!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateFLBom"&&t.currentObj.Tplnrbom!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateWBSBom"&&t.currentObj.WbsExt!==""&&t.currentObj.Matnr!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}};var a="/PlantNameSet";var s=this.getView().getModel("valueHelp");var n=l.getSelectDialog(s,a,[],r,"Werks","Name1");n.setModel(this.getView().getModel("i18n"),"i18n");n.open()},handlePlantConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("BOMDetailModel");t.currentObj.Werks=e.getParameters().selectedItem.getProperty("title");t.currentObj.WerksDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.plantValueState="None";r.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"&&t.currentObj.Matnr!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}if(t.sFragmentName==="CreateEquipmentBom"&&t.currentObj.Eqnrbom!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateFLBom"&&t.currentObj.Tplnrbom!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateWBSBom"&&t.currentObj.WbsExt!==""&&t.currentObj.Matnr!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}},omBomUsageVH:function(e){var t=this;var r=[];if(t.sFragmentName==="CreateEquipmentBom"||t.sFragmentName==="CreateFLBom"){r=[new sap.ui.model.Filter("EqFl","EQ",true)]}var a={title:this.getView().getModel("i18n").getProperty("BOM_USAGE_TXT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/BOMUsageHelpSet",template:new sap.m.StandardListItem({title:"{Stlan}",description:"{Antxt}"})},confirm:function(e){var r=t.getModel("BOMDetailModel");t.currentObj.Stlan=e.getParameters().selectedItem.getProperty("title");t.currentObj.StlanDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.usageValueState="None";r.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"&&t.currentObj.Matnr!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}if(t.sFragmentName==="CreateEquipmentBom"&&t.currentObj.Eqnrbom!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateFLBom"&&t.currentObj.Tplnrbom!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateWBSBom"&&t.currentObj.WbsExt!==""&&t.currentObj.Matnr!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}};var s="/BOMUsageHelpSet";var n=this.getView().getModel("valueHelp");var m=l.getSelectDialog(n,s,r,a,"Stlan","Antxt");m.setModel(this.getView().getModel("i18n"),"i18n");m.open()},handleBomUsageConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("BOMDetailModel");t.currentObj.Stlan=e.getParameter("selectedItem").getCells()[0].getText();t.currentObj.StlanDesc=e.getParameter("selectedItem").getCells()[7].getText();t.currentObj.usageValueState="None";r.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"&&t.currentObj.Matnr!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}if(t.sFragmentName==="CreateEquipmentBom"&&t.currentObj.Eqnrbom!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateFLBom"&&t.currentObj.Tplnrbom!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateWBSBom"&&t.currentObj.WbsExt!==""&&t.currentObj.Matnr!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}},onBomStsVH:function(){var e=this;var t={title:this.getView().getModel("i18n").getProperty("BOM_STATUS_TXT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/BOMStatusValueHelpSet",template:new sap.m.StandardListItem({title:"{BOMStatus}",description:"{BOMStatusTxt}"})},confirm:function(t){var r=e.getModel("BOMDetailModel");e.currentObj.Bomstatus=t.getParameters().selectedItem.getProperty("title");e.currentObj.BomstatusText=t.getParameters().selectedItem.getProperty("description");e.currentObj.statusValueState="None";r.setData(e.currentObj)}};var r="/BOMStatusValueHelpSet";var a=this.getView().getModel("valueHelp");var s=l.getSelectDialog(a,r,[],t,"BOMStatus","BOMStatusTxt");s.setModel(this.getView().getModel("i18n"),"i18n");s.open()},handleBomStatusConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("BOMDetailModel");t.currentObj.Bomstatus=e.getParameters().selectedItem.getProperty("title");t.currentObj.BomstatusText=e.getParameters().selectedItem.getProperty("description");t.currentObj.statusValueState="None";r.setData(t.currentObj)},onBOMStsChange:function(e){var t=this;var r=e.getParameters().newValue;var a=this.getView().getModel("valueHelp");var s=this.getView().getModel("BOMDetailModel");if(r!==""){var n=r.toUpperCase();var m=new sap.ui.model.Filter("BOMStatus","EQ",n);var l="/BOMStatusValueHelpSet";a.read(l,{filters:[m],success:function(e){if(e.results.length>0){t.currentObj.Bomstatus=e.results[0].BOMStatus;t.currentObj.BomstatusText=e.results[0].BOMStatusTxt;t.currentObj.statusValueState="None";s.setData(t.currentObj)}else{t.currentObj.statusValueState="Error";t.currentObj.BomstatusText="";s.setData(t.currentObj)}},error:function(e){t.currentObj.statusValueState="Error";t.currentObj.BomstatusText="";s.setData(t.currentObj)}})}else{t.currentObj.statusValueState="Error";t.currentObj.BomstatusText="";s.setData(t.currentObj)}},onBaseQtyChange:function(e){var t=this;var r=this.getView().getModel("BOMDetailModel");if(e.getSource().getValue()===""){t.currentObj.BaseQtyValueState="Error";r.setData(t.currentObj)}else{t.currentObj.BaseQtyValueState="None";r.setData(t.currentObj)}},materialChange:function(e){var t=this;var r=e.getParameters().newValue;var a=this.getView().getModel("valueHelp");var s=t.getModel("BOMDetailModel");if(r!==""){var n=r.toUpperCase();var m=[new sap.ui.model.Filter("Matnr","EQ",n)];t.BusyDialog.open();a.read("/MaterialSHSet",{filters:m,success:function(e){t.BusyDialog.close();if(e.results.length>0){t.currentObj.Matnr=e.results[0].Matnr;t.currentObj.MatDesc=e.results[0].Maktx;t.currentObj.matValueState="None";s.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"){if(t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}}if(t.sFragmentName==="CreateWBSBom"){if(t.currentObj.WbsExt!==""&&t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}}else{t.currentObj.MatDesc="";t.currentObj.matValueState="Error";s.setData(t.currentObj)}},error:function(e){t.BusyDialog.close();t.currentObj.MatDesc="";t.currentObj.matValueState="Error";s.setData(t.currentObj)}})}else{t.currentObj.MatDesc="";t.currentObj.matValueState="Error";s.setData(t.currentObj)}},equipmentChange:function(e){var t=this;var r=e.getParameters().newValue;var a=this.getView().getModel("valueHelp");var s=t.getModel("BOMDetailModel");if(r!==""){var n=r.toUpperCase();var m=[new sap.ui.model.Filter("Equnr","EQ",n)];t.BusyDialog.open();a.read("/EquipmentNumberSet",{filters:m,success:function(e){t.BusyDialog.close();if(e.results.length>0){t.currentObj.Eqnrbom=e.results[0].Equnr;t.currentObj.EquiDesc=e.results[0].Eqktx;t.currentObj.equipValueState="None";s.setData(t.currentObj);if(t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}}else{t.currentObj.EquiDesc="";t.currentObj.equipValueState="Error";s.setData(t.currentObj)}},error:function(e){t.BusyDialog.close();t.currentObj.EquiDesc="";t.currentObj.equipValueState="Error";s.setData(t.currentObj)}})}else{t.currentObj.EquiDesc="";t.currentObj.equipValueState="Error";s.setData(t.currentObj)}},flocChange:function(e){var t=this;var r=e.getParameters().newValue;var a=this.getView().getModel("valueHelp");var s=this.getView().getModel("BOMDetailModel");if(r!==""){var n=r.toUpperCase();var m=[new sap.ui.model.Filter("Tplnr","EQ",n)];t.BusyDialog.open();a.read("/FunctionLocationSet",{filters:m,success:function(e){t.BusyDialog.close();if(e.results.length>0){t.currentObj.Tplnrbom=e.results[0].Tplnr;t.currentObj.FLDesc=e.results[0].Pltxt;t.currentObj.FLValueState="None";s.setData(t.currentObj);if(t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}}else{t.currentObj.FLDesc="";t.currentObj.FLValueState="Error";s.setData(t.currentObj)}},error:function(e){t.BusyDialog.close();t.currentObj.FLDesc="";t.currentObj.FLValueState="Error";s.setData(t.currentObj)}})}else{t.currentObj.FLDesc="";t.currentObj.FLValueState="Error";s.setData(t.currentObj)}},wbsChange:function(e){var t=this;var r=e.getParameters().newValue;var a=this.getView().getModel("valueHelp");var s=this.getView().getModel("BOMDetailModel");if(r!==""){var n=r.toUpperCase();var m=[new sap.ui.model.Filter("Posid","EQ",n)];t.BusyDialog.open();a.read("/WBSElementSet",{filters:m,success:function(e){t.BusyDialog.close();if(e.results.length>0){t.currentObj.WbsExt=e.results[0].Posid;t.currentObj.WbsDesc=e.results[0].Post1;t.currentObj.wbsValueState="None";s.setData(t.currentObj);if(t.currentObj.Matnr!==""&&t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}else{t.currentObj.wbsValueState="Error";t.currentObj.WbsDesc="";s.setData(t.currentObj)}},error:function(e){t.BusyDialog.close();t.currentObj.wbsValueState="Error";t.currentObj.WbsDesc="";s.setData(t.currentObj)}})}else{t.currentObj.wbsValueState="Error";t.currentObj.WbsDesc="";s.setData(t.currentObj)}},plantChange:function(e){var t=this;var r=e.getParameters().newValue;var a=this.getView().getModel("valueHelp");var s=this.getView().getModel("BOMDetailModel");if(r!==""){var n=r.toUpperCase();var m=[new sap.ui.model.Filter("Werks","EQ",n)];this.BusyDialog.open();a.read("/PlantNameSet",{filters:m,success:function(e){t.BusyDialog.close();if(e.results.length>0){t.currentObj.Werks=e.results[0].Werks;t.currentObj.WerksDesc=e.results[0].Name1;t.currentObj.plantValueState="None";s.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"&&t.currentObj.Matnr!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}if(t.sFragmentName==="CreateEquipmentBom"&&t.currentObj.Eqnrbom!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateFLBom"&&t.currentObj.Tplnrbom!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateWBSBom"&&t.currentObj.WbsExt!==""&&t.currentObj.Matnr!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}else{t.currentObj.WerksDesc="";t.currentObj.plantValueState="Error";s.setData(t.currentObj)}},error:function(e){t.BusyDialog.close();t.currentObj.WerksDesc="";t.currentObj.plantValueState="Error";s.setData(t.currentObj)}})}else{t.currentObj.WerksDesc="";t.currentObj.plantValueState="Error";s.setData(t.currentObj)}},bomUsageChange:function(e){var t=this;var r=e.getParameters().newValue;var a=this.getView().getModel("valueHelp");var s=this.getView().getModel("BOMDetailModel");var n=[];if(t.sFragmentName==="CreateEquipmentBom"||t.sFragmentName==="CreateFLBom"){n.push(new sap.ui.model.Filter("EqFl","EQ",true))}if(r!==""){var m=r.toUpperCase();n.push(new sap.ui.model.Filter("Stlan","EQ",m));t.BusyDialog.open();a.read("/BOMUsageHelpSet",{filters:n,success:function(e){t.BusyDialog.close();if(e.results.length>0){t.currentObj.Stlan=e.results[0].Stlan;t.currentObj.StlanDesc=e.results[0].Antxt;t.currentObj.usageValueState="None";s.setData(t.currentObj);if(t.sFragmentName==="CreateMaterialBom"&&t.currentObj.Matnr!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}if(t.sFragmentName==="CreateEquipmentBom"&&t.currentObj.Eqnrbom!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Eqnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateFLBom"&&t.currentObj.Tplnrbom!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Tplnrbom,t.currentObj.Werks,t.currentObj.Stlan)}if(t.sFragmentName==="CreateWBSBom"&&t.currentObj.WbsExt!==""&&t.currentObj.Matnr!==""&&t.currentObj.Werks!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.WbsExt)}}else{t.currentObj.StlanDesc="";t.currentObj.usageValueState="Error";s.setData(t.currentObj)}},error:function(e){t.BusyDialog.close();t.currentObj.StlanDesc="";t.currentObj.usageValueState="Error";s.setData(t.currentObj)}})}else{t.currentObj.StlanDesc="";t.currentObj.usageValueState="Error";s.setData(t.currentObj)}},onAltBomChange:function(e){var t=this;if(e.getSource().getValue()!==""){if(t.sFragmentName==="CreateMaterialBom"&&t.currentObj.Matnr!==""&&t.currentObj.Werks!==""&&t.currentObj.Stlan!==""){t.readBomHdrDetails(t.currentObj.Matnr,t.currentObj.Werks,t.currentObj.Stlan,t.currentObj.Stalt)}}},readBomHdrDetails:function(e,t,r,a){var s=this;var n=this.getView().getModel();var m;var l=this.getView().getModel("BOMDetailModel");if(s.sFragmentName==="CreateMaterialBom"){var i=0;var o=sap.ui.getCore().getModel("AIWListMatModel").getData();for(var u=0;u<o.length;u++){if(o[u].Matnr===e&&o[u].Werks===t&&o[u].Stlan===r&&o[u].Stalt===a){var b="Material BOM "+e+"/"+t+"/"+r+"/"+a+" already locked in this CR";i=i+1;if(i>1){o[u].Matnr="";o[u].Werks="";o[u].Stlan="";o[u].Stalt="";o[u].MatDesc="";o[u].WerksDesc="";o[u].StlanDesc="";break}}}if(i<=1){m="/DeriveBOMHDRSet(Material='"+e+"',Werks='"+t+"',Stlan='"+r+"',Stlal='"+a+"',Equnr='',Tplnr='',Proid='')"}else{s.createMessagePopover(b,"Error");sap.ui.getCore().getModel("AIWListMatModel").setData(o);this.getView().getModel("BOMDetailModel").refresh();return}}if(s.sFragmentName==="CreateEquipmentBom"){var i=0;var c=sap.ui.getCore().getModel("AIWListEqModel").getData();if(c.length>0){for(var u=0;u<c.length;u++){if(c[u].Eqnrbom===e&&c[u].Werks===t&&c[u].Stlan===r){var b="Equipment BOM "+e+"/"+t+"/"+r+" already locked in this CR";i=i+1;if(i>1){c[u].Eqnrbom="";c[u].Werks="";c[u].Stlan="";c[u].EquiDesc="";c[u].WerksDesc="";c[u].StlanDesc="";break}}}}if(i<=1){m="/DeriveBOMHDRSet(Equnr='"+e+"',Werks='"+t+"',Stlan='"+r+"',Stlal='',Material='',Tplnr='',Proid='')"}else{s.createMessagePopover(b,"Error");sap.ui.getCore().getModel("AIWListEqModel").setData(c);this.getView().getModel("BOMDetailModel").refresh();return}}if(s.sFragmentName==="CreateFLBom"){var i=0;var g=sap.ui.getCore().getModel("AIWListFLModel").getData();if(g.length>0){for(var u=0;u<g.length;u++){if(g[u].Tplnrbom===e&&g[u].Werks===t&&g[u].Stlan===r){var b="Functional Location BOM "+e+"/"+t+"/"+r+" already locked in this CR";i=i+1;if(i>1){g[u].Tplnrbom="";g[u].Werks="";g[u].Stlan="";g[u].FLDesc="";g[u].WerksDesc="";g[u].StlanDesc="";break}}}}if(i<=1){m="/DeriveBOMHDRSet(Tplnr='"+e+"',Werks='"+t+"',Stlan='"+r+"',Stlal='',Material='',Equnr='',Proid='')"}else{s.createMessagePopover(b,"Error");sap.ui.getCore().getModel("AIWListFLModel").setData(g);this.getView().getModel("BOMDetailModel").refresh();return}}if(s.sFragmentName==="CreateWBSBom"){var i=0;var d=sap.ui.getCore().getModel("AIWListWBSModel").getData();if(d.length>0){for(var u=0;u<d.length;u++){if(d[u].WbsExt===a&&d[u].Matnr===e&&d[u].Werks===t&&d[u].Stlan===r){var b="WBS BOM "+a+"/"+e+"/"+t+"/"+r+" already locked in this CR";i=i+1;if(i>1){d[u].WbsExt="";d[u].Matnr="";d[u].Werks="";d[u].Stlan="";d[u].WbsDesc="";d[u].MatDesc="";d[u].WerksDesc="";d[u].StlanDesc="";break}}}}if(i<=1){m="/DeriveBOMHDRSet(Material='"+e+"',Werks='"+t+"',Stlan='"+r+"',Stlal='',Tplnr='',Equnr='',Proid='"+a+"')"}else{s.createMessagePopover(b,"Error");sap.ui.getCore().getModel("AIWListWBSModel").setData(d);this.getView().getModel("AIWListWBSModel").setData(d);return}}this.getView().byId("idSFBomHeader").setBusy(true);n.read(m,{success:function(e){s.getView().byId("idSFBomHeader").setBusy(false);if(e.Message!==""){s.createMessagePopover(e.Message,"Error");s.currentObj.plantEnable=true;s.currentObj.usageEnable=true;if(s.sFragmentName==="CreateMaterialBom"){s.currentObj.matEnable=true;s.currentObj.altbomEnable=true}if(s.sFragmentName==="CreateEquipmentBom"){s.currentObj.equipEnable=true}if(s.sFragmentName==="CreateFLBom"){s.currentObj.FLEnable=true}if(s.sFragmentName==="CreateWBSBom"){s.currentObj.wbsEnable=true;s.currentObj.matEnable=true}return}s.currentObj.BaseQty=e.Bmeng;s.currentObj.BaseUom=e.Bmein;s.currentObj.Bomstatus=e.Stlst;s.currentObj.BomstatusText=e.Sttxt;s.currentObj.Validfrom=s.getDateFormat(e.Validfrom);s.currentObj.Validtoda=s.getDateFormat(e.Validto);s.currentObj.plantEnable=false;s.currentObj.usageEnable=false;s.currentObj.addItemEnable=true;s.currentObj.modeFlag="Delete";if(s.sFragmentName==="CreateMaterialBom"){s.currentObj.Stalt=e.Stlal;s.currentObj.Pmbomtech=e.Pmbomtech;s.currentObj.PmbomtechTxt=e.PmbomtechTxt;s.currentObj.matValueState="None";s.currentObj.matEnable=false;s.currentObj.altbomValueState="None";s.currentObj.crtMatEnable=true;s.currentObj.crtMatHdrBtnEnable=false;if(a&&a!==""&&s.currentObj.Stalt!==""){s.currentObj.altbomEnable=false}}if(s.sFragmentName==="CreateEquipmentBom"){s.currentObj.equipValueState="None";s.currentObj.equipEnable=false}if(s.sFragmentName==="CreateFLBom"){s.currentObj.FLValueState="None";s.currentObj.FLEnable=false}if(s.sFragmentName==="CreateWBSBom"){s.currentObj.wbsValueState="None";s.currentObj.matValueState="None";s.currentObj.wbsEnable=false;s.currentObj.matEnable=false}s.currentObj.plantValueState="None";s.currentObj.usageValueState="None";s.currentObj.BaseQtyValueState="None";s.currentObj.statusValueState="None";l.setData(s.currentObj)},error:function(e){var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var a=t.join("\n");sap.m.MessageBox.show(a,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(e){}});s.getView().byId("idSFBomHeader").setBusy(false)}})},getDateFormat:function(e){if(e!==""&&e!==null&&e!==undefined){var t;if(e instanceof Date){var r="";var a=e.getFullYear();var s=e.getMonth();if(s<10){s=s+1;if(s.length===1){s="0"+s}}else{s=s+1}var n=e.getDate();if(n<10){n="0"+n}var m=e.getHours();if(m<10){m="0"+m}var l=e.getMinutes();if(l<10){l="0"+l}var i=e.getSeconds();if(i<10){i="0"+i}t=s+"/"+n+"/"+a}else{var o=new Date(parseInt(e.substr(6)));var u=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/yyyy"});t=u.format(o)}return t}else if(e===null){return""}},onLiveChange:function(e){if(e.getSource().getValue()===" "){e.getSource().setValue("")}e.getSource().setValueState("None")},readItemNumber:function(){var e=this;var t=true;if(e.itemNo===0||e.itemNo===undefined){t=false;var r=this.getView().getModel();var a="/BOMUserProfileSet";this.getView().byId("idTBLItems").setBusy(true);r.read(a,{success:function(t){if(t.results.length>0){e.itemNo=t.results[0].Psinc;e.addItem(e.itemNo)}e.getView().byId("idTBLItems").setBusy(false)},error:function(t){e.getView().byId("idTBLItems").setBusy(false)}})}if(t===true){e.addItem(e.itemNo)}},addItem:function(e){var t=this;var r;var a=this.getView().getModel("itemDetailModel");var s=a.getData();if(s!==undefined&&s!==null&&s.length!==0){var n=s.length;var m=parseInt(s[n-1].Bomitmpos);var l=0;if(this.sLastItemNum){l=parseInt(this.sLastItemNum)}var i=m>l?m+parseInt(e):l+parseInt(e);while(i.toString().length<4){i="0"+i}r={Bomitmpos:i,Itemcat:"",Itemcomp:"",Itmcmpdesc:"",Itmqty:"",Itmuom:"",Recurallo:false,itmCatState:"None",itmCompState:"None",itmQtyState:"None",itmUOMState:"None",itmCatEnable:true,itmQtyEnable:true,reccrAllowEnable:true,ItmcmpdescEnabled:false,SparePartVis:true,RelCostVis:true,RelSalesVis:true};if(t.sFragmentName==="CreateMaterialBom"){r.ItmcmpdescEnabled=true}s.push(r);a.setData(s);this.getView().setModel(a,"itemDetailModel")}else{if(this.sLastItemNum!=="0000"){e=parseInt(this.sLastItemNum)+parseInt(e);while(e.toString().length<4){e="0"+e}}r={Bomitmpos:e,Itemcat:"",Itemcomp:"",Itmcmpdesc:"",Itmqty:"",Itmuom:"",Recurallo:false,itmCatState:"None",itmCompState:"None",itmQtyState:"None",itmUOMState:"None",itmCatEnable:true,itmQtyEnable:true,ItmcmpdescEnabled:false};if(t.sFragmentName==="CreateMaterialBom"){r.ItmcmpdescEnabled=true}s.push(r);a.setData(s);this.getView().setModel(a,"itemDetailModel")}},onItemCatVH:function(e){var t=this;var r=e.getSource().getBindingContext("itemDetailModel").sPath;var a=[];this.sIndex=parseInt(r.substr(-1));if(this.sFragmentName.indexOf("MaterialBom")>-1){a=[new sap.ui.model.Filter("Stlty","EQ","M")]}else if(this.sFragmentName.indexOf("EquipmentBom")>-1){a=[new sap.ui.model.Filter("Stlty","EQ","E")]}else if(this.sFragmentName.indexOf("FLBom")>-1){a=[new sap.ui.model.Filter("Stlty","EQ","T")]}else if(this.sFragmentName.indexOf("WBSBom")>-1){a=[new sap.ui.model.Filter("Stlty","EQ","P")]}var s={title:this.getView().getModel("i18n").getProperty("IT_CAT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/bomitmcatvhSet",template:new sap.m.StandardListItem({title:"{Postp}",description:"{Ptext}"})},confirm:function(e){var r=t.getModel("itemDetailModel");var a=r.getData();a[t.sIndex].Itemcat=e.getParameters().selectedItem.getProperty("title");a[t.sIndex].itmCatState="None";if(a[t.sIndex].Itemcat!==""&&a[t.sIndex].itmCatState!=="Error"){a[t.sIndex].itmCatEnable=false}if(a[t.sIndex].Itemcat==="D"||a[t.sIndex].Itemcat==="T"){a[t.sIndex].itmCompEnable=false;a[t.sIndex].reccrAllowEnable=false;a[t.sIndex].Recurallo=false;if(a[t.sIndex].Itemcat==="D"){a[t.sIndex].SparePartVis=false;a[t.sIndex].RelCostVis=false;a[t.sIndex].RelSalesVis=false}if(a[t.sIndex].Itemcat==="T"){a[t.sIndex].SparePartVis=false;a[t.sIndex].RelCostVis=false}}else{a[t.sIndex].itmCompEnable=true;a[t.sIndex].reccrAllowEnable=true}var s=e.getParameter("selectedItem").getBindingContext();var n=s.getPath();var m=s.getModel().getProperty(n).Mngvz;a[t.sIndex].qtyFlag=m;r.setData(a);t.initializeCategorySpecificFields(t.sIndex);t.readComponentDetails(t.sIndex,a)}};var n="/bomitmcatvhSet";var m=this.getView().getModel("valueHelp2");var i=l.getSelectDialog(m,n,a,s,"Postp","Ptext");i.setModel(this.getView().getModel("i18n"),"i18n");i.open()},handleItemCatConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("itemDetailModel");var a=r.getData();a[t.sIndex].Itemcat=e.getParameters().selectedItem.getProperty("title");a[t.sIndex].itmCatState="None";if(a[t.sIndex].Itemcat!==""&&a[t.sIndex].itmCatState!=="Error"){a[t.sIndex].itmCatEnable=false}r.setData(a)},onUOMQtyVH:function(e){var t=this;var r=this.getView().getModel("valueHelp2");var a=e.getSource().getBindingContext("itemDetailModel").sPath;this.sIndex=parseInt(a.substr(-1));var s=t.getModel("itemDetailModel");var n=s.getData();var m={title:"{i18n>UOM_QTY}",noDataText:"{i18n>LOAD}"+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>COMMERCIAL}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>INTMEASUNIT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>UNITTXT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>DIMSNTXT}"})]})],items:{path:"/QuantityUOMSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Mseh3}"}),new sap.m.Text({text:"{Msehi}"}),new sap.m.Text({text:"{Msehl}"}),new sap.m.Text({text:"{Txdim}"})]})},confirm:function(e){n[t.sIndex].Itmuom=e.getParameter("selectedItem").getCells()[0].getText();n[t.sIndex].itmUOMState="None";s.setData(n);t.getView().setModel(s,"itemDetailModel")}};var i="/QuantityUOMSet";var o=[];var u=[new sap.m.Text({text:"{Mseh3}"}),new sap.m.Text({text:"{Msehi}"}),new sap.m.Text({text:"{Msehl}"}),new sap.m.Text({text:"{Txdim}"})];var b=l.getValueHelp(r,i,u,o,m,"Msehi","Msehl");b.open();b.setModel(this.getView().getModel("i18n"),"i18n")},handleUomQtyConfirm:function(e){var t=this.getParent().getController();var r=t.getModel("itemDetailModel");var a=r.getData();a[t.sIndex].Itmuom=e.getParameter("selectedItem").getCells()[0].getText();a[t.sIndex].itmUOMState="None";r.setData(a);t.getView().setModel(r,"itemDetailModel")},onItemChange:function(e){var t=e.getSource().getBindingInfo("value").binding.sPath;switch(t){case"Itemcat":this.handleItemCatChange(e);break;case"Itemcomp":this.handleComponentChange(e);break;case"Itmqty":this.handleItemQtyChange(e);break;case"Itmuom":this.handleItemUOMChange(e);break}},handleItemCatChange:function(e){var t=this;var r=e.getParameters().newValue;var a=e.getSource().getBindingContext("itemDetailModel").sPath;var s=parseInt(a.substr(1));var n=this.getView().getModel("itemDetailModel");var m=n.getData();var l=this.getView().getModel("valueHelp2");var i=[];if(r!==""){var o=r.toUpperCase();if(this.sFragmentName.indexOf("MaterialBom")>-1){i=[new sap.ui.model.Filter("Stlty","EQ","M")]}else if(this.sFragmentName.indexOf("EquipmentBom")>-1){i=[new sap.ui.model.Filter("Stlty","EQ","E")]}else if(this.sFragmentName.indexOf("FLBom")>-1){i=[new sap.ui.model.Filter("Stlty","EQ","T")]}else if(this.sFragmentName.indexOf("WBSBom")>-1){i=[new sap.ui.model.Filter("Stlty","EQ","P")]}i.push(new sap.ui.model.Filter("Postp","EQ",o));this.getView().byId("idTBLItems").setBusy(true);l.read("/bomitmcatvhSet",{filters:i,success:function(e){t.getView().byId("idTBLItems").setBusy(false);if(e.results.length>0){m[s].Itemcat=e.results[0].Postp;m[s].itmCatState="None";if(m[s].Itemcat!==""&&m[s].itmCatState!=="Error"){m[s].itmCatEnable=false}m[s].qtyFlag=e.results[0].Mngvz;if(m[s].Itemcat==="D"||m[s].Itemcat==="T"){m[s].itmCompEnable=false;m[s].reccrAllowEnable=false;m[s].Recurallo=false;if(m[s].Itemcat==="D"){m[s].SparePartVis=false;m[s].RelCostVis=false;m[s].RelSalesVis=false}if(m[s].Itemcat==="T"){m[s].SparePartVis=false;m[s].RelCostVis=false}}else{m[s].itmCompEnable=true;m[s].reccrAllowEnable=true}n.setData(m);t.initializeCategorySpecificFields(s);t.readComponentDetails(s,m)}else{m[s].itmCatState="Error";n.setData(m)}},error:function(e){t.getView().byId("idTBLItems").setBusy(false);m[s].itmCatState="Error";n.setData(m);t.getView().byId("idTBLItems").setBusy(false)}})}else{m[s].itmCatState="Error";n.setData(m)}},handleComponentChange:function(e){var t=this;var r=e.getParameters().newValue;var a=e.getSource().getBindingContext("itemDetailModel").sPath;var s=parseInt(a.substr(1));var n=this.getView().getModel("itemDetailModel");var m=n.getData();var l=this.getView().getModel("valueHelp");if(r!==""){var i=r.toUpperCase();var o=[new sap.ui.model.Filter("Matnr","EQ",i)];this.getView().byId("idTBLItems").setBusy(true);l.read("/MaterialSHSet",{filters:o,success:function(e){t.getView().byId("idTBLItems").setBusy(false);if(e.results.length>0){m[s].Itemcomp=e.results[0].Matnr;m[s].Itmcmpdesc=e.results[0].Maktx;m[s].itmCompState="None";if(m[s].Itemcat!==""&&m[s].itmCatState!=="Error"){m[s].itmCatEnable=false}n.setData(m);t.readComponentDetails(s,m)}else{m[s].itmCompState="None";n.setData(m);t.readComponentDetails(s,m)}},error:function(e){t.getView().byId("idTBLItems").setBusy(false);m[s].itmCompState="Error";n.setData(m)}})}else{m[s].itmCompState="Error";n.setData(m)}},handleItemQtyChange:function(e){var t=e.getParameters().newValue;if(t!==""){e.getSource().setValueState("None")}else{e.getSource().setValueState("Error");return}var r=e.getSource().getParent().getBindingContext("itemDetailModel").getPath();var a=this.getModel("itemDetailModel");var s=a.getProperty(r).qtyFlag;var n=a.getProperty(r).Itmqty;var m=a.getProperty(r).Bomitmpos;var l=a.getProperty(r).Itemcat;if(parseFloat(n)===0){a.getProperty(r).itmQtyState="Error";this.createMessagePopover(m+" : Item Quantity cannot be zero","Error")}else if(s==="+"&&parseFloat(n)<0){a.getProperty(r).itmQtyState="Error";this.createMessagePopover(m+" : Item Quantity cannot be negative for the category "+l,"Error")}else if(s==="-"&&parseFloat(n)>0){a.getProperty(r).itmQtyState="Error";this.createMessagePopover(m+" : Item Quantity cannot be positive for the category "+l,"Error")}},handleItemUOMChange:function(e){var t=this;var r=e.getParameters().newValue;var a=e.getSource().getBindingContext("itemDetailModel").sPath;var s=parseInt(a.substr(1));var n=this.getView().getModel("itemDetailModel");var m=n.getData();var l=this.getView().getModel("valueHelp2");if(r!==""){var i=r.toUpperCase();var o=[new sap.ui.model.Filter("Mseh3","EQ",i)];l.read("/QuantityUOMSet",{filters:o,success:function(e){if(e.results.length>0){m[s].Itmuom=e.results[0].Mseh3;m[s].itmUOMState="None";n.setData(m)}else{m[s].itmUOMState="Error";n.setData(m)}},error:function(e){m[s].itmUOMState="Error";n.setData(m)}})}else{m[s].itmUOMState="Error";n.setData(m)}},onQtyLiveChange:function(e){if(e.getSource().getValue()===" "){e.getSource().setValue("")}e.getSource().setValueState("None")},onCompLiveChange:function(e){var t=e.getSource().getBindingContext("itemDetailModel").sPath;var r=parseInt(t.substr(1));var a=this.getView().getModel("itemDetailModel");var s=a.getData();if(e.getSource().getValue()===" "){e.getSource().setValue("")}if(e.getSource().getValue()===""){s[r].Itmcmpdesc="";a.setData(s)}e.getSource().setValueState("None")},readComponentDetails:function(e,t){var r=this;var a;var s=this.getView().getModel("itemDetailModel");var n=this.getView().getModel();var m=this.currentObj.Stalt?this.currentObj.Stalt:"";if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="changeMbom"){a="/DeriveBOMITMSet(Matnr='"+this.currentObj.Matnr+"',Werks='"+this.currentObj.Werks+"',Stlan='"+this.currentObj.Stlan+"',Postp='"+t[e].Itemcat+"',Component='"+t[e].Itemcomp+"',Equnr='',Tplnr='',Stalt='"+m+"')"}if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="changeEbom"){a="/DeriveBOMITMSet(Equnr='"+this.currentObj.Eqnrbom+"',Werks='"+this.currentObj.Werks+"',Stlan='"+this.currentObj.Stlan+"',Postp='"+t[e].Itemcat+"',Component='"+t[e].Itemcomp+"',Matnr='',Tplnr='',Stalt='"+m+"')"}if(this.sFragmentName==="CreateFLBom"||this.sFragmentName==="changeFlbom"){a="/DeriveBOMITMSet(Tplnr='"+this.currentObj.Tplnrbom+"',Werks='"+this.currentObj.Werks+"',Stlan='"+this.currentObj.Stlan+"',Postp='"+t[e].Itemcat+"',Component='"+t[e].Itemcomp+"',Matnr='',Equnr='',Stalt='"+m+"')"}if(r.sFragmentName==="CreateWBSBom"||r.sFragmentName==="changeWbsbom"){a="/DeriveBOMITMSet(Matnr='"+this.currentObj.Matnr+"',Werks='"+this.currentObj.Werks+"',Stlan='"+this.currentObj.Stlan+"',Postp='"+t[e].Itemcat+"',Component='"+t[e].Itemcomp+"',Tplnr='',Equnr='',Stalt='"+m+"')"}this.BusyDialog.open();n.read(a,{success:function(a){r.BusyDialog.close();if(a.Message===""){t[e].itmCompState="None";if(t[e].Itmqty===""||parseInt(t[e].Itmqty)===0){t[e].Itmqty=a.Menge;t[e].itmQtyState="None"}t[e].Itmuom=a.Meins;t[e].itmUOMState="None";if(t[e].Erskz===""||t[e].Erskz===undefined){t[e].Erskz=a.Erskz;t[e].Etext=a.Etext}if(t[e].Sanka===""||t[e].Sanka===undefined){t[e].Costgrelv=a.Sanka;t[e].Stext=a.Stext}if(t[e].Rvrel===""||t[e].Rvrel===undefined){t[e].Rvrel=a.Rvrel;t[e].Bezei=a.Bezei}t[e].Pmper=a.Pmper;t[e].Pmpka=a.Pmpka;t[e].Pmprv=a.Pmprv;t[e].Pmpfe=a.Pmpfe;t[e].Pmpin=a.Pmpin;t[e].Pmpko=a.Pmpko;t[e].Sanfe=a.Sanfe;t[e].Sanin=a.Sanin;t[e].Sanko=a.Sanko;t[e].Itmassind=a.Itmassind;t[e].IsNavPossible=a.IsNavPossible;t[e].Itmcmpdesc=a.Txtmi;t[e].Ekorg=a.Ekorg;t[e].Ekgrp=a.Ekgrp;t[e].Matkl=a.Matkl;t[e].Ekotx=a.Ekotx;t[e].Eknam=a.Eknam;t[e].Preis=a.Preis;t[e].Waers=a.Waers;t[e].Peinh=a.Peinh;t[e].Roms1=a.Roms1;t[e].Romei=a.Romei;t[e].Roms2=a.Roms2;t[e].Roms3=a.Roms3;t[e].Rform=a.Rform;t[e].Roanz=a.Roanz;t[e].Romen=a.Romen;t[e].Rokme=a.Rokme;t[e].addSubItmEnable=a.Subitmflag;s.setData(t);r.getView().setModel(s,"itemDetailModel");if(t[e].Postp==="R"){r.readSizeDetails(e,t)}}else{t[e].Itmcmpdesc=a.Txtmi;t[e].itmCompState="Error";s.setData(t);r.createMessagePopover(a.Message,"Error")}},error:function(e){r.BusyDialog.close();var t=[],a=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var s=0;s<JSON.parse(e.responseText).error.innererror.errordetails.length;s++){t[s]=JSON.parse(e.responseText).error.innererror.errordetails[s].message}}var n=t.join("\n");r.createMessagePopover(n,"Error")}})},readSizeDetails:function(e,t){var r=this;var a;var s=this.getView().getModel("itemDetailModel");var n=this.getView().getModel();var m=this.currentObj.Stalt?this.currentObj.Stalt:"";var l=[new sap.ui.model.Filter("Matnr","EQ",this.currentObj.Matnr),new sap.ui.model.Filter("Werks","EQ",this.currentObj.Werks),new sap.ui.model.Filter("Stlan","EQ",this.currentObj.Stlan),new sap.ui.model.Filter("Stalt","EQ",m),new sap.ui.model.Filter("Postp","EQ",t[e].Itemcat),new sap.ui.model.Filter("Component","EQ",t[e].Itemcomp),new sap.ui.model.Filter("Menge","EQ",t[e].Itmqty),new sap.ui.model.Filter("Romei","EQ",t[e].Romei),new sap.ui.model.Filter("Roms1","EQ",t[e].Roms1),new sap.ui.model.Filter("Roms2","EQ",t[e].Roms2),new sap.ui.model.Filter("Roms3","EQ",t[e].Roms3),new sap.ui.model.Filter("Rform","EQ",t[e].Rform),new sap.ui.model.Filter("Roanz","EQ",t[e].Roanz),new sap.ui.model.Filter("Romen","EQ",t[e].Romen),new sap.ui.model.Filter("Rokme","EQ",t[e].Rokme)];this.BusyDialog.open();n.read("/DeriveBOMITMSet",{filters:l,success:function(a){r.BusyDialog.close();var s=a.results[0];t[e].Roms1=s.Roms1;t[e].Romei=s.Romei;t[e].Roms2=s.Roms2;t[e].Roms3=s.Roms3;t[e].Rform=s.Rform;t[e].Roanz=s.Roanz;t[e].Romen=s.Romen;t[e].Rokme=s.Rokme},error:function(e){r.BusyDialog.close();var t=[],a=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var s=0;s<JSON.parse(e.responseText).error.innererror.errordetails.length;s++){t[s]=JSON.parse(e.responseText).error.innererror.errordetails[s].message}}var n=t.join("\n");r.createMessagePopover(n,"Error")}})},readBomDetails:function(e,r,a,s,n,m){var l=this;if(e===" "||e===undefined){return}var i=this.getView().getModel();var o="/ChangeRequestSet";var u;var b;var c=new t;var g=new t;if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="changeMbom"){if(m===""||m===undefined){m="1"}u=[new sap.ui.model.Filter("Matnr","EQ",e),new sap.ui.model.Filter("Werks","EQ",r),new sap.ui.model.Filter("Stlan","EQ",a),new sap.ui.model.Filter("Stalt","EQ",m)];b=["MRBHeader","MRBItem","MRBSBIT"]}if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="changeEbom"){u=[new sap.ui.model.Filter("Eqnrbom","EQ",e),new sap.ui.model.Filter("Werks","EQ",r),new sap.ui.model.Filter("Stlan","EQ",a),new sap.ui.model.Filter("Stalt","EQ","")];b=["EBHeader","EBItem","EBSBIT"]}if(this.sFragmentName==="changeFlbom"){u=[new sap.ui.model.Filter("Tplnrbom","EQ",e),new sap.ui.model.Filter("Werks","EQ",r),new sap.ui.model.Filter("Stlan","EQ",a),new sap.ui.model.Filter("Stalt","EQ","")];b=["FBHeader","FBItem","FBSBIT"]}if(this.sFragmentName==="changeWbsbom"){u=[new sap.ui.model.Filter("Proid","EQ",n),new sap.ui.model.Filter("Matnr","EQ",e),new sap.ui.model.Filter("Werks","EQ",r),new sap.ui.model.Filter("Stlan","EQ",a),new sap.ui.model.Filter("Stalt","EQ","")];b=["WBHeader","WBItem","WBSBIT"]}this.BusyDialog.open();i.read(o,{filters:u,urlParameters:{$expand:b},success:function(e){l.BusyDialog.close();if(e.results[0].Message&&e.results[0].Message!==""){l.createMessagePopover(e.results[0].Message,"Information")}if(l.sFragmentName==="CreateMaterialBom"||l.sFragmentName==="changeMbom"){var t=e.results[0].MRBHeader.results[0];var r=e.results[0].MRBItem.results;var a=e.results[0].MRBSBIT.results;l.currentObj={Matnr:t.Matnr,Werks:t.Werks,Stlan:t.Stlan,Stalt:t.Stalt,Pmbomtech:t.Pmbomtech,PmbomtechTxt:t.PmbomtechTxt,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Validfrom:l.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:l.getDateFormat(t.Validtoda),MatDesc:t.Maktx,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,matEnable:false,plantEnable:false,usageEnable:false,fromDateEnable:true,addItemEnable:true,crtMatHdrEnable:true,crtMatHdrBtnEnable:false,modeFlag:"Delete",matValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",altbomValueState:"None",bomType:"Change",matItem:[],matSubItem:[]};if(l.sFragmentName==="changeMbom"){l.currentObj.fromDateEnable=false;l.currentObj.crtMatHdrEnable=false;l.currentObj.crtMatHdrBtnEnable=false}if(r&&r.length>0){l.currentObj.matItem=r;for(var n=0;n<l.currentObj.matItem.length;n++){l.currentObj.matItem[n].itmCatState="None";l.currentObj.matItem[n].itmCompState="None";l.currentObj.matItem[n].itmQtyState="None";l.currentObj.matItem[n].itmUOMState="None";l.currentObj.matItem[n].itmCatEnable=false;l.currentObj.matItem[n].itmQtyEnable=true;l.currentObj.matItem[n].ItmcmpdescEnabled=true;if(l.currentObj.matItem[n].Itemcat==="D"||l.currentObj.matItem[n].Itemcat==="T"){l.currentObj.matItem[n].reccrAllowEnable=false;l.currentObj.matItem[n].itmCompEnable=false;if(l.currentObj.matItem[n].Itemcat==="D"){l.currentObj.matItem[n].SparePartVis=false;l.currentObj.matItem[n].RelCostVis=false;l.currentObj.matItem[n].RelSalesVis=false}if(l.currentObj.matItem[n].Itemcat==="T"){l.currentObj.matItem[n].SparePartVis=false;l.currentObj.matItem[n].RelCostVis=false}}}l.sLastItemNum=r.length}else l.currentObj.matItem=[];if(a&&a.length>0)l.currentObj.matSubItem=a;else l.currentObj.matSubItem=[];l.currentObj.crtMatEnable=true;if(s==="true"){l.getView().byId("idBtnCheck").setEnabled(false);l.currentObj.altbomEnable=false;l.currentObj.BomstatusEnable=false;l.currentObj.BaseQtyEnable=false;l.currentObj.LngtxtEnable=false;l.currentObj.fromDateEnable=false;l.currentObj.addItemEnable=false;l.currentObj.crtMatEnable=false;l.currentObj.modeFlag="None";for(var n=0;n<l.currentObj.matItem.length;n++){l.currentObj.matItem[n].itmQtyEnable=false;l.currentObj.matItem[n].itmCompEnable=false;l.currentObj.matItem[n].itmUomEnable=false;l.currentObj.matItem[n].reccrAllowEnable=false;l.currentObj.matItem[n].ItmcmpdescEnabled=false;l.currentObj.matItem[n].Pmper="-";l.currentObj.matItem[n].Pmper="-";l.currentObj.matItem[n].Pmpka="-";l.currentObj.matItem[n].Pmprv="-";l.currentObj.matItem[n].Pmpfe="-";l.currentObj.matItem[n].Pmpin="-";l.currentObj.matItem[n].Pmpko="-"}for(var n=0;n<l.currentObj.matSubItem.length;n++){l.currentObj.matSubItem[n].intPointEnable=false;l.currentObj.matSubItem[n].subQtyEnable=false;l.currentObj.matSubItem[n].subTextEnable=false}}c.setData(l.currentObj);g.setData(l.currentObj.matItem)}if(l.sFragmentName==="CreateEquipmentBom"||l.sFragmentName==="changeEbom"){var t=e.results[0].EBHeader.results[0];var r=e.results[0].EBItem.results;var a=e.results[0].EBSBIT.results;l.currentObj={Eqnrbom:t.Eqnrbom,Werks:t.Werks,Stlan:t.Stlan,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Validfrom:l.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:l.getDateFormat(t.Validtoda),EquiDesc:t.Eqktx,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,equipEnable:false,plantEnable:false,usageEnable:false,fromDateEnable:true,addItemEnable:true,modeFlag:"Delete",equipValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",bomType:"Change",eqItem:[],eqSubItem:[]};if(l.sFragmentName==="changeEbom"){l.currentObj.fromDateEnable=false}if(r&&r.length>0){l.currentObj.eqItem=r;for(var n=0;n<l.currentObj.eqItem.length;n++){l.currentObj.eqItem[n].itmCatState="None";l.currentObj.eqItem[n].itmCompState="None";l.currentObj.eqItem[n].itmQtyState="None";l.currentObj.eqItem[n].itmUOMState="None";l.currentObj.eqItem[n].itmCatEnable=false;l.currentObj.eqItem[n].itmQtyEnable=true;l.currentObj.eqItem[n].ItmcmpdescEnabled=false;if(l.currentObj.eqItem[n].Itemcat==="D"||l.currentObj.eqItem[n].Itemcat==="T"){l.currentObj.eqItem[n].itmCompEnable=false;if(l.currentObj.eqItem[n].Itemcat==="D"){l.currentObj.eqItem[n].SparePartVis=false;l.currentObj.eqItem[n].RelCostVis=false;l.currentObj.eqItem[n].RelSalesVis=false}if(l.currentObj.eqItem[n].Itemcat==="T"){l.currentObj.eqItem[n].SparePartVis=false;l.currentObj.eqItem[n].RelCostVis=false}}}l.sLastItemNum=r.length}else l.currentObj.eqItem=[];if(a&&a.length>0){l.currentObj.eqSubItem=a}else l.currentObj.eqSubItem=[];l.currentObj.crtMatEnable=false;if(s==="true"){l.getView().byId("idBtnCheck").setEnabled(false);l.currentObj.BomstatusEnable=false;l.currentObj.BaseQtyEnable=false;l.currentObj.LngtxtEnable=false;l.currentObj.fromDateEnable=false;l.currentObj.addItemEnable=false;l.currentObj.modeFlag="None";for(var n=0;n<l.currentObj.eqItem.length;n++){l.currentObj.eqItem[n].itmQtyEnable=false;l.currentObj.eqItem[n].itmCompEnable=false;l.currentObj.eqItem[n].itmUomEnable=false;l.currentObj.eqItem[n].addSubItmEnable=false;l.currentObj.eqItem[n].Pmper="-";l.currentObj.eqItem[n].Pmpka="-";l.currentObj.eqItem[n].Pmprv="-";l.currentObj.eqItem[n].Pmpfe="-";l.currentObj.eqItem[n].Pmpin="-";l.currentObj.eqItem[n].Pmpko="-"}for(var n=0;n<l.currentObj.eqSubItem.length;n++){l.currentObj.eqSubItem[n].intPointEnable=false;l.currentObj.eqSubItem[n].subQtyEnable=false;l.currentObj.eqSubItem[n].subTextEnable=false}}c.setData(l.currentObj);g.setData(l.currentObj.eqItem)}if(l.sFragmentName==="changeFlbom"){var t=e.results[0].FBHeader.results[0];var r=e.results[0].FBItem.results;var a=e.results[0].FBSBIT.results;l.currentObj={Tplnrbom:t.Tplnrbom,Werks:t.Werks,Stlan:t.Stlan,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Validfrom:l.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:l.getDateFormat(t.Validtoda),FLDesc:t.Pltxt,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,FLEnable:false,plantEnable:false,usageEnable:false,fromDateEnable:true,addItemEnable:true,modeFlag:"Delete",FLValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",bomType:"Change",flItem:[],flSubItem:[]};if(l.sFragmentName==="changeFlbom"){l.currentObj.fromDateEnable=false}if(r&&r.length>0){l.currentObj.flItem=r;for(var n=0;n<l.currentObj.flItem.length;n++){l.currentObj.flItem[n].itmCatState="None";l.currentObj.flItem[n].itmCompState="None";l.currentObj.flItem[n].itmQtyState="None";l.currentObj.flItem[n].itmUOMState="None";l.currentObj.flItem[n].itmCatEnable=false;l.currentObj.flItem[n].itmQtyEnable=true;l.currentObj.flItem[n].ItmcmpdescEnabled=false;if(l.currentObj.flItem[n].Itemcat==="D"||l.currentObj.flItem[n].Itemcat==="T"){l.currentObj.flItem[n].itmCompEnable=false;if(l.currentObj.flItem[n].Itemcat==="D"){l.currentObj.flItem[n].SparePartVis=false;l.currentObj.flItem[n].RelCostVis=false;l.currentObj.flItem[n].RelSalesVis=false}if(l.currentObj.flItem[n].Itemcat==="T"){l.currentObj.flItem[n].SparePartVis=false;l.currentObj.flItem[n].RelCostVis=false}}}l.sLastItemNum=r.length}else l.currentObj.flItem=[];if(a&&a.length>0)l.currentObj.flSubItem=a;else l.currentObj.flSubItem=[];l.currentObj.crtMatEnable=false;if(s==="true"){l.getView().byId("idBtnCheck").setEnabled(false);l.currentObj.BomstatusEnable=false;l.currentObj.BaseQtyEnable=false;l.currentObj.LngtxtEnable=false;l.currentObj.fromDateEnable=false;l.currentObj.addItemEnable=false;l.currentObj.modeFlag="None";for(var n=0;n<l.currentObj.flItem.length;n++){l.currentObj.flItem[n].itmQtyEnable=false;l.currentObj.flItem[n].itmCompEnable=false;l.currentObj.flItem[n].itmUomEnable=false;l.currentObj.flItem[n].addSubItmEnable=false;l.currentObj.flItem[n].Pmper="-";l.currentObj.flItem[n].Pmpka="-";l.currentObj.flItem[n].Pmprv="-";l.currentObj.flItem[n].Pmpfe="-";l.currentObj.flItem[n].Pmpin="-";l.currentObj.flItem[n].Pmpko="-"}for(var n=0;n<l.currentObj.flSubItem.length;n++){l.currentObj.flSubItem[n].intPointEnable=false;l.currentObj.flSubItem[n].subQtyEnable=false;l.currentObj.flSubItem[n].subTextEnable=false}}c.setData(l.currentObj);g.setData(l.currentObj.flItem)}if(l.sFragmentName==="changeWbsbom"){var t=e.results[0].WBHeader.results[0];var r=e.results[0].WBItem.results;var a=e.results[0].WBSBIT.results;l.currentObj={WbsExt:t.WbsExt,Matnr:t.MatnrWbs,Werks:t.Werks,Stlan:t.Stlan,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Validfrom:l.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:l.getDateFormat(t.Validtoda),WbsDesc:t.Post1,MatDesc:t.Maktx,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,wbsEnable:false,matEnable:false,plantEnable:false,usageEnable:false,fromDateEnable:true,addItemEnable:true,modeFlag:"Delete",wbsValueState:"None",matValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",bomType:"Change",wbsItem:[],wbsSubItem:[]};if(l.sFragmentName==="changeWbsbom"){l.currentObj.fromDateEnable=false}if(r&&r.length>0){l.currentObj.wbsItem=r;for(var n=0;n<l.currentObj.wbsItem.length;n++){l.currentObj.wbsItem[n].itmCatState="None";l.currentObj.wbsItem[n].itmCompState="None";l.currentObj.wbsItem[n].itmQtyState="None";l.currentObj.wbsItem[n].itmUOMState="None";l.currentObj.wbsItem[n].itmCatEnable=false;l.currentObj.wbsItem[n].itmQtyEnable=true;l.currentObj.wbsItem[n].ItmcmpdescEnabled=false;if(l.currentObj.wbsItem[n].Itemcat==="D"||l.currentObj.wbsItem[n].Itemcat==="T"){l.currentObj.wbsItem[n].reccrAllowEnable=false;l.currentObj.wbsItem[n].itmCompEnable=false;if(l.currentObj.wbsItem[n].Itemcat==="D"){l.currentObj.wbsItem[n].SparePartVis=false;l.currentObj.wbsItem[n].RelCostVis=false;l.currentObj.wbsItem[n].RelSalesVis=false}if(l.currentObj.wbsItem[n].Itemcat==="T"){l.currentObj.wbsItem[n].SparePartVis=false;l.currentObj.wbsItem[n].RelCostVis=false}}}l.sLastItemNum=r.length}else l.currentObj.wbsItem=[];if(a&&a.length>0)l.currentObj.wbsSubItem=a;else l.currentObj.wbsSubItem=[];l.currentObj.crtMatEnable=false;if(s==="true"){l.getView().byId("idBtnCheck").setEnabled(false);l.currentObj.BomstatusEnable=false;l.currentObj.BaseQtyEnable=false;l.currentObj.LngtxtEnable=false;l.currentObj.fromDateEnable=false;l.currentObj.addItemEnable=false;l.currentObj.modeFlag="None";for(var n=0;n<l.currentObj.wbsItem.length;n++){l.currentObj.wbsItem[n].itmQtyEnable=false;l.currentObj.wbsItem[n].itmCompEnable=false;l.currentObj.wbsItem[n].itmUomEnable=false;l.currentObj.wbsItem[n].reccrAllowEnable=false;l.currentObj.wbsItem[n].addSubItmEnable=false;l.currentObj.wbsItem[n].Pmper="-";l.currentObj.wbsItem[n].Pmpka="-";l.currentObj.wbsItem[n].Pmprv="-";l.currentObj.wbsItem[n].Pmpfe="-";l.currentObj.wbsItem[n].Pmpin="-";l.currentObj.wbsItem[n].Pmpko="-"}for(var n=0;n<l.currentObj.wbsSubItem.length;n++){l.currentObj.wbsSubItem[n].intPointEnable=false;l.currentObj.wbsSubItem[n].subQtyEnable=false;l.currentObj.wbsSubItem[n].subTextEnable=false}}c.setData(l.currentObj);g.setData(l.currentObj.wbsItem)}l.getView().setModel(c,"BOMDetailModel");l.getView().setModel(g,"itemDetailModel");l.attachModelEventHandlers(c);l.attachModelEventHandlers(g)},error:function(e){l.BusyDialog.close()}})},attachModelEventHandlers:function(e){e.attachPropertyChange(this.handlePropertyChanged,this)},handlePropertyChanged:function(){this.oModelUpdateFlag=true},handleItemDelete:function(e){var t=e.getParameter("listItem").getBindingContext("itemDetailModel").sPath;t=t.substring(t.lastIndexOf("/")+1);var r=e.getSource().getModel("itemDetailModel");var a=r.getProperty("/");var s=a[parseInt(t)].Bomitmpos;if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="changeMbom"){var n=this.currentObj.matSubItem.length;for(var m=n-1;m>=0;m--){if(this.currentObj.matSubItem[m].Posnr===s){this.currentObj.matSubItem.splice(m,1)}}}if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="changeEbom"){var n=this.currentObj.eqSubItem.length;for(var m=n-1;m>=0;m--){if(this.currentObj.eqSubItem[m].Posnr===s){this.currentObj.eqSubItem.splice(m,1)}}}if(this.sFragmentName==="CreateFLBom"||this.sFragmentName==="changeFlbom"){var n=this.currentObj.flSubItem.length;for(var m=n-1;m>=0;m--){if(this.currentObj.flSubItem[m].Posnr===s){this.currentObj.flSubItem.splice(m,1)}}}if(this.sFragmentName==="CreateWBSBom"||this.sFragmentName==="changeWbsbom"){var n=this.currentObj.wbsSubItem.length;for(var m=n-1;m>=0;m--){if(this.currentObj.wbsSubItem[m].Posnr===s){this.currentObj.wbsSubItem.splice(m,1)}}}a.splice(parseInt(t),1);r.setProperty("/",a);if(this.sFragmentName.indexOf("Search")>-1){this.oModelUpdateFlag=true}},onItemPress:function(e){var t=this;var r=e.getSource().getBindingContext("itemDetailModel").sPath;var a=parseInt(r.substr(1));var s=this.getView().getModel("itemDetailModel");var n=s.getData();if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="changeMbom"){if(n[a].Itemcat===""||n[a].itmCatState==="Error"){n[a].itmCatState="Error";s.setData(n);return}if(this.sFragmentName==="changeMbom"){sap.ui.getCore().setModel({updateFlag:this.oModelUpdateFlag},"oModelUpdateFlag")}}if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="changeEbom"){if(n[a].Itemcat===""||n[a].itmCatState==="Error"){n[a].itmCatState="Error";s.setData(n);return}if(this.sFragmentName==="changeEbom"){sap.ui.getCore().setModel({updateFlag:this.oModelUpdateFlag},"oModelUpdateFlag")}}if(this.sFragmentName==="CreateFLBom"||this.sFragmentName==="changeFlbom"){if(n[a].Itemcat===""||n[a].itmCatState==="Error"){n[a].itmCatState="Error";s.setData(n);return}if(this.sFragmentName==="changeFlbom"){sap.ui.getCore().setModel({updateFlag:this.oModelUpdateFlag},"oModelUpdateFlag")}}if(this.sFragmentName==="CreateWBSBom"||this.sFragmentName==="changeWbsbom"){if(n[a].Itemcat===""||n[a].itmCatState==="Error"){n[a].itmCatState="Error";s.setData(n);return}if(this.sFragmentName==="changeWbsbom"){sap.ui.getCore().setModel({updateFlag:this.oModelUpdateFlag},"oModelUpdateFlag")}}var m=this.getView().getModel("BOMDetailModel");sap.ui.getCore().setModel(m,"BOMDetailModel");this.getRouter().navTo("itmDetail",{sFragmentName:t.sFragmentName,sCrStatus:t.crstatus,itemPath:encodeURIComponent(r),mode:this.mode})},onDonePress:function(e){var t=e.getSource().getId();if(this.mode==="request"&&this.crstatus!=="true"){var a=this;var s=true;var n=this.getView().getModel("BOMDetailModel");this.currentObj=n.getData();var m=this.getView().getModel("itemDetailModel");if(m){var l=m.getData()}if(this.sFragmentName==="CreateMaterialBom"&&this.currentObj.Matnr===""){s=false;this.currentObj.matValueState="Error"}if(this.sFragmentName==="CreateMaterialBom"&&this.currentObj.Stalt===""){s=false;this.currentObj.altbomValueState="Error"}if(this.sFragmentName==="CreateEquipmentBom"&&this.currentObj.Eqnrbom===""){s=false;this.currentObj.equipValueState="Error"}if(this.sFragmentName==="CreateFLBom"&&this.currentObj.Tplnrbom===""){s=false;this.currentObj.FLValueState="Error"}if(this.sFragmentName==="CreateWBSBom"){if(this.currentObj.Matnr===""){s=false;this.currentObj.matValueState="Error"}if(this.currentObj.WbsExt===""){s=false;this.currentObj.wbsValueState="Error"}}if(this.currentObj.Werks===""){s=false;this.currentObj.plantValueState="Error"}if(this.currentObj.Stlan===""){s=false;this.currentObj.usageValueState="Error"}if(this.currentObj.BaseQty===""){s=false;this.currentObj.BaseQtyValueState="Error"}if(this.currentObj.statusValueState==="Error"){s=false}if(l!==undefined&&l.length>0){for(var i=0;i<l.length;i++){if(l[i].Itemcat===""||l[i].itmCatState==="Error"){s=false;l[i].itmCatState="Error"}if(l[i].Itemcat!=="N"&&l[i].Itemcat!=="D"&&l[i].Itemcat!=="T"&&(l[i].Itemcomp===""||l[i].itmCompState==="Error")){s=false;l[i].itmCompState="Error"}if(l[i].Itmqty===""||parseInt(l[i].Itmqty)===0||l[i].itmQtyState==="Error"){s=false;l[i].itmQtyState="Error"}if(l[i].Itmuom===""||l[i].itmUOMState==="Error"){s=false;l[i].itmUOMState="Error"}}m.setData(l)}if(!s&&n!==undefined){a.createMessagePopover(this.getResourceBundle().getText("MANDMSG"),"Error");n.setData(this.currentObj);return}var o=[];var u="";if(l!==undefined&&l.length>0){for(var i=0;i<l.length;i++){if(l[i].Itemcat==="N"&&l[i].Itemcomp===""){if(l[i].Ekgrp===""||l[i].Preis===""||l[i].Waers===""||l[i].Peinh===""||l[i].Matkl===""){u="Purchasing data is mandatory for item position "+l[i].Bomitmpos;o.push({type:"Error",title:u,message:u});s=false}if(l[i].Potx1===""){u="Item Text is mandatory for item position "+l[i].Bomitmpos;o.push({type:"Error",title:u,message:u});s=false}}if(l[i].Itemcat==="D"&&l[i].Bomdocitm===""){u="Document Assignment is mandatory for item position "+l[i].Bomitmpos;o.push({type:"Error",title:u,message:u});s=false}if(l[i].Itemcat==="R"){if(l[i].Roms1===""||l[i].Romei===""||l[i].Roanz===""){u="Variable-Size Item Data is mandatory for item position "+l[i].Bomitmpos;o.push({type:"Error",title:u,message:u});s=false}}if(l[i].Itemcat==="T"&&l[i].Potx1===""){u="Item Text is mandatory for item position "+l[i].Bomitmpos;o.push({type:"Error",title:u,message:u});s=false}}}if(!s){a.createMessagePopover(o,"Error");return}if(this.currentObj.Stalt!==""){this.currentObj.altbomEnable=false}if(t.indexOf("idBtnCheck")>-1){this.validateCheck();return}if(this.sFragmentName==="CreateMaterialBom"){var b=decodeURIComponent(this.itemPath);sap.ui.getCore().getModel("AIWListMatModel").setProperty(b,a.getView().getModel("BOMDetailModel").getData())}else if(this.sFragmentName==="CreateEquipmentBom"){var b=decodeURIComponent(this.itemPath);sap.ui.getCore().getModel("AIWListEqModel").setProperty(b,a.getView().getModel("BOMDetailModel").getData())}else if(this.sFragmentName==="CreateFLBom"){var b=decodeURIComponent(this.itemPath);sap.ui.getCore().getModel("AIWListFLModel").setProperty(b,a.getView().getModel("BOMDetailModel").getData())}else if(this.sFragmentName==="CreateWBSBom"){var b=decodeURIComponent(this.itemPath);sap.ui.getCore().getModel("AIWListWBSModel").setProperty(b,a.getView().getModel("BOMDetailModel").getData())}if(this.sFragmentName==="changeMbom"){if(this.oModelUpdateFlag===true){var c=sap.ui.getCore().getModel("AIWListMatModel").getData();if(!this.existFlag){var n=a.getView().getModel("BOMDetailModel");n.getData().bomType="Change";c.push(n.getData())}sap.ui.getCore().getModel("AIWListMatModel").refresh()}var g=sap.ui.getCore().getModel("refreshModel");g.setProperty("/refreshSearch",false);g.setProperty("/refresh",true)}if(this.sFragmentName==="changeEbom"){if(this.oModelUpdateFlag===true){var d=sap.ui.getCore().getModel("AIWListEqModel").getData();if(!this.existFlag){var n=a.getView().getModel("BOMDetailModel");n.getData().bomType="Change";d.push(n.getData())}sap.ui.getCore().getModel("AIWListEqModel").refresh()}var g=sap.ui.getCore().getModel("refreshModel");g.setProperty("/refreshSearch",false);g.setProperty("/refresh",true)}if(this.sFragmentName==="changeFlbom"){if(this.oModelUpdateFlag===true){var f=sap.ui.getCore().getModel("AIWListFLModel").getData();if(!this.existFlag){var n=a.getView().getModel("BOMDetailModel");n.getData().bomType="Change";f.push(n.getData())}sap.ui.getCore().getModel("AIWListFLModel").refresh()}var g=sap.ui.getCore().getModel("refreshModel");g.setProperty("/refreshSearch",false);g.setProperty("/refresh",true)}if(this.sFragmentName==="changeWbsbom"){if(this.oModelUpdateFlag===true){var I=sap.ui.getCore().getModel("AIWListWBSModel").getData();if(!this.existFlag){var n=a.getView().getModel("BOMDetailModel");n.getData().bomType="Change";I.push(n.getData())}sap.ui.getCore().getModel("AIWListWBSModel").refresh()}var g=sap.ui.getCore().getModel("refreshModel");g.setProperty("/refreshSearch",false);g.setProperty("/refresh",true)}}else{if(this.sFragmentName.indexOf("Search")>-1){var g=sap.ui.getCore().getModel("refreshModel");g.setProperty("/refreshSearch",false);g.setProperty("/refresh",true)}}var p=r.getInstance().getPreviousHash();if(p!==undefined){history.go(-1)}},validateCheck:function(){var e=this;var t=sap.ui.getCore().getModel("AIWFLOC").getData();var r=sap.ui.getCore().getModel("AIWEQUI").getData();var s=e.getView().getModel("BOMDetailModel").getData();var n=sap.ui.getCore().getModel("tempCrTypeModel").getData();var m={ChangeRequestType:n.crtype,CrDescription:n.desc,IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};if(t.length>0){for(var l=0;l<t.length;l++){var i={Tplnr:t[l].Functionallocation,Txtmi:t[l].Flocdescription,TplkzFlc:t[l].Strucindicator,Tplxt:t[l].StrucIndicatorDesc,EditMask:t[l].EditMask,Hierarchy:t[l].Hierarchy,Fltyp:t[l].Floccategory,Flttx:t[l].FlocCategoryDesc,Swerk:t[l].Maintplant,Plantname:t[l].MaintplantDesc,StorFloc:t[l].Location,Locationdesc:t[l].Locationdesc,Abckzfloc:t[l].Abckz,Abctx:t[l].Abctx,Bukrsfloc:t[l].Bukrs,Butxt:t[l].Butxt,City:t[l].City,KostFloc:t[l].Kostl,KokrFloc:t[l].Kokrs,Contareaname:t[l].Mctxt,PlntFloc:t[l].Werks,Planningplantdes:t[l].Planningplantdes,Ingrp:t[l].Ingrp,Plannergrpdesc:t[l].Innam,Arbplfloc:t[l].Arbpl,Wergwfloc:t[l].WcWerks,Gewrkfloc:t[l].MainArbpl,MainWcPlant:t[l].MainWerks,Tplma:t[l].SupFunctionallocation,Supflocdesc:t[l].SupFlocdescription,BeberFl:t[l].BeberFl,Fing:t[l].Fing,Tele:t[l].Tele,Submtiflo:t[l].ConstrType,Constdesc:t[l].ConstructionDesc,Eqart:t[l].TechnicalObjectTyp,Eartx:t[l].Description,Stattext:t[l].Stattext,StsmFloc:t[l].StsmEqui,Statproftxt:t[l].StsmEquiDesc,UstwFloc:t[l].UstwEqui,UswoFloc:t[l].UswoEqui,UstaFloc:t[l].UstaEqui,Adrnri:t[l].Adrnri,Deact:t[l].Deact};m.FuncLoc.push(i);var o={Funcloc:t[l].Functionallocation,Title:t[l].TitleCode,Name1:t[l].Name1,Name2:t[l].Name2,Name3:t[l].Name3,Name4:t[l].Name4,Sort1:t[l].Sort1,Sort2:t[l].Sort2,NameCo:t[l].NameCo,PostCod1:t[l].PostCod1,City1:t[l].City1,Building:t[l].Building,Floor:t[l].Floor,Roomnum:t[l].Roomnum,Strsuppl1:t[l].Strsuppl1,Strsuppl2:t[l].Strsuppl2,Strsuppl3:t[l].Strsuppl3,Location:t[l].AddrLocation,RPostafl:t[l].RefPosta,Landx:t[l].Landx,TimeZone:t[l].TimeZone,RPostFl:t[l].Region,Regiotxt:t[l].RegionDesc};m.FLAddr.push(o);var u=t[l].intlAddr;if(u.length>0){for(var b=0;b<u.length;b++){m.FLAddrI.push(u[b])}}if(e.AltLblDerv==="2"&&t[l].altlbl.length>0){for(var c=0;c<t[l].altlbl.length;c++){var g={Funcloc:t[l].Functionallocation,AltAlkey:t[l].altlbl[c].AltAlkey,AltStrno:t[l].altlbl[c].AltStrno,AltTplkz:t[l].altlbl[c].AltTplkz};m.FLALTLBEL.push(g)}}if(t[l].Floccategory==="L"){var d={Funcloc:t[l].Functionallocation,Lrpid:t[l].lam.Lrpid,Strtptatr:t[l].lam.Strtptatr,Endptatr:t[l].lam.Endptatr,Length:t[l].lam.Length.toString(),LinUnit:t[l].lam.LinUnit,Startmrkr:t[l].lam.Startmrkr,Endmrkr:t[l].lam.Endmrkr,Mrkdisst:t[l].lam.Mrkdisst,Mrkdisend:t[l].lam.Mrkdisend,MrkrUnit:t[l].lam.MrkrUnit};m.FLLAM.push(d)}var f=t[l].classItems;if(f){if(f.length>0){for(var I=0;I<f.length;I++){var p={Funcloc:t[l].Functionallocation,Classtype:f[I].Classtype,Class:f[I].Class,Clstatus1:f[I].Clstatus1};m.FLClass.push(p)}}}var h=t[l].characteristics;if(h){if(h.length>0){for(var O=0;O<h.length;O++){var M={Funcloc:t[l].Functionallocation,Atnam:h[O].Atnam,Textbez:h[O].Textbez,Atwrt:h[O].Atwrt,Class:h[O].Class};m.FLVal.push(M)}}}}}if(r.length>0){for(var S=0;S<r.length;S++){var B={Herst:r[S].Herst,Equnr:r[S].Equnr,Txtmi:r[S].Eqktx,Swerk:r[S].Maintplant,Name1:r[S].MaintplantDesc,TplnEilo:r[S].Tplnr,Flocdescription:r[S].Pltxt,Eqtyp:r[S].EquipmentCatogory,Etytx:r[S].EquipCatgDescription,Eqart:r[S].TechnicalObjectTyp,Eartx:r[S].Description,Typbz:r[S].Typbz,SubmEeqz:r[S].ConstrType,Constdesc:r[S].ConstructionDesc,BukrEilo:r[S].Bukrs,Butxt:r[S].Butxt,HequEeqz:r[S].SuperordinateEquip,SuperordEqDes:r[S].SuperordinateEquipDesc,TidnEeqz:r[S].TechIdNum,KostEilo:r[S].Kostl,KokrEilo:r[S].Kokrs,Contareaname:r[S].Mctxt,StorEilo:r[S].Location,Locationdesc:r[S].Locationdesc,AbckEilo:r[S].Abckz,Abctx:r[S].Abctx,PplaEeqz:r[S].Werks,Planningplantdes:r[S].Planningplantdes,IngrEeqz:r[S].Ingrp,Plannergrpdesc:r[S].Innam,Serge:r[S].Serge,MapaEeqz:r[S].MapaEeqz,Stattext:r[S].Stattext,StsmEqui:r[S].StsmEqui,Statproftxt:r[S].StsmEquiDesc,UstwEqui:r[S].UstwEqui,UswoEqui:r[S].UswoEqui,UstaEqui:r[S].UstaEqui,Deact:r[S].Deact,Answt:r[S].Answt,Ansdt:e._formatDate(r[S].Ansdt),Waers:r[S].Waers,ArbpEilo:r[S].Arbpl,WorkCenterPlant:r[S].WcWerks,ArbpEeqz:r[S].MainArbpl,MainWcPlant:r[S].MainWerks,BebeEilo:r[S].BeberFl,Fing:r[S].Fing,Tele:r[S].Tele,HeqnEeqz:r[S].EquipPosition,Adrnri:r[S].Adrnri,Funcid:r[S].Funcid,Frcfit:r[S].Frcfit,Frcrmv:r[S].Frcrmv};m.Equipment.push(B);var j={Equi:r[S].Equnr,PlanvPrt:r[S].PlanvPrt,SteufPrt:r[S].SteufPrt,KtschPrt:r[S].KtschPrt,Ewformprt:r[S].Ewformprt,SteufRef:r[S].SteufRef,KtschRef:r[S].KtschRef,EwformRef:r[S].EwformRef};m.EqPRT.push(j);if(r[S].EquipmentCatogory==="L"){var E={Equi:r[S].Equnr,Lrpid:r[S].lam.Lrpid,Strtptatr:r[S].lam.Strtptatr,Endptatr:r[S].lam.Endptatr,Length:r[S].lam.Length.toString(),LinUnit:r[S].lam.LinUnit,Startmrkr:r[S].lam.Startmrkr,Endmrkr:r[S].lam.Endmrkr,Mrkdisst:r[S].lam.Mrkdisst,Mrkdisend:r[S].lam.Mrkdisend,MrkrUnit:r[S].lam.MrkrUnit};m.EqLAM.push(E)}var v={Equi:r[S].Equnr,Title:r[S].TitleCode,Name1:r[S].Name1,Name2:r[S].Name2,Name3:r[S].Name3,Name4:r[S].Name4,Sort1:r[S].Sort1,Sort2:r[S].Sort2,NameCo:r[S].NameCo,PostCod1:r[S].PostCod1,City1:r[S].City1,Building:r[S].Building,Floor:r[S].Floor,Roomnum:r[S].Roomnum,Strsuppl1:r[S].Strsuppl1,Strsuppl2:r[S].Strsuppl2,Strsuppl3:r[S].Strsuppl3,Location:r[S].AddrLocation,RefPosta:r[S].RefPosta,Landx:r[S].Landx,TimeZone:r[S].TimeZone,RfePost:r[S].Region,Regiotxt:r[S].RegionDesc};m.EqAddr.push(v);var D=r[S].intlAddr;if(D.length>0){for(var b=0;b<D.length;b++){m.EqAddrI.push(D[b])}}var C=r[S].classItems;if(C){if(C.length>0){for(var V=0;V<C.length;V++){var w={Equi:r[S].Equnr,Classtype:C[V].Classtype,Class:C[V].Class,Clstatus1:C[V].Clstatus1};m.EqClass.push(w)}}}var x=r[S].characteristics;if(x){if(x.length>0){for(var P=0;P<x.length;P++){var T={Equi:r[S].Equnr,Atnam:x[P].Atnam,Textbez:x[P].Textbez,Atwrt:x[P].Atwrt,Class:x[P].Class};m.EqVal.push(T)}}}}}if(this.sFragmentName.indexOf("MaterialBom")>-1){var k={Matnr:s.Matnr,Stalt:s.Stalt,Stlan:s.Stlan,Werks:s.Werks,Pmbomtech:s.Pmbomtech?s.Pmbomtech:"",PmbomtechTxt:s.PmbomtechTxt?s.PmbomtechTxt:"",Bomstatus:s.Bomstatus,Lngtxt:s.Lngtxt,Txtmi:s.Lngtxt,Validfrom:this._formatDate(s.Validfrom),Baseqty:s.BaseQty,Baseuom:s.BaseUom,Validtoda:this._formatDate(s.Validtoda)};m.MRBHeader.push(k);for(var F=0;F<s.matItem.length;F++){var y={Matnr:s.Matnr,Stlan:s.Stlan,Werks:s.Werks,Bomitmpos:s.matItem[F].Bomitmpos,Itemcat:s.matItem[F].Itemcat,Itemcomp:s.matItem[F].Itemcomp,Compdesc:"",Itmqty:s.matItem[F].Itmqty,Itmuom:s.matItem[F].Itmuom,Recurallo:s.matItem[F].Recurallo,Erskz:s.matItem[F].Erskz,Rvrel:s.matItem[F].Rvrel==="0"?"":s.matItem[F].Rvrel,Sanfe:s.matItem[F].Sanfe,Sanin:s.matItem[F].Sanin,Sanko:s.matItem[F].Sanko,Itmcmpdesc:s.matItem[F].Itmcmpdesc,Costgrelv:s.matItem[F].Costgrelv==="0"?"":s.matItem[F].Costgrelv};if(s.bomType==="Change"){y.Bomitmnod=s.matItem[F].Bomitmnod}if(s.matItem[F].Itemcat==="N"){y.Ekorg=s.matItem[F].Ekorg;y.Ekotx=s.matItem[F].Ekotx;y.Ekgrp=s.matItem[F].Ekgrp;y.Eknam=s.matItem[F].Eknam;y.Preis=s.matItem[F].Preis;y.Waers=s.matItem[F].Waers;y.Peinh=s.matItem[F].Peinh;y.Matkl=s.matItem[F].Matkl;y.Wgbez=s.matItem[F].Wgbez;y.Potx1=s.matItem[F].Potx1}else if(s.matItem[F].Itemcat==="D"){y.Bomdocitm=s.matItem[F].Bomdocitm;y.Bomitmdkr=s.matItem[F].Bomitmdkr;y.BomitmdkrTxt=s.matItem[F].BomitmdkrTxt;y.Bomitmdtl=s.matItem[F].Bomitmdtl;y.Bomitmdvr=s.matItem[F].Bomitmdvr}else if(s.matItem[F].Itemcat==="R"){y.Roms1=s.matItem[F].Roms1;y.Romei=s.matItem[F].Romei;y.Roms2=s.matItem[F].Roms2;y.Roms3=s.matItem[F].Roms3;y.Rform=s.matItem[F].Rform;y.Roanz=s.matItem[F].Roanz;y.Romen=s.matItem[F].Romen;y.Rokme=s.matItem[F].Rokme}else if(s.matItem[F].Itemcat==="T"){y.Potx1=s.matItem[F].Potx1}m.MRBItem.push(y)}for(var W=0;W<s.matSubItem.length;W++){var N={Matnr:s.Matnr,Stlan:s.Stlan,Werks:s.Werks,Posnr:s.matSubItem[W].Posnr,Bomitmnod:s.matSubItem[W].Bomitmnod,Bomsubno:s.matSubItem[W].Bomsubno,Ebort:s.matSubItem[W].Ebort,Upmng:s.matSubItem[W].Upmng,Uptxt:s.matSubItem[W].Uptxt};m.MRBSBIT.push(N)}}else if(this.sFragmentName.indexOf("EquipmentBom")>-1){var q={Eqnrbom:s.Eqnrbom,Stlan:s.Stlan,Werks:s.Werks,Bomstatus:s.Bomstatus,Lngtxt:s.Lngtxt,Txtmi:s.Lngtxt,Validfrom:this._formatDate(s.Validfrom),Baseqty:s.BaseQty,Baseuom:s.BaseUom,Validtoda:this._formatDate(s.Validtoda)};m.EBHeader.push(q);for(var F=0;F<s.eqItem.length;F++){var R={Eqnrbom:s.Eqnrbom,Stlan:s.Stlan,Werks:s.Werks,Bomitmpos:s.eqItem[F].Bomitmpos,Itemcat:s.eqItem[F].Itemcat,Itemcomp:s.eqItem[F].Itemcomp,Compdesc:"",Itmqty:s.eqItem[F].Itmqty,Itmuom:s.eqItem[F].Itmuom,Recurallo:s.eqItem[F].Recurallo,Erskz:s.eqItem[F].Erskz,Rvrel:s.eqItem[F].Rvrel==="0"?"":s.eqItem[F].Rvrel,Sanfe:s.eqItem[F].Sanfe,Sanin:s.eqItem[F].Sanin,Sanko:s.eqItem[F].Sanko,Itmcmpdesc:s.eqItem[F].Itmcmpdesc,Costgrelv:s.eqItem[F].Costgrelv==="0"?"":s.eqItem[F].Costgrelv};if(s.bomType==="Change"){R.Bomitmnod=s.eqItem[F].Bomitmnod}if(s.eqItem[F].Itemcat==="N"){R.Ekorg=s.eqItem[F].Ekorg;R.Ekotx=s.eqItem[F].Ekotx;R.Ekgrp=s.eqItem[F].Ekgrp;R.Eknam=s.eqItem[F].Eknam;R.Preis=s.eqItem[F].Preis;R.Waers=s.eqItem[F].Waers;R.Peinh=s.eqItem[F].Peinh;R.Matkl=s.eqItem[F].Matkl;R.Wgbez=s.eqItem[F].Wgbez;R.Potx1=s.eqItem[F].Potx1}else if(s.eqItem[F].Itemcat==="D"){R.Bomdocitm=s.eqItem[F].Bomdocitm;R.Bomitmdkr=s.eqItem[F].Bomitmdkr;R.BomitmdkrTxt=s.eqItem[F].BomitmdkrTxt;R.Bomitmdtl=s.eqItem[F].Bomitmdtl;R.Bomitmdvr=s.eqItem[F].Bomitmdvr}else if(s.eqItem[F].Itemcat==="R"){R.Roms1=s.eqItem[F].Roms1;R.Romei=s.eqItem[F].Romei;R.Roms2=s.eqItem[F].Roms2;R.Roms3=s.eqItem[F].Roms3;R.Rform=s.eqItem[F].Rform;R.Roanz=s.eqItem[F].Roanz;R.Romen=s.eqItem[F].Romen;R.Rokme=s.eqItem[F].Rokme}else if(s.eqItem[F].Itemcat==="T"){R.Potx1=s.eqItem[F].Potx1}m.EBItem.push(R)}for(var W=0;W<s.eqSubItem.length;W++){var L={Eqnrbom:s.Eqnrbom,Stlan:s.Stlan,Werks:s.Werks,Posnr:s.eqSubItem[W].Posnr,Bomitmnod:s.eqSubItem[W].Bomitmnod,Bomsubno:s.eqSubItem[W].Bomsubno,Ebort:s.eqSubItem[W].Ebort,Upmng:s.eqSubItem[W].Upmng,Uptxt:s.eqSubItem[W].Uptxt};m.EBSBIT.push(L)}}else if(this.sFragmentName.indexOf("FLBom")>-1){var A={Tplnrbom:s.Tplnrbom,Stlan:s.Stlan,Werks:s.Werks,Bomstatus:s.Bomstatus,Lngtxt:s.Lngtxt,Txtmi:s.Lngtxt,Validfrom:this._formatDate(s.Validfrom),Baseqty:s.BaseQty,Baseuom:s.BaseUom,Validtoda:this._formatDate(s.Validtoda)};m.FBHeader.push(A);for(var F=0;F<s.flItem.length;F++){var H={Tplnrbom:s.Tplnrbom,Stlan:s.Stlan,Werks:s.Werks,Bomitmpos:s.flItem[F].Bomitmpos,Itemcat:s.flItem[F].Itemcat,Itemcomp:s.flItem[F].Itemcomp,Compdesc:"",Itmqty:s.flItem[F].Itmqty,Itmuom:s.flItem[F].Itmuom,Recurallo:s.flItem[F].Recurallo,Erskz:s.flItem[F].Erskz,Rvrel:s.flItem[F].Rvrel==="0"?"":s.flItem[F].Rvrel,Sanfe:s.flItem[F].Sanfe,Sanin:s.flItem[F].Sanin,Sanko:s.flItem[F].Sanko,Itmcmpdesc:s.flItem[F].Itmcmpdesc,Costgrelv:s.flItem[F].Costgrelv==="0"?"":s.flItem[F].Costgrelv};if(s.bomType==="Change"){H.Bomitmnod=s.flItem[F].Bomitmnod}if(s.flItem[F].Itemcat==="N"){H.Ekorg=s.flItem[F].Ekorg;H.Ekotx=s.flItem[F].Ekotx;H.Ekgrp=s.flItem[F].Ekgrp;H.Eknam=s.flItem[F].Eknam;H.Preis=s.flItem[F].Preis;H.Waers=s.flItem[F].Waers;H.Peinh=s.flItem[F].Peinh;H.Matkl=s.flItem[F].Matkl;H.Wgbez=s.flItem[F].Wgbez;H.Potx1=s.flItem[F].Potx1}else if(s.flItem[F].Itemcat==="D"){H.Bomdocitm=s.flItem[F].Bomdocitm;H.Bomitmdkr=s.flItem[F].Bomitmdkr;H.BomitmdkrTxt=s.flItem[F].BomitmdkrTxt;H.Bomitmdtl=s.flItem[F].Bomitmdtl;H.Bomitmdvr=s.flItem[F].Bomitmdvr}else if(s.flItem[F].Itemcat==="R"){H.Roms1=s.flItem[F].Roms1;H.Romei=s.flItem[F].Romei;H.Roms2=s.flItem[F].Roms2;H.Roms3=s.flItem[F].Roms3;H.Rform=s.flItem[F].Rform;H.Roanz=s.flItem[F].Roanz;H.Romen=s.flItem[F].Romen;H.Rokme=s.flItem[F].Rokme}else if(s.flItem[F].Itemcat==="T"){H.Potx1=s.flItem[F].Potx1}m.FBItem.push(H)}for(var W=0;W<s.flSubItem.length;W++){var U={Tplnrbom:s.Tplnrbom,Stlan:s.Stlan,Werks:s.Werks,Posnr:s.flSubItem[W].Posnr,Bomitmnod:s.flSubItem[W].Bomitmnod,Bomsubno:s.flSubItem[W].Bomsubno,Ebort:s.flSubItem[W].Ebort,Upmng:s.flSubItem[W].Upmng,Uptxt:s.flSubItem[W].Uptxt};m.FBSBIT.push(U)}}else if(this.sFragmentName.indexOf("WBSBom")>-1){var Q={WbsExt:s.WbsExt,MatnrWbs:s.Matnr,Stlan:s.Stlan,Werks:s.Werks,Bomstatus:s.Bomstatus,Lngtxt:s.Lngtxt,Txtmi:s.Lngtxt,Validfrom:this._formatDate(s.Validfrom),Baseqty:s.BaseQty,Baseuom:s.BaseUom,Validtoda:this._formatDate(s.Validtoda)};m.WBHeader.push(Q);for(var F=0;F<s.wbsItem.length;F++){var z={WbsExt:s.WbsExt,MatnrWbs:s.Matnr,Stlan:s.Stlan,Werks:s.Werks,Bomitmpos:s.wbsItem[F].Bomitmpos,Itemcat:s.wbsItem[F].Itemcat,Itemcomp:s.wbsItem[F].Itemcomp,Compdesc:"",Itmqty:s.wbsItem[F].Itmqty,Itmuom:s.wbsItem[F].Itmuom,Recurallo:s.wbsItem[F].Recurallo,Erskz:s.wbsItem[F].Erskz,Rvrel:s.wbsItem[F].Rvrel==="0"?"":s.wbsItem[F].Rvrel,Sanfe:s.wbsItem[F].Sanfe,Sanin:s.wbsItem[F].Sanin,Sanko:s.wbsItem[F].Sanko,Itmcmpdesc:s.wbsItem[F].Itmcmpdesc,Costgrelv:s.wbsItem[F].Costgrelv==="0"?"":s.wbsItem[F].Costgrelv};if(s.bomType==="Change"){z.Bomitmnod=s.wbsItem[F].Bomitmnod}if(s.wbsItem[F].Itemcat==="N"){z.Ekorg=s.wbsItem[F].Ekorg;z.Ekotx=s.wbsItem[F].Ekotx;z.Ekgrp=s.wbsItem[F].Ekgrp;z.Eknam=s.wbsItem[F].Eknam;z.Preis=s.wbsItem[F].Preis;z.Waers=s.wbsItem[F].Waers;z.Peinh=s.wbsItem[F].Peinh;z.Matkl=s.wbsItem[F].Matkl;z.Wgbez=s.wbsItem[F].Wgbez;z.Potx1=s.wbsItem[F].Potx1}else if(s.wbsItem[F].Itemcat==="D"){z.Bomdocitm=s.wbsItem[F].Bomdocitm;z.Bomitmdkr=s.wbsItem[F].Bomitmdkr;z.BomitmdkrTxt=s.wbsItem[F].BomitmdkrTxt;z.Bomitmdtl=s.wbsItem[F].Bomitmdtl;z.Bomitmdvr=s.wbsItem[F].Bomitmdvr}else if(s.wbsItem[F].Itemcat==="R"){z.Roms1=s.wbsItem[F].Roms1;z.Romei=s.wbsItem[F].Romei;z.Roms2=s.wbsItem[F].Roms2;z.Roms3=s.wbsItem[F].Roms3;z.Rform=s.wbsItem[F].Rform;z.Roanz=s.wbsItem[F].Roanz;z.Romen=s.wbsItem[F].Romen;z.Rokme=s.wbsItem[F].Rokme}else if(s.wbsItem[F].Itemcat==="T"){z.Potx1=s.wbsItem[F].Potx1}m.WBItem.push(z)}for(var W=0;W<s.wbsSubItem.length;W++){var _={WbsExt:s.WbsExt,MatnrWbs:s.Matnr,Stlan:s.Stlan,Werks:s.Werks,Posnr:s.wbsSubItem[W].Posnr,Bomitmnod:s.wbsSubItem[W].Bomitmnod,Bomsubno:s.wbsSubItem[W].Bomsubno,Ebort:s.wbsSubItem[W].Ebort,Upmng:s.wbsSubItem[W].Upmng,Uptxt:s.wbsSubItem[W].Uptxt};m.WBSBIT.push(_)}}this.getView().byId("detailPage").setBusy(true);var J=this.getView().getModel();J.create("/ChangeRequestSet",m,{success:function(t){e.getView().byId("detailPage").setBusy(false);var r=t;var s=[];for(var n=0;n<r.Messages.results.length;n++){s.push({type:a.getMessageType(r.Messages.results[n].Type),title:r.Messages.results[n].Message})}e.createMessagePopover(s,"")},error:function(t){e.getView().byId("detailPage").setBusy(false);var r=[],a=[];if(JSON.parse(t.responseText).error.innererror.errordetails===undefined||JSON.parse(t.responseText).error.innererror.errordetails.length===0){r[0]=JSON.parse(t.responseText).error.message.value}else{for(var s=0;s<JSON.parse(t.responseText).error.innererror.errordetails.length;s++){r[s]=JSON.parse(t.responseText).error.innererror.errordetails[s].message}}var n=r.join("\n");sap.m.MessageBox.show(n,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var r=[];var a,s=this._getMessagePopover();if(typeof e==="string"){r.push({type:t,title:e,message:e})}else if(Array.isArray(e)){r=e;for(var n=0;n<r.length;n++){r[n].message=r[n].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var n=0;n<r.length;n++){a=new i({message:r[n].message,type:r[n].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(a)}s.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(r.length+"")},initializeCategorySpecificFields:function(e){var t=this;var r=this.getView().getModel("itemDetailModel");var a=r.getData();if(a[e].Itemcat==="N"){a[e].Ekorg="";a[e].Ekotx="";a[e].Ekgrp="";a[e].Eknam="";a[e].Preis="";a[e].Waers="";a[e].Peinh="";a[e].Matkl="";a[e].Wgbez="";a[e].Potx1="";a[e].PGrpReq=false;a[e].PrcReq=false;a[e].PrcUnitReq=false;a[e].MatGrpReq=false;a[e].ItmTxt1Req=false}else if(a[e].Itemcat==="D"){a[e].Bomdocitm="";a[e].Bomitmdkr="";a[e].BomitmdkrTxt="";a[e].Bomitmdtl="";a[e].Bomitmdvr="";a[e].DocReq=false}else if(a[e].Itemcat==="R"){a[e].Roms1="";a[e].Romei="";a[e].Roms2="";a[e].Roms3="";a[e].Rform="";a[e].FrmlaKeyDesc="";a[e].Roanz="";a[e].numVarSizeDesc="";a[e].Romen="";a[e].Rokme="";a[e].Size1Req=false;a[e].NumVarSizReq=false}else if(a[e].Itemcat==="T"){a[e].Potx1="";a[e].ItmTxt1Req=false}r.setData(a);r.refresh()},handleMaterialPress:function(e){var t=e.getSource().getId();if(t.indexOf("create")>-1){this.pushToBuffer("Comp","create")}else if(t.indexOf("addMaterial")>-1){this.pushToBuffer("Comp","change")}},pushToBuffer:function(e,r,a){var s=this;var n=s.getView().getModel("BOMDetailModel").getData();var m=sap.ui.getCore().getModel("AIWFLOC").getData();var l=$.map(m,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(l),"AIWFLOCBackup");var i=sap.ui.getCore().getModel("AIWEQUI").getData();var o=$.map(i,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(o),"AIWEQUIBackup");var u=sap.ui.getCore().getModel("AIWMSPT").getData();var b=$.map(u,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(b),"AIWMSPTBackup");var c=sap.ui.getCore().getModel("AIWMPMI").getData();var g=$.map(c,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(g),"AIWMPMIBackup");var d=sap.ui.getCore().getModel("AIWListMatModel").getData();var f=$.map(d,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(f),"AIWListMatModelBackup");var I=sap.ui.getCore().getModel("AIWListEqModel").getData();var p=$.map(I,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(p),"AIWListEqModelBackup");var h=sap.ui.getCore().getModel("AIWListFLModel").getData();var O=$.map(h,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(O),"AIWListFLModelBackup");var M=sap.ui.getCore().getModel("AIWListWBSModel").getData();var S=$.map(M,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(S),"AIWListWBSModelBackup");var B=sap.ui.getCore().getModel("AIWListONModel").getData();var j=$.map(B,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(j),"AIWListONModelBackup");var E=sap.ui.getCore().getModel("AIWListWCModel").getData();var v=$.map(E,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(v),"AIWListWCModelBackup");var D=sap.ui.getCore().getModel("AIWListGTLModel").getData();var C=$.map(D,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(C),"AIWListGTLModelBackup");var V=sap.ui.getCore().getModel("AIWListETLModel").getData();var w=$.map(D,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(w),"AIWListETLModelBackup");var x=sap.ui.getCore().getModel("AIWListFTLModel").getData();var P=$.map(x,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(P),"AIWListFTLModelBackup");var T=sap.ui.getCore().getModel("AIWListOLModel").getData();var k=$.map(x,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(k),"AIWListOLModelBackup");var F=[];F.push(sap.ui.getCore().getModel("dataOriginMOP").getData());var y=$.map(F,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(y),"dataOriginMOPBackup");var W=[];W.push(sap.ui.getCore().getModel("EnableModel").getData());var N=$.map(W,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(N),"EnableModelBackup");var q=[];q.push(sap.ui.getCore().getModel("AIWModel").getData());var R=$.map(q,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(R),"AIWModelBackup");var L=sap.ui.getCore().getModel("ainMOP").getData();var A=$.map(L,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(A),"ainMOPBackup");var H=[sap.ui.getCore().getModel("tempCrTypeModel").getData()];var U=$.map(H,function(e){return $.extend(true,{},e)});sap.ui.getCore().setModel(new t(U),"tempCrTypeModelBackup");var n=s.getView().getModel("BOMDetailModel").getData();var Q=sap.ui.getCore().getModel("tempCrTypeModel").getData();var z={ChangeRequestType:Q.crtype,CrDescription:Q.desc,MbomBuffer:true,IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};if(this.sFragmentName==="CreateMaterialBom"||this.sFragmentName==="changeMbom"){var _={Matnr:n.Matnr,Stalt:n.Stalt,Stlan:n.Stlan,Werks:n.Werks,Pmbomtech:n.Pmbomtech?n.Pmbomtech:"",PmbomtechTxt:n.PmbomtechTxt?n.PmbomtechTxt:"",Bomstatus:n.Bomstatus,Lngtxt:n.Lngtxt,Stktx:n.Stktx,Txtmi:n.Lngtxt,Validfrom:n.Validfrom!==""?this._formatDate(n.Validfrom):"2020-08-10T00:00:00",Baseqty:n.BaseQty!==""?n.BaseQty:"0",Baseuom:n.BaseUom,Validtoda:n.Validtoda!==""?this._formatDate(n.Validtoda):"9999-12-31T00:00:00",Maktx:n.MatDesc,Plantname:n.WerksDesc,Bomusagetxt:n.StlanDesc,BomstatusText:n.Bomstatustxt};z.MRBHeader.push(_);for(var J=0;J<n.matItem.length;J++){var X={Matnr:n.Matnr,Stlan:n.Stlan,Werks:n.Werks,Bomitmpos:n.matItem[J].Bomitmpos,Itemcat:n.matItem[J].Itemcat,Itemcomp:n.matItem[J].Itemcomp,Compdesc:"",Itmqty:n.matItem[J].Itmqty,Itmuom:n.matItem[J].Itmuom,Recurallo:n.matItem[J].Recurallo,Erskz:n.matItem[J].Erskz,Rvrel:n.matItem[J].Rvrel==="0"?"":n.matItem[J].Rvrel,Sanfe:n.matItem[J].Sanfe,Sanin:n.matItem[J].Sanin,Sanko:n.matItem[J].Sanko,Itmcmpdesc:n.matItem[J].Itmcmpdesc,Costgrelv:n.matItem[J].Costgrelv==="0"?"":n.matItem[J].Costgrelv,Itmassind:n.matItem[J].Itmassind,IsNavPossible:n.matItem[J].IsNavPossible};if(n.bomType==="Change"){X.Bomitmnod=n.matItem[J].Bomitmnod}if(n.matItem[J].Itemcat==="N"){X.Ekorg=n.matItem[J].Ekorg;X.Ekotx=n.matItem[J].Ekotx;X.Ekgrp=n.matItem[J].Ekgrp;X.Eknam=n.matItem[J].Eknam;X.Preis=n.matItem[J].Preis;X.Waers=n.matItem[J].Waers;X.Peinh=n.matItem[J].Peinh;X.Matkl=n.matItem[J].Matkl;X.Wgbez=n.matItem[J].Wgbez;X.Potx1=n.matItem[J].Potx1}else if(n.matItem[J].Itemcat==="D"){X.Bomdocitm=n.matItem[J].Bomdocitm;X.Bomitmdkr=n.matItem[J].Bomitmdkr;X.BomitmdkrTxt=n.matItem[J].BomitmdkrTxt;X.Bomitmdtl=n.matItem[J].Bomitmdtl;X.Bomitmdvr=n.matItem[J].Bomitmdvr}else if(n.matItem[J].Itemcat==="R"){X.Roms1=n.matItem[J].Roms1;X.Romei=n.matItem[J].Romei;X.Roms2=n.matItem[J].Roms2;X.Roms3=n.matItem[J].Roms3;X.Rform=n.matItem[J].Rform;X.Roanz=n.matItem[J].Roanz;X.Romen=n.matItem[J].Romen;X.Rokme=n.matItem[J].Rokme}else if(n.matItem[J].Itemcat==="T"){X.Potx1=n.matItem[J].Potx1}z.MRBItem.push(X)}for(var G=0;G<n.matSubItem.length;G++){var K={Matnr:n.Matnr,Stlan:n.Stlan,Werks:n.Werks,Posnr:n.matSubItem[G].Posnr,Bomitmnod:n.matSubItem[G].Bomitmnod,Bomsubno:n.matSubItem[G].Bomsubno,Ebort:n.matSubItem[G].Ebort,Upmng:n.matSubItem[G].Upmng,Uptxt:n.matSubItem[G].Uptxt};z.MRBSBIT.push(K)}}else if(this.sFragmentName==="CreateEquipmentBom"||this.sFragmentName==="changeEbom"){var Z={Eqnrbom:n.Eqnrbom,Stlan:n.Stlan,Werks:n.Werks,Bomstatus:n.Bomstatus,Lngtxt:n.Lngtxt,Txtmi:n.Lngtxt,Validfrom:this._formatDate(n.Validfrom),Baseqty:n.BaseQty,Baseuom:n.BaseUom,Validtoda:this._formatDate(n.Validtoda),Eqktx:n.EquiDesc,Plantname:n.WerksDesc,Bomusagetxt:n.StlanDesc,BomstatusText:n.Bomstatustxt};z.EBHeader.push(Z);for(var J=0;J<n.eqItem.length;J++){var Y={Eqnrbom:n.Eqnrbom,Stlan:n.Stlan,Werks:n.Werks,Bomitmpos:n.eqItem[J].Bomitmpos,Itemcat:n.eqItem[J].Itemcat,Itemcomp:n.eqItem[J].Itemcomp,Compdesc:"",Itmqty:n.eqItem[J].Itmqty,Itmuom:n.eqItem[J].Itmuom,Recurallo:n.eqItem[J].Recurallo,Erskz:n.eqItem[J].Erskz,Rvrel:n.eqItem[J].Rvrel==="0"?"":n.eqItem[J].Rvrel,Sanfe:n.eqItem[J].Sanfe,Sanin:n.eqItem[J].Sanin,Sanko:n.eqItem[J].Sanko,Itmcmpdesc:n.eqItem[J].Itmcmpdesc,Costgrelv:n.eqItem[J].Costgrelv==="0"?"":n.eqItem[J].Costgrelv,Itmassind:n.eqItem[J].Itmassind,IsNavPossible:n.eqItem[J].IsNavPossible};if(n.bomType==="Change"){Y.Bomitmnod=n.eqItem[J].Bomitmnod}if(n.eqItem[J].Itemcat==="N"){Y.Ekorg=n.eqItem[J].Ekorg;Y.Ekotx=n.eqItem[J].Ekotx;Y.Ekgrp=n.eqItem[J].Ekgrp;Y.Eknam=n.eqItem[J].Eknam;Y.Preis=n.eqItem[J].Preis;Y.Waers=n.eqItem[J].Waers;Y.Peinh=n.eqItem[J].Peinh;Y.Matkl=n.eqItem[J].Matkl;Y.Wgbez=n.eqItem[J].Wgbez;Y.Potx1=n.eqItem[J].Potx1}else if(n.eqItem[J].Itemcat==="D"){Y.Bomdocitm=n.eqItem[J].Bomdocitm;Y.Bomitmdkr=n.eqItem[J].Bomitmdkr;Y.BomitmdkrTxt=n.eqItem[J].BomitmdkrTxt;Y.Bomitmdtl=n.eqItem[J].Bomitmdtl;Y.Bomitmdvr=n.eqItem[J].Bomitmdvr}else if(n.eqItem[J].Itemcat==="R"){Y.Roms1=n.eqItem[J].Roms1;Y.Romei=n.eqItem[J].Romei;Y.Roms2=n.eqItem[J].Roms2;Y.Roms3=n.eqItem[J].Roms3;Y.Rform=n.eqItem[J].Rform;Y.Roanz=n.eqItem[J].Roanz;Y.Romen=n.eqItem[J].Romen;Y.Rokme=n.eqItem[J].Rokme}else if(n.eqItem[J].Itemcat==="T"){Y.Potx1=n.eqItem[J].Potx1}z.EBItem.push(Y)}for(var G=0;G<n.eqSubItem.length;G++){var ee={Eqnrbom:n.Eqnrbom,Stlan:n.Stlan,Werks:n.Werks,Posnr:n.eqSubItem[G].Posnr,Bomitmnod:n.eqSubItem[G].Bomitmnod,Bomsubno:n.eqSubItem[G].Bomsubno,Ebort:n.eqSubItem[G].Ebort,Upmng:n.eqSubItem[G].Upmng,Uptxt:n.eqSubItem[G].Uptxt};z.EBSBIT.push(ee)}}else if(this.sFragmentName==="CreateFLBom"||this.sFragmentName==="changeFlbom"){var te={Tplnrbom:n.Tplnrbom,Stlan:n.Stlan,Werks:n.Werks,Bomstatus:n.Bomstatus,Lngtxt:n.Lngtxt,Txtmi:n.Lngtxt,Validfrom:this._formatDate(n.Validfrom),Baseqty:n.BaseQty,Baseuom:n.BaseUom,Validtoda:this._formatDate(n.Validtoda),Pltxt:n.FLDesc,Plantname:n.WerksDesc,Bomusagetxt:n.StlanDesc,BomstatusText:n.Bomstatustxt};z.FBHeader.push(te);for(var J=0;J<n.flItem.length;J++){var re={Tplnrbom:n.Tplnrbom,Stlan:n.Stlan,Werks:n.Werks,Bomitmpos:n.flItem[J].Bomitmpos,Itemcat:n.flItem[J].Itemcat,Itemcomp:n.flItem[J].Itemcomp,Compdesc:"",Itmqty:n.flItem[J].Itmqty,Itmuom:n.flItem[J].Itmuom,Recurallo:n.flItem[J].Recurallo,Erskz:n.flItem[J].Erskz,Rvrel:n.flItem[J].Rvrel==="0"?"":n.flItem[J].Rvrel,Sanfe:n.flItem[J].Sanfe,Sanin:n.flItem[J].Sanin,Sanko:n.flItem[J].Sanko,Itmcmpdesc:n.flItem[J].Itmcmpdesc,Costgrelv:n.flItem[J].Costgrelv==="0"?"":n.flItem[J].Costgrelv,Itmassind:n.flItem[J].Itmassind,IsNavPossible:n.flItem[J].IsNavPossible};if(n.bomType==="Change"){re.Bomitmnod=n.flItem[J].Bomitmnod}if(n.flItem[J].Itemcat==="N"){re.Ekorg=n.flItem[J].Ekorg;re.Ekotx=n.flItem[J].Ekotx;re.Ekgrp=n.flItem[J].Ekgrp;re.Eknam=n.flItem[J].Eknam;re.Preis=n.flItem[J].Preis;re.Waers=n.flItem[J].Waers;re.Peinh=n.flItem[J].Peinh;re.Matkl=n.flItem[J].Matkl;re.Wgbez=n.flItem[J].Wgbez;re.Potx1=n.flItem[J].Potx1}else if(n.flItem[J].Itemcat==="D"){re.Bomdocitm=n.flItem[J].Bomdocitm;re.Bomitmdkr=n.flItem[J].Bomitmdkr;re.BomitmdkrTxt=n.flItem[J].BomitmdkrTxt;re.Bomitmdtl=n.flItem[J].Bomitmdtl;re.Bomitmdvr=n.flItem[J].Bomitmdvr}else if(n.flItem[J].Itemcat==="R"){re.Roms1=n.flItem[J].Roms1;re.Romei=n.flItem[J].Romei;re.Roms2=n.flItem[J].Roms2;re.Roms3=n.flItem[J].Roms3;re.Rform=n.flItem[J].Rform;re.Roanz=n.flItem[J].Roanz;re.Romen=n.flItem[J].Romen;re.Rokme=n.flItem[J].Rokme}else if(n.flItem[J].Itemcat==="T"){re.Potx1=n.flItem[J].Potx1}z.FBItem.push(re)}for(var G=0;G<n.flSubItem.length;G++){var ae={Tplnrbom:n.Tplnrbom,Stlan:n.Stlan,Werks:n.Werks,Posnr:n.flSubItem[G].Posnr,Bomitmnod:n.flSubItem[G].Bomitmnod,Bomsubno:n.flSubItem[G].Bomsubno,Ebort:n.flSubItem[G].Ebort,Upmng:n.flSubItem[G].Upmng,Uptxt:n.flSubItem[G].Uptxt};z.FBSBIT.push(ae)}}else if(this.sFragmentName==="CreateWBSBom"||this.sFragmentName==="changeWbsbom"){var se={WbsExt:n.WbsExt,MatnrWbs:n.Matnr,Stlan:n.Stlan,Werks:n.Werks,Bomstatus:n.Bomstatus,Lngtxt:n.Lngtxt,Txtmi:n.Lngtxt,Validfrom:this._formatDate(n.Validfrom),Baseqty:n.BaseQty,Baseuom:n.BaseUom,Validtoda:this._formatDate(n.Validtoda),Post1:n.WbsDesc,Maktx:n.MatDesc,Plantname:n.WerksDesc,Bomusagetxt:n.StlanDesc,BomstatusText:n.Bomstatustxt};z.WBHeader.push(se);for(var J=0;J<n.wbsItem.length;J++){var ne={WbsExt:n.WbsExt,MatnrWbs:n.Matnr,Stlan:n.Stlan,Werks:n.Werks,Bomitmpos:n.wbsItem[J].Bomitmpos,Itemcat:n.wbsItem[J].Itemcat,Itemcomp:n.wbsItem[J].Itemcomp,Compdesc:"",Itmqty:n.wbsItem[J].Itmqty,Itmuom:n.wbsItem[J].Itmuom,Recurallo:n.wbsItem[J].Recurallo,Erskz:n.wbsItem[J].Erskz,Rvrel:n.wbsItem[J].Rvrel==="0"?"":n.wbsItem[J].Rvrel,Sanfe:n.wbsItem[J].Sanfe,Sanin:n.wbsItem[J].Sanin,Sanko:n.wbsItem[J].Sanko,Itmcmpdesc:n.wbsItem[J].Itmcmpdesc,Costgrelv:n.wbsItem[J].Costgrelv==="0"?"":n.wbsItem[J].Costgrelv,Itmassind:n.wbsItem[J].Itmassind,IsNavPossible:n.wbsItem[J].IsNavPossible};if(n.bomType==="Change"){ne.Bomitmnod=n.wbsItem[J].Bomitmnod}if(n.wbsItem[J].Itemcat==="N"){ne.Ekorg=n.wbsItem[J].Ekorg;ne.Ekotx=n.wbsItem[J].Ekotx;ne.Ekgrp=n.wbsItem[J].Ekgrp;ne.Eknam=n.wbsItem[J].Eknam;ne.Preis=n.wbsItem[J].Preis;ne.Waers=n.wbsItem[J].Waers;ne.Peinh=n.wbsItem[J].Peinh;ne.Matkl=n.wbsItem[J].Matkl;ne.Wgbez=n.wbsItem[J].Wgbez;ne.Potx1=n.wbsItem[J].Potx1}else if(n.wbsItem[J].Itemcat==="D"){ne.Bomdocitm=n.wbsItem[J].Bomdocitm;ne.Bomitmdkr=n.wbsItem[J].Bomitmdkr;ne.BomitmdkrTxt=n.wbsItem[J].BomitmdkrTxt;ne.Bomitmdtl=n.wbsItem[J].Bomitmdtl;ne.Bomitmdvr=n.wbsItem[J].Bomitmdvr}else if(n.wbsItem[J].Itemcat==="R"){ne.Roms1=n.wbsItem[J].Roms1;ne.Romei=n.wbsItem[J].Romei;ne.Roms2=n.wbsItem[J].Roms2;ne.Roms3=n.wbsItem[J].Roms3;ne.Rform=n.wbsItem[J].Rform;ne.Roanz=n.wbsItem[J].Roanz;ne.Romen=n.wbsItem[J].Romen;ne.Rokme=n.wbsItem[J].Rokme}else if(n.wbsItem[J].Itemcat==="T"){ne.Potx1=n.wbsItem[J].Potx1}z.WBItem.push(ne)}for(var G=0;G<n.wbsSubItem.length;G++){var me={WbsExt:n.WbsExt,MatnrWbs:n.Matnr,Stlan:n.Stlan,Werks:n.Werks,Posnr:n.wbsSubItem[G].Posnr,Bomitmnod:n.wbsSubItem[G].Bomitmnod,Bomsubno:n.wbsSubItem[G].Bomsubno,Ebort:n.wbsSubItem[G].Ebort,Upmng:n.wbsSubItem[G].Upmng,Uptxt:n.wbsSubItem[G].Uptxt};z.WBSBIT.push(me)}}if(!this.uid){this.uid=s.generateUUID()}var le="component";if(e==="Hdr"){le="header"}else if(r==="View"){le="link"}else if(r==="change"){le="add"}this.getView().byId("detailPage").setBusy(true);var ie=this.getView().getModel();ie.create("/ChangeRequestSet",z,{success:function(t){if(e==="Assembly"){var m=n.Stalt?n.Stalt:"1";s._crossAppNavigation("MatBillOfMaterial","changeMROBOM",{IT_CAT:"L",OBJ:"M",m:a,plant:n.Werks!==""?n.Werks:"null",usage:n.Stlan,altBom:m,status:n.Bomstatus,p:s.itemPath+"-"+s.sFragmentName,uid:s.uid,assInd:"false",caller:"AIW"});sap.ui.getCore().setModel(false,"BOMCHNavModel")}else if(e==="Hdr"||e==="Comp"){if(r==="create"){s._crossAppNavigation("UtopiaMaterial","create",{OBJ:"MARA",plant:n.Werks!==""?n.Werks:"null",id:s.uid,mode:"AIWcreate",case:le,m:n.Matnr,usage:n.Stlan,status:n.Bomstatus,altBom:n.Stalt,p:s.itemPath+"-"+s.sFragmentName,assInd:""});sap.ui.getCore().setModel(false,"MatNavModel")}else if(r==="change"){s._crossAppNavigation("UtopiaMaterial","change",{OBJ:"MARA",plant:n.Werks!==""?n.Werks:"null",id:s.uid,mode:"AIWcreate",case:le,m:n.Matnr,usage:n.Stlan,status:n.Bomstatus,altBom:n.Stalt,p:s.itemPath+"-"+s.sFragmentName,assInd:""});sap.ui.getCore().setModel(false,"MatNavModel")}else if(r==="View"){s._crossAppNavigation("UtopiaMaterial","change",{OBJ:"MARA",mode:"AIWcreate",case:le,assInd:"",status:n.Bomstatus,id:s.uid,mat:a,p:s.itemPath+"-"+s.sFragmentName});sap.ui.getCore().setModel(false,"MatNavModel")}}},error:function(e){s.getView().byId("detailPage").setBusy(false);var t=[],r=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var a=0;a<JSON.parse(e.responseText).error.innererror.errordetails.length;a++){t[a]=JSON.parse(e.responseText).error.innererror.errordetails[a].message}}var n=t.join("\n");sap.m.MessageBox.show(n,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},_crossAppNavigation:function(e,t,r){if(sap.ushell){var a=sap.ushell.Container.getService("CrossApplicationNavigation");a.toExternal({target:{semanticObject:e,action:t},params:r})}},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e=="x"?t:t&3|8;return r.toString(16)})},handleAssemblyIndPress:function(e){var t=this;var r=e.getSource().getBindingContext("itemDetailModel").sPath;var a=parseInt(r.substr(1),10);var s=this.getView().getModel("itemDetailModel");var n=s.getData();var m=this.getView().getModel("BOMDetailModel");var l=m.getData();var i=n[a].Itemcomp;var o=l.Stlan;var u=l.Werks;var b=l.Stalt;var c=false;var g=sap.ui.getCore().getModel("AIWListMatModel").getData();for(var d in g){if(g[d].Matnr===i&&g[d].Werks===u&&g[d].Stlan===o&&g[d].Stalt===b){c=true;break}}if(c){var f="BOM exists in same CR";t.createMessagePopover(f,"Information")}else{this.pushToBuffer("Assembly","",i)}},readfrombufferBom:function(e){var r=this;var a=this.getView().getModel();var s="/ChangeRequestSet";var n;var m;var l=new t;var i=new t;n=[new sap.ui.model.Filter("MbomBuffer","EQ",true)];m=["MRBHeader","MRBItem","MRBSBIT"];this.getView().byId("detailPage").setBusy(true);a.read(s,{filters:n,urlParameters:{$expand:m},success:function(t){r.getView().byId("detailPage").setBusy(false);var a=false;if(r.sFragmentName==="CreateMaterialBom"||r.sFragmentName==="changeMbom"){var s=t.results[0].MRBHeader.results[0];var n=t.results[0].MRBItem.results;var m=t.results[0].MRBSBIT.results;r.currentObj={Matnr:s.Matnr,Werks:s.Werks,Stlan:s.Stlan,Stalt:s.Stalt,Pmbomtech:s.Pmbomtech,PmbomtechTxt:s.PmbomtechTxt,Bomstatus:s.Bomstatus,Lngtxt:s.Txtmi,Stktx:s.Stktx,Validfrom:r.getDateFormat(s.Validfrom),BaseQty:s.Baseqty,BaseUom:s.Baseuom,Validtoda:r.getDateFormat(s.Validtoda),MatDesc:s.Maktx,WerksDesc:s.Plantname,StlanDesc:s.Bomusagetxt,BomstatusText:s.Bomstatustxt,matEnable:false,plantEnable:false,usageEnable:false,altbomEnable:false,crtMatHdrBtnEnable:false,fromDateEnable:true,addItemEnable:true,modeFlag:"Delete",matValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",altbomValueState:"None",matItem:[],matSubItem:[]};if(n&&n.length>0){r.currentObj.matItem=n;for(var o=0;o<r.currentObj.matItem.length;o++){r.currentObj.matItem[o].itmCatState="None";r.currentObj.matItem[o].itmCompState="None";r.currentObj.matItem[o].itmQtyState="None";r.currentObj.matItem[o].itmUOMState="None";r.currentObj.matItem[o].itmCatEnable=false;r.currentObj.matItem[o].itmQtyEnable=true;if(r.currentObj.matItem[o].Itemcat==="D"||r.currentObj.matItem[o].Itemcat==="T"){r.currentObj.matItem[o].reccrAllowEnable=false}}r.sLastItemNum=n.length}else r.currentObj.matItem=[];if(m&&m.length>0)r.currentObj.matSubItem=m;else r.currentObj.matSubItem=[];r.currentObj.crtMatEnable=true;if(r.sFragmentName==="changeMbom"){r.currentObj.fromDateEnable=false;r.currentObj.bomType="Change";if(a==="true"){r.getView().byId("idBtnCheck").setEnabled(false);r.currentObj.altbomEnable=false;r.currentObj.BomstatusEnable=false;r.currentObj.BaseQtyEnable=false;r.currentObj.LngtxtEnable=false;r.currentObj.fromDateEnable=false;r.currentObj.addItemEnable=false;r.currentObj.crtMatEnable=false;r.currentObj.modeFlag="None";for(var o=0;o<r.currentObj.matItem.length;o++){r.currentObj.matItem[o].itmQtyEnable=false;r.currentObj.matItem[o].itmCompEnable=false;r.currentObj.matItem[o].itmUomEnable=false;r.currentObj.matItem[o].reccrAllowEnable=false;r.currentObj.matItem[o].Pmper="-";r.currentObj.matItem[o].Pmper="-";r.currentObj.matItem[o].Pmpka="-";r.currentObj.matItem[o].Pmprv="-";r.currentObj.matItem[o].Pmpfe="-";r.currentObj.matItem[o].Pmpin="-";r.currentObj.matItem[o].Pmpko="-"}for(var o=0;o<r.currentObj.matSubItem.length;o++){r.currentObj.matSubItem[o].intPointEnable=false;r.currentObj.matSubItem[o].subQtyEnable=false;r.currentObj.matSubItem[o].subTextEnable=false}}}if(r.case==="header"){r.currentObj.matEnable=true;r.currentObj.plantEnable=true;r.currentObj.usageEnable=true;r.currentObj.altbomEnable=true}l.setData(r.currentObj);i.setData(r.currentObj.matItem)}if(r.sFragmentName==="CreateEquipmentBom"||r.sFragmentName==="changeEbom"){var s=t.results[0].EBHeader.results[0];var n=t.results[0].EBItem.results;var m=t.results[0].EBSBIT.results;r.currentObj={Eqnrbom:s.Eqnrbom,Werks:s.Werks,Stlan:s.Stlan,Bomstatus:s.Bomstatus,Lngtxt:s.Txtmi,Validfrom:r.getDateFormat(s.Validfrom),BaseQty:s.Baseqty,BaseUom:s.Baseuom,Validtoda:r.getDateFormat(s.Validtoda),EquiDesc:s.Eqktx,WerksDesc:s.Plantname,StlanDesc:s.Bomusagetxt,BomstatusText:s.Bomstatustxt,equipEnable:false,plantEnable:false,usageEnable:false,fromDateEnable:true,addItemEnable:true,modeFlag:"Delete",equipValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",eqItem:[],eqSubItem:[]};if(n&&n.length>0){r.currentObj.eqItem=n;for(var o=0;o<r.currentObj.eqItem.length;o++){r.currentObj.eqItem[o].itmCatState="None";r.currentObj.eqItem[o].itmCompState="None";r.currentObj.eqItem[o].itmQtyState="None";r.currentObj.eqItem[o].itmUOMState="None";r.currentObj.eqItem[o].itmCatEnable=false;r.currentObj.eqItem[o].itmQtyEnable=true}r.sLastItemNum=n.length}else r.currentObj.eqItem=[];if(m&&m.length>0){r.currentObj.eqSubItem=m}else r.currentObj.eqSubItem=[];r.currentObj.crtMatEnable=false;if(r.sFragmentName==="changeEbom"){r.currentObj.fromDateEnable=false;r.currentObj.bomType="Change";if(a==="true"){r.getView().byId("idBtnCheck").setEnabled(false);r.currentObj.BomstatusEnable=false;r.currentObj.BaseQtyEnable=false;r.currentObj.LngtxtEnable=false;r.currentObj.fromDateEnable=false;r.currentObj.addItemEnable=false;r.currentObj.modeFlag="None";for(var o=0;o<r.currentObj.eqItem.length;o++){r.currentObj.eqItem[o].itmQtyEnable=false;r.currentObj.eqItem[o].itmCompEnable=false;r.currentObj.eqItem[o].itmUomEnable=false;r.currentObj.eqItem[o].addSubItmEnable=false;r.currentObj.eqItem[o].Pmper="-";r.currentObj.eqItem[o].Pmpka="-";r.currentObj.eqItem[o].Pmprv="-";r.currentObj.eqItem[o].Pmpfe="-";r.currentObj.eqItem[o].Pmpin="-";r.currentObj.eqItem[o].Pmpko="-"}for(var o=0;o<r.currentObj.eqSubItem.length;o++){r.currentObj.eqSubItem[o].intPointEnable=false;r.currentObj.eqSubItem[o].subQtyEnable=false;r.currentObj.eqSubItem[o].subTextEnable=false}}}l.setData(r.currentObj);i.setData(r.currentObj.eqItem)}if(r.sFragmentName==="CreateFLBom"||r.sFragmentName==="changeFlbom"){var s=t.results[0].FBHeader.results[0];var n=t.results[0].FBItem.results;var m=t.results[0].FBSBIT.results;r.currentObj={Tplnrbom:s.Tplnrbom,Werks:s.Werks,Stlan:s.Stlan,Bomstatus:s.Bomstatus,Lngtxt:s.Txtmi,Validfrom:r.getDateFormat(s.Validfrom),BaseQty:s.Baseqty,BaseUom:s.Baseuom,Validtoda:r.getDateFormat(s.Validtoda),FLDesc:s.Pltxt,WerksDesc:s.Plantname,StlanDesc:s.Bomusagetxt,BomstatusText:s.Bomstatustxt,FLEnable:false,plantEnable:false,usageEnable:false,fromDateEnable:true,addItemEnable:true,modeFlag:"Delete",FLValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",flItem:[],flSubItem:[]};if(n&&n.length>0){r.currentObj.flItem=n;for(var o=0;o<r.currentObj.flItem.length;o++){r.currentObj.flItem[o].itmCatState="None";r.currentObj.flItem[o].itmCompState="None";r.currentObj.flItem[o].itmQtyState="None";r.currentObj.flItem[o].itmUOMState="None";r.currentObj.flItem[o].itmCatEnable=false;r.currentObj.flItem[o].itmQtyEnable=true}r.sLastItemNum=n.length}else r.currentObj.flItem=[];if(m&&m.length>0)r.currentObj.flSubItem=m;else r.currentObj.flSubItem=[];r.currentObj.crtMatEnable=false;if(r.sFragmentName==="changeFlbom"){r.currentObj.fromDateEnable=false;r.currentObj.bomType="Change";if(a==="true"){r.getView().byId("idBtnCheck").setEnabled(false);r.currentObj.BomstatusEnable=false;r.currentObj.BaseQtyEnable=false;r.currentObj.LngtxtEnable=false;r.currentObj.fromDateEnable=false;r.currentObj.addItemEnable=false;r.currentObj.modeFlag="None";for(var o=0;o<r.currentObj.flItem.length;o++){r.currentObj.flItem[o].itmQtyEnable=false;r.currentObj.flItem[o].itmCompEnable=false;r.currentObj.flItem[o].itmUomEnable=false;r.currentObj.flItem[o].addSubItmEnable=false;r.currentObj.flItem[o].Pmper="-";r.currentObj.flItem[o].Pmpka="-";r.currentObj.flItem[o].Pmprv="-";r.currentObj.flItem[o].Pmpfe="-";r.currentObj.flItem[o].Pmpin="-";r.currentObj.flItem[o].Pmpko="-"}for(var o=0;o<r.currentObj.flSubItem.length;o++){r.currentObj.flSubItem[o].intPointEnable=false;r.currentObj.flSubItem[o].subQtyEnable=false;r.currentObj.flSubItem[o].subTextEnable=false}}}l.setData(r.currentObj);i.setData(r.currentObj.flItem)}if(r.sFragmentName==="CreateWBSBom"||r.sFragmentName==="changeWbsbom"){var s=t.results[0].WBHeader.results[0];var n=t.results[0].WBItem.results;var m=t.results[0].WBSBIT.results;r.currentObj={WbsExt:s.WbsExt,Matnr:s.MatnrWbs,Werks:s.Werks,Stlan:s.Stlan,Bomstatus:s.Bomstatus,Lngtxt:s.Txtmi,Validfrom:r.getDateFormat(s.Validfrom),BaseQty:s.Baseqty,BaseUom:s.Baseuom,Validtoda:r.getDateFormat(s.Validtoda),WbsDesc:s.Post1,MatDesc:s.Maktx,WerksDesc:s.Plantname,StlanDesc:s.Bomusagetxt,BomstatusText:s.Bomstatustxt,wbsEnable:false,matEnable:false,plantEnable:false,usageEnable:false,fromDateEnable:true,addItemEnable:true,modeFlag:"Delete",wbsValueState:"None",matValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",wbsItem:[],wbsSubItem:[]};if(n&&n.length>0){r.currentObj.wbsItem=n;for(var o=0;o<r.currentObj.wbsItem.length;o++){r.currentObj.wbsItem[o].itmCatState="None";r.currentObj.wbsItem[o].itmCompState="None";r.currentObj.wbsItem[o].itmQtyState="None";r.currentObj.wbsItem[o].itmUOMState="None";r.currentObj.wbsItem[o].itmCatEnable=false;r.currentObj.wbsItem[o].itmQtyEnable=true;r.currentObj.wbsItem[o].Matnr=r.currentObj.wbsItem[o].MatnrWbs;if(r.currentObj.wbsItem[o].Itemcat==="D"||r.currentObj.wbsItem[o].Itemcat==="T"){r.currentObj.wbsItem[o].reccrAllowEnable=false}}r.sLastItemNum=n.length}else r.currentObj.wbsItem=[];if(m&&m.length>0)r.currentObj.wbsSubItem=m;else r.currentObj.wbsSubItem=[];r.currentObj.crtMatEnable=false;if(r.sFragmentName==="changeWbsbom"){r.currentObj.fromDateEnable=false;r.currentObj.bomType="Change";if(a==="true"){r.getView().byId("idBtnCheck").setEnabled(false);r.currentObj.BomstatusEnable=false;r.currentObj.BaseQtyEnable=false;r.currentObj.LngtxtEnable=false;r.currentObj.fromDateEnable=false;r.currentObj.addItemEnable=false;r.currentObj.modeFlag="None";for(var o=0;o<r.currentObj.wbsItem.length;o++){r.currentObj.wbsItem[o].itmQtyEnable=false;r.currentObj.wbsItem[o].itmCompEnable=false;r.currentObj.wbsItem[o].itmUomEnable=false;r.currentObj.wbsItem[o].reccrAllowEnable=false;r.currentObj.wbsItem[o].addSubItmEnable=false;r.currentObj.wbsItem[o].Pmper="-";r.currentObj.wbsItem[o].Pmpka="-";r.currentObj.wbsItem[o].Pmprv="-";r.currentObj.wbsItem[o].Pmpfe="-";r.currentObj.wbsItem[o].Pmpin="-";r.currentObj.wbsItem[o].Pmpko="-"}for(var o=0;o<r.currentObj.wbsSubItem.length;o++){r.currentObj.wbsSubItem[o].intPointEnable=false;r.currentObj.wbsSubItem[o].subQtyEnable=false;r.currentObj.wbsSubItem[o].subTextEnable=false}}}l.setData(r.currentObj);i.setData(r.currentObj.wbsItem)}r.getView().setModel(l,"BOMDetailModel");r.getView().setModel(i,"itemDetailModel");r.attachModelEventHandlers(l);r.attachModelEventHandlers(i);if(e){r.syncBOMItem(e)}},error:function(e){r.BusyDialog.close()}})},syncBOMItem:function(e){var r=this;var a=r.getView().getModel("BOMDetailModel").getData();var s=sap.ui.getCore().getModel("tempCrTypeModel").getData();var n={ChangeRequestType:s.crtype,CrDescription:s.desc,IsDraft:"C",ShmmInstance:e,Messages:[],FuncLoc:[],FLAddr:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};if(r.case==="header"){n.SyncHeadData=true}else if(r.case==="component"||r.case==="link"){n.SyncMbom=true}else if(r.case==="add"){n.SyncSearchData=true}var m={Matnr:a.Matnr,Stalt:a.Stalt,Stlan:a.Stlan,Werks:a.Werks,Pmbomtech:a.Pmbomtech?a.Pmbomtech:"",PmbomtechTxt:a.PmbomtechTxt?a.PmbomtechTxt:"",Bomstatus:a.Bomstatus,Lngtxt:a.Lngtxt,Txtmi:a.Lngtxt,Stktx:a.Stktx,Validfrom:this._formatDate(a.Validfrom),Baseqty:a.BaseQty,Baseuom:a.BaseUom,Validtoda:this._formatDate(a.Validtoda)};n.MRBHeader.push(m);for(var l=0;l<a.matItem.length;l++){var i={Matnr:a.Matnr,Stlan:a.Stlan,Werks:a.Werks,Bomitmpos:a.matItem[l].Bomitmpos,Itemcat:a.matItem[l].Itemcat,Itemcomp:a.matItem[l].Itemcomp,Compdesc:"",Itmqty:a.matItem[l].Itmqty,Itmuom:a.matItem[l].Itmuom,Recurallo:a.matItem[l].Recurallo,Erskz:a.matItem[l].Erskz,Rvrel:a.matItem[l].Rvrel==="0"?"":a.matItem[l].Rvrel,Sanfe:a.matItem[l].Sanfe,Sanin:a.matItem[l].Sanin,Sanko:a.matItem[l].Sanko,Itmcmpdesc:a.matItem[l].Itmcmpdesc,Costgrelv:a.matItem[l].Costgrelv==="0"?"":a.matItem[l].Costgrelv,IsNavPossible:a.matItem[l].IsNavPossible,Itmassind:a.matItem[l].Itmassind};if(a.bomType==="Change"){i.Bomitmnod=a.matItem[l].Bomitmnod}if(a.matItem[l].Itemcat==="N"){i.Ekorg=a.matItem[l].Ekorg;i.Ekotx=a.matItem[l].Ekotx;i.Ekgrp=a.matItem[l].Ekgrp;i.Eknam=a.matItem[l].Eknam;i.Preis=a.matItem[l].Preis;i.Waers=a.matItem[l].Waers;i.Peinh=a.matItem[l].Peinh;i.Matkl=a.matItem[l].Matkl;i.Wgbez=a.matItem[l].Wgbez;i.Potx1=a.matItem[l].Potx1}else if(a.matItem[l].Itemcat==="D"){i.Bomdocitm=a.matItem[l].Bomdocitm;i.Bomitmdkr=a.matItem[l].Bomitmdkr;i.BomitmdkrTxt=a.matItem[l].BomitmdkrTxt;i.Bomitmdtl=a.matItem[l].Bomitmdtl;i.Bomitmdvr=a.matItem[l].Bomitmdvr}else if(a.matItem[l].Itemcat==="R"){i.Roms1=a.matItem[l].Roms1;i.Romei=a.matItem[l].Romei;i.Roms2=a.matItem[l].Roms2;i.Roms3=a.matItem[l].Roms3;i.Rform=a.matItem[l].Rform;i.Roanz=a.matItem[l].Roanz;i.Romen=a.matItem[l].Romen;i.Rokme=a.matItem[l].Rokme}else if(a.matItem[l].Itemcat==="T"){i.Potx1=a.matItem[l].Potx1}n.MRBItem.push(i)}for(var o=0;o<a.matSubItem.length;o++){var u={Matnr:a.Matnr,Stlan:a.Stlan,Werks:a.Werks,Posnr:a.matSubItem[o].Posnr,Bomitmnod:a.matSubItem[o].Bomitmnod,Bomsubno:a.matSubItem[o].Bomsubno,Ebort:a.matSubItem[o].Ebort,Upmng:a.matSubItem[o].Upmng,Uptxt:a.matSubItem[o].Uptxt};n.MRBSBIT.push(u)}this.getView().byId("detailPage").setBusy(true);var b=this.getView().getModel();b.create("/ChangeRequestSet",n,{success:function(e){r.getView().byId("detailPage").setBusy(false);if(r.case==="header"){a.Matnr=e.MRBHeader.results[0].Matnr;a.MatDesc=e.MRBHeader.results[0].Maktx;r.getView().getModel("BOMDetailModel").refresh();sap.ui.getCore().getModel("AIWListMatModel").setProperty(r.sBOMModelPath,a);if(r.sFragmentName==="CreateMaterialBom"&&a.Matnr!==""&&a.Werks!==""&&a.Stlan!==""){r.readBomHdrDetails(a.Matnr,a.Werks,a.Stlan,a.Stalt)}}else if(r.case==="component"||r.case==="add"){var s=e.MRBItem.results;a.matItem=[];for(var n=0;n<s.length;n++){s[n].Matnr=a.Matnr;s[n].Stlan=a.Stlan;s[n].Werks=a.Werks;s[n].Costgrelv=s[n].Costgrelv===""?"0":s[n].Costgrelv;s[n].Rvrel=s[n].Rvrel===""?"0":s[n].Rvrel;s[n].ItmcmpdescEnabled=true;a.matItem.push(s[n])}r.getView().getModel("BOMDetailModel").refresh();var m=new t;m.setData(a.matItem);r.getView().setModel(m,"itemDetailModel");sap.ui.getCore().getModel("AIWListMatModel").setProperty(r.sBOMModelPath,a)}else if(r.case==="link"){if(r.sFragmentName==="CreateMaterialBom"){if(a.Matnr===""||a.Werks===""||a.Stlan===""){a.Matnr=e.MRBHeader.results[0].Matnr;a.MatDesc=e.MRBHeader.results[0].Maktx;a.Werks=e.MRBHeader.results[0].Werks;a.WerksDesc=e.MRBHeader.results[0].Plantname;a.Stlan=e.MRBHeader.results[0].Stlan;a.StlanDesc=e.MRBHeader.results[0].Stktx;a.matEnable=true;a.plantEnable=true;a.usageEnable=true;a.altbomVisible=true;r.getView().getModel("BOMDetailModel").refresh();sap.ui.getCore().getModel("AIWListMatModel").setProperty(r.sBOMModelPath,a)}else if(a.Matnr!==""&&a.Werks!==""&&a.Stlan!==""){var s=e.MRBItem.results;a.matItem=[];for(var n=0;n<s.length;n++){s[n].Matnr=a.Matnr;s[n].Stlan=a.Stlan;s[n].Werks=a.Werks;s[n].Costgrelv=s[n].Costgrelv===""?"0":s[n].Costgrelv;s[n].Rvrel=s[n].Rvrel===""?"0":s[n].Rvrel;s[n].ItmcmpdescEnabled=true;a.matItem.push(s[n])}r.getView().getModel("BOMDetailModel").refresh();var m=new t;m.setData(a.matItem);r.getView().setModel(m,"itemDetailModel");sap.ui.getCore().getModel("AIWListMatModel").setProperty(r.sBOMModelPath,a)}}}},error:function(e){r.getView().byId("detailPage").setBusy(false);var t=[],a=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var s=0;s<JSON.parse(e.responseText).error.innererror.errordetails.length;s++){t[s]=JSON.parse(e.responseText).error.innererror.errordetails[s].message}}var n=t.join("\n");sap.m.MessageBox.show(n,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},handleHdrMatCrtPress:function(){var e=this;var t=e.getView().getModel("BOMDetailModel").getData();this.pushToBuffer("Hdr","create")},handleMaterialCompPress:function(e){this.pushToBuffer("Comp","View")},handleMaterialLinkPress:function(e){var t=this;var r;if(e.getSource().getBindingContext("itemDetailModel")){var a=e.getSource().getBindingContext("itemDetailModel").sPath;var s=parseInt(a.substr(1),10);var n=this.getView().getModel("itemDetailModel");var m=n.getData();r=m[s].Itemcomp}else{var l=t.getView().getModel("BOMDetailModel").getData();r=l.Matnr}this.pushToBuffer("Comp","View",r)},handleDisplay:function(){var e=this;var t=e.getView().getModel("BOMDetailModel").getData();var r=[];if(t.Matnr.indexOf("$")>-1){var a={};a.Matnr=t.Matnr;r.push(a)}if(t.matItem.length>0){var s=t.matItem;for(var n=0;n<s.length;n++){var m={};m.Matnr=s[n].Itemcomp;r.push(m)}}var l={ChangeRequestId:"",DisplayMATCR:r};var i=this.getView().getModel();var a={"X-Requested-With":"xmlHTTPrequest"};this.BusyDialog=new sap.m.BusyDialog;this.BusyDialog.open();i.setHeaders(a);i.create("/ChangeRequestSet",l,{success:function(t){e.BusyDialog.close();var r=t.DisplayMATCR.results;var a=new sap.m.List({mode:"SingleSelectMaster"});e.displayMat=new sap.m.Dialog({title:"Display Change Request",content:[a],leftButton:new sap.m.Button({text:"OK",press:function(){e.displayMat.close()}})});var s=new sap.m.StandardListItem({title:"{Matnr}",description:"{ChangeRequest}",icon:"sap-icon://request"});var n=new sap.ui.model.json.JSONModel;n.setData(r);a.setModel(n);a.bindAggregation("items","/",s);e.displayMat.open()},error:function(t){e.BusyDialog.close();var r=false;var a=[];if(JSON.parse(t.responseText).error.innererror.errordetails===undefined||JSON.parse(t.responseText).error.innererror.errordetails.length===0){a[0]=JSON.parse(t.responseText).error.message.value}else{for(var s=0;s<JSON.parse(t.responseText).error.innererror.errordetails.length;s++){a[s]=JSON.parse(t.responseText).error.innererror.errordetails[s].message}}var n=a.join("\n");sap.m.MessageBox.show(n,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(e){}})}})}})});