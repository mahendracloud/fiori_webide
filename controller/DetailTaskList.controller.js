sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","ugiaiwui/mdg/aiw/request/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","ugiaiwui/mdg/aiw/library/js/ClassUtils","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider","sap/ui/core/message/Message","sap/m/BusyDialog","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest"],function(e,t,r,a,l,n,s,i,o,p,u,d){"use strict";return e.extend("ugiaiwui.mdg.aiw.request.controller.DetailTaskList",{formatter:a,colItems:"",colItemsT:"",taskListH:"",index:-1,oAttach:[],oFileUpload:"",cmpData:null,cData:null,chData:[],opData:null,opRowData:null,planPlant:"",eSelectDialog:undefined,fSelectDialog:undefined,ppSelectDialog:undefined,pSelectDialog:undefined,uSelectDialog:undefined,pgSelectDialog:undefined,sSelectDialog:undefined,sySelectDialog:undefined,wcSelectDialog:undefined,wctabSelectDialog:undefined,wctabSearchResults:undefined,wcpSearchResults:undefined,wcpSelectDialog:undefined,qSelectDialog:undefined,qSearchResults:undefined,matSearchResults:undefined,matSelectDialog:undefined,stdSelectDialog:undefined,prSelectDialog:undefined,isItemPress:"",classType:"",_class:"",defaultCharArr:[],charValueArr:[],lArray:[],singleVal:"",charValue:"",cPath:"",sPath:"",resultArr:[],system:false,ctrlKey:"",cReqType:"",cReqTypeE:"",cReqTypeF:"",itemCat:"",obj:"",oData:null,objDetails:undefined,charFlag:"",codeFlag:"",tlType:"",group:"",onInit:function(){this._oView=this.getView();this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this._oView));var e=this._oComponent.getModel();e.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(e);var t=this._oComponent.getModel("NewModel");this.getView().setModel(t,"valueHelp");var r=this._oComponent.getModel("NewModel2");this.getView().setModel(r,"valueHelp2");this.system=this.readSystem();this.ctrlKey=" ";this.itemCat="L";this.getRouter().getRoute("tlDetail").attachPatternMatched(this._onRouteMatched,this);var a=new sap.ui.model.json.JSONModel;var l={visible:false};a.setData(l);this.getView().setModel(a,"aVisModel");var n=new sap.ui.model.json.JSONModel;var s={enable:false};n.setData(s);this.getView().setModel(n,"aEnModel");jQuery.sap.delayedCall(30,this,function(){this.getClassType(this)});var i=sap.ui.getCore().getMessageManager();this.getView().setModel(i.getMessageModel(),"message");i.registerObject(this.getView(),true)},getClassType:function(e){var t=e.getView().getModel("valueHelp");var r=e.getObTab();var a=new sap.ui.model.Filter("Obtab","EQ",r);var l="/ClassTypeSet";t.read(l,{filters:[a],success:function(t){if(t.results.length>0){e.Classtype=t.results[0].Klart;e.Classtypedesc=t.results[0].Artxt}else{e.Classtype="";e.Classtypedesc=""}},error:function(){e.Classtype="";e.Classtypedesc=""}})},WCPPCheckHeader:function(){var e=this;var t;var r=this.getView().getModel();var a=this.getView().getModel("tlDetailModel");var l=a.getData();t="/WorkcentrePlantValSet(Werks='"+l.lHeader.Iwerk+"',Tarbpl='"+l.lHeader.wc+"',Wcplant='"+l.lHeader.plant+"') ";r.read(t,{success:function(e){l.lHeader.wcValueState="None";a.setData(l);a.refresh()},error:function(e){var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var n=t.join("\n");s.show(n,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}});l.lHeader.wcValueState="Error";a.setData(l);a.refresh()}})},DeriveEquiFlocData:function(e,t){var r=this;var a="/ChangeRequestSet";var l=r.getView().getModel();var n={};var s={ChangeRequestType:"AIWEAM0P",CrDescription:"",Reason:"01",DeriveData:true,FuncLoc:[],FLAddr:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqClass:[],EqVal:[],MSPoint:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};var i=sap.ui.getCore().getModel("AIWEQUI").getData();var o=sap.ui.getCore().getModel("AIWFLOC").getData();if(o.length>0){for(var p=0;p<o.length;p++){var u={Tplnr:o[p].Functionallocation,Txtmi:o[p].Flocdescription,TplkzFlc:o[p].Strucindicator,Tplxt:o[p].StrucIndicatorDesc,EditMask:o[p].EditMask,Hierarchy:o[p].Hierarchy,Fltyp:o[p].Floccategory,Flttx:o[p].FlocCategoryDesc,Swerk:o[p].Maintplant,Plantname:o[p].MaintplantDesc,StorFloc:o[p].Location,Locationdesc:o[p].Locationdesc,Abckzfloc:o[p].Abckz,Abctx:o[p].Abctx,Bukrsfloc:o[p].Bukrs,Butxt:o[p].Butxt,City:o[p].City,KostFloc:o[p].Kostl,KokrFloc:o[p].Kokrs,Contareaname:o[p].Mctxt,PlntFloc:o[p].Werks,Planningplantdes:o[p].Planningplantdes,Ingrp:o[p].Ingrp,Plannergrpdesc:o[p].Innam,Arbplfloc:o[p].Arbpl,Wergwfloc:o[p].WcWerks,Gewrkfloc:o[p].MainArbpl,MainWcPlant:o[p].MainWerks,Tplma:o[p].SupFunctionallocation,Supflocdesc:o[p].SupFlocdescription,BeberFl:o[p].BeberFl,Fing:o[p].Fing,Tele:o[p].Tele,Submtiflo:o[p].ConstrType,Constdesc:o[p].ConstructionDesc,Eqart:o[p].TechnicalObjectTyp,Eartx:o[p].Description,Stattext:o[p].Stattext,StsmFloc:o[p].StsmEqui,Statproftxt:o[p].StsmEquiDesc,UstwFloc:o[p].UstwEqui,UswoFloc:o[p].UswoEqui,UstaFloc:o[p].UstaEqui};if(o[p].viewParameter==="create"){u.Type=true}s.FuncLoc.push(u);var d={Funcloc:o[p].Functionallocation,Title:o[p].TitleCode,Name1:o[p].Name1,Name2:o[p].Name2,Name3:o[p].Name3,Name4:o[p].Name4,Sort1:o[p].Sort1,Sort2:o[p].Sort2,NameCo:o[p].NameCo,PostCod1:o[p].PostCod1,City1:o[p].City1,Building:o[p].Building,Floor:o[p].Floor,Roomnum:o[p].Roomnum,Strsuppl1:o[p].Strsuppl1,Strsuppl2:o[p].Strsuppl2,Strsuppl3:o[p].Strsuppl3,Location:o[p].AddrLocation,RPostafl:o[p].RefPosta,Landx:o[p].Landx,TimeZone:o[p].TimeZone};s.FLAddr.push(d);var c=o[p].classItems;if(c){if(c.length>0){for(var g=0;g<c.length;g++){var h={Funcloc:o[p].Functionallocation,Classtype:c[g].Classtype,Class:c[g].Class,Clstatus1:c[g].Clstatus1};s.FLClass.push(h)}}}var m=o[p].characteristics;if(m){if(m.length>0){for(var f=0;f<m.length;f++){var v={Funcloc:o[p].Functionallocation,Atnam:m[f].Atnam,Textbez:m[f].Textbez,Atwrt:m[f].Atwrt,Class:m[f].Class};s.FLVal.push(v)}}}}}if(i.length>0){for(var b=0;b<i.length;b++){var O={Herst:i[b].Herst,Equnr:i[b].Equnr,Txtmi:i[b].Eqktx,Swerk:i[b].Maintplant,Name1:i[b].MaintplantDesc,TplnEilo:i[b].Tplnr,Flocdescription:i[b].Pltxt,Eqtyp:i[b].EquipmentCatogory,Etytx:i[b].EquipCatgDescription,Eqart:i[b].TechnicalObjectTyp,Eartx:i[b].Description,Typbz:i[b].Typbz,SubmEeqz:i[b].ConstrType,Constdesc:i[b].ConstructionDesc,BukrEilo:i[b].Bukrs,Butxt:i[b].Butxt,HequEeqz:i[b].SuperordinateEquip,SuperordEqDes:i[b].SuperordinateEquipDesc,TidnEeqz:i[b].TechIdNum,KostEilo:i[b].Kostl,KokrEilo:i[b].Kokrs,Contareaname:i[b].Mctxt,StorEilo:i[b].Location,Locationdesc:i[b].Locationdesc,AbckEilo:i[b].Abckz,Abctx:i[b].Abctx,PplaEeqz:i[b].Werks,Planningplantdes:i[b].Planningplantdes,IngrEeqz:i[b].Ingrp,Plannergrpdesc:i[b].Innam,Serge:i[b].Serge,MapaEeqz:i[b].MapaEeqz,Stattext:i[b].Stattext,StsmEqui:i[b].StsmEqui,Statproftxt:i[b].StsmEquiDesc,UstwEqui:i[b].UstwEqui,UswoEqui:i[b].UswoEqui,UstaEqui:i[b].UstaEqui,Answt:i[b].Answt,Ansdt:r._formatDate(i[b].Ansdt),Waers:i[b].Waers,ArbpEilo:i[b].Arbpl,WorkCenterPlant:i[b].WcWerks,ArbpEeqz:i[b].MainArbpl,MainWcPlant:i[b].MainWerks,BebeEilo:i[b].BeberFl,Fing:i[b].Fing,Tele:i[b].Tele,HeqnEeqz:i[b].EquipPosition};if(i[b].viewParameter==="create"){O.Type=true}s.Equipment.push(O);var S={Equi:i[b].Equnr,Title:i[b].TitleCode,Name1:i[b].Name1,Name2:i[b].Name2,Name3:i[b].Name3,Name4:i[b].Name4,Sort1:i[b].Sort1,Sort2:i[b].Sort2,NameCo:i[b].NameCo,PostCod1:i[b].PostCod1,City1:i[b].City1,Building:i[b].Building,Floor:i[b].Floor,Roomnum:i[b].Roomnum,Strsuppl1:i[b].Strsuppl1,Strsuppl2:i[b].Strsuppl2,Strsuppl3:i[b].Strsuppl3,Location:i[b].AddrLocation,RefPosta:i[b].RefPosta,Landx:i[b].Landx,TimeZone:i[b].TimeZone};s.EqAddr.push(S);var P=i[b].classItems;if(P){if(P.length>0){for(var e=0;e<P.length;e++){var M={Equi:i[b].Equnr,Classtype:P[e].Classtype,Class:P[e].Class,Clstatus1:P[e].Clstatus1};s.EqClass.push(M)}}}var T=i[b].characteristics;if(T){if(T.length>0){for(var C=0;C<T.length;C++){var D={Equi:i[b].Equnr,Atnam:T[C].Atnam,Textbez:T[C].Textbez,Atwrt:T[C].Atwrt,Class:T[C].Class};s.EqVal.push(D)}}}}}if(t==="E"){var w=sap.ui.getCore().getModel("tlDetailModel");var V=w.getData();if(V.lHeader.Iwerk!==""){V.lHeader.Werks=V.lHeader.Iwerk}var x={Werks:V.lHeader.Werks,Wcplant:V.lHeader.plant,Statu:V.lHeader.Statu,Tverwe:V.lHeader.tlusg,Ktext:V.lHeader.Ktext,Tarbpl:V.lHeader.wc,Vagrp:V.lHeader.Vagrp,Anlzu:V.lHeader.Anlzu,Tplnal:V.lHeader.Plnal.toString(),Tleqhdr:V.grp,Strat:V.lHeader.Strat,Eq2tl:V.lHeader.equipment};s.ETList.push(x);for(var y=0;y<V.lOperation.length;y++){var j={Tleqhdr:V.grp,Vornr:V.lOperation[y].Vornr,TlArbpl:V.lOperation[y].Arbpl,Werks2eop:V.lOperation[y].Werks,Steus2eop:V.lOperation[y].Steus,Ltxa1:V.lOperation[y].Ltxa1,Arbei:V.lOperation[y].Arbei,Dauno:V.lOperation[y].Dauno,Arbeh:V.lOperation[y].Arbeh,Anzzl:V.lOperation[y].Anzzl,Daune:V.lOperation[y].Daune,Indet:V.lOperation[y].Indet,Tplnal:V.lOperation[y].Plnal.toString()};s.ETOprs.push(j)}}if(t==="F"){var w=sap.ui.getCore().getModel("tlDetailModel");var V=w.getData();if(V.lHeader.Iwerk!==""){V.lHeader.Werks=V.lHeader.Iwerk}var E={Werks:V.lHeader.Werks,Wcplant:V.lHeader.plant,Statu:V.lHeader.Statu,Tverwe:V.lHeader.tlusg,Ktext:V.lHeader.Ktext,Tarbpl:V.lHeader.wc,Vagrp:V.lHeader.Vagrp,Anlzu:V.lHeader.Anlzu,Tplnal:V.lHeader.Plnal.toString(),Tlflhdr:V.grp,Strat:V.lHeader.Strat,Fl2tl:V.lHeader.floc};s.FTList.push(E);for(var y=0;y<V.lOperation.length;y++){var I={Tlflhdr:V.grp,Vornr:V.lOperation[y].Vornr,TlArbpl:V.lOperation[y].Arbpl,Werks2fop:V.lOperation[y].Werks,Steus2fop:V.lOperation[y].Steus,Ltxa1:V.lOperation[y].Ltxa1,Arbei:V.lOperation[y].Arbei,Dauno:V.lOperation[y].Dauno,Arbeh:V.lOperation[y].Arbeh,Anzzl:V.lOperation[y].Anzzl,Daune:V.lOperation[y].Daune,Indet:V.lOperation[y].Indet,Tplnal:V.lOperation[y].Plnal.toString()};s.FTOprs.push(I)}}var k=function(e){var r=sap.ui.getCore().getModel("tlDetailModel");var a=r.getData();if(t==="E"){for(var l=0;l<e.ETOprs.results.length;l++){a.lOperation[l].Arbpl=e.ETOprs.results[l].TlArbpl;a.lOperation[l].Werks=e.ETOprs.results[l].Werks2eop;a.lOperation[l].Steus=e.ETOprs.results[l].Steus2eop;if(e.ETOprs.results[l].Usrvalflg1==="X"){a.lOperation[l].SteusEnable=false}else{a.lOperation[l].SteusEnable=true}}r.setData(a);sap.ui.getCore().getModel("tlDetailModel").refresh()}if(t==="F"){for(var l=0;l<e.FTOprs.results.length;l++){a.lOperation[l].Arbpl=e.FTOprs.results[l].TlArbpl;a.lOperation[l].Werks=e.FTOprs.results[l].Werks2fop;a.lOperation[l].Steus=e.FTOprs.results[l].Steus2fop;if(e.FTOprs.results[l].Usrvalflg1==="X"){a.lOperation[l].SteusEnable=false}else{a.lOperation[l].SteusEnable=true}}r.setData(a);sap.ui.getCore().getModel("tlDetailModel").refresh()}};l.create(a,s,{success:k,error:{}})},_onRouteMatched:function(e){this.currentObj=undefined;var r=decodeURIComponent(e.getParameter("arguments").itemPath);this.basicPath="/"+r.split("/")[1];this.headerPath="/"+r.split("/")[2];this.mainPath=r;this.action=e.getParameter("arguments").action;this.status=e.getParameter("arguments").status;this.mode=e.getParameter("arguments").mode;var a=[];var l=[];var n=[];var s=[];var i=[];this.getView().byId("idBtnCheck").setVisible(true);var o=this.getView().createId("clsFrag");this.class=sap.ui.core.Fragment.byId(o,"assignmentTab");var p=this.getView().createId("charFrag");this.char=sap.ui.core.Fragment.byId(p,"characteristicsTab");if(sap.ui.getCore().getModel("oOpFlag")){var u=sap.ui.getCore().getModel("oOpFlag").opDetFlag}var d=new sap.ui.model.json.JSONModel;this.getView().setModel(d,"tlDetailModel");if(this.action.indexOf("GTL")>0&&this.action!=="changeGTL"){var c=sap.ui.getCore().getModel("AIWListGTLModel");this.currentObj=c.getProperty(this.basicPath);this.currentObj.lHeader=this.currentObj.header[parseInt(this.headerPath.substr(1))];this.currentObj.lHeader.vEquiLbl=false;this.currentObj.lHeader.vEqui=false;this.currentObj.lHeader.vEquiDesc=false;this.currentObj.lHeader.vFlocLbl=false;this.currentObj.lHeader.vFloc=false;this.currentObj.lHeader.vFlocDesc=false;this.currentObj.lHeader.equipment="";this.currentObj.lHeader.equipmentDesc="";this.currentObj.lHeader.floc="";this.currentObj.lHeader.flocDesc="";this.currentObj.lHeader.PPenable=true;this.getView().byId("grpDetLbl").setText(this.getView().getModel("i18n").getProperty("GROUP_GEN_TXT"))}else if(this.action.indexOf("ETL")>0&&this.action!=="changeETL"){var g=sap.ui.getCore().getModel("AIWListETLModel");this.currentObj=g.getProperty(this.basicPath);this.currentObj.lHeader=this.currentObj.header[parseInt(this.headerPath.substr(1))];this.currentObj.lHeader.vEquiLbl=true;this.currentObj.lHeader.vEqui=true;this.currentObj.lHeader.vEquiDesc=true;this.currentObj.lHeader.vFlocLbl=false;this.currentObj.lHeader.vFloc=false;this.currentObj.lHeader.vFlocDesc=false;this.currentObj.lHeader.PPenable=false;this.currentObj.lHeader.bAddHeader=false;if(this.currentObj.lHeader.equipment!==""&&this.currentObj.lHeader.equipment!==null){this.currentObj.lHeader.bAddHeader=true}this.getView().byId("grpDetLbl").setText(this.getView().getModel("i18n").getProperty("GROUP_EQ_TXT"))}else if(this.action.indexOf("FTL")>0&&this.action!=="changeFTL"){var h=sap.ui.getCore().getModel("AIWListFTLModel");this.currentObj=h.getProperty(this.basicPath);this.currentObj.lHeader=this.currentObj.header[parseInt(this.headerPath.substr(1))];this.currentObj.lHeader.vEquiLbl=false;this.currentObj.lHeader.vEqui=false;this.currentObj.lHeader.vEquiDesc=false;this.currentObj.lHeader.vFlocLbl=true;this.currentObj.lHeader.vFloc=true;this.currentObj.lHeader.vFlocDesc=true;this.currentObj.lHeader.PPenable=false;this.currentObj.lHeader.bAddHeader=false;if(this.currentObj.lHeader.floc!==""&&this.currentObj.lHeader.floc!==null){this.currentObj.lHeader.bAddHeader=true}this.getView().byId("grpDetLbl").setText(this.getView().getModel("i18n").getProperty("GROUP_FL_TXT"))}if(!u){this.grpCounter=this.currentObj.lHeader.Plnal;this.currentObj.lHeader.bAddOperation=true;this.currentObj.lHeader.bAddComponent=false;this.currentObj.lHeader.bAddOprRel=false;this.currentObj.lHeader.bAddSrvOpOrvw=false;this.currentObj.lHeader.bAddPRT=false;this.currentObj.lHeader.bAddInspChar=false;this.currentObj.lOperation=[];this.currentObj.lComponent=[];this.currentObj.lOprRel=[];this.currentObj.lPRT=[];this.currentObj.lInspChar=[];if(this.currentObj.operation===undefined||this.currentObj.operation.length===0){if(this.getView().byId("operationTab").getModel("tlDetailModel")){this.getView().getModel("tlDetailModel").setProperty("/lOperation",a);this.getView().byId("operationTab").setModel(d,"tlDetailModel")}}else{var m=this.currentObj.operation;for(var f=0;f<m.length;f++){if(m[f].Plnal===this.grpCounter){s.push(m[f])}}this.currentObj.lOperation=s;this.getView().getModel("tlDetailModel").setProperty("/lOperation",s);this.getView().byId("operationTab").setModel(d,"tlDetailModel");if(this.currentObj.lOperation.length>0){this.getView().byId("operationTab").getItems()[0].setSelected(true)}}if(this.currentObj.component===undefined||this.currentObj.component.length===0){if(this.getView().byId("components").getModel("tlDetailModel")){this.getView().getModel("tlDetailModel").setProperty("/lComponent",a);this.getView().byId("components").setModel(d,"tlDetailModel")}}else{if(this.currentObj.lOperation.length>0){this.cmpData=this.currentObj.component;var v=this.currentObj.component;for(var f=0;f<v.length;f++){if(v[f].Plnal===this.grpCounter&&v[f].Vornr===this.currentObj.lOperation[0].Vornr){i.push(v[f])}}this.currentObj.lComponent=i;this.getView().getModel("tlDetailModel").setProperty("/lComponent",i);this.getView().byId("components").setModel(d,"tlDetailModel")}else{this.currentObj.lComponent=[];this.getView().getModel("tlDetailModel").setProperty("/lComponent",i);this.getView().byId("components").setModel(d,"tlDetailModel")}}if(this.currentObj.lOperation===undefined||this.currentObj.lOperation.length===0){this.currentObj.lOprRel=[];this.currentObj.lSrvPckgOvrw=[];this.currentObj.lMaintPckg=[];this.currentObj.lPRT=[];this.currentObj.lInspChar=[]}else{var b=this.currentObj.lOperation[0].OprRel;this.currentObj.lOprRel=b;var O=this.currentObj.lOperation[0].SrvPckgOvrw;this.currentObj.lSrvPckgOvrw=O;var S=this.currentObj.lOperation[0].PRT;this.currentObj.lPRT=S;var P=this.currentObj.lOperation[0].InspChar;this.currentObj.lInspChar=P;if(this.currentObj.lOperation[0].Steus==="PM03"||this.currentObj.lOperation[0].Steus==="PM05"){this.currentObj.lHeader.bAddSrvOpOrvw=true}else{this.currentObj.lHeader.bAddSrvOpOrvw=false}if(this.currentObj.lOperation[0].insPt!==""){this.currentObj.lHeader.bAddInspChar=true}else{this.currentObj.lHeader.bAddInspChar=false}this.currentObj.lMaintPckg=[];for(var M in this.currentObj.lOperation){for(var T in this.currentObj.MaintPckg){if(this.currentObj.lOperation[M].Vornr===this.currentObj.MaintPckg[T].Vornr&&this.currentObj.lOperation[M].Plnal===this.currentObj.MaintPckg[T].Plnal){this.currentObj.lMaintPckg.push(this.currentObj.MaintPckg[T])}}}}if(this.currentObj.lHeader.Strat!==""){this.getView().byId("idTabMaintPckg").setVisible(true);d.setData(this.currentObj);this.readMaintPckgConfig(this.currentObj.lHeader.Strat,true)}else{this.getView().byId("idTabMaintPckg").setVisible(false);this.getView().byId("idTabMaintPckg").setModel(new t(this.currentObj.lMaintPckg))}}else{this.currentObj=sap.ui.getCore().getModel("tlDetailModel").getData();var C=parseInt(sap.ui.getCore().getModel("oOpFlag").opIndex);if(this.currentObj.lOperation.length>0){this.getView().byId("operationTab").getItems()[C].setSelected(true);var i=[];if(this.cmpData){for(var f=0;f<this.cmpData.length;f++){if(this.cmpData[f].Plnal===this.grpCounter&&this.cmpData[f].Vornr===this.currentObj.lOperation[C].Vornr){i.push(this.cmpData[f])}}}this.currentObj.lComponent=i}var b=this.currentObj.lOperation[C].OprRel;this.currentObj.lOprRel=b;var O=this.currentObj.lOperation[C].SrvPckgOvrw;this.currentObj.lSrvPckgOvrw=O;var S=this.currentObj.lOperation[C].PRT;this.currentObj.lPRT=S;var P=this.currentObj.lOperation[C].InspChar;this.currentObj.lInspChar=P;if(this.currentObj.lOperation[C].Steus==="PM03"||this.currentObj.lOperation[C].Steus==="PM05"){this.currentObj.lHeader.bAddSrvOpOrvw=true}else{this.currentObj.lHeader.bAddSrvOpOrvw=false}if(this.currentObj.lOperation[0].insPt!==""){this.currentObj.lHeader.bAddInspChar=true}else{this.currentObj.lHeader.bAddInspChar=false}var D={opDetFlag:false};sap.ui.getCore().setModel(D,"oOpFlag")}d.setData(this.currentObj);this.getView().setModel(d,"tlDetailModel");this.getView().getModel("tlDetailModel").refresh();sap.ui.getCore().setModel(d,"tlDetailModel");this.getView().byId("operationTab").getModel("tlDetailModel").refresh();if(this.action==="changeGTL"||this.action==="changeETL"||this.action==="changeFTL"){this.tlType=e.getParameter("arguments").tlType;this.group=e.getParameter("arguments").group;this.getView().byId("operationTab").setVisible(true);this.getView().byId("components").setVisible(true);this.class.setVisible(true);this.char.setVisible(true);var w=this.getView().getModel("aVisModel").getData();w.visible=false;this.getView().getModel("aVisModel").setData(w);var V=this.getView().getModel("aEnModel").getData();V.enable=true;this.getView().getModel("aEnModel").setData(V);this.readTaskListDetails();if(this.action==="changeGTL"){var c=sap.ui.getCore().getModel("AIWListGTLModel");this.currentObj=c.getProperty(this.basicPath);this.currentObj.modeflag="Chg"}else if(this.action==="changeFTL"){var h=sap.ui.getCore().getModel("AIWListFTLModel");this.currentObj=h.getProperty(this.basicPath);this.currentObj.modeflag="Chg"}else if(this.action==="changeETL"){var g=sap.ui.getCore().getModel("AIWListETLModel");this.currentObj=g.getProperty(this.basicPath);this.currentObj.modeflag="Chg"}this.getView().byId("tlDetailPage").setTitle(this.getView().getModel("i18n").getProperty("tlChgMasterTitle"));var x=sap.ui.getCore().getModel("refreshModel");x.setProperty("/refreshSearch",false)}else{if(this.currentObj.mode==="create"){this.getView().byId("tlDetailPage").setTitle(this.getView().getModel("i18n").getProperty("tlMasterTitle"))}else{this.getView().byId("tlDetailPage").setTitle(this.getView().getModel("i18n").getProperty("tlChgMasterTitle"))}}if(this.mode==="display"){this.getView().byId("idBtnCheck").setVisible(false);var w=this.getView().getModel("aVisModel").getData();w.visible=true;this.getView().getModel("aVisModel").setData(w);this.getView().byId("idTABFormSections").setVisible(false);this.getView().byId("operationTab").setVisible(false);this.getView().byId("components").setVisible(false);this.class.setVisible(false);this.char.setVisible(false);var w=this.getView().getModel("aVisModel").getData();w.visible=true;this.getView().getModel("aVisModel").setData(w);var V=this.getView().getModel("aEnModel").getData();V.enable=false;this.getView().getModel("aEnModel").setData(V);var y=new t([]);var j={classItems:[],characteristics:[]};if(this.currentObj.Class){var E=this.currentObj.Class.length;for(var f=0;f<E;f++){if(this.currentObj.lHeader.Plnal===this.currentObj.Class[f].Tplnal){l.push(this.currentObj.Class[f])}}}j.classItems=l;if(this.currentObj.Char){var I=this.currentObj.Char.length;var k=j.classItems;if(k.length>0){for(var f=0;f<k.length;f++){for(var N=0;N<I;N++){if(k[f].Class===this.currentObj.Char[N].Class){n.push(this.currentObj.Char[N])}}}}}j.characteristics=n;y.setData(j);this.getView().setModel(y,"AIWAPPROVE");var A={};A.sTitle="Task List";var H=new t(A);this.getView().setModel(H,"titleModelTL");if(this.currentObj.lHeader.Strat!==""){this.getView().byId("idTabApprMaintPckg").setVisible(true);d.setData(this.currentObj);this.readMaintPckgConfig(this.currentObj.lHeader.Strat,true,"Appr")}else{this.getView().byId("idTabApprMaintPckg").setVisible(false);this.getView().byId("idTblApprMaintPckg").setModel(new t(this.currentObj.lMaintPckg))}}else{this.getActivityType(this.currentObj.lHeader.wc);this.getView().byId("idTABFormSections").setVisible(true);this.getView().byId("operationTab").setVisible(true);this.getView().byId("components").setVisible(true);if(this.currentObj.Class){var F=new sap.ui.model.json.JSONModel;var E=this.currentObj.Class.length;for(var f=0;f<E;f++){if(this.currentObj.Class[f].Plnal===this.currentObj.lHeader.Plnal){l.push(this.currentObj.Class[f])}}F.setData(l);this.class.setModel(F);if(l.length>0){this.class.getItems()[0].setSelected(true)}}this.chData=[];if(this.currentObj.Char){for(var T=0;T<l.length;T++){for(var M=0;M<this.currentObj.Char.length;M++){if(this.currentObj.Char[M].Class===l[T].Class&&this.currentObj.Char[M].Plnal===l[T].Plnal){this.chData.push(this.currentObj.Char[M])}}}}if(this.chData.length>0){for(var N=0;N<this.chData.length;N++){if(l[0].Class===this.chData[N].Class&&l[0].Plnal===this.chData[N].Plnal){n.push(this.chData[N])}}this.char.setModel(new t(n))}else{this.char.setModel(new t([]))}this.class.setVisible(true);this.char.setVisible(true);var w=this.getView().getModel("aVisModel").getData();w.visible=false;this.getView().getModel("aVisModel").setData(w);var V=this.getView().getModel("aEnModel").getData();V.enable=true;this.getView().getModel("aEnModel").setData(V);var A={};if(this.currentObj.modeflag==="Crt"&&this.currentObj.typeFlag==="G"){A.sTitle="Create General Task List"}else if(this.currentObj.modeflag==="Crt"&&this.currentObj.typeFlag==="E"){A.sTitle="Create Equipment Task List"}else if(this.currentObj.modeflag==="Crt"&&this.currentObj.typeFlag==="F"){A.sTitle="Create Functional Location Task List"}else if(this.currentObj.modeflag==="Chg"&&this.currentObj.typeFlag==="G"){A.sTitle="Change General Task List"}else if(this.currentObj.modeflag==="Chg"&&this.currentObj.typeFlag==="E"){A.sTitle="Change Equipment Task List"}else if(this.currentObj.modeflag==="Chg"&&this.currentObj.typeFlag==="F"){A.sTitle="Change Functional Location Task List"}var H=new t(A);this.getView().setModel(H,"titleModelTL")}},getActivityType:function(e){var t=this;var r="/WorkCenterVHSet";var a=new sap.ui.model.Filter("Arbpl","EQ",e);var l=this.getView().getModel("valueHelp");var n=false;if(n===true){return}else{l.read(r,{filters:[a],success:function(e){if(e.results.length>0){t.ActivityType=e.results[0].Lar01;t.ctrlKey=e.results[0].Steus}else{t.ActivityType="";t.ctrlKey=""}},error:function(e){var r=JSON.parse(e.responseText);var a=r.error.message.value;t.ActivityType="";t.ctrlKey=""}})}},onAfterRendering:function(){this.attachRequest()},readSystem:function(){var e=this._oView.getModel("valueHelp");var t=this;var r="/SystemTypeSet";e.read(r,{success:function(e){t.system=e.results[0].System;if(t.system===true){t._oView.byId("material").setMaxLength(40)}else{t._oView.byId("material").setMaxLength(18)}return t.system}})},readTaskListDetails:function(){var e=this;var t=this.getView().getModel();var r;var l=this.getModel("tlDetailModel");var r="/ChangeRequestSet";var n=[new sap.ui.model.Filter("Plnnr","EQ",this.group),new sap.ui.model.Filter("Plnty","EQ",this.tlType)];if(this.tlType==="A"){var s=["GTClass","GTComp","GTInsp","GTList","GTMPack","GTMpackRead","GTOprs","GTPRT","GTRel","GTSpack","GTVal"]}else if(this.tlType==="E"){var s=["ETClass","ETComp","ETInsp","ETList","ETMPack","ETMpackRead","ETOprs","ETPRT","ETRel","ETSpack","ETVal"]}else if(this.tlType==="T"){var s=["FTClass","FTComp","FTInsp","FTList","FTMPack","FTMpackRead","FTOprs","FTPRT","FTRel","FTSpack","FTVal"]}t.read(r,{filters:n,urlParameters:{$expand:s},success:function(t){if(t.results.length>0){var r=t.results[0];var n=t.results[0].Message;e.lockMsg="";if(n!==""){e.lockMsg=true;sap.m.MessageToast.show(n,{duration:15e3,animationDuration:15e3})}var s=parseInt(e.headerPath.substr(1));var i,o,p,u,d,c;if(e.tlType==="A"){if(r.GTList.results.length>0){var g=r.GTList.results[0];e.currentObj={validFrm:a.getDateFormat(r.Datuv),grp:t.results[0].Plnnr,vEquiLbl:false,vEqui:false,vEquiDesc:false,vFlocLbl:false,vFloc:false,vFlocDesc:false,bAddComponent:true,mode:"change",MaintPckg:[],KDenable:false};l.setData(e.currentObj);var h=r.GTList.results;if(h.length>0){for(var m=0;m<h.length;m++){h[m].pPlantDesc=h[m].Iwerktxt;h[m].usageDesc=h[m].TlUsgTxt;h[m].plGrpDesc=h[m].Plnnrgrptxt;h[m].statusDesc=h[m].Statustxt;h[m].sysCondDesc=h[m].Anlzux;h[m].stratDesc=h[m].Strattxt;h[m].Plnal=h[m].Tplnal;h[m].Verwe=h[m].Tverwe;h[m].plEnable=false;h[m].vEquiLbl=false;h[m].vEqui=false;h[m].vEquiDesc=false;h[m].vFlocLbl=false;h[m].vFloc=false;h[m].vFlocDesc=false;h[m].valueStateT="None";h[m].valueStatePP="None";h[m].valueStateU="None";h[m].valueStateS="None";h[m].tlusg=h[m].Tverwe;h[m].Iwerk=h[m].Werks;h[m].wc=h[m].Tarbpl;h[m].plant=h[m].Wcplant;h[m].grp=h[m].Tlgnhdr;h[m].insPt=h[m].Slwbez;h[m].insPtDesc=h[m].Slwbeztxt}var f=new sap.ui.model.json.JSONModel;f.setData(h);e.getModel("tlDetailModel").setProperty("/lHeader",h[s])}var v=r.GTOprs.results;if(v.length>0){var b=r.GTRel.results;var O=r.GTSpack.results;var S=r.GTMPack.results;var P=r.GTMpackRead.results;var M=r.GTPRT.results;var T=r.GTInsp.results;for(var C=0;C<v.length;C++){v[C].calcKeyDesc="";v[C].actTypDesc="";v[C].flag=v[C].Plnal+"-"+v[C].Vornr;v[C].Arbpl=v[C].TlArbpl;v[C].Plnal=v[C].Tplnal;v[C].opState="None";v[C].opDescState="None";v[C].wcValueState="None";v[C].plantState="None";v[C].ctrlKeyState="None";v[C].Werks=v[C].Werks2gop;v[C].Steus=v[C].Steus2gop;v[C].workPerc=v[C].Prznt.toString();v[C].orderQty=v[C].Bmvrg;v[C].ordQtyUnit=v[C].Bmeih;v[C].netPrice=v[C].Opreis;v[C].currency=v[C].Owaers;v[C].priceUnit=v[C].Opeinh;v[C].costElement=v[C].Sakto2gop;v[C].materialGrp=v[C].Omatkl;v[C].puchGroup=v[C].Oekgrp;v[C].purchOrg=v[C].Ekorg;v[C].Uvorn=v[C].Uvorn;v[C].equi=v[C].EqunrGop;v[C].floc=v[C].TplnrGop;v[C].UvornEnable=false;v[C].OprRel=[];v[C].SrvPckgOvrw=[];v[C].PRT=[];v[C].InspChar=[];if(b.length>0){for(var D in b){if(e.currentObj.grp===b[D].Tlgnhdr&&v[C].Plnal===b[D].Tplnal&&v[C].Vornr===b[D].Vorn2){var w={Plnal:b[D].Tplnal,Vornr:b[D].Vorn2,OperationOR:b[D].Vornrgrel,Offset:b[D].Dauer,OUn:b[D].Zeinh,RelType:b[D].Aobar,PO:b[D].Gprznt,OI:b[D].Provg,ID:b[D].Gkalid,WrkCtrOR:b[D].Arbplgrel,PlantOR:b[D].Werksgrel,OperationORVS:"None",OffsetVS:"None",OUnVS:"None",RelTypeVS:"None",POVS:"None",OIVS:"None",IDVS:"None",WrkCtrORVS:"None",PlantORVS:"None"};v[C].OprRel.push(w)}}}if(O.length>0){for(var D in O){if(e.currentObj.grp===O[D].Tlgnhdr&&v[C].Plnal===O[D].Tplnal&&v[C].Vornr===O[D].Vornrr){var V={group:O[D].Tlgnhdr,Plnal:O[D].Tplnal,Vornr:O[D].Vornrr,LineNum:O[D].SrvLine,DelIndSP:a.statusSel(O[D].Del),ActNum:O[D].Srvpos,ShrtTxt:O[D].Ktext1,Qty:O[D].Mengegspk,BUomSP:O[D].Meinsgspk,GrossPrc:O[D].Tbtwr,CurKey:O[D].Waersgspk,Work:O[D].IntWork,UnitOfWork:O[D].Iwein,ActNumVS:"None",ShrtTxtVS:"None",QtyVS:"None",BUomSPVS:"None",GrossPrcVS:"None",CurKeyVS:"None",WorkVS:"None",UnitOfWorkVS:"None",DelIndSPEnabled:false,SPEnabled:true};v[C].SrvPckgOvrw.push(V)}}}if(M.length>0){for(var D in M){if(e.currentObj.grp===M[D].Tlgnhdr&&v[C].Plnal===M[D].Tplnal&&v[C].Vornr===M[D].Vornrgprt){var x={grp:M[D].Tlgnhdr,Plnal:M[D].Tplnal,Vornr:M[D].Vornrgprt,ItmNum:M[D].Psnfh,ItmCat:M[D].Fhmar,Plant:M[D].Fhwrk,Mat:M[D].Matnrgprt,MatDesc:"",Equi:M[D].EqunrGpt,EquiDesc:"",Mspt:M[D].Eqpnt,MsptDesc:"",doc:M[D].Dokargprt,docDesc:"",docType:M[D].Doknrgprt,docTypeDesc:"",docPart:M[D].Doktlgprt,docVersion:M[D].Dokvrgprt,Othr:M[D].Fhmnr,OthrDesc:"",Qty:M[D].Mgvgw,UOM:M[D].Mgeinh,QtyFrmla:M[D].Mgform,PRTCtrl:M[D].Steuf,PRTCtrlDesc:M[D].Stftxt,StdUsgVal:M[D].Ewvgw,StdUsgUOM:M[D].Eweinh,UsgValFrmla:M[D].Ewform,PRTVS:"None",PlantVS:"None",QtyVS:"None",UOMVS:"None",QtyFrmlaVS:"None",PRTCtrlVS:"None",StdUsgValVS:"None",StdUsgUOMVS:"None",UsgValFrmlaVS:"None"};if(x.ItmCat==="M"){x.PRT=x.Mat;x.title="Material";x.matEnable=true;x.eqEnable=false;x.msptEnable=false;x.docEnable=false;x.othEnable=false;x.Plant=v[C].Werks}else if(x.ItmCat==="E"){x.PRT=x.Equi;x.title="Equipment";x.matEnable=false;x.eqEnable=true;x.msptEnable=false;x.docEnable=false;x.othEnable=false}else if(x.ItmCat==="P"){x.PRT=x.Mspt;x.title="Measuring Point";x.matEnable=false;x.eqEnable=false;x.msptEnable=true;x.docEnable=false;x.othEnable=false}else if(x.ItmCat==="D"){x.PRT=x.doc+"-"+x.docType+"-"+x.docPart+"-"+x.docVersion;x.title="Document";x.matEnable=false;x.eqEnable=false;x.msptEnable=false;x.docEnable=true;x.othEnable=false;x.docType="";x.docTypeDesc="";x.docPart="";x.docVersion=""}else if(x.ItmCat==="O"){x.PRT=x.Othr;x.title="Others";x.matEnable=false;x.eqEnable=false;x.msptEnable=false;x.docEnable=false;x.othEnable=true}v[C].PRT.push(x)}}}if(T.length>0){for(var D in T){if(e.currentObj.grp===T[D].Tlgnhdr&&v[C].Plnal===T[D].Tplnal&&e.currentObj.operation[C].Vornr===T[D].Vornrgins){var y={group:T[D].Tlgnhdr,Plnal:T[D].Tplnal,Vornr:T[D].Vornrgins,InspChar:T[D].Merknr,PrstInd:T[D].Vste2gins,QuanChar:a.statusSel(T[D].Quantitat),QualChar:a.statusSel(T[D].QpmkRef),MastInspChar:T[D].Verw2gins,Plant:T[D].Uzae2tlgn,Version:T[D].Ver2tlgni,ShrtTxt:T[D].Kurztext,InspMthd:T[D].Pmth2gins,InspMthdPlnt:T[D].Qwe2tlgni,TolKey:T[D].Toleranzs,VrsnInspMthd:T[D].Pmtversio,SampProc:T[D].Stichprve,SampUOM:T[D].Probemgeh,BaseSampQty:T[D].Pruefeinh.toString(),CodeGrp:T[D].Auswmenge,MastInspCharVS:"None",PlantVS:"None",VersionVS:"None",InspMthdVS:"None",InspMthdPlntVS:"None",SampProcVS:"None"};v[C].InspChar.push(y)}}}var j=[];if(P.length>0){for(var E in P){if(e.currentObj.grp===P[E].Tlgnhdr&&v[C].Plnal===P[E].Tplnal){j.push(P[E])}}}var I=[];if(S.length>0){for(var D in S){if(e.currentObj.grp===S[D].Tlgnhdr&&v[C].Plnal===S[D].Tplnal&&v[C].Vornr===S[D].Vorn2gmpk){I.push(S[D])}}}var k={};if(j.length>0){k={Plnal:j[0].Tplnal,Vornr:v[C].Vornr,Strat:j[0].Startgmpk,SOp:"",Ltxa1:v[C].Ltxa1,flag:j[0].Tplnal+"-"+v[C].Vornr,MPArr:[]};for(var N in j){var A=j[N];k[A.Paketgmpk]=false}}if(I.length>0){for(var H in I){I[H].Vornr=I[H].Vorn2gmpk;I[H].Strat=I[H].Startgmpk;I[H].Paket=I[H].Paketgmpk;I[H].MPEnable=true;var F=I[H];if(I[H].IsSelected==="X"){k[F.Paketgmpk]=true}}k.MPArr=I}e.currentObj.MaintPckg.push(k)}e.oData=v;var L=new sap.ui.model.json.JSONModel;L.setData(v);e.getModel("tlDetailModel").setProperty("/lOperation",v);e.getModel("tlDetailModel").setProperty("/bAddOperation",true)}i=r.GTComp.results;if(i.length>0){for(var R=0;R<i.length;R++){i[R].matDesc=i[R].Maktx;i[R].slNo=R+1;i[R].flag=i[R].Plnal+"-"+i[R].Vornr+"-"+i[R].slNo;i[R].hFlag=i[R].Plnal+"-"+i[R].Vornr}e.cmpData=i;o=new sap.ui.model.json.JSONModel;o.setData(i);e.getModel("tlDetailModel").setProperty("/lComponent",i)}p=r.GTClass.results;if(p){if(p.length>0){for(var q=0;q<p.length;q++){p[q].ctEnable=false;p[q].classEnable=false;p[q].ClassTypeDesc=p[q].Artxt;delete p[q].Artxt;delete p[q].Changerequestid;delete p[q].Clint;delete p[q].Service;p[q].classDelEnable=true;p[q].slNo=q+1;p[q].flag=p[q].Plnal+"-"+p[q].slNo}if(e.lockMsg==="true"){for(var q=0;q<p.length;q++){p[q].classDelEnable=false}}e.cData=p;d=new sap.ui.model.json.JSONModel;d.setData(p);e.class.setModel(d)}}u=r.GTVal.results;if(u){if(u.length>0){for(var U=0;U<u.length;U++){u[U].cNameEnable=false;u[U].Textbz=u[U].Atwtb;delete u[U].Ataut;delete u[U].Ataw1;delete u[U].Atawe;delete u[U].Atcod;delete u[U].Atflb;delete u[U].Atflv;delete u[U].Atimb;delete u[U].Atsrt;delete u[U].Atvglart;delete u[U].Atzis;delete u[U].Changerequestid;delete u[U].CharName;delete u[U].Charid;delete u[U].Classtype;delete u[U].Service;delete u[U].Valcnt;u[U].slNo=U+1;u[U].flag=u[U].Plnal+"-"+u[U].Class+"-"+u[U].slNo}if(e.lockMsg==="true"){for(var q=0;q<u.length;q++){u[q].charAddEnable=false;u[q].charClrEnable=false;u[q].charDltEnable=false}}else{for(var H=0;H<u.length;H++){var W=1;for(var B=0;B<u.length;B++){if(H===B){continue}if(u[B].Atnam===u[H].Atnam&&u[B].Class===u[H].Class){W++}}if(W>1){u[H].charDltEnable=true}else{u[H].charDltEnable=false}if(u[H].Atein===true){u[H].charAddEnable=false}}}e.chData=u;c=new sap.ui.model.json.JSONModel;c.setData(u);e.char.setModel(c)}}}}else if(e.tlType==="E"){if(r.ETList.results.length>0){var g=r.ETList.results[0];e.currentObj={validFrm:e.getDateFormat(g.Datuv),grp:t.results[0].Plnnr,vEquiLbl:true,vEqui:true,vEquiDesc:true,equipment:g.Equnr,equipmentDesc:g.Eqktx,vFlocLbl:false,vFloc:false,vFlocDesc:false,bAddComponent:true,mode:"change",MaintPckg:[],KDenable:false};l.setData(e.currentObj);var h=r.ETList.results;if(h.length>0){for(var m=0;m<h.length;m++){h[m].pPlantDesc=h[m].Iwerktxt;h[m].usageDesc=h[m].TlUsgTxt;h[m].plGrpDesc=h[m].Plnnrgrptxt;h[m].statusDesc=h[m].Statustxt;h[m].sysCondDesc=h[m].Anlzux;h[m].stratDesc=h[m].Strattxt;h[m].Plnal=h[m].Tplnal;h[m].Verwe=h[m].Tverwe;h[m].plEnable=false;h[m].equiEnb=false;h[m].vEquiLbl=true;h[m].vEqui=true;h[m].vEquiDesc=true;h[m].equipment=g.Equnr;h[m].equipmentDesc=g.Eqktx;h[m].vFlocLbl=false;h[m].vFloc=false;h[m].vFlocDesc=false;h[m].Ktext=g.Eqktx;h[m].valueStateT="None";h[m].valueStatePP="None";h[m].valueStateU="None";h[m].valueStateS="None";h[m].tlusg=h[m].Tverwe;h[m].Iwerk=h[m].Werks;h[m].wc=h[m].Tarbpl;h[m].plant=h[m].Wcplant;h[m].grp=h[m].Tlgnhdr;h[m].insPt=h[m].Slwbez;h[m].insPtDesc=h[m].Slwbeztxt}var f=new sap.ui.model.json.JSONModel;f.setData(h);e.getModel("tlDetailModel").setProperty("/lHeader",h[s])}var v=r.ETOprs.results;if(v.length>0){var b=r.ETRel.results;var O=r.ETSpack.results;var S=r.ETMPack.results;var P=r.ETMpackRead.results;var M=r.ETPRT.results;var T=r.ETInsp.results;for(var C=0;C<v.length;C++){v[C].calcKeyDesc="";v[C].actTypDesc="";v[C].flag=v[C].Plnal+"-"+v[C].Vornr;v[C].Arbpl=v[C].TlArbpl;v[C].Plnal=v[C].Tplnal;v[C].opState="None";v[C].opDescState="None";v[C].wcValueState="None";v[C].plantState="None";v[C].ctrlKeyState="None";v[C].Werks=v[C].Werks2eop;v[C].Steus=v[C].Steus2eop;v[C].workPerc=v[C].Prznt.toString();v[C].orderQty=v[C].Bmvrg;v[C].ordQtyUnit=v[C].Bmeih;v[C].netPrice=v[C].Opreis;v[C].currency=v[C].Owaers;v[C].priceUnit=v[C].Opeinh;v[C].costElement=v[C].Sakto2eop;v[C].materialGrp=v[C].Omatkl;v[C].puchGroup=v[C].Oekgrp;v[C].purchOrg=v[C].Ekorg;v[C].Uvorn=v[C].Uvorn;v[C].equi=v[C].EqunrEop;v[C].floc=v[C].TplnrEop;v[C].UvornEnable=false;v[C].OprRel=[];v[C].SrvPckgOvrw=[];v[C].PRT=[];v[C].InspChar=[];if(b.length>0){for(var D in b){if(e.currentObj.grp===b[D].Tleqhdr&&v[C].Plnal===b[D].Tplnal&&etlData.operation[C].Vornr===b[D].Vorn2){var w={Plnal:b[D].Tplnal,Vornr:b[D].Vorn2,OperationOR:b[D].Vornrerel,Offset:b[D].Dauer,OUn:b[D].Zeinh,RelType:b[D].Aobar,PO:b[D].Eprznt,OI:b[D].Provg,ID:b[D].Ekalid,WrkCtrOR:b[D].Arbplerel,PlantOR:b[D].Werkserel,OperationORVS:"None",OffsetVS:"None",OUnVS:"None",RelTypeVS:"None",POVS:"None",OIVS:"None",IDVS:"None",WrkCtrORVS:"None",PlantORVS:"None"};v[C].OprRel.push(w)}}}if(O.length>0){for(var D in O){if(e.currentObj.grp===O[D].Tleqhdr&&v[C].Plnal===O[D].Tplnal&&v[C].Vornr===O[D].Vornrr){var V={group:O[D].Tleqhdr,Plnal:O[D].Tplnal,Vornr:O[D].Vornrr,LineNum:O[D].SrvLine,DelIndSP:a.statusSel(O[D].Del),ActNum:O[D].Srvpos,ShrtTxt:O[D].Ktext1,Qty:O[D].Mengeespk,BUomSP:O[D].Meinsespk,GrossPrc:O[D].Tbtwr,CurKey:O[D].Waersespk,Work:O[D].IntWork,UnitOfWork:O[D].Iwein,ActNumVS:"None",ShrtTxtVS:"None",QtyVS:"None",BUomSPVS:"None",GrossPrcVS:"None",CurKeyVS:"None",WorkVS:"None",UnitOfWorkVS:"None",DelIndSPEnabled:false,SPEnabled:true};v[C].SrvPckgOvrw.push(V)}}}if(M.length>0){for(var D in M){if(e.currentObj.grp===M[D].Tleqhdr&&v[C].Plnal===M[D].Tplnal&&v[C].Vornr===M[D].Vornreprt){var x={grp:M[D].Tleqhdr,Plnal:M[D].Tplnal,Vornr:M[D].Vornreprt,ItmNum:M[D].Psnfh,ItmCat:M[D].Fhmar,Plant:M[D].Fhwrk,Mat:M[D].Matnreprt,MatDesc:"",Equi:M[D].EqunrEpt,EquiDesc:"",Mspt:M[D].Eqpnt,MsptDesc:"",doc:M[D].Dokareprt,docDesc:"",docType:M[D].Doknreprt,docTypeDesc:"",docPart:M[D].Doktleprt,docVersion:M[D].Dokvreprt,Othr:M[D].Fhmnr,OthrDesc:"",Qty:M[D].Mgvgw,UOM:M[D].Mgeinh,QtyFrmla:M[D].Mgform,PRTCtrl:M[D].Steuf,PRTCtrlDesc:M[D].Stftxt,StdUsgVal:M[D].Ewvgw,StdUsgUOM:M[D].Eweinh,UsgValFrmla:M[D].Ewform,PRTVS:"None",PlantVS:"None",QtyVS:"None",UOMVS:"None",QtyFrmlaVS:"None",PRTCtrlVS:"None",StdUsgValVS:"None",StdUsgUOMVS:"None",UsgValFrmlaVS:"None"};if(x.ItmCat==="M"){x.PRT=x.Mat;x.title="Material";x.matEnable=true;x.eqEnable=false;x.msptEnable=false;x.docEnable=false;x.othEnable=false;x.Plant=v[C].Werks}else if(x.ItmCat==="E"){x.PRT=x.Equi;x.title="Equipment";x.matEnable=false;x.eqEnable=true;x.msptEnable=false;x.docEnable=false;x.othEnable=false}else if(x.ItmCat==="P"){x.PRT=x.Mspt;x.title="Measuring Point";x.matEnable=false;x.eqEnable=false;x.msptEnable=true;x.docEnable=false;x.othEnable=false}else if(x.ItmCat==="D"){x.PRT=x.doc+"-"+x.docType+"-"+x.docPart+"-"+x.docVersion;x.title="Document";x.matEnable=false;x.eqEnable=false;x.msptEnable=false;x.docEnable=true;x.othEnable=false;x.docType="";x.docTypeDesc="";x.docPart="";x.docVersion=""}else if(x.ItmCat==="O"){x.PRT=x.Othr;x.title="Others";x.matEnable=false;x.eqEnable=false;x.msptEnable=false;x.docEnable=false;x.othEnable=true}v[C].PRT.push(x)}}}if(T.length>0){for(var D in T){if(e.currentObj.grp===T[D].Tleqhdr&&v[C].Plnal===T[D].Tplnal&&v[C].Vornr===T[D].Vornreins){var y={group:T[D].Tlgnhdr,Plnal:T[D].Tplnal,Vornr:T[D].Vornreins,InspChar:T[D].Merknr,PrstInd:T[D].Vste2eins,QuanChar:a.statusSel(T[D].Quantitat),QualChar:a.statusSel(T[D].QpmkRef),MastInspChar:T[D].Verw2eins,Plant:T[D].Uzae2tlen,Version:T[D].Ver2tleqi,ShrtTxt:T[D].Kurztext,InspMthd:T[D].Pmth2eins,InspMthdPlnt:T[D].Qwe2tleqi,TolKey:T[D].Toleranzs,VrsnInspMthd:T[D].Pmtversio,SampProc:T[D].Stichprve,SampUOM:T[D].Probemgeh,BaseSampQty:T[D].Pruefeinh.toString(),CodeGrp:T[D].Auswmenge,MastInspCharVS:"None",PlantVS:"None",VersionVS:"None",InspMthdVS:"None",InspMthdPlntVS:"None",SampProcVS:"None"};v[C].InspChar.push(y)}}}var j=[];if(P.length>0){for(var E in P){if(e.currentObj.grp===P[E].Tleqhdr&&v[C].Plnal===P[E].Tplnal){j.push(P[E])}}}var I=[];if(S.length>0){for(var D in S){if(e.currentObj.grp===S[D].Tleqhdr&&v[C].Plnal===S[D].Tplnal&&v[C].Vornr===S[D].Vorn2empk){I.push(S[D])}}}var k={};if(j.length>0){k={Plnal:j[0].Tplnal,Vornr:v[C].Vornr,Strat:j[0].Startempk,SOp:"",Ltxa1:v[C].Ltxa1,flag:j[0].Tplnal+"-"+v[C].Vornr,MPArr:[]};for(var N in j){var A=j[N];k[A.Paketempk]=false}}if(I.length>0){for(var H in I){I[H].Vornr=I[H].Vorn2empk;I[H].Strat=I[H].Startempk;I[H].Paket=I[H].Paketempk;I[H].MPEnable=true;var F=I[H];if(I[H].IsSelected==="X"){k[F.Paketempk]=true}}k.MPArr=I}e.currentObj.MaintPckg.push(k)}e.oData=v;var L=new sap.ui.model.json.JSONModel;L.setData(v);e.getModel("tlDetailModel").setProperty("/lOperation",v);e.getModel("tlDetailModel").setProperty("/bAddOperation",true)}}i=r.ETComp.results;if(i.length>0){for(var K=0;K<i.length;K++){i[K].matDesc=i[K].Maktx;i[K].slNo=K+1;i[K].flag=i[K].Plnal+"-"+i[K].Vornr+"-"+i[K].slNo;i[K].hFlag=i[K].Plnal+"-"+i[K].Vornr}e.cmpData=i;o=new sap.ui.model.json.JSONModel;o.setData(i);e.getModel("tlDetailModel").setProperty("/lComponent",i)}p=r.ETClass.results;if(p){if(p.length>0){for(var q=0;q<p.length;q++){p[q].ctEnable=false;p[q].classEnable=false;p[q].ClassTypeDesc=p[q].Artxt;delete p[q].Artxt;sClassList[q].ClassDesc=sClassList[q].Kltxt;delete sClassList[q].Kltxt;delete p[q].Changerequestid;delete p[q].Clint;delete p[q].Service;p[q].classDelEnable=true;p[q].slNo=q+1;p[q].flag=p[q].Plnal+"-"+p[q].slNo}if(e.lockMsg==="true"){for(var q=0;q<p.length;q++){p[q].classDelEnable=false}}e.cData=p;d=new sap.ui.model.json.JSONModel;d.setData(p);e.class.setModel(d)}}u=r.ETVal.results;if(u){if(u.length>0){for(var U=0;U<u.length;U++){u[U].cNameEnable=false;u[U].Textbz=u[U].Atwtb;delete u[U].Ataut;delete u[U].Ataw1;delete u[U].Atawe;delete u[U].Atcod;delete u[U].Atflb;delete u[U].Atflv;delete u[U].Atimb;delete u[U].Atsrt;delete u[U].Atvglart;delete u[U].Atzis;delete u[U].Changerequestid;delete u[U].CharName;delete u[U].Charid;delete u[U].Classtype;delete u[U].Service;delete u[U].Valcnt;u[U].slNo=U+1;u[U].flag=u[U].Plnal+"-"+u[U].Class+"-"+u[U].slNo}if(e.lockMsg==="true"){for(var q=0;q<u.length;q++){u[q].charAddEnable=false;u[q].charClrEnable=false;u[q].charDltEnable=false}}else{for(var H=0;H<u.length;H++){var W=1;for(var B=0;B<u.length;B++){if(H===B){continue}if(u[B].Atnam===u[H].Atnam&&u[B].Class===u[H].Class){W++}}if(W>1){u[H].charDltEnable=true}else{u[H].charDltEnable=false}if(u[H].Atein===true){u[H].charAddEnable=false}}}e.chData=u;c=new sap.ui.model.json.JSONModel;c.setData(u);e.char.setModel(c)}}}else if(e.tlType==="T"){if(r.FTList.results.length>0){var g=r.FTList.results[0];e.currentObj={validFrm:e.getDateFormat(g.Datuv),grp:t.results[0].Plnnr,vEquiLbl:false,vEqui:false,vEquiDesc:false,floc:g.Tplnr,flocDesc:g.Pltxt,vFlocLbl:true,vFloc:true,vFlocDesc:true,bAddComponent:true,mode:"change",MaintPckg:[],KDenable:false};l.setData(e.currentObj);var h=r.FTList.results;if(h.length>0){for(var m=0;m<h.length;m++){h[m].pPlantDesc=h[m].Iwerktxt;h[m].usageDesc=h[m].TlUsgTxt;h[m].plGrpDesc=h[m].Plnnrgrptxt;h[m].statusDesc=h[m].Statustxt;h[m].sysCondDesc=h[m].Anlzux;h[m].stratDesc=h[m].Strattxt;h[m].Plnal=h[m].Tplnal;h[m].Verwe=h[m].Tverwe;h[m].plEnable=false;h[m].vEquiLbl=false;h[m].vEqui=false;h[m].vEquiDesc=false;h[m].floc=g.Tplnr;h[m].flocDesc=g.Pltxt;h[m].vFlocLbl=false;h[m].flocEnb=false;h[m].vFloc=false;h[m].vFlocDesc=false;h[m].Ktext=g.Pltxt;h[m].valueStateT="None";h[m].valueStatePP="None";h[m].valueStateU="None";h[m].valueStateS="None";h[m].tlusg=h[m].Tverwe;h[m].Iwerk=h[m].Werks;h[m].wc=h[m].Tarbpl;h[m].plant=h[m].Wcplant;h[m].grp=h[m].Tlgnhdr;h[m].insPt=h[m].Slwbez;h[m].insPtDesc=h[m].Slwbeztxt}var f=new sap.ui.model.json.JSONModel;f.setData(h);e.getModel("tlDetailModel").setProperty("/lHeader",h[s])}var v=r.FTOprs.results;if(v.length>0){var b=r.FTRel.results;var O=r.FTSpack.results;var S=r.FTMPack.results;var P=r.FTMpackRead.results;var M=r.FTPRT.results;var T=r.FTInsp.results;for(var C=0;C<v.length;C++){v[C].calcKeyDesc="";v[C].actTypDesc="";v[C].flag=v[C].Plnal+"-"+v[C].Vornr;v[C].Arbpl=v[C].TlArbpl;v[C].Plnal=v[C].Tplnal;v[C].opState="None";v[C].opDescState="None";v[C].wcValueState="None";v[C].plantState="None";v[C].ctrlKeyState="None";v[C].Werks=v[C].Werks2fop;v[C].Steus=v[C].Steus2fop;v[C].workPerc=v[C].Prznt.toString();v[C].orderQty=v[C].Bmvrg;v[C].ordQtyUnit=v[C].Bmeih;v[C].netPrice=v[C].Opreis;v[C].currency=v[C].Owaers;v[C].priceUnit=v[C].Opeinh;v[C].costElement=v[C].Sakto2fop;v[C].materialGrp=v[C].Omatkl;v[C].puchGroup=v[C].Oekgrp;v[C].purchOrg=v[C].Ekorg;v[C].Uvorn=v[C].Uvorn;v[C].equi=v[C].EqunrFop;v[C].floc=v[C].TplnrFop;v[C].UvornEnable=false;v[C].OprRel=[];v[C].SrvPckgOvrw=[];v[C].PRT=[];v[C].InspChar=[];if(b.length>0){for(var D in b){if(e.currentObj.grp===b[D].Tlflhdr&&v[C].Plnal===b[D].Tplnal&&v[C].Vornr===b[D].Vorn2){var w={Plnal:b[D].Tplnal,Vornr:b[D].Vorn2,OperationOR:b[D].Vornrfrel,Offset:b[D].Dauer,OUn:b[D].Zeinh,RelType:b[D].Aobar,PO:b[D].Fprznt,OI:b[D].Provg,ID:b[D].Fkalid,WrkCtrOR:b[D].Arbplfrel,PlantOR:b[D].Werksfrel,OperationORVS:"None",OffsetVS:"None",OUnVS:"None",RelTypeVS:"None",POVS:"None",OIVS:"None",IDVS:"None",WrkCtrORVS:"None",PlantORVS:"None"};v[C].OprRel.push(w)}}}if(O.length>0){for(var D in O){if(e.currentObj.grp===O[D].Tlflhdr&&v[C].Plnal===O[D].Tplnal&&v[C].Vornr===O[D].Vornrr){var V={group:O[D].Tlflhdr,Plnal:O[D].Tplnal,Vornr:O[D].Vornrr,LineNum:O[D].SrvLine,DelIndSP:a.statusSel(O[D].Del),ActNum:O[D].Srvpos,ShrtTxt:O[D].Ktext1,Qty:O[D].Mengefspk,BUomSP:O[D].Meinsfspk,GrossPrc:O[D].Tbtwr,CurKey:O[D].Waersfspk,Work:O[D].IntWork,UnitOfWork:O[D].Iwein,ActNumVS:"None",ShrtTxtVS:"None",QtyVS:"None",BUomSPVS:"None",GrossPrcVS:"None",CurKeyVS:"None",WorkVS:"None",UnitOfWorkVS:"None",DelIndSPEnabled:false,SPEnabled:true};v[C].SrvPckgOvrw.push(V)}}}if(M.length>0){for(var D in M){if(e.currentObj.grp===M[D].Tlflhdr&&v[C].Plnal===M[D].Tplnal&&v[C].Vornr===M[D].Vornrfprt){var x={grp:M[D].Tlflhdr,Plnal:M[D].Tplnal,Vornr:M[D].Vornrfprt,ItmNum:M[D].Psnfh,ItmCat:M[D].Fhmar,Plant:M[D].Fhwrk,Mat:M[D].Matnrfprt,MatDesc:"",Equi:M[D].EqunrFpt,EquiDesc:"",Mspt:M[D].Eqpnt,MsptDesc:"",doc:M[D].Dokarfprt,docDesc:"",docType:M[D].Doknrfprt,docTypeDesc:"",docPart:M[D].Doktlfprt,docVersion:M[D].Dokvrfprt,Othr:M[D].Fhmnr,OthrDesc:"",Qty:M[D].Mgvgw,UOM:M[D].Mgeinh,QtyFrmla:M[D].Mgform,PRTCtrl:M[D].Steuf,PRTCtrlDesc:M[D].Stftxt,StdUsgVal:M[D].Ewvgw,StdUsgUOM:M[D].Eweinh,UsgValFrmla:M[D].Ewform,PRTVS:"None",PlantVS:"None",QtyVS:"None",UOMVS:"None",QtyFrmlaVS:"None",PRTCtrlVS:"None",StdUsgValVS:"None",StdUsgUOMVS:"None",UsgValFrmlaVS:"None"};if(x.ItmCat==="M"){x.PRT=x.Mat;x.title="Material";x.matEnable=true;x.eqEnable=false;x.msptEnable=false;x.docEnable=false;x.othEnable=false;x.Plant=v[C].Werks}else if(x.ItmCat==="E"){x.PRT=x.Equi;x.title="Equipment";x.matEnable=false;x.eqEnable=true;x.msptEnable=false;x.docEnable=false;x.othEnable=false}else if(x.ItmCat==="P"){x.PRT=x.Mspt;x.title="Measuring Point";x.matEnable=false;x.eqEnable=false;x.msptEnable=true;x.docEnable=false;x.othEnable=false}else if(x.ItmCat==="D"){x.PRT=x.doc+"-"+x.docType+"-"+x.docPart+"-"+x.docVersion;x.title="Document";x.matEnable=false;x.eqEnable=false;x.msptEnable=false;x.docEnable=true;x.othEnable=false;x.docType="";x.docTypeDesc="";x.docPart="";x.docVersion=""}else if(x.ItmCat==="O"){x.PRT=x.Othr;x.title="Others";x.matEnable=false;x.eqEnable=false;x.msptEnable=false;x.docEnable=false;x.othEnable=true}v[C].PRT.push(x)}}}if(T.length>0){for(var D in T){if(e.currentObj.grp===T[D].Tlflhdr&&v[C].Plnal===T[D].Tplnal&&v[C].Vornr===T[D].Vornrfins){var y={group:T[D].Tlflhdr,Plnal:T[D].Tplnal,Vornr:T[D].Vornrfins,InspChar:T[D].Merknr,PrstInd:T[D].Vste2fins,QuanChar:a.statusSel(T[D].Quantitat),QualChar:a.statusSel(T[D].QpmkRef),MastInspChar:T[D].Verw2fins,Plant:T[D].Uzae2tlfn,Version:T[D].Ver2tlfli,ShrtTxt:T[D].Kurztext,InspMthd:T[D].Pmth2fins,InspMthdPlnt:T[D].Qwe2tlfli,TolKey:T[D].Toleranzs,VrsnInspMthd:T[D].Pmtversio,SampProc:T[D].Stichprve,SampUOM:T[D].Probemgeh,BaseSampQty:T[D].Pruefeinh.toString(),CodeGrp:T[D].Auswmenge,MastInspCharVS:"None",PlantVS:"None",VersionVS:"None",InspMthdVS:"None",InspMthdPlntVS:"None",SampProcVS:"None"};v[C].InspChar.push(y)}}}var j=[];if(P.length>0){for(var E in P){if(e.currentObj.grp===P[E].Tlflhdr&&v[C].Plnal===P[E].Tplnal){j.push(P[E])}}}var I=[];if(S.length>0){for(var D in S){if(e.currentObj.grp===S[D].Tlflhdr&&v[C].Plnal===S[D].Tplnal&&v[C].Vornr===S[D].Vorn2fmpk){I.push(S[D])}}}var k={};if(j.length>0){k={Plnal:j[0].Tplnal,Vornr:v[C].Vornr,Strat:j[0].Startfmpk,SOp:"",Ltxa1:v[C].Ltxa1,flag:j[0].Tplnal+"-"+v[C].Vornr,MPArr:[]};for(var N in j){var A=j[N];k[A.Paketfmpk]=false}}if(I.length>0){for(var H in I){I[H].Vornr=I[H].Vorn2fmpk;I[H].Strat=I[H].Startfmpk;I[H].Paket=I[H].Paketfmpk;I[H].MPEnable=true;var F=I[H];if(I[H].IsSelected==="X"){k[F.Paketfmpk]=true}}k.MPArr=I}e.currentObj.MaintPckg.push(k)}e.oData=v;var L=new sap.ui.model.json.JSONModel;L.setData(v);e.getModel("tlDetailModel").setProperty("/lOperation",v);e.getModel("tlDetailModel").setProperty("/bAddOperation",true)}i=r.FTComp.results;if(i.length>0){for(var N=0;N<i.length;N++){i[N].matDesc=i[N].Maktx;i[N].slNo=K+1;i[N].flag=i[N].Plnal+"-"+i[N].Vornr+"-"+i[N].slNo;i[N].hFlag=i[N].Plnal+"-"+i[N].Vornr}e.cmpData=i;o=new sap.ui.model.json.JSONModel;o.setData(i);e.getModel("tlDetailModel").setProperty("/lComponent",i)}p=r.FTClass.results;if(p){if(p.length>0){for(var q=0;q<p.length;q++){p[q].ctEnable=false;p[q].classEnable=false;p[q].ClassTypeDesc=p[q].Artxt;delete p[q].Artxt;delete p[q].Changerequestid;delete p[q].Clint;delete p[q].Service;p[q].classDelEnable=true;p[q].slNo=q+1;p[q].flag=p[q].Plnal+"-"+p[q].slNo}if(e.lockMsg==="true"){for(var q=0;q<p.length;q++){p[q].classDelEnable=false}}e.cData=p;d=new sap.ui.model.json.JSONModel;d.setData(p);e.class.setModel(d)}}u=r.FTVal.results;if(u){if(u.length>0){for(var U=0;U<u.length;U++){u[U].cNameEnable=false;u[U].Textbz=u[U].Atwtb;delete u[U].Ataut;delete u[U].Ataw1;delete u[U].Atawe;delete u[U].Atcod;delete u[U].Atflb;delete u[U].Atflv;delete u[U].Atimb;delete u[U].Atsrt;delete u[U].Atvglart;delete u[U].Atzis;delete u[U].Changerequestid;delete u[U].CharName;delete u[U].Charid;delete u[U].Classtype;delete u[U].Service;delete u[U].Valcnt;u[U].slNo=U+1;u[U].flag=u[U].Plnal+"-"+u[U].Class+"-"+u[U].slNo}if(e.lockMsg==="true"){for(var q=0;q<u.length;q++){u[q].charAddEnable=false;u[q].charClrEnable=false;u[q].charDltEnable=false}}else{for(var H=0;H<u.length;H++){var W=1;for(var B=0;B<u.length;B++){if(H===B){continue}if(u[B].Atnam===u[H].Atnam&&u[B].Class===u[H].Class){W++}}if(W>1){u[H].charDltEnable=true}else{u[H].charDltEnable=false}if(u[H].Atein===true){u[H].charAddEnable=false}}}e.chData=u;c=new sap.ui.model.json.JSONModel;c.setData(u);e.char.setModel(c)}}}}if(this.status==="true"||this.lockMsg===true){e.disableFields()}else{e.enableFields()}e.getView().setModel(l,"tlDetailModel")}},error:function(e){}})},getDateFormat:function(e){if(e!==""&&e!==null){var t="";var r=new Date(e);var a=r.getFullYear();var l=r.getMonth();if(l<10){l=l+1;if(l.length===1){l="0"+l}}else{l=l+1}var n=r.getDate();if(n<10){n="0"+n}var s=r.getHours();if(s<10){s="0"+s}var i=r.getMinutes();if(i<10){i="0"+i}var o=r.getSeconds();if(o<10){o="0"+o}t=l+"/"+n+"/"+a;return t}else if(e===null){return""}},disableFields:function(){var e={enable:false};var t=new sap.ui.model.json.JSONModel;t.setData(e);this.getView().setModel(t,"main");this.currentObj={bAddHeader:false,bAddComponent:false,bAddOperation:false,bAddOprRel:false,bAddSrvOpOrvw:false,bAddPRT:false,bAddInspChar:false};this.getView().byId("operationTab").setMode("None");this.getView().byId("components").setMode("None");this.getModel("tlDetailModel").setData(this.currentObj)},enableFields:function(){var e=this;var t={enable:true};var r=new sap.ui.model.json.JSONModel;r.setData(t);this.getView().setModel(r,"main");this.getModel("tlDetailModel").setProperty("/bAddHeader",true);var a=this.getModel("tlDetailModel").getProperty("/operation");if(a!==undefined&&a!==null){if(a.length>0){this.getModel("tlDetailModel").setProperty("/bAddComponent",true)}}else{this.getModel("tlDetailModel").setProperty("/bAddComponent",false)}this.getModel("tlDetailModel").setProperty("/bAddOperation",true);this.getView().byId("operationTab").setMode("SingleSelectLeft");this.getView().byId("components").setMode("Delete")},addOperation:function(){var e=this;var t=e.getView().getModel("tlDetailModel");var r=t.getData();var a=new sap.ui.model.json.JSONModel;var l=t.getProperty("/lOperation");if(l&&l.length>0){a.setData(l)}var n=e.getView().getModel("tlDetailModel").getProperty("/lHeader");var s,i,l,o;if(a===undefined||l===undefined||l.length===0){o="0010";var l=[];var p={Vornr:o,VornrEnable:false,VornrVS:"None",Uvorn:"",UvornEnable:false,UvornVS:"None",Ltxa1:"",Arbpl:n.wc,Werks:n.plant,Steus:this.ctrlKey,plantDesc:"",ctrlkeyDesc:"",Arbei:"0.0",WorkEnable:true,Arbeh:"",WcZeiwn:"",Anzzl:0,Dauno:"0.0",Daune:"",Indet:"",calcKeyDesc:"",Lar01:e.ActivityType,Larnt:e.ActivityType,actTypDesc:"",Plnal:this.grpCounter,opState:"None",opDescState:"None",wcValueState:"None",plantState:"None",ctrlKeyState:"None",flag:this.grpCounter+"-"+o,workPerc:"",workPercVS:"None",orderQty:"",orderQtyVS:"None",ordQtyUnit:"",orderQtyUnitVS:"None",netPrice:"",netPriceVS:"None",currency:"EUR",currencyVS:"None",priceUnit:"",costElement:"",costElementVS:"None",materialGrp:"",materialGrpVS:"None",puchGroup:"",puchGroupVS:"None",purchOrg:"",purchOrgVS:"None",equi:"",equiDesc:"",floc:"",flocDesc:"",equiVS:"None",flocVS:"None",OprRel:[],SrvPckgOvrw:[],PRT:[],InspChar:[]};l.push(p);a.setData(l);e.getModel("tlDetailModel").setProperty("/lOperation",l);this.getView().byId("operationTab").setSelectedItem(this.getView().byId("operationTab").getItems()[0],true,true)}else{l=a.getData();var u=l.length-1;s=n.wc;i=n.plant;var d=l[u].Vornr;var c=parseInt(d)+10;while(c.toString().length<4){c="0"+c}p={Vornr:c,VornrEnable:false,VornrVS:"None",Uvorn:"",UvornEnable:true,UvornVS:"None",Ltxa1:"",Arbpl:s,Werks:i,Steus:this.ctrlKey,plantDesc:"",ctrlkeyDesc:"",Arbei:"0.0",WorkEnable:true,WcZeiwn:"",Anzzl:0,Dauno:"0.0",Arbeh:"",Daune:"",Indet:"",Plnal:this.grpCounter,calcKeyDesc:"",Lar01:e.ActivityType,Larnt:e.ActivityType,actTypDesc:"",opState:"None",opDescState:"None",wcValueState:"None",plantState:"None",ctrlKeyState:"None",flag:this.grpCounter+"-"+c,workPerc:"",workPercVS:"None",orderQty:"",orderQtyVS:"None",ordQtyUnit:"",orderQtyUnitVS:"None",netPrice:"",netPriceVS:"None",currency:"EUR",currencyVS:"None",priceUnit:"",costElement:"",costElementVS:"None",materialGrp:"",materialGrpVS:"None",puchGroup:"",puchGroupVS:"None",purchOrg:"",purchOrgVS:"None",OprRel:[],SrvPckgOvrw:[],PRT:[],InspChar:[]};l.push(p);a.setData(l);e.getModel("tlDetailModel").setProperty("/lOperation",l);this.getView().byId("operationTab").setSelectedItem(this.getView().byId("operationTab").getItems()[l.length-1],true,true)}if(r.lHeader.Strat!==""){this.createMaintPckgData(p)}r.bAddComponent=true;r.lHeader.bAddOprRel=true;r.lHeader.bAddSrvOpOrvw=false;r.lHeader.bAddPRT=true;r.lHeader.bAddInspChar=false;if(r.lHeader.insPt!==""){r.lHeader.bAddInspChar=true}t.setData(r);this.getView().setModel(t,"tlDetailModel");this.getView().byId("operationTab").setModel(t,"tlDetailModel");sap.ui.getCore().setModel(t,"tlDetailModel");if(this.action.indexOf("ETL")>-1){this.DeriveEquiFlocData(r.lHeader.equipment,"E")}if(this.action.indexOf("FTL")>-1){this.DeriveEquiFlocData(r.lHeader.floc,"F")}},addComponent:function(){var e=this;var t=e.getModel("tlDetailModel");var r=t.getData();var a=new sap.ui.model.json.JSONModel;var l=e.getModel("tlDetailModel").getProperty("/lComponent");if(l&&l.length>0){a.setData(l)}var n;if(a===undefined||a===null||l===undefined||l.length===0){n="1";var s=[{Idnrk:"",matDesc:"",Menge:"",MeinsGcp:"",Postp:this.itemCat,Plnal:this.grpCounter,Vornr:this.opNum,matState:"None",qtyState:"None",qtyUnitState:"None",categoryState:"None",slNo:n,flag:this.grpCounter+"-"+this.opNum+"-"+n,hFlag:this.grpCounter+"-"+this.opNum,group:r.grp,groupCounter:this.grpCounter,activity:this.opNum,cmpCompEnable:true,cmpEnable:true,cmpVisible:false}];a.setData(s);e.getModel("tlDetailModel").setProperty("/lComponent",s);var i=[];if(this.cmpData===null){this.cmpData=s}else if(this.cmpData.length===0){this.cmpData=s}else{if(s!==undefined){if(this.cmpData!==null){for(var o=0;o<s.length;o++){for(var p=0;p<this.cmpData.length;p++){if(s[o].hFlag!==this.cmpData[p].hFlag){var u=s;u[o].flag=this.grpCounter+"-"+this.opNum+"-"+s[o].Idnrk;u[o].hFlag=this.grpCounter+"-"+this.opNum;i.push(u[o])}}}}}if(this.cmpData!==null){Array.prototype.push.apply(this.cmpData,i)}}}else{n=l.length+1;n=n.toString();s={Idnrk:"",matDesc:"",Menge:"",MeinsGcp:"",Vornr:this.opNum,Postp:this.itemCat,Plnal:this.grpCounter,matState:"None",qtyState:"None",qtyUnitState:"None",categoryState:"None",slNo:n,flag:this.grpCounter+"-"+this.opNum+"-"+n,hFlag:this.grpCounter+"-"+this.opNum,group:r.grp,groupCounter:this.grpCounter,activity:this.opNum,cmpCompEnable:true,cmpEnable:true,cmpVisible:false};l.push(s);a.setData(l);var i=[];e.getModel("tlDetailModel").setProperty("/lComponent",l);if(this.cmpData!==null){var d=l;for(var o=0;o<d.length;o++){for(var p=0;p<this.cmpData.length;p++){if(d[o].hFlag!==this.cmpData[p].hFlag){var u=d;u[o].flag=this.grpCounter+"-"+this.opNum+"-"+d[o].Idnrk;u[o].hFlag=this.grpCounter+"-"+this.opNum;i.push(u[o])}}}if(this.cmpData!==null){Array.prototype.push.apply(this.cmpData,i)}}}t.setData(r);this.getView().setModel(t,"tlDetailModel");sap.ui.getCore().setModel(t,"tlDetailModel");this.getView().byId("components").getModel("tlDetailModel").refresh()},readObjectDetails:function(e,t,r){var a=this;var l;var n=a.getModel("tlDetailModel");var s=n.getData();var i=s.lHeader.equipment;var o=s.lHeader.floc;var p=[];var u=false;if(this.action.indexOf("ETL")>0){l="/EQUIP_FLOC_DataSet";var d=[new sap.ui.model.Filter("Equnr","EQ",i)]}else if(this.action.indexOf("FTL")>0){l="/EQUIP_FLOC_DataSet";var d=[new sap.ui.model.Filter("Tplnr","EQ",o)]}var c=new sap.ui.model.json.JSONModel;var g=new sap.ui.model.json.JSONModel;var h=a.getModel("tlDetailModel").getProperty("/header");if(h){c.setData(h)}var m;var f=true;var v="",b="",O="",S="",P="",M="";var T=this.getView().getModel();T.read(l,{filters:d,success:function(l){p=l.results[0];e.setEnabled(false);if(t==="add"){var i=p;a.objDetails=i;if(a.objDetails.Iwerk){v=a.objDetails.Iwerk}if(a.objDetails.Iwerktxt){b=a.objDetails.Iwerktxt}if(a.objDetails.StArbpl){O=a.objDetails.StArbpl}if(a.objDetails.Werks){S=a.objDetails.Werks}if(a.objDetails.Wctext){P=a.objDetails.Wctext}if(a.objDetails.Txtmi){M=a.objDetails.Txtmi}if(c===undefined||c.getData().length===0||c.getData()===null||h===undefined){m="1";var o=[{Plnal:m,Iwerk:v,Plnnr:"",Werks:S,Statu:"",statusDesc:"",Verwe:"",usageDesc:"",Ktext:M,KapArbpl:O,Vagrp:"",plGrpDesc:"",Anlzu:"",sysCondDesc:"",pPlantDesc:b,Strat:"",stratDesc:"",valueStatePP:"None",valueStateS:"None",valueStateU:"None",valueStateT:"None",plEnable:f,wcDesc:P}];c.setData(o);a.getModel("tlDetailModel").setProperty("/header",o)}else{var u=c.getData();m=c.length+1;m=m.toString();o={Plnal:m,Plnnr:"",Iwerk:v,Werks:S,Statu:"",statusDesc:"",Verwe:"",usageDesc:"",Ktext:M,KapArbpl:O,Vagrp:"",plGrpDesc:"",Anlzu:"",sysCondDesc:"",pPlantDesc:b,Strat:"",stratDesc:"",valueStatePP:"None",valueStateS:"None",valueStateU:"None",valueStateT:"None",plEnable:f,wcDesc:P};u.push(o);c.setData(u);a.getModel("tlDetailModel").setProperty("/header",u)}}else if(t==="showDet"){a.objDetails=p;v=a.objDetails.Iwerk;b=a.objDetails.Iwerktxt;O=a.objDetails.StArbpl;S=a.objDetails.Werks;P=a.objDetails.Wctext;M=a.objDetails.Txtmi;if(v===""){v="null"}if(b===""){b="null"}if(O===""){O="null"}if(S===""){S="null"}if(P===""){P="null"}if(M===""){M="null"}a.getRouter().navTo("tlHdrDetail",{action:this.action,mainPath:encodeURIComponent(this.mainPath),itemPath:encodeURIComponent(r),pPlant:v,mainWc:O,mainWcPlant:S,pPlantDesc:b,wcDesc:P,mode:this.mode})}n.setData(s);a.getView().setModel(n,"tlDetailModel")},error:function(t){e.setValueState("Error");var r=[];if(JSON.parse(t.responseText).error.innererror.errordetails===undefined||JSON.parse(t.responseText).error.innererror.errordetails.length===0){r[0]=JSON.parse(t.responseText).error.message.value}else{for(var l=0;l<JSON.parse(t.responseText).error.innererror.errordetails.length;l++){r[l]=JSON.parse(t.responseText).error.innererror.errordetails[l].message}}var n=r.join("\n");a.showMessage(n);e.setEnabled(true)}});return[p,u]},_showOperationDetail:function(e){var t=e.oBindingContexts.tlDetailModel.sPath;var r=this.getModel("tlDetailModel").getProperty("/header");var a=this.getModel("tlDetailModel").getProperty("/lOperation");var l=parseInt(t.substr(-1));var n,s;if(a[l]!==undefined){n=a[l].Arbpl}else{n=a[l-1].Arbpl}if(a[l]!==undefined){s=a[l].Werks}else{s=a[l-1].Werks}if(n===""||n===undefined){n="null"}if(s===""||s===undefined){s="null"}if(a[l].Steus){this.ctrlKey=a[l].Steus}var i={opDetFlag:true,opIndex:l.toString()};sap.ui.getCore().setModel(i,"oOpFlag");this.getRouter().navTo("tlOprDetail",{action:this.action,basicPath:encodeURIComponent(this.basicPath),mainPath:encodeURIComponent(this.mainPath),itemPath:encodeURIComponent(t),wc:n,wcPlant:s,ctrlKey:this.ctrlKey,mode:this.mode})},onOpItemPress:function(e){this._showOperationDetail(e.getSource())},onOperationSelect:function(e){var t=e.getParameter("listItem").getBindingContext("tlDetailModel").getPath();t=t.substring(t.lastIndexOf("/")+1);this.oIndex=t;var r=this.getModel("tlDetailModel");var a=r.getData();var l=this.getModel("tlDetailModel").getProperty("/lOperation");this.opGrpCounter=l[this.oIndex].Plnal;this.opNum=l[this.oIndex].Vornr;var n=this.getModel("tlDetailModel");if(n!==null){var s=n.getProperty("/lComponent");if(s!==undefined){for(var i=0;i<s.length;i++){if(!s[i].hasOwnProperty("flag")){s[i].flag=this.grpCounter+"-"+this.opNum+"-"+s[i].Idnrk;s[i].hFlag=this.grpCounter+"-"+this.opNum}}var o=[];if(this.cmpData===null){this.cmpData=n.getProperty("/lComponent")}else{if(s!==null&&this.cmpData!==null){for(var p=0;p<s.length;p++){for(var u=0;u<this.cmpData.length;u++){if(s[p].hFlag!==this.cmpData[u].hFlag){var d=s;o.push(d[p])}}}}if(this.cmpData!==null){Array.prototype.push.apply(this.cmpData,o);var c=[];this.cmpData=this.cmpData.filter(function(e){if(c.indexOf(e.flag)==-1){c.push(e.flag);return true}return false})}}var g=[];if(this.cmpData!==null){for(var h=0;h<this.cmpData.length;h++){var m=this.cmpData[h].flag;m=m.split("-");if(this.opNum===m[1]&&this.grpCounter.toString()===m[0]){g.push(this.cmpData[h])}}}var f=new sap.ui.model.json.JSONModel;f.setData(g);this.getModel("tlDetailModel").setProperty("/lComponent",g)}var v=a.lOperation[t].OprRel;a.lOprRel=v;var b=a.lOperation[t].SrvPckgOvrw;a.lSrvPckgOvrw=b;var O=a.lOperation[t].PRT;a.lPRT=O;var S=a.lOperation[t].InspChar;a.lInspChar=S}a.lHeader.bAddComponent=true;a.lHeader.bAddOprRel=true;a.lHeader.bAddPRT=true;if(l[this.oIndex].Steus==="PM03"||l[this.oIndex].Steus==="PM05"){a.lHeader.bAddSrvOpOrvw=true}else{a.lHeader.bAddSrvOpOrvw=false}if(a.lHeader.insPt!==""){a.lHeader.bAddInspChar=true}else{a.lHeader.bAddInspChar=false}r.setData(a);this.getView().byId("components").setModel(r,"tlDetailModel");this.getView().setModel(r,"tlDetailModel");sap.ui.getCore().setModel(r,"tlDetailModel")},deleteOperation:function(e){var t=e.getSource();var r=t.getBindingContext("tlDetailModel").getPath();r=r.substring(r.lastIndexOf("/")+1);var a=t.getModel("tlDetailModel");var l=a.getProperty("/operation");var n=a.getProperty("/lOperation");var s=n[r].Plnal;var i=n[r].Vornr;var o=this.getModel("tlDetailModel");var p=o.getData();var u=this.getModel("tlDetailModel");for(var d=0;d<n.length;d++){if(s===n[d].Plnal&&i===n[d].Vornr){n.splice(d,1)}}for(var d=0;d<l.length;d++){if(s===l[d].Plnal&&i===l[d].Vornr){l.splice(d,1)}}if(u!==null){var c=u.getProperty("/lComponent");if(c!==null&&c!==undefined){for(var g=0;g<c.length;g++){if(s===c[g].Plnal&&i===c[g].Vornr){c.splice(g,1)}}if(this.cmpData!==null&&this.cmpData!==undefined){for(var h=0;h<this.cmpData.length;h++){if(s===this.cmpData[h].Plnal&&i===this.cmpData[h].Vornr){this.cmpData.splice(h,1)}}}var m=new sap.ui.model.json.JSONModel;m.setData(c);this.getModel("tlDetailModel").setProperty("/lComponent",c)}}sap.ui.getCore().setModel(a,"tlDetailModel");if(n.length===0){p.lHeader.bAddComponent=false}else{p.lHeader.bAddComponent=true}this.oIndex=undefined;this.opGrpCounter="";this.opNum="";a.setProperty("/lOperation",n);this.getModel("tlDetailModel").setProperty("/lOperation",n)},deleteComponent:function(e){var t=e.getSource();var r=e.getParameter("listItem").getBindingContext("tlDetailModel").sPath;r=r.substring(r.lastIndexOf("/")+1);var a=t.getModel("tlDetailModel");var l=a.getProperty("/lComponent");l.splice(parseInt(r),1);a.setProperty("/lComponent",l);this.getModel("tlDetailModel").setProperty("/lComponent",l);this.matSelectDialog=undefined;this.matSearchResults=undefined},readHdrDefaults:function(e,t,r){var a=this;var l=this.getView().getModel();var n=[];var s=this.getView().getModel("tlDetailModel");var i="/ProfileDataSet";var o=[new sap.ui.model.Filter("Profidnetz","EQ","")];l.read(i,{filters:o,success:function(t){n=t.results[0];if(n){if(e==="planningPlant"){r.lHeader.tlusg=n.Verwe;r.lHeader.Statu=n.Statu;r.lHeader.usageDesc=n.Vtext;r.lHeader.statusDesc=n.Sttext}if(e==="status"){r.lHeader.tlusg=n.Verwe;r.lHeader.usageDesc=n.Vtext}if(e==="usage"){r.lHeader.Statu=n.Statu;r.lHeader.statusDesc=n.Sttext}if(e==="tlDesc"){r.lHeader.tlusg=n.Verwe;r.lHeader.Statu=n.Statu;r.lHeader.usageDesc=n.Vtext;r.lHeader.statusDesc=n.Sttext}s.setData(r);a.getView().setModel(s,"tlDetailModel")}},error:function(e){}})},deriveMatDetails:function(e,t){var r=this.getView().getModel();var a=[];var l="/MaterialDataSet";var n=this.getModel("tlDetailModel");var s=n.getData();var i=this;var o=[new sap.ui.model.Filter("Matnr","EQ",e),new sap.ui.model.Filter("Werks","EQ",t)];r.read(l,{filters:o,success:function(e){if(e.results.length>0){a=e.results;if(a.length>0){s.lComponent[i.index].Menge=a[0].Menge;s.lComponent[i.index].MeinsGcp=a[0].Meins;s.lComponent[i.index].Postp=a[0].Postp}n.setData(s);i.getView().setModel(n,"tlDetailModel");i.getView().byId("components").getModel("tlDetailModel").refresh()}},error:function(e){}});return a},isEmpty:function(e,t,r){var a=false;var l=false;var n=false;if(e){if(e.Iwerk===""||e.Ktext===""||e.tlusg===""||e.Statu===""){a=true}}if(e===undefined){a=true}if(t&&t.length>0){for(var s=0;s<t.length;s++){if(t[s].Vornr===""||t[s].Ltxa1===""||t[s].Arbpl===""||t[s].Werks===""||t[s].Steus===""){l=true}}}if(r&&r.length>0){for(var i=0;i<r.length;i++){if(r[i].Idnrk===""||r[i].Menge===""||r[i].MeinsGcp===""){n=true}}}return[a,l,n]},onDonePress:function(e){var t=true;var a=e.getSource().getId();var l=this.getView().getModel("tlDetailModel");var n=l.getProperty("/lHeader");var s=this.getView().byId("operationTab");if(s.getModel("tlDetailModel")){var i=s.getModel("tlDetailModel").getProperty("/lOperation");var o=[];if(l.getData().operation){o=l.getData().operation}for(var p=0;p<i.length;p++){o.push(i[p])}var u=[];o=o.filter(function(e){if(u.indexOf(e.flag)==-1){u.push(e.flag);return true}return false});l.setProperty("/operation",o)}if(this.cmpData){var d=[];this.cmpData=this.cmpData.filter(function(e){if(d.indexOf(e.flag)==-1){d.push(e.flag);return true}return false});var c=this.cmpData;if(c.length>0){this.getView().getModel("tlDetailModel").setProperty("/component",c);var g=c}}if(l.getData().lMaintPckg){for(var p=0;p<l.getData().lMaintPckg.length;p++){l.getData().MaintPckg.push(l.getData().lMaintPckg[p])}}if(l.getData().MaintPckg){var h=[];l.getData().MaintPckg=l.getData().MaintPckg.filter(function(e){if(h.indexOf(e.flag)==-1){h.push(e.flag);return true}return false})}var m=this.getView().byId("equipment");var f=this.getView().byId("floc");var v=false;var b=false;var O=this.isEmpty(n,i,g);var S=false;var P=this;if(this.action.indexOf("ETL")>0&&m.getValue()!==""){v=true}if(this.action.indexOf("FTL")>0&&f.getValue()!==""){b=true}if(O[0]===true||O[1]===true||O[2]===true||this.currentObj.validFrm===""){if(O[0]===true){if(this.currentObj.lHeader.Iwerk===""){this.currentObj.lHeader.planningPlantValueState="Error"}if(this.currentObj.lHeader.Ktext===""){this.currentObj.lHeader.descDtValueState="Error"}if(this.currentObj.lHeader.tlusg===""){this.currentObj.lHeader.usgValueState="Error"}if(this.currentObj.lHeader.Statu===""){this.currentObj.lHeader.statusVS="Error"}}if(this.currentObj.validFrm===""){this.currentObj.validFrmState="Error"}else{this.currentObj.validFrmState="None"}if(v===true){if(m.getValue()===""){m.setValueState("Error")}}if(b===true){if(f.getValue()===""){f.setValueState("Error")}}l.setData(this.currentObj);var M=this.getView().getModel("i18n").getProperty("MANDMSG");this.showMessage(M);return}else{var T=l.getData();if(T.Class){for(var p=T.Class.length-1;p>=0;p--){if(T.lHeader.Plnal===T.Class[p].Plnal){for(var C=T.Char.length-1;C>=0;C--){if(T.Char[C].Plnal===T.Class[p].Plnal&&T.Char[C].Class===T.Class[p].Class){T.Char.splice(C,1)}}T.Class.splice(p,1)}}}if(this.class.getModel()){var D=this.class.getModel().getData();if(D!==null&&D!==undefined){for(var w=0;w<D.length;w++){T.Class.push(D[w])}}l.setData(T)}if(this.chData){var V=this.chData;if(V!==null&&V!==undefined){for(var u=0;u<V.length;u++){V[u].Plnal=T.lHeader.Plnal;T.Char.push(V[u])}}l.setData(T)}if(a.indexOf("idBtnCheck")>-1){this.validateCheck(v,b);return}this.chData=[];if(this.status!==false){if(this.action==="changeGTL"){var x=l.getData();var y=sap.ui.getCore().getModel("AIWListGTLModel").getData();y.push(x);sap.ui.getCore().getModel("AIWListGTLModel").setData(y)}else if(this.action==="changeETL"){var j=l.getData();var E=sap.ui.getCore().getModel("AIWListETLModel").getData();E.push(j);sap.ui.getCore().getModel("AIWListETLModel").setData(E)}else if(this.action==="changeFTL"){var I=l.getData();var k=sap.ui.getCore().getModel("AIWListFTLModel").getData();k.push(I);sap.ui.getCore().getModel("AIWListFTLModel").setData(k)}}this.cmpData=[];var N=r.getInstance().getPreviousHash();if(N!==undefined){history.go(-1)}}},validateCheck:function(e,t){var r=this;var l=sap.ui.getCore().getModel("AIWFLOC").getData();var n=sap.ui.getCore().getModel("AIWEQUI").getData();var s=sap.ui.getCore().getModel("AIWListWCModel").getData();var i=r.getView().getModel("tlDetailModel").getData();var o=sap.ui.getCore().getModel("tempCrTypeModel").getData();var p={ChangeRequestType:o.crtype,CrDescription:o.desc,IsDraft:"C",Messages:[],FuncLoc:[],FLAddr:[],FLLAM:[],FLClass:[],FLVal:[],Equipment:[],EqAddr:[],EqPRT:[],EqLAM:[],EqClass:[],EqVal:[],MSPoint:[],MSLAM:[],MSClass:[],MSVal:[],MPLAN:[],MPItem:[],MPLAM:[],MPOBList:[],MPCycle:[],MRBHeader:[],MRBItem:[],MRBSBIT:[],EBHeader:[],EBItem:[],EBSBIT:[],FBHeader:[],FBItem:[],FBSBIT:[],WBHeader:[],WBItem:[],WBSBIT:[],ONetwork:[],ONLAM:[],Workcenter:[],WCCost:[],GTList:[],GTOprs:[],GTComp:[],GTMPack:[],GTRel:[],GTSpack:[],GTPRT:[],GTInsp:[],GTClass:[],GTVal:[],ETList:[],ETOprs:[],ETMPack:[],ETRel:[],ETSpack:[],ETPRT:[],ETInsp:[],ETComp:[],ETClass:[],ETVal:[],FTList:[],FTOprs:[],FTComp:[],FTMPack:[],FTRel:[],FTSpack:[],FTPRT:[],FTInsp:[],FTClass:[],FTVal:[],Olink:[],OLClass:[],OLVal:[]};if(l.length>0){for(var u=0;u<l.length;u++){var d={Tplnr:l[u].Functionallocation,Txtmi:l[u].Flocdescription,TplkzFlc:l[u].Strucindicator,Tplxt:l[u].StrucIndicatorDesc,EditMask:l[u].EditMask,Hierarchy:l[u].Hierarchy,Fltyp:l[u].Floccategory,Flttx:l[u].FlocCategoryDesc,Swerk:l[u].Maintplant,Plantname:l[u].MaintplantDesc,StorFloc:l[u].Location,Locationdesc:l[u].Locationdesc,Abckzfloc:l[u].Abckz,Abctx:l[u].Abctx,Bukrsfloc:l[u].Bukrs,Butxt:l[u].Butxt,City:l[u].City,KostFloc:l[u].Kostl,KokrFloc:l[u].Kokrs,Contareaname:l[u].Mctxt,PlntFloc:l[u].Werks,Planningplantdes:l[u].Planningplantdes,Ingrp:l[u].Ingrp,Plannergrpdesc:l[u].Innam,Arbplfloc:l[u].Arbpl,Wergwfloc:l[u].WcWerks,Gewrkfloc:l[u].MainArbpl,MainWcPlant:l[u].MainWerks,Tplma:l[u].SupFunctionallocation,Supflocdesc:l[u].SupFlocdescription,BeberFl:l[u].BeberFl,Fing:l[u].Fing,Tele:l[u].Tele,Submtiflo:l[u].ConstrType,Constdesc:l[u].ConstructionDesc,Eqart:l[u].TechnicalObjectTyp,Eartx:l[u].Description,Stattext:l[u].Stattext,StsmFloc:l[u].StsmEqui,Statproftxt:l[u].StsmEquiDesc,UstwFloc:l[u].UstwEqui,UswoFloc:l[u].UswoEqui,UstaFloc:l[u].UstaEqui,Adrnri:l[u].Adrnri,Deact:l[u].Deact};p.FuncLoc.push(d);var c={Funcloc:l[u].Functionallocation,Title:l[u].TitleCode,Name1:l[u].Name1,Name2:l[u].Name2,Name3:l[u].Name3,Name4:l[u].Name4,Sort1:l[u].Sort1,Sort2:l[u].Sort2,NameCo:l[u].NameCo,PostCod1:l[u].PostCod1,City1:l[u].City1,Building:l[u].Building,Floor:l[u].Floor,Roomnum:l[u].Roomnum,Strsuppl1:l[u].Strsuppl1,Strsuppl2:l[u].Strsuppl2,Strsuppl3:l[u].Strsuppl3,Location:l[u].AddrLocation,RPostafl:l[u].RefPosta,Landx:l[u].Landx,TimeZone:l[u].TimeZone,RPostFl:l[u].Region,Regiotxt:l[u].RegionDesc};p.FLAddr.push(c);var g=l[u].intlAddr;if(g){for(var h=0;h<g.length;h++){p.FLAddrI.push(g[h])}}if(r.AltLblDerv==="2"&&l[u].altlbl){for(var m=0;m<l[u].altlbl.length;m++){var f={Funcloc:l[u].Functionallocation,AltAlkey:l[u].altlbl[m].AltAlkey,AltStrno:l[u].altlbl[m].AltStrno,AltTplkz:l[u].altlbl[m].AltTplkz};p.FLALTLBEL.push(f)}}if(l[u].Floccategory==="L"&&l[u].lam){var v={Funcloc:l[u].Functionallocation,Lrpid:l[u].lam.Lrpid,Strtptatr:l[u].lam.Strtptatr,Endptatr:l[u].lam.Endptatr,Length:l[u].lam.Length.toString(),LinUnit:l[u].lam.LinUnit,Startmrkr:l[u].lam.Startmrkr,Endmrkr:l[u].lam.Endmrkr,Mrkdisst:l[u].lam.Mrkdisst,Mrkdisend:l[u].lam.Mrkdisend,MrkrUnit:l[u].lam.MrkrUnit};p.FLLAM.push(v)}var b=l[u].classItems;if(b){if(b.length>0){for(var O=0;O<b.length;O++){var S={Funcloc:l[u].Functionallocation,Classtype:b[O].Classtype,Class:b[O].Class,Clstatus1:b[O].Clstatus1};p.FLClass.push(S)}}}var P=l[u].characteristics;if(P){if(P.length>0){for(var M=0;M<P.length;M++){var T={Funcloc:l[u].Functionallocation,Atnam:P[M].Atnam,Textbez:P[M].Textbez,Atwrt:P[M].Atwrt,Class:P[M].Class};p.FLVal.push(T)}}}}}if(n.length>0){for(var C=0;C<n.length;C++){var D={Herst:n[C].Herst,Equnr:n[C].Equnr,Txtmi:n[C].Eqktx,Swerk:n[C].Maintplant,Name1:n[C].MaintplantDesc,TplnEilo:n[C].Tplnr,Flocdescription:n[C].Pltxt,Eqtyp:n[C].EquipmentCatogory,Etytx:n[C].EquipCatgDescription,Eqart:n[C].TechnicalObjectTyp,Eartx:n[C].Description,Typbz:n[C].Typbz,SubmEeqz:n[C].ConstrType,Constdesc:n[C].ConstructionDesc,BukrEilo:n[C].Bukrs,Butxt:n[C].Butxt,HequEeqz:n[C].SuperordinateEquip,SuperordEqDes:n[C].SuperordinateEquipDesc,TidnEeqz:n[C].TechIdNum,KostEilo:n[C].Kostl,KokrEilo:n[C].Kokrs,Contareaname:n[C].Mctxt,StorEilo:n[C].Location,Locationdesc:n[C].Locationdesc,AbckEilo:n[C].Abckz,Abctx:n[C].Abctx,PplaEeqz:n[C].Werks,Planningplantdes:n[C].Planningplantdes,IngrEeqz:n[C].Ingrp,Plannergrpdesc:n[C].Innam,Serge:n[C].Serge,MapaEeqz:n[C].MapaEeqz,Stattext:n[C].Stattext,StsmEqui:n[C].StsmEqui,Statproftxt:n[C].StsmEquiDesc,UstwEqui:n[C].UstwEqui,UswoEqui:n[C].UswoEqui,UstaEqui:n[C].UstaEqui,Deact:n[C].Deact,Answt:n[C].Answt,Ansdt:r._formatDate(n[C].Ansdt),Waers:n[C].Waers,ArbpEilo:n[C].Arbpl,WorkCenterPlant:n[C].WcWerks,ArbpEeqz:n[C].MainArbpl,MainWcPlant:n[C].MainWerks,BebeEilo:n[C].BeberFl,Fing:n[C].Fing,Tele:n[C].Tele,HeqnEeqz:n[C].EquipPosition,Adrnri:n[C].Adrnri,Funcid:n[C].Funcid,Frcfit:n[C].Frcfit,Frcrmv:n[C].Frcrmv};p.Equipment.push(D);var w={Equi:n[C].Equnr,PlanvPrt:n[C].PlanvPrt,SteufPrt:n[C].SteufPrt,KtschPrt:n[C].KtschPrt,Ewformprt:n[C].Ewformprt,SteufRef:n[C].SteufRef,KtschRef:n[C].KtschRef,EwformRef:n[C].EwformRef};p.EqPRT.push(w);if(n[C].EquipmentCatogory==="L"&&n[C].lam){var V={Equi:n[C].Equnr,Lrpid:n[C].lam.Lrpid,Strtptatr:n[C].lam.Strtptatr,Endptatr:n[C].lam.Endptatr,Length:n[C].lam.Length.toString(),LinUnit:n[C].lam.LinUnit,Startmrkr:n[C].lam.Startmrkr,Endmrkr:n[C].lam.Endmrkr,Mrkdisst:n[C].lam.Mrkdisst,Mrkdisend:n[C].lam.Mrkdisend,MrkrUnit:n[C].lam.MrkrUnit};p.EqLAM.push(V)}var x={Equi:n[C].Equnr,Title:n[C].TitleCode,Name1:n[C].Name1,Name2:n[C].Name2,Name3:n[C].Name3,Name4:n[C].Name4,Sort1:n[C].Sort1,Sort2:n[C].Sort2,NameCo:n[C].NameCo,PostCod1:n[C].PostCod1,City1:n[C].City1,Building:n[C].Building,Floor:n[C].Floor,Roomnum:n[C].Roomnum,Strsuppl1:n[C].Strsuppl1,Strsuppl2:n[C].Strsuppl2,Strsuppl3:n[C].Strsuppl3,Location:n[C].AddrLocation,RefPosta:n[C].RefPosta,Landx:n[C].Landx,TimeZone:n[C].TimeZone,RfePost:n[C].Region,Regiotxt:n[C].RegionDesc};p.EqAddr.push(x);var y=n[C].intlAddr;if(y){for(var h=0;h<y.length;h++){p.EqAddrI.push(y[h])}}var j=n[C].classItems;if(j){if(j.length>0){for(var E=0;E<j.length;E++){var I={Equi:n[C].Equnr,Classtype:j[E].Classtype,Class:j[E].Class,Clstatus1:j[E].Clstatus1};p.EqClass.push(I)}}}var k=n[C].characteristics;if(k){if(k.length>0){for(var N=0;N<k.length;N++){var A={Equi:n[C].Equnr,Atnam:k[N].Atnam,Textbez:k[N].Textbez,Atwrt:k[N].Atwrt,Class:k[N].Class};p.EqVal.push(A)}}}}}if(s.length>0){for(var H=0;H<s.length;H++){var F={Werks:s[H].plant,Arbpl:s[H].wc,Txtmi:s[H].wcDesc,Verwe:s[H].wcCat,Crveran:s[H].person,Planv:s[H].usg,Vgwts:s[H].stdVal,Crsteus:s[H].ctrlKey};if(s[H].hasOwnProperty("Type")){if(s[H].Type==="X"){F.Type="X"}}p.Workcenter.push(F);if(s[H].cost){for(var L=0;L<s[H].cost.length;L++){var R={Werks:s[H].cost[L].CrKokrs,Arbpl:s[H].wc,CrKostl:s[H].cost[L].CrKostl,Costcentxt:s[H].cost[L].Costcentxt,CrLstar:s[H].cost[L].CrLstar,Forn1:s[H].cost[L].Forn1,ActvttypeTxt:s[H].cost[L].ActvttypeTxt,Frmltxt:s[H].cost[L].Frmltxt};p.WCCost.push(R)}}}}if(e===false&&t===false){if(this.currentObj.lHeader.Iwerk!==""){this.currentObj.lHeader.Werks=this.currentObj.lHeader.Iwerk}var q={Werks:this.currentObj.lHeader.Werks,Wcplant:this.currentObj.lHeader.plant,Statu:this.currentObj.lHeader.Statu,Tverwe:this.currentObj.lHeader.tlusg,Ktext:this.currentObj.lHeader.Ktext,Tarbpl:this.currentObj.lHeader.wc,Vagrp:this.currentObj.lHeader.Vagrp,Anlzu:this.currentObj.lHeader.Anlzu,Tplnal:this.currentObj.lHeader.Plnal.toString(),Tlgnhdr:this.currentObj.grp,Strat:this.currentObj.lHeader.Strat,Slwbez:this.currentObj.lHeader.insPt,Slwbeztxt:this.currentObj.lHeader.insPtDesc};p.GTList.push(q);if(this.currentObj.lOperation&&this.currentObj.lOperation.length>0){for(var U=0;U<this.currentObj.lOperation.length;U++){var W={Tlgnhdr:this.currentObj.grp,Vornr:this.currentObj.lOperation[U].Vornr,TlArbpl:this.currentObj.lOperation[U].Arbpl,Werks2gop:this.currentObj.lOperation[U].Werks,Steus2gop:this.currentObj.lOperation[U].Steus,Ltxa1:this.currentObj.lOperation[U].Ltxa1,Arbei:this.currentObj.lOperation[U].Arbei,Dauno:this.currentObj.lOperation[U].Dauno,Arbeh:this.currentObj.lOperation[U].Arbeh,Anzzl:this.currentObj.lOperation[U].Anzzl,Daune:this.currentObj.lOperation[U].Daune,Indet:this.currentObj.lOperation[U].Indet,Tplnal:this.currentObj.lOperation[U].Plnal.toString(),Uvorn:this.currentObj.lOperation[U].Uvorn,Larnt2gop:this.currentObj.lOperation[U].Larnt,Prznt:this.currentObj.lOperation[U].workPerc===""?0:parseFloat(this.currentObj.lOperation[U].workPerc),Bmvrg:this.currentObj.lOperation[U].orderQty,Bmeih:this.currentObj.lOperation[U].ordQtyUnit,Opreis:this.currentObj.lOperation[U].netPrice===""?"0.000":parseFloat(this.currentObj.lOperation[U].netPrice).toFixed(3).toString(),Owaers:this.currentObj.lOperation[U].currency,Opeinh:this.currentObj.lOperation[U].priceUnit===""?"0.000":parseFloat(this.currentObj.lOperation[U].priceUnit).toFixed(3).toString(),Sakto2gop:this.currentObj.lOperation[U].costElement,Omatkl:this.currentObj.lOperation[U].materialGrp,Oekgrp:this.currentObj.lOperation[U].puchGroup,Ekorg:this.currentObj.lOperation[U].purchOrg,EqunrGop:this.currentObj.lOperation[U].equi,TplnrGop:this.currentObj.lOperation[U].floc};p.GTOprs.push(W);for(var h=0;h<this.currentObj.lOperation[U].OprRel.length;h++){var B=this.currentObj.lOperation[U].OprRel[h];var K={Tlgnhdr:this.currentObj.grp,Tplnal:B.Plnal.toString(),Vorn2:B.Vornr,Vornrgrel:B.OperationOR,Dauer:B.Offset,Zeinh:B.OUn,Aobar:B.RelType,Gprznt:B.PO,Provg:B.OI,Gkalid:B.ID,Arbplgrel:B.WrkCtrOR,Werksgrel:B.PlantOR};p.GTRel.push(K)}for(var h=0;h<this.currentObj.lOperation[U].SrvPckgOvrw.length;h++){var B=this.currentObj.lOperation[U].SrvPckgOvrw[h];var G={Tlgnhdr:B.group,Tplnal:B.Plnal.toString(),Vornrr:B.Vornr,SrvLine:B.LineNum,Del:a.truetoX(B.DelIndSP),Srvpos:B.ActNum,Ktext1:B.ShrtTxt,Mengegspk:B.Qty,Meinsgspk:B.BUomSP,Tbtwr:B.GrossPrc,Waersgspk:B.CurKey,IntWork:B.Work,Iwein:B.UnitOfWork};p.GTSpack.push(G)}for(var h=0;h<this.currentObj.lOperation[U].PRT.length;h++){var B=this.currentObj.lOperation[U].PRT[h];var Q={Tlgnhdr:B.grp,Tplnal:B.Plnal.toString(),Vornrgprt:B.Vornr,Psnfh:B.ItmNum,Fhmar:B.ItmCat,Matnrgprt:B.Mat,EqunrGpt:B.Equi,Eqpnt:B.Mspt,Doknrgprt:B.doc,Dokargprt:B.docType,Doktlgprt:B.docPart,Dokvrgprt:B.docVersion,Fhmnr:B.Othr,Fhwrk:B.Plant,Mgvgw:B.Qty,Mgeinh:B.UOM,Mgform:B.QtyFrmla,Steuf:B.PRTCtrl,Stftxt:B.PRTCtrlDesc,Ewvgw:B.StdUsgVal,Eweinh:B.StdUsgUOM,Ewform:B.UsgValFrmla};p.GTPRT.push(Q)}for(var h=0;h<this.currentObj.lOperation[U].InspChar.length;h++){var B=this.currentObj.lOperation[U].InspChar[h];var z={Tlgnhdr:B.group,Tplnal:B.Plnal.toString(),Vornrgins:B.Vornr,Merknr:B.InspChar,Vste2gins:B.PrstInd,Quantitat:a.truetoX(B.QuanChar),QpmkRef:a.truetoX(B.QualChar),Verw2gins:B.MastInspChar,Uzae2tlgn:B.Plant,Mkv2tlgni:B.Version,Kurztext:B.ShrtTxt,Pmth2gins:B.InspMthd,Qwe2tlgni:B.InspMthdPlnt,Toleranzs:B.TolKey,Ver2tlgni:B.VrsnInspMthd,Stichprve:B.SampProc,Probemgeh:B.SampUOM,Pruefeinh:B.BaseSampQty===""?"0.00":parseFloat(B.BaseSampQty).toFixed(2),Auswmenge:B.CodeGrp};p.GTInsp.push(z)}}}if(this.currentObj.lMaintPckg&&this.currentObj.lMaintPckg.length>0){for(var h=0;h<this.currentObj.lMaintPckg.length;h++){if(this.currentObj.lMaintPckg[h].MPArr&&this.currentObj.lMaintPckg[h].MPArr.length>0){for(var m=0;m<this.currentObj.lMaintPckg[h].MPArr.length;m++){var J=this.currentObj.lMaintPckg[h].MPArr[m];var _={Ktex1:J.Ktex1,Ktxhi:J.Ktxhi,Kzyk1:J.Kzyk1,Paketgmpk:J.Paket,Startgmpk:J.Strat,Tlgnhdr:this.currentObj.grp,Tplnal:J.Plnal.toString(),Vorn2gmpk:J.Vornr}}p.GTMPack.push(_)}}}if(this.currentObj.lComponent&&this.currentObj.lComponent.length>0){for(var X=0;X<this.currentObj.lComponent.length;X++){var Z={Tlgnhdr:this.currentObj.grp,Idnrk:this.currentObj.lComponent[X].Idnrk,Menge:this.currentObj.lComponent[X].Menge,MeinsGcp:this.currentObj.lComponent[X].MeinsGcp,Vornr:this.currentObj.lComponent[X].Vornr,Postp:this.currentObj.lComponent[X].Postp,Tplnal:this.currentObj.lComponent[X].Plnal.toString()};p.GTComp.push(Z)}}if(this.currentObj.Class){for(var $=0;$<this.currentObj.Class.length;$++){if(this.currentObj.Class[$].Plnal===this.currentObj.lHeader.Plnal){var Y={Tlgnhdr:this.currentObj.grp,Classtype:this.currentObj.Class[$].Classtype,Class:this.currentObj.Class[$].Class,Clstatus1:this.currentObj.Class[$].Clstatus1,Tplnal:this.currentObj.Class[$].Plnal.toString()};p.GTClass.push(Y)}}}if(this.chData){for(var ee=0;ee<this.chData.length;ee++){for(var U=0;U<this.currentObj.Class.length;U++){if(this.currentObj.Class[U].Class===this.chData[ee].Class&&this.currentObj.Class[U].Plnal===this.currentObj.lHeader.Plnal&&!this.chData[ee].Plnal){this.chData[ee].Plnal=this.currentObj.Class[U].Plnal}}if(this.chData[ee].Plnal){var te={Tlgnhdr:this.currentObj.grp,Atnam:this.chData[ee].Atnam,Textbez:this.chData[ee].Textbez,Atwrt:this.chData[ee].Atwrt,Class:this.chData[ee].Class,Tplnal:this.chData[ee].Plnal.toString()};p.GTVal.push(te)}}}}else if(e===true&&t===false){if(this.currentObj.lHeader.Iwerk!==""){this.currentObj.lHeader.Werks=this.currentObj.lHeader.Iwerk}var re={Werks:this.currentObj.lHeader.Werks,Wcplant:this.currentObj.lHeader.plant,Statu:this.currentObj.lHeader.Statu,Tverwe:this.currentObj.lHeader.tlusg,Ktext:this.currentObj.lHeader.Ktext,Tarbpl:this.currentObj.lHeader.wc,Vagrp:this.currentObj.lHeader.Vagrp,Anlzu:this.currentObj.lHeader.Anlzu,Tplnal:this.currentObj.lHeader.Plnal.toString(),Tleqhdr:this.currentObj.grp,Strat:this.currentObj.lHeader.Strat,Eq2tl:this.currentObj.lHeader.equipment,Slwbez:this.currentObj.lHeader.insPt,Slwbeztxt:this.currentObj.lHeader.insPtDesc};p.ETList.push(re);if(this.currentObj.lOperation&&this.currentObj.lOperation.length>0){for(var U=0;U<this.currentObj.lOperation.length;U++){var ae={Tleqhdr:this.currentObj.grp,Vornr:this.currentObj.lOperation[U].Vornr,TlArbpl:this.currentObj.lOperation[U].Arbpl,Werks2eop:this.currentObj.lOperation[U].Werks,Steus2eop:this.currentObj.lOperation[U].Steus,Ltxa1:this.currentObj.lOperation[U].Ltxa1,Arbei:this.currentObj.lOperation[U].Arbei,Dauno:this.currentObj.lOperation[U].Dauno,Arbeh:this.currentObj.lOperation[U].Arbeh,Anzzl:this.currentObj.lOperation[U].Anzzl,Daune:this.currentObj.lOperation[U].Daune,Indet:this.currentObj.lOperation[U].Indet,Tplnal:this.currentObj.lOperation[U].Plnal.toString(),Uvorn:this.currentObj.lOperation[U].Uvorn,Larnt2eop:this.currentObj.lOperation[U].Larnt,Prznt:this.currentObj.lOperation[U].workPerc===""?0:parseFloat(this.currentObj.lOperation[U].workPerc),Bmvrg:this.currentObj.lOperation[U].orderQty,Bmeih:this.currentObj.lOperation[U].ordQtyUnit,Opreis:this.currentObj.lOperation[U].netPrice===""?"0.000":parseFloat(this.currentObj.lOperation[U].netPrice).toFixed(3).toString(),Owaers:this.currentObj.lOperation[U].currency,Opeinh:this.currentObj.lOperation[U].priceUnit===""?"0.000":parseFloat(this.currentObj.lOperation[U].priceUnit).toFixed(3).toString(),Sakto2eop:this.currentObj.lOperation[U].costElement,Omatkl:this.currentObj.lOperation[U].materialGrp,Oekgrp:this.currentObj.lOperation[U].puchGroup,Ekorg:this.currentObj.lOperation[U].purchOrg,EqunrEop:this.currentObj.lOperation[U].equi,TplnrEop:this.currentObj.lOperation[U].floc};p.ETOprs.push(ae);for(var h=0;h<this.currentObj.lOperation[U].OprRel.length;h++){var B=this.currentObj.lOperation[U].OprRel[h];var K={Tleqhdr:this.currentObj.grp,Tplnal:B.Plnal.toString(),Vorn2:B.Vornr,Vornrerel:B.OperationOR,Dauer:B.Offset,Zeinh:B.OUn,Aobar:B.RelType,Eprznt:B.PO,Provg:B.OI,Ekalid:B.ID,Arbplerel:B.WrkCtrOR,Werkserel:B.PlantOR};p.ETRel.push(K)}for(var h=0;h<this.currentObj.lOperation[U].SrvPckgOvrw.length;h++){var B=this.currentObj.lOperation[U].SrvPckgOvrw[h];var G={Tleqhdr:B.group,Tplnal:B.Plnal.toString(),Vornrr:B.Vornr,SrvLine:B.LineNum,Del:a.truetoX(B.DelIndSP),Srvpos:B.ActNum,Ktext1:B.ShrtTxt,Mengeespk:B.Qty,Meinsespk:B.BUomSP,Tbtwr:B.GrossPrc,Waersespk:B.CurKey,IntWork:B.Work,Iwein:B.UnitOfWork};p.ETSpack.push(G)}for(var h=0;h<this.currentObj.lOperation[U].PRT.length;h++){var B=this.currentObj.lOperation[U].PRT[h];var Q={Tleqhdr:B.grp,Tplnal:B.Plnal.toString(),Vornreprt:B.Vornr,Psnfh:B.ItmNum,Fhmar:B.ItmCat,Matnreprt:B.Mat,EqunrEpt:B.Equi,Eqpnt:B.Mspt,Doknreprt:B.doc,Dokareprt:B.docType,Doktleprt:B.docPart,Dokvreprt:B.docVersion,Fhmnr:B.Othr,Fhwrk:B.Plant,Mgvgw:B.Qty,Mgeinh:B.UOM,Mgform:B.QtyFrmla,Steuf:B.PRTCtrl,Stftxt:B.PRTCtrlDesc,Ewvgw:B.StdUsgVal,Eweinh:B.StdUsgUOM,Ewform:B.UsgValFrmla};p.ETPRT.push(Q)}for(var h=0;h<this.currentObj.lOperation[U].InspChar.length;h++){var B=this.currentObj.lOperation[U].InspChar[h];var z={Tleqhdr:B.group,Tplnal:B.Plnal.toString(),Vornreins:B.Vornr,Merknr:B.InspChar,Vste2eins:B.PrstInd,Quantitat:a.truetoX(B.QuanChar),QpmkRef:a.truetoX(B.QualChar),Verw2eins:B.MastInspChar,Uzae2tlen:B.Plant,Mkv2tleni:B.Version,Kurztext:B.ShrtTxt,Pmth2eins:B.InspMthd,Qwe2tleqi:B.InspMthdPlnt,Toleranzs:B.TolKey,Ver2tleqi:B.VrsnInspMthd,Stichprve:B.SampProc,Probemgeh:B.SampUOM,Pruefeinh:B.BaseSampQty===""?"0.00":parseFloat(B.BaseSampQty).toFixed(2),Auswmenge:B.CodeGrp};p.ETInsp.push(z)}}}if(this.currentObj.lMaintPckg&&this.currentObj.lMaintPckg.length>0){for(var h=0;h<this.currentObj.lMaintPckg.length;h++){if(this.currentObj.lMaintPckg[h].MPArr&&this.currentObj.lMaintPckg[h].MPArr.length>0){for(var m=0;m<this.currentObj.lMaintPckg[h].MPArr.length;m++){var J=this.currentObj.lMaintPckg[h].MPArr[m];var _={Ktex1:J.Ktex1,Ktxhi:J.Ktxhi,Kzyk1:J.Kzyk1,Paketempk:J.Paket,Startempk:J.Strat,Tleqhdr:this.currentObj.grp,Tplnal:J.Plnal.toString(),Vorn2empk:J.Vornr}}p.ETMPack.push(_)}}}if(this.currentObj.lComponent&&this.currentObj.lComponent.length>0){for(var X=0;X<this.currentObj.lComponent.length;X++){var le={Tleqhdr:this.currentObj.grp,Idnrk:this.currentObj.lComponent[X].Idnrk,Menge:this.currentObj.lComponent[X].Menge,MeinsEcp:this.currentObj.lComponent[X].MeinsGcp,Vornr:this.currentObj.lComponent[X].Vornr,Postp:this.currentObj.lComponent[X].Postp,Tplnal:this.currentObj.lComponent[X].Plnal.toString()};p.ETComp.push(le)}}if(this.currentObj.Class){for(var $=0;$<this.currentObj.Class.length;$++){if(this.currentObj.Class[$].Plnal===this.currentObj.lHeader.Plnal){var ne={Tleqhdr:this.currentObj.grp,Classtype:this.currentObj.Class[$].Classtype,Class:this.currentObj.Class[$].Class,Clstatus1:this.currentObj.Class[$].Clstatus1,Tplnal:this.currentObj.Class[$].Plnal.toString()};p.ETClass.push(ne)}}}if(this.currentObj.Char){for(var ee=0;ee<this.currentObj.Char.length;ee++){for(var U=0;U<this.currentObj.Class.length;U++){if(this.currentObj.Class[U].Class===this.currentObj.Char[ee].Class&&this.currentObj.Class[U].Plnal===this.currentObj.lHeader.Plnal&&!this.currentObj.Char[ee].Plnal){this.currentObj.Char[ee].Plnal=this.currentObj.Class[U].Plnal}}if(this.currentObj.Char[ee].Plnal){var se={Tleqhdr:this.currentObj.grp,Atnam:this.currentObj.Char[ee].Atnam,Textbez:this.currentObj.Char[ee].Textbez,Atwrt:this.currentObj.Char[ee].Atwrt,Class:this.currentObj.Char[ee].Class,Tplnal:this.currentObj.Char[ee].Plnal.toString()};p.ETVal.push(se)}}}}else if(e===false&&t===true){if(this.currentObj.lHeader[L].Iwerk!==""){this.currentObj.lHeader[L].Werks=this.currentObj.lHeader[L].Iwerk}var ie={Werks:this.currentObj.lHeader[L].Werks,Wcplant:this.currentObj.lHeader[L].plant,Statu:this.currentObj.lHeader[L].Statu,Tverwe:this.currentObj.lHeader[L].tlusg,Ktext:this.currentObj.lHeader[L].Ktext,Tarbpl:this.currentObj.lHeader[L].wc,Vagrp:this.currentObj.lHeader[L].Vagrp,Anlzu:this.currentObj.lHeader[L].Anlzu,Tplnal:this.currentObj.lHeader[L].Plnal.toString(),Tlflhdr:this.currentObj.grp,Strat:this.currentObj.lHeader[L].Strat,Fl2tl:this.currentObj.lHeader[L].floc,Slwbez:this.currentObj.lHeader[L].insPt,Slwbeztxt:this.currentObj.lHeader[L].insPtDesc};p.FTList.push(ie);if(this.currentObj.lOperation){for(var U=0;U<this.currentObj.lOperation.length;U++){var oe={Tlflhdr:this.currentObj.grp,Vornr:this.currentObj.lOperation[U].Vornr,TlArbpl:this.currentObj.lOperation[U].Arbpl,Werks2fop:this.currentObj.lOperation[U].Werks,Steus2fop:this.currentObj.lOperation[U].Steus,Ltxa1:this.currentObj.lOperation[U].Ltxa1,Arbei:this.currentObj.lOperation[U].Arbei,Dauno:this.currentObj.lOperation[U].Dauno,Arbeh:this.currentObj.lOperation[U].Arbeh,Anzzl:this.currentObj.lOperation[U].Anzzl,Daune:this.currentObj.lOperation[U].Daune,Indet:this.currentObj.lOperation[U].Indet,Tplnal:this.currentObj.lOperation[U].Plnal.toString(),Uvorn:this.currentObj.lOperation[U].Uvorn,Larnt2fop:this.currentObj.lOperation[U].Larnt,Prznt:this.currentObj.lOperation[U].workPerc===""?0:parseFloat(this.currentObj.lOperation[U].workPerc),Bmvrg:this.currentObj.lOperation[U].orderQty,Bmeih:this.currentObj.lOperation[U].ordQtyUnit,Opreis:this.currentObj.lOperation[U].netPrice===""?"0.000":parseFloat(this.currentObj.lOperation[U].netPrice).toFixed(3).toString(),Owaers:this.currentObj.lOperation[U].currency,Opeinh:this.currentObj.lOperation[U].priceUnit===""?"0.000":parseFloat(this.currentObj.lOperation[U].priceUnit).toFixed(3).toString(),Sakto2fop:this.currentObj.lOperation[U].costElement,Omatkl:this.currentObj.lOperation[U].materialGrp,Oekgrp:this.currentObj.lOperation[U].puchGroup,Ekorg:this.currentObj.lOperation[U].purchOrg,EqunrFop:this.currentObj.lOperation[U].equi,TplnrFop:this.currentObj.lOperation[U].floc};p.FTOprs.push(oe);for(var h=0;h<this.currentObj.lOperation[U].OprRel.length;h++){var B=this.currentObj.lOperation[U].OprRel[h];var K={Tlflhdr:this.currentObj.grp,Tplnal:B.Plnal.toString(),Vorn2:B.Vornr,Vornrfrel:B.OperationOR,Dauer:B.Offset,Zeinh:B.OUn,Aobar:B.RelType,Fprznt:B.PO,Provg:B.OI,Fkalid:B.ID,Arbplfrel:B.WrkCtrOR,Werksfrel:B.PlantOR};p.FTRel.push(K)}for(var h=0;h<this.currentObj.lOperation[U].SrvPckgOvrw.length;h++){var B=this.currentObj.lOperation[U].SrvPckgOvrw[h];var G={Tlflhdr:B.group,Tplnal:B.Plnal.toString(),Vornrr:B.Vornr,SrvLine:B.LineNum,Del:a.truetoX(B.DelIndSP),Srvpos:B.ActNum,Ktext1:B.ShrtTxt,Mengefspk:B.Qty,Meinsfspk:B.BUomSP,Tbtwr:B.GrossPrc,Waersfspk:B.CurKey,IntWork:B.Work,Iwein:B.UnitOfWork};p.FTSpack.push(G)}for(var h=0;h<this.currentObj.lOperation[U].PRT.length;h++){var B=this.currentObj.lOperation[U].PRT[h];var Q={Tlflhdr:B.grp,Tplnal:B.Plnal.toString(),Vornrfprt:B.Vornr,Psnfh:B.ItmNum,Fhmar:B.ItmCat,Matnrfprt:B.Mat,EqunrFpt:B.Equi,Eqpnt:B.Mspt,Doknrfprt:B.doc,Dokarfprt:B.docType,Doktlfprt:B.docPart,Dokvrfprt:B.docVersion,Fhmnr:B.Othr,Fhwrk:B.Plant,Mgvgw:B.Qty,Mgeinh:B.UOM,Mgform:B.QtyFrmla,Steuf:B.PRTCtrl,Stftxt:B.PRTCtrlDesc,Ewvgw:B.StdUsgVal,Eweinh:B.StdUsgUOM,Ewform:B.UsgValFrmla};p.FTPRT.push(Q)}for(var h=0;h<this.currentObj.lOperation[U].InspChar.length;h++){var B=this.currentObj.lOperation[U].InspChar[h];var z={Tlflhdr:B.group,Tplnal:B.Plnal.toString(),Vornrfins:B.Vornr,Merknr:B.InspChar,Vste2eins:B.PrstInd,Quantitat:a.truetoX(B.QuanChar),QpmkRef:a.truetoX(B.QualChar),Verw2fins:B.MastInspChar,Uzae2tlfn:B.Plant,Mkv2tlfni:B.Version,Kurztext:B.ShrtTxt,Pmth2fins:B.InspMthd,Qwe2tlfli:B.InspMthdPlnt,Toleranzs:B.TolKey,Ver2tlfli:B.VrsnInspMthd,Stichprve:B.SampProc,Probemgeh:B.SampUOM,Pruefeinh:B.BaseSampQty===""?"0.00":parseFloat(B.BaseSampQty).toFixed(2),Auswmenge:B.CodeGrp};p.FTInsp.push(z)}}}if(this.currentObj.lMaintPckg&&this.currentObj.lMaintPckg.length>0){for(var h=0;h<this.currentObj.lMaintPckg.length;h++){if(this.currentObj.lMaintPckg[h].MPArr&&this.currentObj.lMaintPckg[h].MPArr.length>0){for(var m=0;m<this.currentObj.lMaintPckg[h].MPArr.length;m++){var J=this.currentObj.lMaintPckg[h].MPArr[m];var _={Ktex1:J.Ktex1,Ktxhi:J.Ktxhi,Kzyk1:J.Kzyk1,Paketfmpk:J.Paket,Startfmpk:J.Strat,Tlflhdr:this.currentObj.grp,Tplnal:J.Plnal.toString(),Vorn2fmpk:J.Vornr}}p.FTMPack.push(_)}}}if(this.currentObj.lComponent){for(var X=0;X<this.currentObj.lComponent.length;X++){var pe={Tlflhdr:this.currentObj.grp,Idnrk:this.currentObj.lComponent[X].Idnrk,Menge:this.currentObj.lComponent[X].Menge,MeinsFcp:this.currentObj.lComponent[X].MeinsGcp,Vornr:this.currentObj.lComponent[X].Vornr,Postp:this.currentObj.lComponent[X].Postp,Tplnal:this.currentObj.lComponent[X].Plnal.toString()};p.FTComp.push(pe)}}if(this.currentObj.Class){for(var $=0;$<this.currentObj.Class.length;$++){if(this.currentObj.Class[$].Plnal===this.currentObj.lHeader.Plnal){var ue={Tlflhdr:this.currentObj.grp,Classtype:this.currentObj.Class[$].Classtype,Class:this.currentObj.Class[$].Class,Clstatus1:this.currentObj.Class[$].Clstatus1,Tplnal:this.currentObj.Class[$].Plnal.toString()};p.FTClass.push(ue)}}}if(this.currentObj.Char){for(var ee=0;ee<this.currentObj.Char.length;ee++){for(var U=0;U<this.currentObj.Class.length;U++){if(this.currentObj.Class[U].Class===this.currentObj.Char[ee].Class&&this.currentObj.Class[U].Plnal===this.currentObj.lHeader.Plnal&&!this.currentObj.Char[ee].Plnal){this.currentObj.Char[ee].Plnal=this.currentObj.Class[U].Plnal}}if(this.currentObj.Char[ee].Plnal){var de={Tlflhdr:this.currentObj.grp,Atnam:this.currentObj.Char[ee].Atnam,Textbez:this.currentObj.Char[ee].Textbez,Atwrt:this.currentObj.Char[ee].Atwrt,Class:this.currentObj.Char[ee].Class,Tplnal:this.currentObj.Char[ee].Plnal.toString()};p.FTVal.push(de)}}}}this.getView().byId("tlDetailPage").setBusy(true);var ce=this.getView().getModel();ce.create("/ChangeRequestSet",p,{success:function(e){r.getView().byId("tlDetailPage").setBusy(false);var t=e;var l=[];for(var n=0;n<t.Messages.results.length;n++){l.push({type:a.getMessageType(t.Messages.results[n].Type),title:t.Messages.results[n].Message})}r.createMessagePopover(l,"")},error:function(e){r.getView().byId("tlDetailPage").setBusy(false);var t=[],a=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var l=0;l<JSON.parse(e.responseText).error.innererror.errordetails.length;l++){t[l]=JSON.parse(e.responseText).error.innererror.errordetails[l].message}}var n=t.join("\n");sap.m.MessageBox.show(n,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},showMessage:function(e){this.createMessagePopover(e,"Error")},onEquipVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a;if(a===undefined){var l=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("EQUIPMENT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/EquipmentNumberSet",template:new sap.m.StandardListItem({title:"{Equnr}",description:"{Eqktx}"})},confirm:function(e){t.currentObj.lHeader.equiValueState="None";t.currentObj.lHeader.equiValueStateTxt="";t.currentObj.lHeader.equipmentDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.lHeader.equipment=e.getParameters().selectedItem.getProperty("title");t.currentObj.lHeader.bAddHeader=true;r.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Equnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Eqktx",sap.ui.model.FilterOperator.Contains,t)],false)])}});var n="/EquipmentNumberSet";var s=this.getView().getModel("valueHelp");s.read(n,{success:function(e,r){if(e.results.length>0){var n=sap.ui.getCore().getModel("AIWEQUI").getData();if(n.length>0){for(var s=0;s<n.length;s++){if(n[s].Equnr){var i={Equnr:n[s].Equnr,Eqktx:n[s].Eqktx};e.results.unshift(i)}}}a=e;var o=new sap.m.StandardListItem({title:"{Equnr}",description:"{Eqktx}",active:true});var p=new sap.ui.model.json.JSONModel;p.setData(e);l.setModel(p);l.bindAggregation("items","/results",o)}else{l.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var i=new sap.ui.model.json.JSONModel;i.setData(a);l.setModel(i);var o=l.getItems();for(var p=0;p<o.length;p++){o[p].setVisible(true)}}l.open()},onFlocVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a;if(a===undefined){var l=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("FLOC"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/FunctionLocationSet",template:new sap.m.StandardListItem({title:"{Tplnr}",description:"{Pltxt}"})},confirm:function(e){t.currentObj.lHeader.flocValueState="None";t.currentObj.lHeader.flocValueStateTxt="";t.currentObj.lHeader.flocDesc=e.getParameters().selectedItem.getProperty("description");t.currentObj.lHeader.floc=e.getParameters().selectedItem.getProperty("title");t.currentObj.lHeader.bAddHeader=true;r.setData(t.currentObj)},search:function(e){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Tplnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Pltxt",sap.ui.model.FilterOperator.Contains,t)],false)])}});var n="/FunctionLocationSet";var s=this.getView().getModel("valueHelp");s.read(n,{success:function(e,r){if(e.results.length>0){var n=sap.ui.getCore().getModel("AIWFLOC").getData();if(n.length>0){for(var s=0;s<n.length;s++){if(n[s].Functionallocation){var i={Tplnr:n[s].Functionallocation,Pltxt:n[s].Flocdescription};e.results.unshift(i)}}}a=e;var o=new sap.m.StandardListItem({title:"{Tplnr}",description:"{Pltxt}",active:true});var p=new sap.ui.model.json.JSONModel;p.setData(e);l.setModel(p);l.bindAggregation("items","/results",o)}else{l.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var i=new sap.ui.model.json.JSONModel;i.setData(a);l.setModel(i);var o=l.getItems();for(var p=0;p<o.length;p++){o[p].setVisible(true)}}l.open()},onPplantVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=r.getData();var l={title:this.getView().getModel("i18n").getProperty("PLAN_PLANT_TXT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/PlanningPlantSet",template:new sap.m.StandardListItem({title:"{Werks}",description:"{Name1}"})},confirm:function(e){a.lHeader.valueStatePP="None";a.lHeader.Iwerk=e.getParameters().selectedItem.getProperty("title");a.lHeader.pPlantDesc=e.getParameters().selectedItem.getProperty("description");a.lHeader.planningPlantValueState="None";r.setData(a);t.readHdrDefaults("planningPlant",t.index,a)}};var n="/PlanningPlantSet";var s=this.getView().getModel("valueHelp");var i=o.getSelectDialog(s,n,[],l,"Werks","Name1");i.open()},onHWCVH:function(e){var t=this;var r=this.getView().getModel("tlDetailModel");var a=r.getData();var l=a.lHeader.Iwerk;var n;if(n===undefined){var s=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("WC"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Work Center Category"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Plant"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Work Center"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Description"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Language"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",visible:false,header:[new sap.m.Text({text:"Control Key"})]})],items:{path:"/WorkCenterVHSet?$filter= Werks eq '"+l+"'",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:"{Steus}"})]})},confirm:function(e){a.lHeader.wcValueState="None";a.lHeader.wc=e.getParameter("selectedItem").getCells()[2].getText();a.lHeader.Steus=e.getParameter("selectedItem").getCells()[5].getText();a.lHeader.plant=e.getParameter("selectedItem").getCells()[1].getText();a.lHeader.wcValueState="None";t.ActivityType=e.getParameter("selectedItem").getBindingContext().getObject().Lar01;r.setData(a);t.WCPPCheckHeader()},search:function(e){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Arbpl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ktext",sap.ui.model.FilterOperator.Contains,t)],false)])}});var i="/WorkCenterVHSet";var o=[];var p=this.getView().getModel("valueHelp");p.read(i,{filters:o,success:function(e,r){if(e.results.length>0){var a=sap.ui.getCore().getModel("AIWListWCModel").getData();if(a.length>0){for(var l=0;l<a.length;l++){if(a[l].wc){var i={Verwe:a[l].wcCat,Werks:a[l].plant,Arbpl:a[l].wc,Ktext:a[l].wcDesc,Spras:e.results[0].Spras};e.results.unshift(i)}}}n=e;var o=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:"{Steus}"})]});var p=new sap.ui.model.json.JSONModel;p.setData(e);s.setModel(p);s.bindAggregation("items","/results",o)}else{s.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var u=new sap.ui.model.json.JSONModel;u.setData(n);s.setModel(u);var d=s.getItems();for(var c=0;c<d.length;c++){d[c].setVisible(true)}}s.open()},onPlantWcVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=r.getData();var l={title:this.getView().getModel("i18n").getProperty("PLANT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>SEARCHTERM1}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>SEARCHTERM2}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>POST_CODE}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>CITY}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>Name2}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>Name1}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>COMP_NAME}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>ADDR_VERSION}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>PLANT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>DESCRIPTION}"})]})],items:{path:"/PlantVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{CompanyName}"}),new sap.m.Text({text:"{AddrVersion}"}),new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{PlantName}"})]})},confirm:function(e){a.lHeader.plantValueState="None";a.lHeader.plantValueStateTxt="";a.lHeader.plant=e.getParameter("selectedItem").getCells()[8].getText();a.lHeader.plantDesc=e.getParameter("selectedItem").getCells()[9].getText();r.setData(a)}};var n="/PlantVHSet";var s=[];var i=this.getView().getModel("valueHelp");var p=[new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{CompanyName}"}),new sap.m.Text({text:"{AddrVersion}"}),new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{PlantName}"})];var u=o.getValueHelp(i,n,p,s,l,"Plant","PlantName");u.open();u.setModel(t.getView().getModel("i18n"),"i18n")},onUsageVH:function(e){var t=this;var r=this.getView().getModel("tlDetailModel");var a=r.getData();var l={title:this.getView().getModel("i18n").getProperty("USAGE"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/UsageVHSet",template:new sap.m.StandardListItem({title:"{VERWE}",description:"{TXT}"})},confirm:function(e){a.lHeader.tlusg=e.getParameters().selectedItem.getProperty("title");a.lHeader.usageDesc=e.getParameters().selectedItem.getProperty("description");a.lHeader.usgValueState="None";r.setData(a);t.readHdrDefaults("usage",t.index,a)}};var n="/UsageVHSet";var s=this.getView().getModel("valueHelp");var i=o.getSelectDialog(s,n,[],l,"VERWE","TXT");i.open()},onPlannerGrpVH:function(e){var t=this;var r=this.getView().getModel("tlDetailModel");var a=r.getData();var l=a.lHeader.Iwerk;var n;if(l){n="/PlannerGroupTLSet";var s=[new sap.ui.model.Filter("Iwerk","EQ",l)]}else{n="/PlannerGroupTLSet";var s=[]}var i=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("PL_GRP"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:n,template:new sap.m.StandardListItem({title:"{Ingrp}",description:"{Innam}"})},confirm:function(e){a.lHeader.Vagrp=e.getParameters().selectedItem.getProperty("title");a.lHeader.plGrpDesc=e.getParameters().selectedItem.getProperty("description");a.lHeader.plGrpValueState="None";r.setData(a)},search:function(e){var t=e.getParameter("value").toUpperCase();t=t.replace(/^[ ]+|[ ]+$/g,"");var r=i.getItems();for(var a=0;a<r.length;a++){if(t.length>0){var l=r[a].getBindingContext().getProperty("Ingrp");var n=r[a].getBindingContext().getProperty("Innam");if(l.toUpperCase().indexOf(t)===-1&&n.toUpperCase().indexOf(t)===-1){r[a].setVisible(false)}else{r[a].setVisible(true)}}else{r[a].setVisible(true)}}},liveChange:function(e){var t=e.getParameter("value").toUpperCase();t=t.replace(/^[ ]+|[ ]+$/g,"");var r=i.getItems();for(var a=0;a<r.length;a++){if(t.length>0){var l=r[a].getBindingContext().getProperty("Ingrp");var n=r[a].getBindingContext().getProperty("Innam");if(l.toUpperCase().indexOf(t)===-1&&n.toUpperCase().indexOf(t)===-1){r[a].setVisible(false)}else{r[a].setVisible(true)}}else{r[a].setVisible(true)}}}});var o=n;var p=this.getView().getModel("valueHelp");p.read(o,{filters:s,success:function(e,r){if(e.results.length>0){t.pgSearchResults=e;var a=new sap.m.StandardListItem({title:"{Ingrp}",description:"{Innam}"});var l=new sap.ui.model.json.JSONModel;l.setData(e);i.setModel(l);i.setGrowingThreshold(e.results.length);i.bindAggregation("items","/results",a)}else{i.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}});i.open()},onStatusVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=r.getData();var l={title:this.getView().getModel("i18n").getProperty("STATUS"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/StatusVHSet",template:new sap.m.StandardListItem({title:"{PLNST}",description:"{TXT}"})},confirm:function(e){a.lHeader.Statu=e.getParameters().selectedItem.getProperty("title");a.lHeader.statusDesc=e.getParameters().selectedItem.getProperty("description");a.lHeader.statusVS="None";a.lHeader.statusVST="";r.setData(a);t.readHdrDefaults("status",a)}};var n="/StatusVHSet";var s=this.getView().getModel("valueHelp");var i=o.getSelectDialog(s,n,[],l,"PLNST","TXT");i.open()},onSysCondDtVH:function(e){var t=this;var r=this.getView().getModel("tlDetailModel");var a;if(a===undefined){var l=r.getData();var n=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("SYS_CONDITION"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/SystemConditionSet",template:new sap.m.StandardListItem({title:"{ANLZU}",description:"{ANLZUX}"})},confirm:function(e){l.lHeader.Anlzu=e.getParameters().selectedItem.getProperty("title");l.lHeader.sysCondDesc=e.getParameters().selectedItem.getProperty("description");l.lHeader.sysCondValueState="None";r.setData(l)},search:function(e){var r=e.getParameter("value").toUpperCase();r=r.replace(/^[ ]+|[ ]+$/g,"");var a=t.sySelectDialog.getItems();for(var l=0;l<a.length;l++){if(r.length>0){var n=a[l].getBindingContext().getProperty("ANLZU");var s=a[l].getBindingContext().getProperty("ANLZUX");if(n.toUpperCase().indexOf(r)===-1&&s.toUpperCase().indexOf(r)===-1){a[l].setVisible(false)}else{a[l].setVisible(true)}}else{a[l].setVisible(true)}}},liveChange:function(e){var r=e.getParameter("value").toUpperCase();r=r.replace(/^[ ]+|[ ]+$/g,"");var a=t.sySelectDialog.getItems();for(var l=0;l<a.length;l++){if(r.length>0){var n=a[l].getBindingContext().getProperty("ANLZU");var s=a[l].getBindingContext().getProperty("ANLZUX");if(n.toUpperCase().indexOf(r)===-1&&s.toUpperCase().indexOf(r)===-1){a[l].setVisible(false)}else{a[l].setVisible(true)}}else{a[l].setVisible(true)}}}});var s="/SystemConditionSet";var i=this.getView().getModel("valueHelp");i.read(s,{success:function(e,r){if(e.results.length>0){a=e;var l=new sap.m.StandardListItem({title:"{ANLZU}",description:"{ANLZUX}"});var s=new sap.ui.model.json.JSONModel;s.setData(e);n.setModel(s);n.setGrowingThreshold(e.results.length);n.bindAggregation("items","/results",l)}else{n.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var o=new sap.ui.model.json.JSONModel;o.setData(a);n.setModel(o);var p=n.getItems();for(var u=0;u<p.length;u++){p[u].setVisible(true)}}n.open()},onStrategyVH:function(e){var t=this;var r=this.getView().getModel("tlDetailModel");var a=r.getData();var l={title:this.getView().getModel("i18n").getProperty("STRAT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>STRATEGY}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>DESCRIPTION}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>SCH_IND}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>UNIT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>FACT_CAL}"})]})],items:{path:"/StrategyVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Strat}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Termk}"}),new sap.m.Text({text:"{Zeieh}"}),new sap.m.Text({text:"{Fabkl}"})]})},confirm:function(e){a.lHeader.Strat=e.getParameter("selectedItem").getCells()[0].getText();a.lHeader.stratDesc=e.getParameter("selectedItem").getCells()[1].getText();a.lHeader.maintStrValueState="None";r.setData(a);t.getView().byId("idTabMaintPckg").setVisible(true);t.readMaintPckgConfig(a.lHeader.Strat)}};var n="/StrategyVHSet";var s=[];var i=this.getView().getModel("valueHelp");var p=[new sap.m.Text({text:"{Strat}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Termk}"}),new sap.m.Text({text:"{Zeieh}"}),new sap.m.Text({text:"{Fabkl}"})];var u=o.getValueHelp(i,n,p,s,l,"Strat","Ktext");u.open();u.setModel(t.getView().getModel("i18n"),"i18n")},onAssemblyVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=r.getData();var l=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("Assembly"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",growing:true,growingThreshold:20,columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>DESCRIPTION}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>LANGUAGE}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>MAT}"})]})],items:{path:"/MaterialVH_PRTSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Maktg}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:"{Matnr}"})]})},confirm:function(e){a.lHeader.assmbly=e.getParameter("selectedItem").getCells()[2].getText();a.lHeader.assmblyDesc=e.getParameter("selectedItem").getCells()[0].getText();a.lHeader.assemblyValueState="None";r.setData(a)},liveChange:function(e){var t=e.getParameter("value").toUpperCase();t=t.replace(/^[ ]+|[ ]+$/g,"");var r=l.getItems();for(var a=0;a<r.length;a++){if(t.length>0){var n=r[a].getBindingContext().getProperty("Maktg");var s=r[a].getBindingContext().getProperty("Matnr");if(n.toUpperCase().indexOf(t)===-1&&s.toUpperCase().indexOf(t)===-1){r[a].setVisible(false)}else{r[a].setVisible(true)}}else{r[a].setVisible(true)}}}});var n=this.getView().getModel("valueHelp");l.setModel(n);l.setModel(t.getView().getModel("i18n"),"i18n");l.open()},onQtyUnitVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=new sap.ui.model.json.JSONModel;a=t.getView().byId("components").getModel("tlDetailModel");var l=a.getData();var n=e.getSource().getBindingContext("tlDetailModel").sPath;t.index=parseInt(n.substr(-1));var s={title:this.getView().getModel("i18n").getProperty("U_QTY"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>COMMERCIAL}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>INTMEASUNIT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>UNITTXT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>DIMSNTXT}"})]})],items:{path:"/QuantityUOMSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Mseh3}"}),new sap.m.Text({text:"{Msehi}"}),new sap.m.Text({text:"{Msehl}"}),new sap.m.Text({text:"{Txdim}"})]})},confirm:function(e){l.lComponent[t.index].qtyUnitState="None";l.lComponent[t.index].MeinsGcp=e.getParameter("selectedItem").getCells()[0].getText();r.setData(l)}};var i="/QuantityUOMSet";var p=[];var u=this.getView().getModel("valueHelp");var d=[new sap.m.Text({text:"{Mseh3}"}),new sap.m.Text({text:"{Msehi}"}),new sap.m.Text({text:"{Msehl}"}),new sap.m.Text({text:"{Txdim}"})];var c=o.getValueHelp(u,i,d,p,s,"Msehi","Msehl");c.open();c.setModel(t.getView().getModel("i18n"),"i18n")},onCtrlKeyVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=new sap.ui.model.json.JSONModel;a=t.getView().byId("operationTab").getModel("tlDetailModel");var l=a.getData();var n=e.getSource().getBindingContext("tlDetailModel").sPath;t.index=parseInt(n.substr(-1));var s={title:this.getView().getModel("i18n").getProperty("OP_CTRL_KEY"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/ControlKeySet",template:new sap.m.StandardListItem({title:"{Steus}",description:"{Txt}"})},confirm:function(e){l.lOperation[t.index].Steus=e.getParameters().selectedItem.getProperty("title");t.ctrlKey=e.getParameters().selectedItem.getProperty("title");l.lOperation[t.index].ctrlKeyState="None";r.setData(l);if(l.lOperation[t.index].Steus==="PM03"||l.lOperation[t.index].Steus==="PM05"){r.getData().lHeader.bAddSrvOpOrvw=true}else{r.getData().lHeader.bAddSrvOpOrvw=false}}};var i="/ControlKeySet";var p=this.getView().getModel("valueHelp");var u=[new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Steus","GE","PM01"),new sap.ui.model.Filter("Steus","LE","PM05")],and:true})];var d=o.getSelectDialog(p,i,u,s,"Steus","Txt");d.open()},onOpPlantVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=new sap.ui.model.json.JSONModel;a=t.getView().byId("operationTab").getModel("tlDetailModel");var l=a.getData();var n=e.getSource().getBindingContext("tlDetailModel").sPath;t.index=parseInt(n.substr(-1));var s={title:this.getView().getModel("i18n").getProperty("PLANT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>PLANT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>SEARCHTERM2}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>SEARCHTERM1}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>POST_CODE}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>CITY}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>Name2}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>Name}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>ADDRESS}"})]})],items:{path:"/PlantVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{AddrVersion}"})]})},confirm:function(e){l.lOperation[t.index].plantState="None";l.lOperation[t.index].Werks=e.getParameter("selectedItem").getCells()[0].getText();r.setData(l)}};var i="/PlantVHSet";var p=[];var u=this.getView().getModel("valueHelp");var d=[new sap.m.Text({text:"{Plant}"}),new sap.m.Text({text:"{SearchTerm2}"}),new sap.m.Text({text:"{SearchTerm1}"}),new sap.m.Text({text:"{PostalCode}"}),new sap.m.Text({text:"{City}"}),new sap.m.Text({text:"{Name2}"}),new sap.m.Text({text:"{Name}"}),new sap.m.Text({text:"{AddrVersion}"})];var c=o.getValueHelp(u,i,d,p,s,"Plant","Name");c.open();c.setModel(t.getView().getModel("i18n"),"i18n")},onWCVH:function(e){var t=this;var r=this.getView().getModel("tlDetailModel");var a=r.getData();var l=e.getSource().getBindingContext("tlDetailModel").sPath;t.index=parseInt(l.substr(-1));var n=r.getData();var s=n.lHeader.Iwerk;var i;if(i===undefined){var o=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("WC"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Work Center Category"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Plant"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Work Center"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Description"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Language"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",visible:false,header:[new sap.m.Text({text:"Control Key"})]})],items:{path:"/WorkCenterVHSet?$filter= Werks eq '"+s+"'",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:"{Steus}"})]})},confirm:function(e){a.lOperation[t.index].wcState="None";a.lOperation[t.index].Arbpl=e.getParameter("selectedItem").getCells()[2].getText();a.lOperation[t.index].Steus=e.getParameter("selectedItem").getCells()[5].getText();a.lOperation[t.index].Larnt=e.getParameter("selectedItem").getBindingContext().getObject().Lar01;t.ctrlKey=e.getParameter("selectedItem").getCells()[5].getText();r.setData(a);t.getView().byId("operationTab").setModel(r,"tlDetailModel");t.WCPPCheck(e.getParameter("selectedItem").getCells()[1].getText())},search:function(e){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Arbpl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ktext",sap.ui.model.FilterOperator.Contains,t)],false)])}});if(s===null||s===""){var p="/WorkCenterVHSet";var u=[]}else{var p="/WorkCenterVHSet";var u=[new sap.ui.model.Filter("Werks","EQ",s)]}var d=this.getView().getModel("valueHelp");d.read(p,{filters:u,success:function(e,r){if(e.results.length>0){var a=sap.ui.getCore().getModel("AIWListWCModel").getData();if(a.length>0){for(var l=0;l<a.length;l++){if(a[l].wc){var n={Verwe:a[l].wcCat,Werks:a[l].plant,Arbpl:a[l].wc,Ktext:a[l].wcDesc,Spras:e.results[0].Spras};e.results.unshift(n)}}}i=e;var s=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Verwe}"}),new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Arbpl}"}),new sap.m.Text({text:"{Ktext}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:"{Steus}"})]});var p=new sap.ui.model.json.JSONModel;p.setData(e);o.setModel(p);o.bindAggregation("items","/results",s)}else{o.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var c=new sap.ui.model.json.JSONModel;c.setData(i);o.setModel(c);var g=o.getItems();for(var h=0;h<g.length;h++){g[h].setVisible(true)}}o.open()},onMaterialVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=r.getData();var l=e.getSource().getBindingContext("tlDetailModel").sPath;t.index=parseInt(l.substr(-1));var n=new sap.m.TableSelectDialog({title:this.getView().getModel("i18n").getProperty("COMPO"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>DESCRIPTION}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>LANGUAGE}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"{i18n>MAT}"})]})],growing:true,growingThreshold:30,items:{path:"/MaterialVH_PRTSet?$skip=0&$top=30",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Maktg}"}),new sap.m.Text({text:"{Spras}"}),new sap.m.Text({text:"{Matnr}"})]})},confirm:function(e){a.lComponent[t.index].matState="None";a.lComponent[t.index].Idnrk=e.getParameter("selectedItem").getCells()[2].getText();a.lComponent[t.index].matDesc=e.getParameter("selectedItem").getCells()[0].getText();var l=e.getParameter("selectedItem").getCells()[2].getText();var n=a.lHeader.Iwerk;var s=t.deriveMatDetails(l,n);r.setData(a);t.getView().setModel(r,"tlDetailModel")}});var s=this.getView().getModel("valueHelp");n.setModel(s);n.setModel(t.getView().getModel("i18n"),"i18n");n.open()},onItCatVH:function(e){var t=this;var r=this.getModel("tlDetailModel");var a=new sap.ui.model.json.JSONModel;a=t.getView().byId("components").getModel("tlDetailModel");var l=a.getData();var n=e.getSource().getBindingContext("tlDetailModel").sPath;t.index=parseInt(n.substr(-1));var s;if(s===undefined){var i=new sap.m.SelectDialog({title:this.getView().getModel("i18n").getProperty("CYCLE_UNIT_TXT"),noDataText:this.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/BOMItmCatVHSet",template:new sap.m.StandardListItem({title:"{Postp}",description:"{Ptext}"})},confirm:function(e){l.lComponent[t.index].Postp=e.getParameters().selectedItem.getProperty("title");l.lComponent[t.index].categoryState="None";t.maintCycle.setModel(null,a);r.setData(l)},search:function(e){var t=e.getParameter("value").toUpperCase();t=t.replace(/^[ ]+|[ ]+$/g,"");var r=i.getItems();for(var a=0;a<r.length;a++){if(t.length>0){var l=r[a].getBindingContext().getProperty("Postp");var n=r[a].getBindingContext().getProperty("Ptext");if(l.toUpperCase().indexOf(t)===-1&&n.toUpperCase().indexOf(t)===-1){r[a].setVisible(false)}else{r[a].setVisible(true)}}else{r[a].setVisible(true)}}},liveChange:function(e){var t=e.getParameter("value").toUpperCase();t=t.replace(/^[ ]+|[ ]+$/g,"");var r=i.getItems();for(var a=0;a<r.length;a++){if(t.length>0){var l=r[a].getBindingContext().getProperty("Postp");var n=r[a].getBindingContext().getProperty("Ptext");if(l.toUpperCase().indexOf(t)===-1&&n.toUpperCase().indexOf(t)===-1){r[a].setVisible(false)}else{r[a].setVisible(true)}}else{r[a].setVisible(true)}}}});var o="/BOMItmCatVHSet";var p=this.getView().getModel("valueHelp");p.read(o,{success:function(e,r){if(e.results.length>0){s=e;var a=new sap.m.StandardListItem({title:"{Postp}",description:"{Ptext}"});var l=new sap.ui.model.json.JSONModel;l.setData(e);i.setModel(l);i.bindAggregation("items","/results",a)}else{i.setNoDataText(t.getView().getModel("i18n").getProperty("NO_DATA"))}}})}else{var u=new sap.ui.model.json.JSONModel;u.setData(s);i.setModel(u);var d=i.getItems();for(var c=0;c<d.length;c++){d[c].setVisible(true)}}i.open()},onLiveChange:function(e){if(e.getSource().getValue()===" "){e.getSource().setValue("")}e.getSource().setValueState("None")},onDateChange:function(){var e=this.getView().byId("keyDate");if(e.getValue()!==""){e.setValueState("None")}},onTLChange:function(e){var t=e.getSource().getValue();var r;var a=e.getSource().mBindingInfos.value.binding;if(a!==undefined&&a!==null){r=a.sPath}else{r=e.getSource().mBindingInfos.value.parts[0].path}var l=r.split("/");if(l.length>1){r=l[l.length-1]}switch(r){case"equipment":this._equipment(t,e);break;case"floc":this._functionalLocation(t,e);break;case"Iwerk":this._planPlant(t,e);break;case"wc":this._workCenter(t,e);break;case"plant":this._plant(t,e);break;case"tlusg":this._usage(t,e);break;case"Vagrp":this._plannerGrp(t,e);break;case"Statu":this._status(t,e);break;case"Anlzu":this._sysCond(t,e);break;case"Strat":this._maintStrat(t,e);break;case"assmbly":this._assmbly(t,e);break}},_equipment:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s=false;var i=[];var o=sap.ui.getCore().getModel("AIWEQUI").getData();if(o.length>0){for(var p=0;p<o.length;p++){var u={};if(o[p].Equnr){u={Equnr:o[p].Equnr,Eqktx:o[p].Eqktx};i.push(u)}}for(var d=0;d<i.length;d++){if(n===i[d].Equnr){r.currentObj.lHeader.equipmentDesc=i[d].Eqktx;r.currentObj.lHeader.equipment=n;r.currentObj.lHeader.bAddHeader=true;l.setData(r.currentObj);s=true}}}if(!s){var c=this.getView().getModel("valueHelp");var g="/EquipmentNumberSet";var h=[new sap.ui.model.Filter("Equnr","EQ",a)];c.read(g,{filters:h,success:function(e,t){if(e.results.length>0){r.currentObj.lHeader.equipmentDesc=e.results[0].Eqktx;r.currentObj.lHeader.equipment=n;r.currentObj.lHeader.bAddHeader=true;l.setData(r.currentObj)}else{r.currentObj.lHeader.equiValueState="Error";r.currentObj.lHeader.equipmentDesc="";r.currentObj.lHeader.equiValueStateTxt="Invalid Entry";l.setData(r.currentObj)}},error:function(e){r.currentObj.lHeader.equiValueStateTxt="Error";var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var a=0;a<JSON.parse(e.responseText).error.innererror.errordetails.length;a++){t[a]=JSON.parse(e.responseText).error.innererror.errordetails[a].message}}var n=t.join("\n");r.showMessage(n);r.currentObj.lHeader.equiEnb="true";l.setData(r.currentObj)}})}else{r.currentObj.lHeader.equipment=n;l.setData(r.currentObj)}}},_functionalLocation:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s=false;var i=[];var o=sap.ui.getCore().getModel("AIWFLOC").getData();if(o.length>0){for(var p=0;p<o.length;p++){var u={};if(o[p].Functionallocation){u={Tplnr:o[p].Functionallocation,Pltxt:o[p].Flocdescription};i.push(u)}}for(var d=0;d<i.length;d++){if(n===i[d].Tplnr){r.currentObj.lHeader.flocDesc=i[d].Pltxt;r.currentObj.lHeader.floc=n;r.currentObj.lHeader.bAddHeader=true;l.setData(r.currentObj);s=true}}}if(!s){var c=this.getView().getModel("valueHelp");var g="/FunctionLocationSet";var h=[new sap.ui.model.Filter("Tplnr","EQ",a)];c.read(g,{filters:h,success:function(e,t){if(e.results.length>0){r.currentObj.lHeader.flocDesc=e.results[0].Pltxt;r.currentObj.lHeader.floc=n;r.currentObj.lHeader.bAddHeader=true;l.setData(r.currentObj)}else{r.currentObj.lHeader.flocValueState="Error";r.currentObj.lHeader.flocDesc="";r.currentObj.lHeader.flocValueStateTxt="Invalid Entry";l.setData(r.currentObj)}},error:function(e){r.currentObj.lHeader.flocValueState="Error";var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var a=0;a<JSON.parse(e.responseText).error.innererror.errordetails.length;a++){t[a]=JSON.parse(e.responseText).error.innererror.errordetails[a].message}}var n=t.join("\n");r.showMessage(n);r.currentObj.lHeader.flocEnb="true";l.setData(r.currentObj)}})}else{r.currentObj.lHeader.floc=n;l.setData(r.currentObj)}}},_planPlant:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getView().getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/PlanningPlantSet";var i=new sap.ui.model.Filter("Werks","EQ",a);var o=this.getView().getModel("valueHelp");o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.pPlantDesc=e.results[0].Name1;r.currentObj.lHeader.Iwerk=n;l.setData(r.currentObj)}else{r.currentObj.lHeader.planningPlantValueState="Error";r.currentObj.lHeader.pPlantDesc="";r.currentObj.lHeader.planningPlantValueStateTxt="Invalid Entry";l.lHeader.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.planningPlantValueState="Error";r.currentObj.lHeader.planningPlantValueStateTxt=a;l.setData(r.currentObj)}})}else{r.currentObj.lHeader.Iwerk=n;r.currentObj.lHeader.pPlantDesc="";l.setData(r.currentObj)}},_workCenter:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/WorkCenterVHSet";var i=new sap.ui.model.Filter("Arbpl","EQ",a);var o=this.getView().getModel("valueHelp");var p=false;var u=sap.ui.getCore().getModel("AIWListWCModel").getData();if(u.length>0){for(var d=0;d<u.length;d++){if(u[d].wc===a){r.currentObj.lHeader.wcDesc=u[d].Ktext;r.currentObj.lHeader.wc=n;r.currentObj.lHeader.plant=u[d].plant;l.setData(r.currentObj);p=true}}}if(p===true){return}else{o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.wcDesc=e.results[0].Ktext;r.currentObj.lHeader.wc=n;r.currentObj.lHeader.plant=e.results[0].Werks;l.setData(r.currentObj);r.ActivityType=e.results[0].Lar01;r.WCPPCheckHeader()}else{r.currentObj.lHeader.wcValueState="Error";r.currentObj.lHeader.wcDesc="";r.currentObj.lHeader.plant="";r.currentObj.lHeader.wcValueStateTxt="Invalid Entry";r.ActivityType="";l.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.wcValueState="Error";r.currentObj.lHeader.wcValueStateTxt=a;l.setData(r.currentObj);r.ActivityType=""}})}}else{r.currentObj.lHeader.wc=n;r.currentObj.lHeader.wcDesc="";l.setData(r.currentObj);r.ActivityType=""}},_plant:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/PlantVHSet";var i=new sap.ui.model.Filter("Plant","EQ",a);var o=this.getView().getModel("valueHelp");o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.plantDesc=e.results[0].PlantName;r.currentObj.lHeader.plant=n;l.setData(r.currentObj)}else{r.currentObj.lHeader.plantValueState="Error";r.currentObj.lHeader.plantDesc="";r.currentObj.lHeader.plantValueStateTxt="Invalid Entry";l.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.plantValueState="Error";r.currentObj.lHeader.plantValueStateTxt=a;l.setData(r.currentObj)}})}else{r.currentObj.lHeader.plant=n;r.currentObj.lHeader.plantDesc="";l.setData(r.currentObj)}},_usage:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getView().getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/UsageVHSet";var i=new sap.ui.model.Filter("VERWE","EQ",a);var o=this.getView().getModel("valueHelp");o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.usageDesc=e.results[0].TXT;r.currentObj.lHeader.tlusg=n;l.setData(r.currentObj);r.readHdrDefaults("usage",r.index,r.currentObj)}else{r.currentObj.lHeader.usgValueState="Error";r.currentObj.lHeader.usageDesc="";r.currentObj.lHeader.usgValueStateTxt="Invalid Entry";l.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.usgValueState="Error";r.currentObj.lHeader.usgValueStateTxt=a;l.setData(r.currentObj)}})}else{r.currentObj.lHeader.tlusg=n;r.currentObj.lHeader.usageDesc="";l.setData(r.currentObj)}},_plannerGrp:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getView().getModel("tlDetailModel");var n=l.getData();var s=n.lHeader.Iwerk;var i=a.replace(/^[ ]+|[ ]+$/g,"");if(i!==""){var o="/PlannerGroupTLSet";var p=[new sap.ui.model.Filter("Ingrp","EQ",a),new sap.ui.model.Filter("Iwerk","EQ",s)];var u=this.getView().getModel("valueHelp");u.read(o,{filters:p,success:function(e){if(e.results.length>0){r.currentObj.lHeader.plGrpDesc=e.results[0].Innam;r.currentObj.lHeader.Vagrp=i;l.setData(r.currentObj)}else{r.currentObj.lHeader.plGrpValueState="Error";r.currentObj.lHeader.plGrpDesc="";r.currentObj.lHeader.plGrpValueStateTxt="Invalid Entry";l.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.plGrpValueState="Error";r.currentObj.lHeader.plGrpValueStateTxt=a;l.setData(r.currentObj)}})}else{r.currentObj.lHeader.Vagrp=i;r.currentObj.lHeader.plGrpDesc="";l.setData(r.currentObj)}},_status:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getView().getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/StatusVHSet";var i=new sap.ui.model.Filter("PLNST","EQ",a);var o=this.getView().getModel("valueHelp");o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.statusDesc=e.results[0].TXT;r.currentObj.lHeader.Statu=n;l.setData(r.currentObj)}else{r.currentObj.lHeader.statusVS="Error";r.currentObj.lHeader.statusDesc="";r.currentObj.lHeader.statusVST="Invalid Entry";l.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.statusVS="Error";r.currentObj.lHeader.statusVST=a;l.setData(r.currentObj)}})}else{r.currentObj.lHeader.Statu=n;r.currentObj.lHeader.statusDesc="";l.setData(r.currentObj)}},_sysCond:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/SystemConditionSet";var i=new sap.ui.model.Filter("ANLZU","EQ",a);var o=this.getView().getModel("valueHelp");o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.sysCondDesc=e.results[0].ANLZUX;r.currentObj.lHeader.Anlzu=n;l.setData(r.currentObj)}else{r.currentObj.lHeader.sysCondValueState="Error";r.currentObj.lHeader.sysCondDesc="";r.currentObj.lHeader.sysCondValueStateTxt="Invalid Entry";l.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.sysCondValueState="Error";r.currentObj.lHeader.sysCondValueStateTxt=a;l.setData(r.currentObj)}})}else{r.currentObj.lHeader.Anlzu=n;r.currentObj.lHeader.sysCondDesc="";l.setData(r.currentObj)}},_maintStrat:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/StrategyVHSet";var i=new sap.ui.model.Filter("Strat","EQ",a);var o=this.getView().getModel("valueHelp");o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.stratDesc=e.results[0].Ktext;r.currentObj.lHeader.Strat=n;l.setData(r.currentObj);r.getView().byId("idTabMaintPckg").setVisible(true);r.readMaintPckgConfig(r.currentObj.lHeader.Strat)}else{r.currentObj.lHeader.maintStrValueState="Error";r.currentObj.lHeader.stratDesc="";r.currentObj.lHeader.maintStrValueStateTxt="Invalid Entry";l.setData(r.currentObj);r.getView().byId("idTabMaintPckg").setVisible(false)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.maintStrValueState="Error";r.currentObj.lHeader.maintStrValueStateTxt=a;l.setData(r.currentObj);r.getView().byId("idTabMaintPckg").setVisible(false)}})}else{r.currentObj.lHeader.Strat=n;r.currentObj.lHeader.maintStrValueState="None";r.currentObj.lHeader.stratDesc="";l.setData(r.currentObj);r.getView().byId("idTabMaintPckg").setVisible(false)}},_assmbly:function(e,t){var r=this;var a=e.toUpperCase();var l=this.getModel("tlDetailModel");var n=a.replace(/^[ ]+|[ ]+$/g,"");if(n!==""){var s="/MaterialVH_PRTSet";var i=new sap.ui.model.Filter("Matnr","EQ",a);var o=this.getView().getModel("valueHelp");o.read(s,{filters:[i],success:function(e){if(e.results.length>0){r.currentObj.lHeader.assmblyDesc=e.results[0].Maktg;r.currentObj.lHeader.assmbly=n;l.setData(r.currentObj)}else{r.currentObj.lHeader.assemblyValueState="Error";r.currentObj.lHeader.assmblyDesc="";r.currentObj.lHeader.assemblyValueStateTxt="Invalid Entry";l.setData(r.currentObj)}},error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;r.currentObj.lHeader.assemblyValueState="Error";r.currentObj.lHeader.assemblyValueStateTxt=a;l.setData(r.currentObj)}})}else{r.currentObj.lHeader.assmbly=n;r.currentObj.lHeader.assmblyDesc="";l.setData(r.currentObj)}},onHeaderChange:function(e){var t=this.getView().getModel("tlDetailModel");var r=t.getData();var a=e.getSource().getBindingInfo("value").binding.sPath;var l=e.getParameters().newValue;var n=e.getSource().getBindingContext("tlDetailModel").sPath;var s=parseInt(n.substr(-1));var i=this;var o=this.getView().getModel("valueHelp");if(a==="Iwerk"){if(l!==""){var p=l.toUpperCase();var u="/PlantVHSet";var d=[new sap.ui.model.Filter("WERKS","EQ",p)];o.read(u,{filters:d,success:function(e){if(e.results.length>0){r.header[s].valueStatePP="None";r.header[s].Iwerk=p;r.header[s].pPlantDesc=e.results[0].NAME1;i.readHdrDefaults("planningPlant",s,r)}else{r.header[s].valueStatePP="Error";t.setData(r);i.getView().setModel(t,"tlDetailModel")}},error:function(e){r.header[s].valueStatePP="Error";t.setData(r);i.getView().setModel(t,"tlDetailModel")}})}else{r.header[s].valueStatePP="Error";t.setData(r);this.getView().setModel(t,"tlDetailModel")}}if(a==="Statu"){if(l!==""){p=l.toUpperCase();var u="/StatusVHSet";var d=[new sap.ui.model.Filter("PLNST","EQ",p)];o.read(u,{filters:d,success:function(e){if(e.results.length>0){r.header[s].valueStateS="None";r.header[s].Statu=p;r.header[s].statusDesc=e.results[0].TXT;i.readHdrDefaults("status",s,r)}else{r.header[s].valueStateS="Error";t.setData(r);i.getView().setModel(t,"tlDetailModel")}},error:function(e){r.header[s].valueStateS="Error";t.setData(r);i.getView().setModel(t,"tlDetailModel")}})}else{r.header[s].valueStateS="Error";this.getView().setModel(t,"tlDetailModel")}}if(a==="Verwe"){if(l!==""){p=l.toUpperCase();var u="/UsageVHSet";var d=[new sap.ui.model.Filter("VERWE","EQ",p)];o.read(u,{filters:d,success:function(e){if(e.results.length>0){r.header[s].valueStateU="None";r.header[s].Verwe=p;r.header[s].usageDesc=e.results[0].TXT;i.readHdrDefaults("usage",s,r)}else{r.header[s].valueStateU="Error";t.setData(r);i.getView().setModel(t,"tlDetailModel")}},error:function(e){r.header[s].valueStateU="Error";t.setData(r);i.getView().setModel(t,"tlDetailModel")}})}else{r.header[s].valueStateU="Error";this.getView().setModel(t,"tlDetailModel")}}if(a==="Ktext"){if(l!==""){r.header[s].valueStateT="None";r.header[s].Ktext=l;i.readHdrDefaults("tlDesc",s,r)}else{r.header[s].valueStateT="Error";this.getView().setModel(t,"tlDetailModel")}}},onOperationChange:function(e){var t=this.getView().byId("operationTab").getModel("tlDetailModel");var r=t.getData();var a=e.getSource().getBindingInfo("value").binding.sPath;var l=e.getParameters().newValue;var n=e.getSource().getBindingContext("tlDetailModel").sPath;var s=parseInt(n.substr(-1));var i=this;var o=i.getView().getModel("tlDetailModel");var p=o.getData();var u=p.lHeader.Iwerk;var d=this.getView().getModel("valueHelp");if(a==="Vornr"){if(l!==""){r.lOperation[s].opState="None";r.lOperation[s].Vornr=l;t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}else{r.lOperation[s].opState="Error";t.setData(r);this.getView().byId("operationTab").setModel(t,"tlDetailModel")}}if(a==="Ltxa1"){if(l!==""){r.lOperation[s].opDescState="None";r.lOperation[s].Ltxa1=l;if(r.lMaintPckg.length>0){r.lMaintPckg[s].Ltxa1=l}t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}else{r.lOperation[s].opDescState="Error";if(r.lMaintPckg.length>0){r.lMaintPckg[s].Ltxa1=""}t.setData(r);this.getView().byId("operationTab").setModel(t,"tlDetailModel")}}if(a==="Arbpl"){if(l!==""){var c=l.toUpperCase();if(u===null||u===""){var g="/WorkCenterVHSet";var h=[new sap.ui.model.Filter("Arbpl","EQ",c)]}else{var g="/WorkCenterVHSet";var h=[new sap.ui.model.Filter("Arbpl","EQ",c),new sap.ui.model.Filter("Werks","EQ",u)]}var m=false;var f=sap.ui.getCore().getModel("AIWListWCModel").getData();if(f.length>0){for(var v=0;v<f.length;v++){if(f[v].wc===c){r.lOperation[s].Arbpl=f[v].wc;r.lOperation[s].Steus=f[v].ctrlKey;i.ctrlKey=f[v].ctrlKey;r.lOperation[s].wcState="None";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel");i.WCPPCheck(f[v].Werks);m=true}}}if(m===true){return}else{d.read(g,{filters:h,success:function(e){if(e.results.length>0){r.lOperation[s].Arbpl=e.results[0].Arbpl;r.lOperation[s].Steus=e.results[0].Steus;r.lOperation[s].Larnt=e.results[0].Lar01;i.ctrlKey=e.results[0].Steus;r.lOperation[s].Werks=e.results[0].Werks;r.lOperation[s].wcState="None";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel");i.WCPPCheck(e.results[0].Werks)}else{r.lOperation[s].wcState="Error";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}},error:function(e){r.lOperation[s].wcState="Error";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel");var a=JSON.parse(e.responseText);var l=a.error.message.value;if(l!==""&&l!==null&&l!==undefined){i.showMessage(l)}}})}}else{r.lOperation[s].wcState="Error";t.setData(r);this.getView().byId("operationTab").setModel(t,"tlDetailModel")}}if(a==="Werks"){if(l!==""){c=l.toUpperCase();var g="/PlanningPlantSet";var h=[new sap.ui.model.Filter("Werks","EQ",c)];d.read(g,{filters:h,success:function(e){if(e.results.length>0){r.lOperation[s].Werks=e.results[0].Werks;r.lOperation[s].plantDesc=e.results[0].Name1;r.lOperation[s].plantState="None";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}else{r.lOperation[s].plantState="Error";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}},error:function(e){r.lOperation[s].plantState="Error";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}})}else{r.lOperation[s].plantState="Error";t.setData(r);this.getView().byId("operationTab").setModel(t,"tlDetailModel")}}if(a==="Steus"){if(l!==""){c=l.toUpperCase();var b=this.getView().getModel("valueHelp");var g="/ControlKeySet";var h=[new sap.ui.model.Filter("Steus","EQ",c)];b.read(g,{filters:h,success:function(e){if(e.results.length>0){r.lOperation[s].Steus=e.results[0].Steus;r.lOperation[s].ctrlkeyDesc=e.results[0].Txt;r.lOperation[s].ctrlKeyState="None";i.ctrlKey=e.results[0].Steus;t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel");if(r.lOperation[s].Steus==="PM03"||r.lOperation[s].Steus==="PM05"){p.lHeader.bAddSrvOpOrvw=true}else{p.lHeader.bAddSrvOpOrvw=false}o.refresh()}else{r.lOperation[s].ctrlKeyState="Error";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}},error:function(e){r.lOperation[s].ctrlKeyState="Error";t.setData(r);i.getView().byId("operationTab").setModel(t,"tlDetailModel")}})}else{r.lOperation[s].ctrlKeyState="Error";t.setData(r);this.getView().byId("operationTab").setModel(t,"tlDetailModel")}}},WCPPCheck:function(e){var t=this;var r;var a=this.getView().getModel();var l=this.getView().getModel("tlDetailModel");var n=l.getData();r="/WorkcentrePlantValSet(Werks='"+n.lOperation[t.index].Werks+"',Tarbpl='"+n.lOperation[t.index].Arbpl+"',Wcplant='"+e+"') ";a.read(r,{success:function(e){n.lOperation[t.index].wcState="None";l.setData(n);l.refresh()},error:function(e){var r=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){r[0]=JSON.parse(e.responseText).error.message.value}else{for(var a=0;a<JSON.parse(e.responseText).error.innererror.errordetails.length;a++){r[a]=JSON.parse(e.responseText).error.innererror.errordetails[a].message}}var s=r.join("\n");sap.m.MessageBox.show(s,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}});n.lOperation[t.index].wcState="Error";l.setData(n);l.refresh()}})},onComponentChange:function(e){var t=this.getView().byId("components").getModel("tlDetailModel");var r=t.getData();var a=e.getSource().getBindingInfo("value").binding.sPath;var l=e.getParameters().newValue;var n=e.getSource().getBindingContext("tlDetailModel").sPath;var s=parseInt(n.substr(-1));var i=this;var o=this.getView().getModel("valueHelp");var p=this.getView().getModel("tlDetailModel").getData();var u=p.header.length;var d;if(a==="Idnrk"){if(l!==""){d=l.toUpperCase();var c="/MaterialVH_PRTSet";var g=[new sap.ui.model.Filter("Matnr","EQ",d)];o.read(c,{filters:g,success:function(e){if(e.results.length>0){r.lComponent[s].Idnrk=d;r.lComponent[s].matDesc=e.results[0].Maktg;r.lComponent[s].matState="None";var a=e.results[0].Matnr;var l=r.lHeader.Iwerk;i.index=s;var n=i.deriveMatDetails(a,l);t.setData(r);i.getView().byId("components").setModel(t,"tlDetailModel")}else{r.lComponent[s].matState="Error";t.setData(r);i.getView().byId("components").setModel(t,"tlDetailModel")}},error:function(e){r.lComponent[s].matState="Error";t.setData(r);i.getView().byId("components").setModel(t,"tlDetailModel")}})}else{r.lComponent[s].matState="Error";t.setData(r);this.getView().byId("components").setModel(t,"tlDetailModel")}}if(a==="Menge"){if(l!==""){r.lComponent[s].qtyState="None";r.lComponent[s].Menge=l;t.setData(r);i.getView().byId("components").setModel(t,"tlDetailModel")}else{r.lComponent[s].qtyState="Error";t.setData(r);this.getView().byId("components").setModel(t,"tlDetailModel")}}if(a==="MeinsGcp"){if(l!==""){d=l.toUpperCase();var h=this.getView().getModel("valueHelp");var c="/QuantityUOMSet";var g=[new sap.ui.model.Filter("Mseh3","EQ",d)];h.read(c,{filters:g,success:function(e){if(e.results.length>0){r.lComponent[s].MeinsGcp=d;r.lComponent[s].qtyUnitState="None";t.setData(r);i.getView().byId("components").setModel(t,"tlDetailModel")}else{r.lComponent[s].qtyUnitState="Error";t.setData(r);i.getView().byId("components").setModel(t,"tlDetailModel")}},error:function(e){r.lComponent[s].qtyUnitState="Error";t.setData(r);i.getView().byId("components").setModel(t,"tlDetailModel")}})}else{r.lComponent[s].qtyUnitState="Error";t.setData(r);this.getView().byId("components").setModel(t,"tlDetailModel")}}},tlOperationPress:function(e){this._showTlOperationDetail(e.getSource())},_showTlOperationDetail:function(e){var t=e.oBindingContexts.tlDetailModel.sPath;var r=t.split("/")[2];var a={opDetFlag:true,opIndex:r.toString()};sap.ui.getCore().setModel(a,"oOpFlag");this.getRouter().navTo("tlOprDetail",{action:this.action,basicPath:encodeURIComponent(this.basicPath),mainPath:encodeURIComponent(this.mainPath),itemPath:encodeURIComponent(t),wc:" ",wcPlant:" ",ctrlKey:" ",mode:this.mode})},tlComponentPress:function(e){this.showComponentDetail(e.getSource())},showComponentDetail:function(e){var t=e.oBindingContexts.tlDetailModel.sPath;if(this.mode!=="display"){var r=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var a=r.split("/")[2]}else{var a=t.split("/")[2]}var l={opDetFlag:true,opIndex:a};sap.ui.getCore().setModel(l,"oOpFlag");this.getRouter().navTo("tlComponent",{itemPath:encodeURIComponent(t),mode:this.mode})},getObTab:function(){var e=sap.ui.getCore().getModel("EAMCRModel");var t=e.getData();var r="";if(this.action.indexOf("GTL")>0){for(var a=0;a<t.length;a++){if(t[a].Obtab==="PLKO"&&t[a].ObjLabel.indexOf("General Task List")>-1){r=t[a].Obtab;break}}}else if(this.action.indexOf("ETL")>0){for(var a=0;a<t.length;a++){if(t[a].Obtab==="PLKO"&&t[a].ObjLabel.indexOf("Equipment Task List")>-1){r=t[a].Obtab;break}}}else if(this.action.indexOf("FTL")>0){for(var a=0;a<t.length;a++){if(t[a].Obtab==="PLKO"&&t[a].ObjLabel.indexOf("Functional Location Task List")>-1){r=t[a].Obtab;break}}}return r},attachRequest:function(){var e=this.getView().createId("clsFrag");var t=this.getView().createId("charFrag");var r=sap.ui.core.Fragment.byId(e,"type");var a=sap.ui.core.Fragment.byId(e,"class");var l=sap.ui.core.Fragment.byId(e,"status");var n=sap.ui.core.Fragment.byId(t,"charName");var s=sap.ui.core.Fragment.byId(t,"charValue");var o=sap.ui.core.Fragment.byId(t,"charValueAdd");var p=sap.ui.core.Fragment.byId(t,"charValueClear");var u=sap.ui.core.Fragment.byId(t,"charValueDelete");var d=this;o.attachPress(function(e){i.handleSelCharAdd(e)});p.attachPress(function(e){i.handleCharClear(e)});u.attachPress(function(e){i.charRowDeletePress(e)});s.attachChange(function(e){d.onChange(e)})},valueHelpSelect:function(e){var t=this.getObTab();var r=e.getSource().getId().split("tskL--");r=r[1];if(e.getSource().getId().indexOf("type")>-1){i.valueHelpClassSelect("type",this,t,e)}else if(e.getSource().getId().indexOf("class")>-1){i.valueHelpClassSelect("class",this,t,e)}else if(e.getSource().getId().indexOf("status")>-1){i.valueHelpClassSelect("status",this,t,e)}else if(e.getSource().getId().indexOf("charName")>-1){i.valueHelpCharSelect("charName",this,t,e)}else if(e.getSource().getId().indexOf("charValue")>-1){var a=e.getSource().getParent().getBindingContext().getPath();i.valueHelpCharSelect("charValue",this,t,e,a)}},onChange:function(e){var t=this.getObTab();var r=e.getSource().getId().split("tskL--");r=r[1];if(e.getSource().getId().indexOf("type")>-1){i.onClassChange("type",this,t,e)}else if(e.getSource().getId().indexOf("class")>-1){i.onClassChange("class",this,t,e)}else if(e.getSource().getId().indexOf("status")>-1){i.onClassChange("status",this,t,e)}else if(e.getSource().getId().indexOf("charName")>-1){i.onCharChange("charName",this,e)}else if(e.getSource().getId().indexOf("charValue")>-1){i.onCharChange("charValue",this,e)}},onCharChange:function(e){var t=this.getObTab(this.oModelName);var r=e.getSource().getId().split("tskL--");r=r[1];if(e.getSource().getId().indexOf("charValueAdd")>-1){i.handleSelCharAdd("charValueAdd",this,t,e)}else if(e.getSource().getId().indexOf("charValueClear")>-1){i.handleCharClear("charValueClear",this,t,e)}else if(e.getSource().getId().indexOf("status")>-1){i.onClassChange("status",this,t,e)}else if(e.getSource().getId().indexOf("charName")>-1){i.onCharChange("charName",this,e)}},handleClassRowAdd:function(){var e=this.getObTab();i.classRowAddPress(this,e)},handleCharRowAdd:function(){i.charRowAddPress(this)},handleCharRowDelete:function(e){var t=this.getObTab();i.charRowDeletePress(e,this,t)},handleClassRowDelete:function(e){i.classRowDeletePress(e,this)},onClassSelect:function(e){i.classSelectPress(e,this)},onSelect:function(e){i.selectPress(e,this)},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var r=[];var a,l=this._getMessagePopover();if(typeof e==="string"){r.push({type:t,title:e,message:e})}else if(Array.isArray(e)){r=e;for(var n=0;n<r.length;n++){r[n].message=r[n].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var n=0;n<r.length;n++){a=new p({message:r[n].message,type:r[n].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(a)}l.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(r.length+"")},onCompSelectionpress:function(e){var r=this;if(!this.dlgCompSelection){this.dlgCompSelection=sap.ui.xmlfragment("ugiaiwui.mdg.aiw.request.Fragments.TL.CompSelection",this);this.getView().addDependent(this.dlgCompSelection)}var l=this.getView().getModel("tlDetailModel");var n=l.getData();if(n.lHeader.assmbly&&n.lHeader.assmbly!==""){var s=this.getView().getModel("valueHelp");var i="/CompHierSet";var o=[new sap.ui.model.Filter("Istru","EQ",n.lHeader.assmbly),new sap.ui.model.Filter("Werks","EQ",n.lHeader.Iwerk),new sap.ui.model.Filter("Keydate","EQ",a._formatDate(n.validFrm))];if(this.action.indexOf("ETL")>0){o.push(new sap.ui.model.Filter("Equnr","EQ",n.equipment))}else if(this.action.indexOf("FTL")>0){o.push(new sap.ui.model.Filter("Tplnr","EQ",n.floc))}var p=new u;p.open();s.read(i,{filters:o,success:function(e){p.close();var a=r.getTreeTblData(e.results);var l=new t(a);var n=sap.ui.getCore().byId("idCompSelTbl");n.setModel(l);r.dlgCompSelection.open();r.SelectedComponents=[]},error:function(e){p.close();var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var a=t.join("\n");sap.m.MessageBox.show(a,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})}else{var d=new t([]);var c=sap.ui.getCore().byId("idCompSelTbl");c.setModel(d);this.dlgCompSelection.open()}},getTreeTblData:function(e){var t=[];var r={};if(e){var a;for(var l=0;l<e.length;l++){var n=e[l];a=n;a.IsSelect=false;a.children=[];if(n.ParentKey&&n.ParentKey.length>0){var s=r[n.ParentKey];if(s){s.children.push(a)}}else{t.push(a)}r[a.RowKey]=a}return t}},onCompSelChoosePress:function(){var e=sap.ui.getCore().byId("idCompSelTbl");var t=e.getModel();var r=this.getView().getModel("tlDetailModel");var a=r.getData();if(this.SelectedComponents.length>0){for(var l=0;l<this.SelectedComponents.length;l++){this.SelectedComponents[l].Vornr=this.opNum;this.SelectedComponents[l].Plnal=this.grpCounter;var n=(a.lComponent.length+1).toString();this.SelectedComponents[l].slNo=n;this.SelectedComponents[l].flag=this.grpCounter+"-"+this.opNum+"-"+n;this.SelectedComponents[l].hFlag=this.grpCounter+"-"+this.opNum;this.SelectedComponents[l].group=a.grp;this.SelectedComponents[l].groupCounter=this.grpCounter;this.SelectedComponents[l].activity=this.opNum;this.SelectedComponents[l].cmpCompEnable=true;this.SelectedComponents[l].cmpEnable=true;this.SelectedComponents[l].cmpVisible=false;a.lComponent.push(this.SelectedComponents[l])}}r.setData(a);this.getView().byId("components").getModel("tlDetailModel").refresh();var s=[];if(this.cmpData!==null){var i=this.SelectedComponents;for(var o=0;o<i.length;o++){for(var p=0;p<this.cmpData.length;p++){if(i[o].hFlag!==this.cmpData[p].hFlag){s.push(C[o])}}}if(this.cmpData!==null){Array.prototype.push.apply(this.cmpData,s)}}this.SelectedComponents=[];this.dlgCompSelection.close()},onCompSelCancelPress:function(){this.SelectedComponents=[];this.dlgCompSelection.close()},onCompSelRowSelect:function(e){var t=e.getParameter("selected");var r=e.getSource().getBindingContext().getObject();if(t){var a={};a.Idnrk=r.Idnrk;a.matDesc=r.Maktx;a.Menge=r.Kmpmg;a.MeinsGcp=r.Kmpme;a.Postp=r.Postp;a.Stltygcmp=r.Stlty;a.Stlnrgcmp=r.Stlnr;a.Stlal=r.Stlal;this.SelectedComponents.push(a)}else{var l=r.Idnrk;for(var n=0;n<this.SelectedComponents.length;n++){if(this.SelectedComponents[n].Idnrk===l){this.SelectedComponents.pop(n)}}}},addOprRel:function(){var e=this;var t=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var r=e.getModel("tlDetailModel").getProperty(t+"/OprRel");r.push({Plnal:this.grpCounter,Vornr:this.opNum,OperationOR:"",Offset:"",OUn:"",RelType:"",PO:"",OI:"",ID:"",WrkCtrOR:"",PlantOR:"",OperationORVS:"None",OffsetVS:"None",OUnVS:"None",RelTypeVS:"None",POVS:"None",OIVS:"None",IDVS:"None",WrkCtrORVS:"None",PlantORVS:"None"});e.getModel("tlDetailModel").setProperty(t+"/OprRel",r);e.getModel("tlDetailModel").setProperty("/lOprRel",r);e.getModel("tlDetailModel").refresh()},deleteOprRel:function(e){var t=e.getSource();var r=e.getParameter("listItem").getBindingContext("tlDetailModel").sPath;r=r.substring(r.lastIndexOf("/")+1);var a=t.getModel("tlDetailModel");var l=a.getProperty("/lOprRel");l.splice(parseInt(r),1);a.setProperty("/lOprRel",l);this.getModel("tlDetailModel").setProperty("/lOprRel",l)},onOffUnitVH:function(e){d.UOMVH(e,this)},onOffUnitChange:function(e){d._UOMchange(e,this)},onRelTypeVH:function(e){d.RelTypeVH(e,this)},onRelTypeChange:function(e){d._changeRelType(e,this)},onOffIntrpVH:function(e){d.OffIntrpVH(e,this)},onOffIntrpChange:function(e){d._changeOffIntrp(e,this)},onFactryIdVH:function(e){d.FactryIdVH(e,this)},onFactryIdChange:function(e){d._changeFactryId(e,this)},onWrkCtrORVH:function(e){d.WrkCtrORVH(e,this)},onWrkCtrORChange:function(e){d._changeWrkCtrOR(e,this)},onPlantORVH:function(e){d.PlantORVH(e,this)},onPlantORChange:function(e){d._changePlantOR(e,this)},onOperationORChange:function(e){var t=e.getSource();var r=t.getValue();var a=this.getView().getModel("tlDetailModel");var l=a.getData();var n=l.lOperation;var s=false;t.setValueState("None");if(r===""){return}for(var i=0;i<n.length;i++){if(r===n[i].Vornr){s=true;break}}if(s){var o=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var p=a.getProperty(o).Vornr;if(r!==p){s="Valid"}else{s="Inalid"}}var u=[];if(s===false){u.push({type:"Error",title:"Operation does not exist"});this.createMessagePopover(u,"");t.setValueState("Error")}else if(s==="Inalid"){u.push({type:"Error",title:"Cannot create operation relationship for itself"});this.createMessagePopover(u,"");t.setValueState("Error")}else{t.setValueState("None")}},addSrvPckgOvrw:function(e){var t=this;var r=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var a=t.getModel("tlDetailModel").getProperty(r+"/SrvPckgOvrw");var l="";if(a.length<1){l="10"}else{var n=a[a.length-1].LineNum;var l=(parseInt(n)+10).toString()}a.push({group:this.group,Plnal:this.grpCounter,Vornr:this.opNum,LineNum:l,DelIndSP:false,ActNum:"",ShrtTxt:"",Qty:"",BUomSP:"",GrossPrc:"",CurKey:"",Work:"",UnitOfWork:"",ActNumVS:"None",ShrtTxtVS:"None",QtyVS:"None",BUomSPVS:"None",GrossPrcVS:"None",CurKeyVS:"None",WorkVS:"None",UnitOfWorkVS:"None",DelIndSPEnabled:false,SPEnabled:true});t.getModel("tlDetailModel").setProperty(r+"/SrvPckgOvrw",a);t.getModel("tlDetailModel").setProperty("/lSrvPckgOvrw",a);t.getModel("tlDetailModel").refresh()},deleteSrvPckgOvrw:function(e){var t=e.getSource();var r=e.getParameter("listItem").getBindingContext("tlDetailModel").sPath;r=r.substring(r.lastIndexOf("/")+1);var a=t.getModel("tlDetailModel");var l=a.getProperty("/lSrvPckgOvrw");l.splice(parseInt(r),1);a.setProperty("/lSrvPckgOvrw",l);this.getModel("tlDetailModel").setProperty("/lSrvPckgOvrw",l)},tlSrvPckgOvrwDetailPress:function(e){var t=e.getSource();if(this.mode!=="display"){var r=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var a=r.split("/")[2];var l={opDetFlag:true,opIndex:a};sap.ui.getCore().setModel(l,"oOpFlag")}var n=t.oBindingContexts.tlDetailModel.sPath;this.getRouter().navTo("tlSrvPckge",{itemPath:encodeURIComponent(n),mode:this.mode})},onActNumVH:function(e){d.ActNumVH(e,this)},onActNumChange:function(e){d._ActNumchange(e,this)},onBUomSPVH:function(e){d.UOMVH(e,this)},onBUomSPChange:function(e){d._UOMchange(e,this)},onQtySPOchange:function(e){d.Qtychange(e,this)},onShrtTxtchange:function(e){d.ShrtTxtchange(e,this)},deriveActQty:function(e,t,r){var a=this;var l=this.getView().getModel("valueHelp2");var n=this.getView().getModel("tlDetailModel");var i=e.getBindingInfo("value").binding.getContext().getPath();var o=n.getProperty(i);var p=n.getData();if(t){o.UnitOfWork=t}if(r){o.BUomSP=r}var u="/SpackWrkDrvSet";var d=[new sap.ui.model.Filter("Meins","EQ",o.BUomSP),new sap.ui.model.Filter("Iwein","EQ",o.UnitOfWork),new sap.ui.model.Filter("Srvpos","EQ",o.ActNum),new sap.ui.model.Filter("IAmount","EQ",o.Qty)];l.read(u,{filters:d,success:function(e){if(e.results.length>0){var t=e.results[0];o.BUomSP=t.Meins;o.Work=t.OAmount;o.ActNum=t.Srvpos;o.Qty=t.IAmount;o.UnitOfWork=t.Iwein;n.refresh()}},error:function(e){var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var a=t.join("\n");s.show(a,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},onInspPointVH:function(e){d.InspPointVH(e,this)},onInspPointChange:function(e){d._InspPointchange(e,this)},readMaintPckgConfig:function(e,r,a){var l=this;var n=this.getView().getModel("valueHelp2");var i=this.getView().getModel("tlDetailModel");var o=i.getData();var p="/MpackSet";var u=[new sap.ui.model.Filter("Strat","EQ",e)];n.read(p,{filters:u,success:function(e){l.maintPckg=e.results;sap.ui.getCore().setModel(new t(l.maintPckg),"maintPckgResults");l.maintPckgCols=["Vornr","SOp","Ltxa1"];for(var n=0;n<e.results.length;n++){l.maintPckgCols.push(e.results[n].Paket)}if(a==="Appr"){var s=l.getView().byId("idTblApprMaintPckg")}else{var s=l.getView().byId("idTblMaintPckge")}s.destroyColumns();s.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Op"})}));s.addColumn(new sap.m.Column({header:new sap.m.Label({text:"SOp"})}));s.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Op Short Text"})}));for(var n=0;n<e.results.length;n++){s.addColumn(new sap.m.Column({header:new sap.m.Label({text:e.results[n].Paket})}))}l.defaultCreateMaintPckg(r,a)},error:function(e){var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var r=0;r<JSON.parse(e.responseText).error.innererror.errordetails.length;r++){t[r]=JSON.parse(e.responseText).error.innererror.errordetails[r].message}}var a=t.join("\n");s.show(a,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},createMaintPckgData:function(e){var t=this;var r=t.getView().getModel("tlDetailModel");var a=r.getData();var l=t.getView().byId("idTblMaintPckge");var n={Plnal:this.grpCounter,Vornr:e.Vornr,Strat:a.lHeader.Strat,SOp:"",Ltxa1:e.Ltxa1,MPArr:[],flag:this.grpCounter+"-"+e.Vornr};t.maintPckg.forEach(function(e){n[e.Paket]=false});if(!a.MaintPckg){a.MaintPckg=[]}if(!a.lMaintPckg){a.lMaintPckg=[]}a.lMaintPckg.push(n);var s=[];for(var i=0;i<t.maintPckgCols.length;i++){if(i<3){s.push(new sap.m.Text({text:"{"+t.maintPckgCols[i]+"}"}))}else{s.push(new sap.m.CheckBox({selected:"{"+t.maintPckgCols[i]+"}",select:t.maintPckgColSelect}))}}var o=new sap.m.ColumnListItem({type:"Active",unread:false,cells:s});var p=new sap.ui.model.json.JSONModel;p.setData(a.lMaintPckg);l.setModel(p);l.bindAggregation("items","/",o)},maintPckgColSelect:function(e){var t=this;var r=e.getParameter("selected");var a=e.getSource().getBindingContext().getObject();var l=e.getSource().getBindingInfo("selected").parts[0].path;if(r){var n=sap.ui.getCore().getModel("maintPckgResults").getData();var s=$.map(n,function(e){return $.extend(true,{},e)});var i={};for(var o in s){if(s[o].Paket===l){i=s[o];break}}i.Vornr=a.Vornr;i.Plnal=a.Plnal;i.MPEnable=true;a.MPArr.push(i);a[l]=true}else{for(var p in a.MPArr){if(a.MPArr[p].Paket===l){a.MPArr.splice(p,1);break}}a[l]=false}},defaultCreateMaintPckg:function(e,t){var r=this;if(t==="Appr"){var a=r.getView().byId("idTblApprMaintPckg");var l=false}else{var a=r.getView().byId("idTblMaintPckge");var l=true}var n=r.getView().getModel("tlDetailModel");var s=n.getData();var i=[];if(s.lOperation&&s.lOperation.length>0){i=s.lOperation}else if(s.Operation&&s.Operation.length>0){i=s.Operation}else{return}var o=[];for(var p=0;p<i.length;p++){if(!e){var u={Plnal:this.grpCounter,Vornr:i[p].Vornr,Strat:s.lHeader.Strat,SOp:"",Ltxa1:i[p].Ltxa1,MPArr:[],flag:this.grpCounter+"-"+i[p].Vornr};r.maintPckg.forEach(function(e){u[e.Paket]=false});s.lMaintPckg.push(u)}for(var d=0;d<r.maintPckgCols.length;d++){if(d<3){o.push(new sap.m.Text({text:"{"+r.maintPckgCols[d]+"}"}))}else{o.push(new sap.m.CheckBox({selected:"{"+r.maintPckgCols[d]+"}",select:r.maintPckgColSelect,enabled:l}))}}}var c=new sap.m.ColumnListItem({type:"Active",unread:false,cells:o});var g=new sap.ui.model.json.JSONModel;g.setData(s.lMaintPckg);a.setModel(g);a.bindAggregation("items","/",c)},navMaintPckgeDetail:function(){if(this.mode!=="display"){var e=this.getView().byId("idTblMaintPckge")}else{var e=this.getView().byId("idTblApprMaintPckg")}if(e.getSelectedItem()!==null){var t=e.getSelectedItem().getBindingContext().getPath();t=t.split("/")[1];if(this.mode!=="display"){var r={opDetFlag:true,opIndex:t};sap.ui.getCore().setModel(r,"oOpFlag")}this.getRouter().navTo("tlMaintPckg",{itemPath:t,mode:this.mode})}},onPRTMenuAction:function(e){var t=e.getParameter("item").getKey();var r="";switch(t){case"mat":r="M";break;case"eq":r="E";break;case"mspt":r="P";break;case"doc":r="D";break;case"oth":r="O";break}this.addPRT(r)},addPRT:function(e){var t=this;var r=t.getView().getModel("tlDetailModel");var a=r.getData();if(this.getView().byId("operationTab").getSelectedItem()){var l=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath}else{return}var n=t.getModel("tlDetailModel").getProperty(l+"/PRT");var s=t.getModel("tlDetailModel").getProperty(l);var i="";if(n.length<1){i="10"}else{var o=n[n.length-1].ItmNum;var i=(parseInt(o)+10).toString()}var p={grp:a.grp,Plnal:a.lHeader.Plnal,Vornr:t.getModel("tlDetailModel").getProperty(l).Vornr,Ltxa1:t.getModel("tlDetailModel").getProperty(l).Ltxa1,ItmNum:i,ItmCat:e,PRT:"",PRTDesc:"",Mat:"",MatDesc:"",Equi:"",EquiDesc:"",Mspt:"",MsptDesc:"",doc:"",docDesc:"",docType:"",docTypeDesc:"",docPart:"",docVersion:"",Othr:"",OthrDesc:"",Qty:"1",UOM:"EA",QtyFrmla:"",PRTCtrl:"1",PRTCtrlDesc:"All Functions",StdUsgVal:"",StdUsgUOM:"",UsgValFrmla:"",prtEnable:true,PRTVS:"None",PlantVS:"None",QtyVS:"None",UOMVS:"None",QtyFrmlaVS:"None",PRTCtrlVS:"None",StdUsgValVS:"None",StdUsgUOMVS:"None",UsgValFrmlaVS:"None"};if(e==="M"){p.title="Material";p.matEnable=true;p.eqEnable=false;p.msptEnable=false;p.docEnable=false;p.othEnable=false;p.Plant=s.Werks}else if(e==="E"){p.title="Equipment";p.matEnable=false;p.eqEnable=true;p.msptEnable=false;p.docEnable=false;p.othEnable=false}else if(e==="P"){p.title="Measuring Point";p.matEnable=false;p.eqEnable=false;p.msptEnable=true;p.docEnable=false;p.othEnable=false}else if(e==="D"){p.title="Document";p.matEnable=false;p.eqEnable=false;p.msptEnable=false;p.docEnable=true;p.othEnable=false;p.docType="";p.docTypeDesc="";p.docPart="";p.docVersion=""}else if(e==="O"){p.title="Others";p.matEnable=false;p.eqEnable=false;p.msptEnable=false;p.docEnable=false;p.othEnable=true}n.push(p);t.getModel("tlDetailModel").setProperty(l+"/PRT",n);t.getModel("tlDetailModel").setProperty("/lPRT",n);t.getModel("tlDetailModel").refresh()},deleteTLPRT:function(e){var t=e.getSource();var r=e.getParameter("listItem").getBindingContext("tlDetailModel").sPath;r=r.substring(r.lastIndexOf("/")+1);var a=t.getModel("tlDetailModel");var l=a.getProperty("/lPRT");l.splice(parseInt(r),1);a.setProperty("/lPRT",l);this.getModel("tlDetailModel").setProperty("/lPRT",l)},onprtCtrlKeyVH:function(e){d.prtCtrlKeyVH(e,this)},onprtCtrlKeyChange:function(e){d.prtCtrlKeyChange(e,this)},onprtQtyChange:function(e){var t=e.getSource();var r=t.getValue();t.setValueState("None");if(r===""){t.setValueState("Error")}else if(parseInt(r)<=0){t.setValueState("Error")}},onprtUOMVH:function(e){d.UOMVH(e,this)},onprtUOMChange:function(e){d._UOMchange(e,this)},tlPRTPress:function(e){if(this.mode!=="display"){var t=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var r=t.split("/")[2];var a={opDetFlag:true,opIndex:r};sap.ui.getCore().setModel(a,"oOpFlag")}var l=e.getSource().oBindingContexts.tlDetailModel.sPath;this.getRouter().navTo("tlPRT",{itemPath:encodeURIComponent(l),mode:this.mode})},addInspChar:function(e){var t=this;var r=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var a=t.getModel("tlDetailModel").getProperty(r+"/InspChar");var l=t.getModel("tlDetailModel").getData();var n="";if(a.length<1){n="10"}else{var s=a[a.length-1].LineNum;var n=(parseInt(s)+10).toString()}a.push({group:l.grp,Plnal:this.grpCounter,Vornr:this.opNum,InspChar:n,PrstInd:"",QuanChar:false,QualChar:false,MastInspChar:"",Plant:"",Version:"",ShrtTxt:"",InspMthd:"",InspMthdPlnt:"",TolKey:"",VrsnInspMthd:"",SampProc:"",SampUOM:"",BaseSampQty:"",CodeGrp:"",MastInspCharVS:"None",PlantVS:"None",VersionVS:"None",InspMthdVS:"None",InspMthdPlntVS:"None",SampProcVS:"None",InspEnable:true});t.getModel("tlDetailModel").setProperty(r+"/InspChar",a);t.getModel("tlDetailModel").setProperty("/lInspChar",a);t.getModel("tlDetailModel").refresh()},deleteInspChar:function(e){var t=e.getSource();var r=e.getParameter("listItem").getBindingContext("tlDetailModel").sPath;r=r.substring(r.lastIndexOf("/")+1);var a=t.getModel("tlDetailModel");var l=a.getProperty("/lInspChar");l.splice(parseInt(r),1);a.setProperty("/lInspChar",l);this.getModel("tlDetailModel").setProperty("/lInspChar",l)},onMastInspCharVH:function(e){d.MastInspCharVH(e,this)},onMastInspCharChange:function(e){d.MastInspCharChange(e,this)},readInspChar:function(e,t,r,a){var l=this;var n=l.getView().getModel("tlDetailModel");var s=n.getData();var i=l.getView().getModel("valueHelp2");var o="/TLPresetIndSet(Werks='"+e+"',Mic='"+t+"',Version='"+r+"')";i.read(o,{success:function(e){n.getProperty(a).QualChar=e.Qualitat;n.getProperty(a).QuanChar=e.Quantitat;n.refresh()},error:function(e){var t=JSON.parse(e.responseText);var r=t.error.message.value;l.showMessage(r)}})},onICPlantChange:function(e){d.ICPlantChange(e,this)},onICVersionChange:function(e){d.ICVersionChange(e,this)},onInspMthdPlntVH:function(e){d.InspMthdPlntVH(e,this)},onInspMthdPlntChange:function(e){d.InspMthdPlntChange(e,this)},onSampProcVH:function(e){d.SampProcVH(e,this)},onSampProcChange:function(e){d.SampProcChange(e,this)},tlInspCharDetailPress:function(e){if(this.mode!=="display"){var t=this.getView().byId("operationTab").getSelectedItem().getBindingContext("tlDetailModel").sPath;var r=t.split("/")[2];var a={opDetFlag:true,opIndex:r};sap.ui.getCore().setModel(a,"oOpFlag")}var l=e.getSource().oBindingContexts.tlDetailModel.sPath;this.getRouter().navTo("tlInspChar",{itemPath:encodeURIComponent(l),mode:this.mode})}})});