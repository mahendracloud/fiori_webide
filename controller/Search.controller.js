sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/core/routing/History","ugiaiwui/mdg/aiw/request/model/formatter","sap/m/MessagePopover","sap/m/MessageItem","sap/m/BusyDialog","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider","ugieamui/mdg/eam/lib/util/SearchUtil","ugieamui/mdg/eam/lib/util/PersoService","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest","sap/ui/core/message/Message","sap/ui/core/library"],function(e,t,a,r,s,l,o,n,i,p,h,g,c,d){"use strict";var u=d.MessageType;return e.extend("ugiaiwui.mdg.aiw.request.controller.Search",{formatter:s,oMessageManager:sap.ui.getCore().getMessageManager(),onInit:function(){this._oView=this.getView();this.BusyDialog=new n;this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this._oView));var e=this._oComponent.getModel();e.setDefaultCountMode(sap.ui.model.odata.CountMode.None);e.setRefreshAfterChange(false);e.setUseBatch(false);this.getView().setModel(e);var t=this._oComponent.getModel("NewModel");t.setDefaultCountMode(sap.ui.model.odata.CountMode.None);t.setRefreshAfterChange(false);t.setUseBatch(false);this.getView().setModel(t,"valueHelp");var a=this._oComponent.getModel("NewModel2");a.setDefaultCountMode(sap.ui.model.odata.CountMode.None);a.setRefreshAfterChange(false);a.setUseBatch(false);this.getView().setModel(a,"valueHelp2");this.getRouter().getRoute("search").attachPatternMatched(this._onRouteMatched,this);var r=new sap.ui.model.json.JSONModel({refresh:true,refreshSearch:true});sap.ui.getCore().setModel(r,"refreshModel");this.getView().byId("deleteBtn").setVisible(false);var s=sap.ui.getCore().getMessageManager();this.getView().setModel(s.getMessageModel(),"message");s.registerObject(this.getView(),true);this.ObjFlag="";this._oView.setModel(this.oMessageManager.getMessageModel(),"message");this.oMessageManager.registerObject(this._oView,true);this._getMessagePopover();this.readDOIList("EQUI");this.readDOIList("FUNCLOC")},_onRouteMatched:function(e){var a=e.getParameter("name");if(a==="search"){this.getView().byId("idImportMocr").setEnabled(false);this.getView().byId("searchResults").setMode("MultiSelect");var r=sap.ui.getCore().getModel("refreshModel");if(e.getParameter("arguments").action!==this.action){r.setProperty("/refreshSearch",true)}this.action=e.getParameter("arguments").action;var s=new t;var l={};var r=sap.ui.getCore().getModel("refreshModel");if(r.getProperty("/refreshSearch")===true){var o=this.getView().byId("idPanel");var n=this.getView().byId("searchResults");var i=this.getView().byId("sColListItem");o.destroyContent();n.destroyColumns();n.destroyItems();i.destroyCells();n.setModel();if(this._oTPC){this._oTPC.destroyPersoService();this._oTPC.destroy()}this.loadSearchService()}if(this.action==="changeMbom"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="MBOM"}l.titleName=this.getView().getModel("i18n").getProperty("searchMaterialBomTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_MAT"))}if(this.action==="changeEbom"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="EBOM"}l.titleName=this.getView().getModel("i18n").getProperty("searchEquipmentBomTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_EQUI"))}if(this.action==="changeFlbom"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="FBOM"}l.titleName=this.getView().getModel("i18n").getProperty("searchFLBomTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_FLOC"))}if(this.action==="changeWbsbom"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="WBOM"}l.titleName=this.getView().getModel("i18n").getProperty("searchWBSBomTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_WBS"))}if(this.action==="changeOL"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="OBJL"}l.titleName=this.getView().getModel("i18n").getProperty("olSearchTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_OBJL"))}if(this.action==="changeEqui"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="EQUI"}l.titleName=this.getView().getModel("i18n").getProperty("searchEquiTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("searchEquiImportTitle"))}if(this.action==="changeFloc"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="FLOC"}l.titleName=this.getView().getModel("i18n").getProperty("searchFlocTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("searchFlocImportTitle"))}if(this.action==="changeMpmi"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="MPMI"}l.titleName=this.getView().getModel("i18n").getProperty("searchMpmiTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("searchMpmiImportTitle"))}if(this.action==="changeMspt"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="MSPT"}l.titleName=this.getView().getModel("i18n").getProperty("searchMsptTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("searchMsptImportTitle"))}if(this.action==="changeOn"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="OBJN"}l.titleName=this.getView().getModel("i18n").getProperty("SearchONHeader");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_OBJN"))}if(this.action==="changeWC"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="WKCT"}l.titleName=this.getView().getModel("i18n").getProperty("wcSearchTitle");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_WC"))}if(this.action==="changeGTL"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="GTL"}l.titleName=this.getView().getModel("i18n").getProperty("SRCH_GTL");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_GTL_MOCR"))}if(this.action==="changeETL"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="ETL"}l.titleName=this.getView().getModel("i18n").getProperty("SRCH_ETL");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_ETL_MOCR"))}if(this.action==="changeFTL"){if(r.getProperty("/refreshSearch")===true){this.selectedIndices=[];this.ObjFlag="FTL"}l.titleName=this.getView().getModel("i18n").getProperty("SRCH_FTL");this.getView().byId("idImportMocr").setText(this.getView().getModel("i18n").getProperty("IMP_FTL_MOCR"))}s.setData(l);this.getView().setModel(s,"applicationModel");if(r.getProperty("/refreshSearch")===true){var h=this.getView().getModel("hanaSearch");h.metadataLoaded().then(function(){this.onHaMetadataLoaded("hanaSearch",this.ObjFlag)}.bind(this));p.setSearchMethod(h,this.getView().byId("srchMethod"),"AIW");var g=new t([{text:"",searchId:""}]);this.getView().setModel(g,"saveSearch");p.readAllSavedSearch(h,this,this.ObjFlag)}this.getView().byId("idBtnMsgPopOver").setText(0);this.getView().byId("idBtnMsgPopOver").setEnabled(false)}else{return}},readSearchOperators:function(e,t,a){this.operators=[];var r=this;var s=this.getView().getModel(e);var l=function(s){var l=new sap.ui.model.json.JSONModel;sap.ui.getCore().setModel(l,"searchOperators");sap.ui.getCore().getModel("searchOperators").setProperty("/operators",s.results);var o;if(r.action==="changeGTL"){o="GTL"}else if(r.action==="changeETL"){o="ETL"}else if(r.action==="changeFTL"){o="FTL"}if(a==="DB"){var n=r.getView().getModel(e).getServiceMetadata();var i=p.getEntityTypes(n,t);var h=r.getView().byId("idPanel");var g=new sap.ui.model.json.JSONModel;g.setData(n);sap.ui.getCore().setModel(g,"dbMetadata");sap.ui.getCore().getModel("dbMetadata").setProperty("/entityType",i);var c=r.getView().getModel("valueHelp2");var d=p.getMetadata(i,h,a,c,r,o);sap.ui.getCore().getModel("dbMetadata").setProperty("/dbInputs",d);var u=r.getView().byId("searchResults");var m=r.getView().byId("sColListItem");var f=p.getResultEntityTypes(n,t);sap.ui.getCore().getModel("dbMetadata").setProperty("/resultEntityType",f);r._oTPC=p.getResultMetadata(f,t,u,m,r)}else{var n=r.getView().getModel(e).getServiceMetadata();var i=p.getEntityTypes(n,t);var h=r.getView().byId("idPanel");var g=new sap.ui.model.json.JSONModel;g.setData(n);sap.ui.getCore().setModel(g,"haMetadata");sap.ui.getCore().getModel("haMetadata").setProperty("/entityType",i);var c=r.getView().getModel("valueHelp2");var d=p.getMetadata(i,h,a,c,r,o);sap.ui.getCore().getModel("haMetadata").setProperty("/haInputs",d);var u=r.getView().byId("searchResults");var m=r.getView().byId("sColListItem");var f=p.getResultEntityTypes(n,t);sap.ui.getCore().getModel("haMetadata").setProperty("/resultEntityType",f);r._oTPC=p.getResultMetadata(f,t,u,m,r)}};var o=function(e){};s.read("/searchoperatorSet",{success:l,error:o})},loadSearchService:function(){if(this.action==="changeMbom"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.PMBOMHDR_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.PMBOMHDR_HA_SRCH_SRV.uri}if(this.action==="changeEbom"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.EQBOMHDR_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.EQBOMHDR_HA_SRCH_SRV.uri}if(this.action==="changeFlbom"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.FLBOMHDR_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.FLBOMHDR_HA_SRCH_SRV.uri}if(this.action==="changeWbsbom"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.WBSBOMHDR_DB_SEARCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.WBSBOMHDR_HA_SRCH_SRV.uri}if(this.action==="changeOL"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.OBJLINK_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.OBJLINK_HA_SRCH_SRV.uri}if(this.action==="changeEqui"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.EQUI_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.EQUI_HA_SRCH_SRV.uri}if(this.action==="changeFloc"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.FUNCLOC_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.FUNCLOC_HA_SRCH_SRV.uri}if(this.action==="changeMpmi"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.MPLAN_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.MPLAN_HA_SRCH_SRV.uri}if(this.action==="changeMspt"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.MSPOINT_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.MSPOINT_HA_SRCH_SRV.uri}if(this.action==="changeOn"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.OBJNETWRK_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.OBJNETWRK_HA_SRCH_SRV.uri}if(this.action==="changeWC"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.WORKCNTR_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.WORKCNTR_HA_SRCH_SRV.uri}if(this.action==="changeGTL"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.TLGNHDR_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.TLGNHDR_HA_SRCH_SRV.uri}if(this.action==="changeETL"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.TLEQHDR_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.TLEQHDR_HA_SRCH_SRV.uri}if(this.action==="changeFTL"){var e=this._oComponent.getManifestEntry("sap.app").dataSources.TLFLHDR_DB_SRCH_SRV.uri;var t=this._oComponent.getManifestEntry("sap.app").dataSources.TLFLHDR_HA_SRCH_SRV.uri}var a=new sap.ui.model.odata.v2.ODataModel(t,{json:true,loadMetadataAsync:true,refreshAfterChange:false});a.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(a,"hanaSearch")},onDbMetadataLoaded:function(e,t){this.readSearchOperators(e,t,"DB")},onHaMetadataLoaded:function(e,t){this.readSearchOperators(e,t,"HA")},onPersoButtonPressed:function(e){this._oTPC.openDialog()},onTablePersoRefresh:function(){h.resetPersData();this._oTPC.refresh()},handleSelectChange:function(e){var t;if(this.action==="changeMbom"){t="MBOM"}else if(this.action==="changeEbom"){t="EBOM"}else if(this.action==="changeFlbom"){t="FBOM"}else if(this.action==="changeWbsbom"){t="WBOM"}else if(this.action==="changeOL"){t="OBJL"}else if(this.action==="changeEqui"){t="EQUI"}else if(this.action==="changeFloc"){t="FLOC"}else if(this.action==="changeMpmi"){t="MPMI"}else if(this.action==="changeMspt"){t="MSPT"}else if(this.action==="changeOn"){t="OBJN"}else if(this.action==="changeWC"){t="WKCT"}else if(this.action==="changeGTL"){t="GTL"}else if(this.action==="changeETL"){t="ETL"}else if(this.action==="changeFTL"){t="FTL"}var a=e.getSource().getSelectedItem().getAdditionalText();var r=this.getView().byId("idPanel");var s=this.getView().getModel("valueHelp2");if(a==="HA"){sap.ui.getCore().getModel("searchType").setProperty("/searchType",a);r.destroyContent();var l=p.getEntityTypes(sap.ui.getCore().getModel("haMetadata").getData(),t);var o=p.getMetadata(l,r,"HA",s,this,t);sap.ui.getCore().getModel("haMetadata").setProperty("/haInputs",o)}else{sap.ui.getCore().getModel("searchType").setProperty("/searchType",a);r.destroyContent();var l=p.getEntityTypes(sap.ui.getCore().getModel("dbMetadata").getData(),t);var o=p.getMetadata(l,r,"DB",s,this,t);sap.ui.getCore().getModel("dbMetadata").setProperty("/dbInputs",o)}},onExit:function(){this._oTPC.destroyPersoService();this._oTPC.destroy()},onSearchPress:function(e){var t=this;var a=this.getView().byId("idPanel");var r=this.getView().byId("searchResults");var s=a.getContent();var l=[],o=this.getView().byId("srchMethod").getSelectedKey();for(var n=0;n<s.length;n++){var i;if(n<1){i=s[0].getItems();l.push(new sap.ui.model.Filter(i[i.length-1].getName(),"EQ",i[i.length-1].getValue().toUpperCase()))}else{i=s[n].getItems();l.push(new sap.ui.model.Filter(i[2].getName(),i[1].getSelectedKey(),i[2].getValue().toUpperCase()))}}l.push(new sap.ui.model.Filter("SearchHelp","EQ",o));var p=this.getView().byId("srchMethod").getSelectedKey();var h,g,c;if(this.action==="changeMbom"){g="/PMBOMHDRSearchSet";if(p==="DB"){c="PMBOMHDRDBSearch"}else{c="PMBOMHDRHASearch"}}else if(this.action==="changeEbom"){g="/EQBOMHDRSearchSet";if(p==="DB"){c="EQBOMHDRDBSearch"}else{c="EQBOMHDRHASearch"}}else if(this.action==="changeFlbom"){g="/FLBOMHDRSearchSet";if(p==="DB"){c="FLBOMHDRDBSearch"}else{c="FLBOMHDRHASearch"}}else if(this.action==="changeWbsbom"){g="/WBSBOMHDRSearchSet";if(p==="DB"){c="WBSBOMHDRDBSearch"}else{c="WBSBOMHDRHASearch"}}else if(this.action==="changeOL"){g="/OBJLINKSearchSet";if(p==="DB"){c="OBJLINKDBSearch"}else{c="OBJLINKHASearch"}}else if(this.action==="changeEqui"){g="/EQUISearchSet";if(p==="DB"){c="EQUIDBSearch"}else{c="EQUIHASearch"}}else if(this.action==="changeFloc"){g="/FUNCLOCSearchSet";if(p==="DB"){c="FUNCLOCDBSearch"}else{c="FUNCLOCHASearch"}}else if(this.action==="changeMpmi"){g="/MPLANSearchSet";if(p==="DB"){c="MPLANDBSearch"}else{c="MPLANHASearch"}}else if(this.action==="changeMspt"){g="/MSPOINTSearchSet";if(p==="DB"){c="MSPOINTDBSearch"}else{c="MSPOINTHASearch"}}else if(this.action==="changeOn"){g="/OBJNETWRKSearchSet";if(p==="DB"){c="OBJNETWRKDBSearch"}else{c="OBJNETWRKHASearch"}}else if(this.action==="changeWC"){g="/WORKCNTRSearchSet";if(p==="DB"){c="WORKCNTRDBSearch"}else{c="WORKCNTRHASearch"}}else if(this.action==="changeGTL"){g="/TLGNHDRSearchSet";if(p==="DB"){c="TLGNHDRDBSearch"}else{c="TLGNHDRHASearch"}}else if(this.action==="changeETL"){g="/TLEQHDRSearchSet";if(p==="DB"){c="TLEQHDRDBSearch"}else{c="TLEQHDRHASearch"}}else if(this.action==="changeFTL"){g="/TLFLHDRSearchSet";if(p==="DB"){c="TLFLHDRDBSearch"}else{c="TLFLHDRHASearch"}}if(p==="DB"){h=this.getView().getModel("DBSearch")}else{h=this.getView().getModel("hanaSearch")}var d=this.getView().byId("maxNo").getValue();d=parseInt(d);if(d===""||d===0||isNaN(d)){this.getView().byId("maxNo").setValueState("Error");var u=this.getView().getModel("i18n").getProperty("VALUE_ERR");this.showMessage(u);return}else{this.getView().byId("maxNo").setValueState("None")}r.setBusy(true);h.read(g,{filters:l,urlParameters:{$expand:c,$top:d},success:function(e){r.setBusy(false);if(e.results.length>0){var a;if(t.action==="changeMbom"){if(p==="DB"){a=e.results[0].PMBOMHDRDBSearch.results}else{a=e.results[0].PMBOMHDRHASearch.results}var s=sap.ui.getCore().getModel("AIWListMatModel").getData();if(s.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<s.length;o++){if(a[l].Matnr===s[o].Matnr&&a[l].Werks===s[o].Werks&&a[l].Stlan===s[o].Stlan){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeEbom"){if(p==="DB"){a=e.results[0].EQBOMHDRDBSearch.results}else{a=e.results[0].EQBOMHDRHASearch.results}var n=sap.ui.getCore().getModel("AIWListEqModel").getData();if(n.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<n.length;o++){if(a[l].Eqnrbom===n[o].Eqnrbom&&a[l].Werks===n[o].Werks&&a[l].Stlan===n[o].Stlan){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeFlbom"){if(p==="DB"){a=e.results[0].FLBOMHDRDBSearch.results}else{a=e.results[0].FLBOMHDRHASearch.results}var i=sap.ui.getCore().getModel("AIWListFLModel").getData();if(i.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<i.length;o++){if(a[l].Tplnrbom===i[o].Tplnrbom&&a[l].Werks===i[o].Werks&&a[l].Stlan===i[o].Stlan){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeWbsbom"){if(p==="DB"){a=e.results[0].WBSBOMHDRDBSearch.results}else{a=e.results[0].WBSBOMHDRHASearch.results}var h=sap.ui.getCore().getModel("AIWListWBSModel").getData();if(h.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<h.length;o++){if(a[l].Proid===h[o].WbsExt&&a[l].MatnrWbs===h[o].Matnr&&a[l].Werks===h[o].Werks&&a[l].Stlan===h[o].Stlan){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeOL"){if(p==="DB"){a=e.results[0].OBJLINKDBSearch.results}else{a=e.results[0].OBJLINKHASearch.results}var g=sap.ui.getCore().getModel("AIWListOLModel").getData();if(g.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<g.length;o++){if(a[l].Objlink===g[o].link){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeEqui"){if(p==="DB"){a=e.results[0].EQUIDBSearch.results}else{a=e.results[0].EQUIHASearch.results}var c=sap.ui.getCore().getModel("AIWEQUI").getData();if(c.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<c.length;o++){if(a[l].Equi===c[o].Equnr){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeFloc"){if(p==="DB"){a=e.results[0].FUNCLOCDBSearch.results}else{a=e.results[0].FUNCLOCHASearch.results}var d=sap.ui.getCore().getModel("AIWFLOC").getData();if(d.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<d.length;o++){if(a[l].Funcloc===d[o].Functionallocation){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeMpmi"){if(p==="DB"){a=e.results[0].MPLANDBSearch.results}else{a=e.results[0].MPLANHASearch.results}var u=sap.ui.getCore().getModel("AIWMPMI").getData();if(u.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<u.length;o++){if(a[l].Mplan===u[o].Warpl){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeMspt"){if(p==="DB"){a=e.results[0].MSPOINTDBSearch.results}else{a=e.results[0].MSPOINTHASearch.results}var m=sap.ui.getCore().getModel("AIWMSPT").getData();if(m.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<m.length;o++){if(a[l].Mspoint===m[o].Mspoint){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeOn"){if(p==="DB"){a=e.results[0].OBJNETWRKDBSearch.results}else{a=e.results[0].OBJNETWRKHASearch.results}var f=sap.ui.getCore().getModel("AIWListONModel").getData();if(f.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<f.length;o++){if(a[l].Objnetwrk===f[o].Objnetwrk){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeWC"){if(p==="DB"){a=e.results[0].WORKCNTRDBSearch.results}else{a=e.results[0].WORKCNTRHASearch.results}var S=sap.ui.getCore().getModel("AIWListWCModel").getData();if(S.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<S.length;o++){if(a[l].Arbpl===S[o].wc){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeGTL"){if(p==="DB"){a=e.results[0].TLGNHDRDBSearch.results}else{a=e.results[0].TLGNHDRHASearch.results}var M=sap.ui.getCore().getModel("AIWListGTLModel").getData();if(M.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<M.length;o++){if(a[l].Tlgnhdr===M[o].grp){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeETL"){if(p==="DB"){a=e.results[0].TLEQHDRDBSearch.results}else{a=e.results[0].TLEQHDRHASearch.results}var v=sap.ui.getCore().getModel("AIWListETLModel").getData();if(v.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<v.length;o++){if(a[l].Tlgnhdr===v[o].grp){a[l].UsmdActive="1";break}}}}}else if(t.action==="changeFTL"){if(p==="DB"){a=e.results[0].TLFLHDRDBSearch.results}else{a=e.results[0].TLFLHDRHASearch.results}var T=sap.ui.getCore().getModel("AIWListFTLModel").getData();if(T.length>0&&a.length>0){for(var l=0;l<a.length;l++){for(var o=0;o<T.length;o++){if(a[l].Tlgnhdr===T[o].grp){a[l].UsmdActive="1";break}}}}}var b=new sap.ui.model.json.JSONModel;b.setData(a);r.setModel(b);if(t.action==="changeGTL"||t.action==="changeETL"||t.action==="changeFTL"){var D=r.getItems();if(D.length>0){for(var l=0;l<D.length;l++){D[l].setType("Inactive")}}}}else{r.setModel()}},error:function(e){}})},onUpdateFinished:function(e){var t,a=e.getSource(),r=e.getParameter("total");if(r&&a.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("RESULTS",[r])}else{t=this.getResourceBundle().getText("RESULTS",["0"])}this.getView().byId("title").setText(t)},onPress:function(e){var t=e.getSource().getBindingContext().sPath;var a=parseInt(t.substr(1));var r=e.getSource().getBindingContext().getProperty(t);if(this.action.indexOf("bom")>-1){var s=" ",l=" ";if(this.action==="changeMbom")l=r.Matnr;if(this.action==="changeEbom")l=r.Eqnrbom;if(this.action==="changeFlbom")l=r.Tplnrbom;if(this.action==="changeWbsbom"){s=r.Proid;l=r.MatnrWbs}var o=r.Werks;var n=r.Stlan;var i=r.UsmdActive==="1"?"true":"false";this.getRouter().navTo("detail",{FragmentName:this.action,itemPath:encodeURIComponent(t),e:l,p:o,u:n,cr:i,w:s,mode:"request"})}else if(this.action==="changeOL"){var p=r.Objlink;var h=r.UsmdActive==="1"?"true":"false";var g="Create";this.getRouter().navTo("olDetail",{itemPath:encodeURIComponent(t),action:this.action,link:p,status:h,mode:g})}else if(this.action==="changeEqui"){var c=r.Equi;var d=r.UsmdActive==="1"?"true":"false";this.getRouter().navTo("detailEqui",{Path:encodeURIComponent(a),ViewName:"ChangeEqui",Equi:c,CrStatus:d})}else if(this.action==="changeFloc"){var u=r.Funcloc;var d=r.UsmdActive==="1"?"true":"false";this.getRouter().navTo("detailFloc",{Path:encodeURIComponent(a),ViewName:"ChangeFloc",Floc:u,CrStatus:d})}else if(this.action==="changeMpmi"){var m=r.Mplan;var d=r.UsmdActive==="1"?"true":"false";this.getRouter().navTo("detailMpmi",{Path:encodeURIComponent(a),ViewName:"ChangeMpmi",Mplan:m,CrStatus:d})}else if(this.action==="changeMspt"){var f=r.Mspoint;var d=r.UsmdActive==="1"?"true":"false";this.getRouter().navTo("detailMspt",{Path:encodeURIComponent(a),ViewName:"ChangeMspt",Mspt:f,CrStatus:d})}else if(this.action==="changeOn"){var S=r.Objnetwrk;var M=r.Ntobjtyp;var h=r.UsmdActive==="1"?"true":"false";if(M===""){M=" "}this.getRouter().navTo("ONdetail",{itemPath:encodeURIComponent(t),action:"Change",netId:S,objType:M,status:h,mode:"request"})}else if(this.action==="changeWC"){var v=r.Arbpl;var h=r.UsmdActive==="1"?"true":"false";var T=r.Werks;var g="Create";this.getRouter().navTo("wcDetail",{itemPath:encodeURIComponent(t),action:this.action,wc:v,status:h,plant:T,mode:g})}},onSelect:function(e){this.onSearchItemSelect(e)},onSearchItemSelect:function(e){this.selectedIndices=e.getSource()._aSelectedPaths;if(e.getSource()._aSelectedPaths.length>0){this.getView().byId("idImportMocr").setEnabled(true)}else{this.getView().byId("idImportMocr").setEnabled(false)}},onImportToMocrPress:function(){var e=this;var t=[];var a=0;var r=this.getView().byId("searchResults").getModel().getData();if(this.selectedIndices.length>0){for(var s=0;s<this.selectedIndices.length;s++){var l=false;var o=this.selectedIndices[s].split("/")[1];o=parseInt(o);if(this.action==="changeMbom"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var n=sap.ui.getCore().getModel("AIWListMatModel").getData();if(n.length>0){for(var i=0;i<n.length;i++){if(n[i].Matnr===r[o].Matnr&&n[i].Werks===r[o].Werks&&n[i].Stlan===r[o].Stlan&&n[i].Stalt===r[o].Stalt){var p=e.getResourceBundle().getText("matBomErr")+r[o].Matnr+"/"+r[o].Werks+"/"+r[o].Stlan+"/"+r[o].Stalt+" "+e.getResourceBundle().getText("locked");t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readBomDetails(r[o].Matnr,r[o].Werks,r[o].Stlan,r[o].Stalt)}}if(this.action==="changeEbom"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var h=sap.ui.getCore().getModel("AIWListEqModel").getData();if(h.length>0){for(var i=0;i<h.length;i++){if(h[i].Eqnrbom===r[o].Eqnrbom&&h[i].Werks===r[o].Werks&&h[i].Stlan===r[o].Stlan){var p=e.getResourceBundle().getText("equiBomErr")+r[o].Eqnrbom+"/"+r[o].Werks+"/"+r[o].Stlan+" "+e.getResourceBundle().getText("locked");t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readBomDetails(r[o].Eqnrbom,r[o].Werks,r[o].Stlan)}}if(this.action==="changeFlbom"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var c=sap.ui.getCore().getModel("AIWListFLModel").getData();if(c.length>0){for(var i=0;i<c.length;i++){if(c[i].Tplnrbom===r[o].Tplnrbom&&c[i].Werks===r[o].Werks&&c[i].Stlan===r[o].Stlan){var p=e.getResourceBundle().getText("flocBomErr")+r[o].Tplnrbom+"/"+r[o].Werks+"/"+r[o].Stlan+" "+e.getResourceBundle().getText("locked");t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readBomDetails(r[o].Tplnrbom,r[o].Werks,r[o].Stlan)}}if(this.action==="changeWbsbom"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var d=sap.ui.getCore().getModel("AIWListWBSModel").getData();if(d.length>0){for(var i=0;i<d.length;i++){if(d[i].WbsExt===r[o].Proid&&d[i].Matnr===r[o].MatnrWbs&&d[i].Werks===r[o].Werks&&d[i].Stlan===r[o].Stlan){var p=e.getResourceBundle().getText("wbsBomErr")+r[o].Proid+"/"+r[o].MatnrWbs+"/"+r[o].Werks+"/"+r[o].Stlan+" "+e.getResourceBundle().getText("locked");t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readBomDetails(r[o].MatnrWbs,r[o].Werks,r[o].Stlan,r[o].Proid)}}if(this.action==="changeOL"){if(r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var u=sap.ui.getCore().getModel("AIWListOLModel").getData();if(u.length>0){for(var i=0;i<u.length;i++){if(u[i].link===r[o].Objlink&&u[i].netId===r[o].Netid&&u[i].Kantyp===r[o].Kantyp){var p=this.getResourceBundle().getText("OBJ_LINK")+" "+r[o].Objlink+"/"+r[o].Netid+"/"+r[o].Kantyp+" "+this.getResourceBundle().getText("locked");t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readLinkData(r[o].Objlink)}}if(this.action==="changeEqui"){this.oSearchModelName="AIWEQUI";this.oModelName="AIWEQUISearch";g.handleImportToMocr(this);return}if(this.action==="changeFloc"){this.oSearchModelName="AIWFLOC";this.oModelName="AIWFLOCSearch";g.handleImportToMocr(this);return}if(this.action==="changeMpmi"){this.oSearchModelName="AIWMPMI";this.oModelName="AIWMPMISearch";g.handleImportToMocr(this);return}if(this.action==="changeMspt"){this.oSearchModelName="AIWMSPT";this.oModelName="AIWMSPTSearch";g.handleImportToMocr(this);return}if(this.action==="changeOn"){if(r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var m=sap.ui.getCore().getModel("AIWListONModel").getData();if(m.length>0){for(var i=0;i<m.length;i++){if(m[i].Objnetwrk===r[o].Objnetwrk){var p=this.getResourceBundle().getText("objNetErr")+r[o].Objnetwrk+" "+this.getResourceBundle().getText("locked");t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readNetworkData(r[o].Objnetwrk,r[o].Ntobjtyp)}}if(this.action==="changeWC"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var f=sap.ui.getCore().getModel("AIWListWCModel").getData();if(f.length>0){for(var i=0;i<f.length;i++){if(f[i].wc===r[o].Arbpl&&f[i].plant===r[o].Werks){var p="Work Center "+r[o].Arbpl+"/"+r[o].Werks+this.getResourceBundle().getText("locked");t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readWCDetails(r[o].Arbpl,r[o].Werks)}}if(this.action==="changeGTL"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var S=sap.ui.getCore().getModel("AIWListGTLModel").getData();if(S.length>0){for(var i=0;i<S.length;i++){if(S[i].grp===r[o].Tlgnhdr){var p="General Task List "+r[o].Tlgnhdr+" already locked in this CR";t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readTaskListDetails(r[o].Tlgnhdr,r[o].PlntyGn)}}if(this.action==="changeETL"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var M=sap.ui.getCore().getModel("AIWListETLModel").getData();if(M.length>0){for(var i=0;i<M.length;i++){if(M[i].grp===r[o].Tleqhdr&&M[i].equipment===r[o].Equnr2eth){var p="Equipment Task List "+r[o].Tleqhdr+"/"+r[o].Equnr2eth+" already locked in this CR";t.push({type:"Error",title:r[o].Message,message:r[o].Message});l=true;break}}}if(!l){a=a+1;this.readTaskListDetails(r[o].Tleqhdr,r[o].PlntyEq)}}if(this.action==="changeFTL"){if(r[o].UsmdActive&&r[o].UsmdActive==="1"){t.push({type:"Error",title:r[o].Message,message:r[o].Message});continue}var v=sap.ui.getCore().getModel("AIWListFTLModel").getData();if(v.length>0){for(var i=0;i<v.length;i++){if(v[i].grp===r[o].Tlflhdr&&v[i].floc===r[o].Tplnr2fth){var p="Functional Location Task List "+r[o].Tlflhdr+"/"+r[o].Tplnr2fth+" already locked in this CR";t.push({type:"Error",title:p,message:p});l=true;break}}}if(!l){a=a+1;this.readTaskListDetails(r[o].Tlflhdr,r[o].PlntyFl)}}}this.createMessagePopover(t,a)}else{}},readBomDetails:function(e,t,a,r){var s=this;var l=this.getView().getModel();var o="/ChangeRequestSet";var n;var i;if(this.action==="changeMbom"){var p=sap.ui.getCore().getModel("AIWListMatModel").getData();n=[new sap.ui.model.Filter("Matnr","EQ",e),new sap.ui.model.Filter("Werks","EQ",t),new sap.ui.model.Filter("Stlan","EQ",a),new sap.ui.model.Filter("Stalt","EQ",r)];i=["MRBHeader","MRBItem","MRBSBIT"]}if(this.action==="changeEbom"){var h=sap.ui.getCore().getModel("AIWListEqModel").getData();n=[new sap.ui.model.Filter("Eqnrbom","EQ",e),new sap.ui.model.Filter("Werks","EQ",t),new sap.ui.model.Filter("Stlan","EQ",a)];i=["EBHeader","EBItem","EBSBIT"]}if(this.action==="changeFlbom"){var g=sap.ui.getCore().getModel("AIWListFLModel").getData();n=[new sap.ui.model.Filter("Tplnrbom","EQ",e),new sap.ui.model.Filter("Werks","EQ",t),new sap.ui.model.Filter("Stlan","EQ",a)];i=["FBHeader","FBItem","FBSBIT"]}if(this.action==="changeWbsbom"){var c=sap.ui.getCore().getModel("AIWListWBSModel").getData();n=[new sap.ui.model.Filter("Proid","EQ",r),new sap.ui.model.Filter("Matnr","EQ",e),new sap.ui.model.Filter("Werks","EQ",t),new sap.ui.model.Filter("Stlan","EQ",a)];i=["WBHeader","WBItem","WBSBIT"]}this.BusyDialog.open();l.read(o,{filters:n,urlParameters:{$expand:i},success:function(e){s.BusyDialog.close();if(e.results[0].Message!==""){s.createMessagePopover2(e.results[0].Message,"Information");return}if(s.action==="changeMbom"){var t=e.results[0].MRBHeader.results[0];var a=e.results[0].MRBItem.results;var r=e.results[0].MRBSBIT.results;if(t!==undefined){var l={Matnr:t.Matnr,Werks:t.Werks,Stlan:t.Stlan,Stalt:t.Stalt,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Stktx:t.Stktx,Validfrom:s.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:s.getDateFormat(t.Validtoda),MatDesc:t.Maktx,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,matEnable:false,plantEnable:false,usageEnable:false,altbomEnable:false,crtMatHdrEnable:false,crtMatEnable:false,addItemEnable:true,matValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",bomType:"Change",modeFlag:"Delete",matItem:[],matSubItem:[]};if(a&&a.length>0){l.matItem=a;for(var o=0;o<l.matItem.length;o++){l.matItem[o].itmCatState="None";l.matItem[o].itmCompState="None";l.matItem[o].itmQtyState="None";l.matItem[o].itmUOMState="None";l.matItem[o].itmCatEnable=false;l.matItem[o].itmQtyEnable=true;l.matItem[o].Costgrelv=l.matItem[o].Costgrelv===""?"0":l.matItem[o].Costgrelv;l.matItem[o].Rvrel=l.matItem[o].Rvrel===""?"0":l.matItem[o].Rvrel;l.matItem[o].ItmcmpdescEnabled=true}s.sLastItemNum=a.length}else{l.matItem=[]}if(r&&r.length>0){l.matSubItem=r}else{l.matSubItem=[]}p.push(l);sap.ui.getCore().getModel("AIWListMatModel").setSizeLimit(p.length);sap.ui.getCore().getModel("AIWListMatModel").refresh()}}if(s.action==="changeEbom"){var t=e.results[0].EBHeader.results[0];var a=e.results[0].EBItem.results;var r=e.results[0].EBSBIT.results;if(t!==undefined){var n={Eqnrbom:t.Eqnrbom,Werks:t.Werks,Stlan:t.Stlan,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Validfrom:s.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:s.getDateFormat(t.Validtoda),EquiDesc:t.Eqktx,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,equipEnable:false,plantEnable:false,usageEnable:false,addItemEnable:true,equipValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",bomType:"Change",modeFlag:"Delete",eqItem:[],eqSubItem:[]};if(a&&a.length>0){n.eqItem=a;for(var o=0;o<n.eqItem.length;o++){n.eqItem[o].itmCatState="None";n.eqItem[o].itmCompState="None";n.eqItem[o].itmQtyState="None";n.eqItem[o].itmUOMState="None";n.eqItem[o].itmCatEnable=false;n.eqItem[o].itmQtyEnable=true;n.eqItem[o].Costgrelv=n.eqItem[o].Costgrelv===""?"0":n.eqItem[o].Costgrelv;n.eqItem[o].Rvrel=n.eqItem[o].Rvrel===""?"0":n.eqItem[o].Rvrel;n.eqItem[o].ItmcmpdescEnabled=false}}else{n.eqItem=[]}if(r&&r.length>0){n.eqSubItem=r}else{n.eqSubItem=[]}h.push(n);sap.ui.getCore().getModel("AIWListEqModel").setSizeLimit(h.length);sap.ui.getCore().getModel("AIWListEqModel").refresh()}}if(s.action==="changeFlbom"){var t=e.results[0].FBHeader.results[0];var a=e.results[0].FBItem.results;var r=e.results[0].FBSBIT.results;if(t!==undefined){var i={Tplnrbom:t.Tplnrbom,Werks:t.Werks,Stlan:t.Stlan,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Validfrom:s.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:s.getDateFormat(t.Validtoda),FLDesc:t.Pltxt,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,FLEnable:false,plantEnable:false,usageEnable:false,addItemEnable:true,FLValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",bomType:"Change",modeFlag:"Delete",flItem:[],flSubItem:[]};if(a&&a.length>0){i.flItem=a;for(var o=0;o<i.flItem.length;o++){i.flItem[o].itmCatState="None";i.flItem[o].itmCompState="None";i.flItem[o].itmQtyState="None";i.flItem[o].itmUOMState="None";i.flItem[o].itmCatEnable=false;i.flItem[o].itmQtyEnable=true;i.flItem[o].ItmcmpdescEnabled=false}s.sLastItemNum=a.length}else{i.flItem=[]}if(r&&r.length>0){i.flSubItem=r}else{i.flSubItem=[]}g.push(i);sap.ui.getCore().getModel("AIWListFLModel").setSizeLimit(g.length);sap.ui.getCore().getModel("AIWListFLModel").refresh()}}if(s.action==="changeWbsbom"){var t=e.results[0].WBHeader.results[0];var a=e.results[0].WBItem.results;var r=e.results[0].WBSBIT.results;if(t!==undefined){var d={WbsExt:t.WbsExt,Matnr:t.MatnrWbs,Werks:t.Werks,Stlan:t.Stlan,Bomstatus:t.Bomstatus,Lngtxt:t.Txtmi,Validfrom:s.getDateFormat(t.Dvalidfrm),BaseQty:t.Baseqty,BaseUom:t.Baseuom,Validtoda:s.getDateFormat(t.Validtoda),WbsDesc:t.Post1,MatDesc:t.Maktx,WerksDesc:t.Plantname,StlanDesc:t.Bomusagetxt,BomstatusText:t.Bomstatustxt,wbsEnable:false,matEnable:false,plantEnable:false,usageEnable:false,addItemEnable:true,wbsValueState:"None",matValueState:"None",plantValueState:"None",usageValueState:"None",statusValueState:"None",BaseQtyValueState:"None",crtMatHdrEnable:false,bomType:"Change",modeFlag:"Delete",wbsItem:[],wbsSubItem:[]};if(a&&a.length>0){d.wbsItem=a;for(var o=0;o<d.wbsItem.length;o++){d.wbsItem[o].itmCatState="None";d.wbsItem[o].itmCompState="None";d.wbsItem[o].itmQtyState="None";d.wbsItem[o].itmUOMState="None";d.wbsItem[o].itmCatEnable=false;d.wbsItem[o].itmQtyEnable=true;d.wbsItem[o].ItmcmpdescEnabled=false}s.sLastItemNum=a.length}else{d.wbsItem=[]}if(r&&r.length>0){d.wbsSubItem=r}else{d.wbsSubItem=[]}c.push(d);sap.ui.getCore().getModel("AIWListWBSModel").setSizeLimit(c.length);sap.ui.getCore().getModel("AIWListWBSModel").refresh()}}},error:function(e){s.BusyDialog.close()}})},readLinkData:function(e){var t=this;var a=this.getView().getModel();var r=sap.ui.getCore().getModel("AIWListOLModel").getData();var l=[new sap.ui.model.Filter("Objlink","EQ",e)];var o=["OLClass","OLVal","Olink","OLLAM"];this.tempOLimportArray=[];this.tempImportCounter=0;function n(e){var s="/DeriveOLstatusSet('"+e+"')";a.read(s,{success:function(e){if(t.tempImportCounter!==t.successCount){r=sap.ui.getCore().getModel("AIWListOLModel").getData();if(e.Statproftxt!==""&&(e.Ustw_oln!==""||e.Uswo_oln!=="")){t.tempOLimportArray[t.tempImportCounter].usrSts=e.Usta_oln;t.tempOLimportArray[t.tempImportCounter].stProfLblV=true;t.tempOLimportArray[t.tempImportCounter].stsProf=e.Stsm_oln;t.tempOLimportArray[t.tempImportCounter].stsProfV=true;t.tempOLimportArray[t.tempImportCounter].stsProfDesc=e.Statproftxt;t.tempOLimportArray[t.tempImportCounter].stsProfDescV=true;t.tempOLimportArray[t.tempImportCounter].stsObj=e.Ustw_oln;t.tempOLimportArray[t.tempImportCounter].stsObjLblV=true;t.tempOLimportArray[t.tempImportCounter].stsObjV=true;t.tempOLimportArray[t.tempImportCounter].stsWoLblV=true;t.tempOLimportArray[t.tempImportCounter].stsWoNoV=true;t.tempOLimportArray[t.tempImportCounter].stsWoNo=e.Uswo_oln;t.tempOLimportArray[t.tempImportCounter].sysSts=e.Stattext}else{t.tempOLimportArray[t.tempImportCounter].stProfLblV=false;t.tempOLimportArray[t.tempImportCounter].stsProfV=false;t.tempOLimportArray[t.tempImportCounter].stsProfDescV=false;t.tempOLimportArray[t.tempImportCounter].stsObjLblV=false;t.tempOLimportArray[t.tempImportCounter].stsObjV=false;t.tempOLimportArray[t.tempImportCounter].stsWoLblV=false;t.tempOLimportArray[t.tempImportCounter].stsWoNoV=false;t.tempOLimportArray[t.tempImportCounter].usrSts="";t.tempOLimportArray[t.tempImportCounter].stsProf="";t.tempOLimportArray[t.tempImportCounter].stsProfDesc="";t.tempOLimportArray[t.tempImportCounter].stsObj="";t.tempOLimportArray[t.tempImportCounter].stsWoNo="";t.tempOLimportArray[t.tempImportCounter].sysSts=""}r.push(t.tempOLimportArray[t.tempImportCounter]);t.tempImportCounter=t.tempImportCounter+1;sap.ui.getCore().getModel("AIWListOLModel").setData(r);sap.ui.getCore().getModel("AIWListOLModel").setSizeLimit(r.length);sap.ui.getCore().getModel("AIWListOLModel").refresh()}},error:function(e){}})}t.BusyDialog.open();a.read("/ChangeRequestSet",{filters:l,urlParameters:{$expand:o},success:function(e){t.BusyDialog.close();if(e.results.length>0){var a=e.results[0];var r=a.Olink.results[0];if(r!==null){t.linkCat=r.Netyp;t.objCat=r.Kantyp;t.olData={mode:"change",link:r.Objlink,Netyp:r.Netyp,linkCat:r.Netyp,linkCatDesc:r.Netyptxt,Kantyp:r.Kantyp,objCat:r.Kantyp,objCatDesc:r.Kantyptxt,linkDesc:r.Txtmi,netId:r.Netid,netIdDesc:r.Netidtxt,linkNum:r.Lfdknr,autGrp:r.Begru,autGrpDesc:r.Begtx,validFrm:s.getDateFormat(r.Datva),timeFrm:s.getTime(r.Zeitva),validTo:s.getDateFormat(r.Datvb),timeTo:s.getTime(r.Zeitvb),medium:r.Mediu,mediumDesc:r.Medkxt,linkCatEn:false,linkCatVS:"None",objCatEn:false,objCatVS:"None",linkFrmFlEn:true,linkToFlEn:true,linkObjFlEn:true,linkFromEQEn:true,linkToEQEn:true,linkObjEqEn:true,linkFEqLblRQ:true,linkToEqLblRQ:true,linkFrmEq:"",linkFrmEqDesc:"",linkToEq:"",linkToEqDesc:"",linkObjEq:"",linkObjEqDesc:"",linkFrmflLblV:false,linkFrmFlV:false,linkFrmFlDescV:false,linkToFlLblV:false,linkToFlV:false,linkToFlDescV:false,linkObjFlLblV:false,linkObjFlV:false,linkObjFlDescV:false,linkFrmEqLblV:true,linkFrmEqV:true,linkFrmEqDescV:true,linkToEqLblV:true,linkToEQV:true,linkToEqDescV:true,linkObjEqLblV:true,linkObjEqV:true,linkObjEqDescV:true,usrSts:"",stProfLblV:true,stsProf:"",stsProfV:true,stsProfDesc:"",stsProfDescV:true,stsObj:"",stsObjLblV:true,stsObjV:true,stsWoLblV:true,stsWoNoV:true,stsWoNo:""};if(t.objCat==="E"){t.olData.linkCatEn=false;t.olData.linkCatVS="None";t.olData.objCatEn=false;t.olData.objCatVS="None";t.olData.linkFrmFlEn=false;t.olData.linkToFlEn=false;t.olData.linkObjFlEn=false;t.olData.linkFEqLblRQ=true;t.olData.linkToEqLblRQ=true;t.olData.linkFrmEq=r.Eqvon;t.olData.linkFrmEqDesc=r.Eqtxtf;t.olData.linkToEq=r.Eqnach;t.olData.linkToEqDesc=r.Eqtxtt;t.olData.linkObjEq=r.Eqkant;t.olData.linkObjEqDesc=r.Eqtxtl;t.olData.linkFrmflLblV=false;t.olData.linkFrmFlV=false;t.olData.linkFrmFlDescV=false;t.olData.linkToFlLblV=false;t.olData.linkToFlV=false;t.olData.linkToFlDescV=false;t.olData.linkObjFlLblV=false;t.olData.linkObjFlV=false;t.olData.linkObjFlDescV=false;t.olData.linkFrmEqLblV=true;t.olData.linkFrmEqV=true;t.olData.linkFrmEqDescV=true;t.olData.linkToEqLblV=true;t.olData.linkToEQV=true;t.olData.linkToEqDescV=true;t.olData.linkObjEqLblV=true;t.olData.linkObjEqV=true;t.olData.linkObjEqDescV=true;n(t.linkCat)}else if(t.objCat==="T"){t.olData.linkCatEn=false;t.olData.linkCatVS="None";t.olData.objCatEn=false;t.olData.objCatVS="None";t.olData.linkFromEQEn=false;t.olData.linkToEQEn=false;t.olData.linkObjEqEn=false;t.olData.linkFrmflLblRQ=true;t.olData.linkToFlLblRQ=true;t.olData.linkFrmFl=r.Tpvon;t.olData.linkFrmFlDesc=r.Fltxtf;t.olData.linkToFl=r.Tpnach;t.olData.linkToFlDesc=r.Fltxtt;t.olData.linkObjFl=r.Tpkant;t.olData.linkObjFlDesc=r.Fltxtl;t.olData.linkFrmflLblV=true;t.olData.linkFrmFlV=true;t.olData.linkFrmFlDescV=true;t.olData.linkToFlLblV=true;t.olData.linkToFlV=true;t.olData.linkToFlDescV=true;t.olData.linkObjFlLblV=true;t.olData.linkObjFlV=true;t.olData.linkObjFlDescV=true;t.olData.linkFrmEqLblV=false;t.olData.linkFrmEqV=false;t.olData.linkFrmEqDescV=false;t.olData.linkToEqLblV=false;t.olData.linkToEQV=false;t.olData.linkToEqDescV=false;t.olData.linkObjEqLblV=false;t.olData.linkObjEqV=false;t.olData.linkObjEqDescV=false;n(t.linkCat)}if(r.Bezarp==="2"){t.olData.twoWayRel=true;t.olData.oneWayRel=false}else if(r.Bezarp==="1"){t.olData.oneWayRel=true;t.olData.twoWayRel=false}if(r.Bezarl==="2"){t.olData.twoWayUsd=true;t.olData.oneWayUsd=false;t.olData.relNotUsd=false}else if(r.Bezarl==="1"){t.olData.oneWayUsd=true;t.olData.relNotUsd=false;t.olData.twoWayUsd=false}else if(r.Bezarl==="0"){t.olData.relNotUsd=true;t.olData.oneWayUsd=false;t.olData.twoWayUsd=false}var l=a.OLLAM.results;var o=new sap.ui.model.json.JSONModel;o.setData(l);t.olData.LAM=l;var i=a.OLClass.results;if(i){if(i.length>0){for(var p=0;p<i.length;p++){i[p].ctEnable=false;i[p].classEnable=false;i[p].ClassTypeDesc=i[p].Artxt;delete i[p].Artxt;sClassList[p].ClassDesc=sClassList[p].Kltxt;delete sClassList[p].Kltxt;delete i[p].Changerequestid;delete i[p].Clint;delete i[p].Service;i[p].classDelEnable=true}var h=new sap.ui.model.json.JSONModel;h.setData(i);t.olData.Class=i}}var g=a.OLVal.results;if(g){if(g.length>0){for(var c=0;c<g.length;c++){g[c].cNameEnable=false;g[c].Textbz=g[c].Atwtb;delete g[c].Ataut;delete g[c].Ataw1;delete g[c].Atawe;delete g[c].Atcod;delete g[c].Atflb;delete g[c].Atflv;delete g[c].Atimb;delete g[c].Atsrt;delete g[c].Atvglart;delete g[c].Atzis;delete g[c].Changerequestid;delete g[c].CharName;delete g[c].Charid;delete g[c].Classtype;delete g[c].Service;delete g[c].Valcnt;g[c].slNo=c+1;g[c].flag=g[c].Class+"-"+g[c].slNo}var d=new sap.ui.model.json.JSONModel;d.setData(g);t.olData.Char=g}for(var u=0;u<t.olData.Char.length;u++){var m=1;for(var f=0;f<t.olData.Char.length;f++){if(u===f){continue}if(t.olData.Char[f].Atnam===t.olData.Char[u].Atnam){m++}}if(m>1){t.olData.Char[u].charDltEnable=true}else{t.olData.Char[u].charDltEnable=false}}}}t.tempOLimportArray.push(t.olData)}},error:function(e){t.BusyDialog.close()}})},readNetworkData:function(e,t,a){var r=this;var s=this.getView().getModel();var l=sap.ui.getCore().getModel("AIWListONModel").getData();var o=[new sap.ui.model.Filter("Objnetwrk","EQ",e),new sap.ui.model.Filter("Kantyp","EQ",t)];var n=["ONLAM","ONText","ONetwork","ONWClass","ONVal","ONALAM","ONatevt","ONattrp","ONLink","ONLLAM"];var i="/ChangeRequestSet";this.BusyDialog.open();s.read(i,{filters:o,urlParameters:{$expand:n},success:function(e){r.BusyDialog.close();if(e.results.length>0){r.match=true;var a=e.results[0];var s={};s.onType="Change";var o=a.ONetwork.results;if(o.length>0){var n=o[0];s.Objnetwrk=n.Objnetwrk;s.Netgrp=n.Netgrp;s.Netwtyp=n.Netwtyp;s.Netxt=n.Netxt;s.NetgrpDesc=n.NetgroupTxt;s.NetwtypDesc=n.NettypeTxt;s.NetgrpValueState="None";s.NetwtypValueState="None";s.NetIDEnable=false}if(t==="E"){s.Ntobjtyp="EQ"}else if(t==="T"){s.Ntobjtyp="FL"}else{s.Ntobjtyp=""}var i=a.ONLAM.results;if(i.length>0){var p=i[0];s.lam={Lrpid:p.Lrpid,Strtptatr:p.Strtptatr,Endptatr:p.Endptatr,Length:parseInt(p.Length),LinUnit:p.LinUnit,LinUnitDesc:p.Uomtext,Startmrkr:p.Startmrkr,Endmrkr:p.Endmrkr,Mrkdisst:p.Mrkdisst,Mrkdisend:p.Mrkdisend,MrkrUnit:p.MrkrUnit,LrpidDesc:p.LrpDescr,enableLrp:true,enableMarker:true,LrpidVS:"None",StrtptatrVS:"None",EndptatrVS:"None",LinUnitVS:"None",StartmrkrVS:"None",EndmrkrVS:"None",MrkdisstVS:"None",MrkdisendVS:"None",MrkrUnitVS:"None"}}else{s.lam={Lrpid:"",Strtptatr:"",Endptatr:"",Length:"",LinUnit:"",LinUnitDesc:"",Startmrkr:"",Endmrkr:"",Mrkdisst:"",Mrkdisend:"",MrkrUnit:"",LrpidDesc:"",enableLrp:true,enableMarker:false,LrpidVS:"None",StrtptatrVS:"None",EndptatrVS:"None",LinUnitVS:"None",StartmrkrVS:"None",EndmrkrVS:"None",MrkdisstVS:"None",MrkdisendVS:"None",MrkrUnitVS:"None"}}l.push(s);sap.ui.getCore().getModel("AIWListONModel").setSizeLimit(l.length);sap.ui.getCore().getModel("AIWListONModel").refresh()}r.BusyDialog.close()},error:function(e){r.BusyDialog.close()}})},readWCDetails:function(e,t){var r=this;var s=this.getView().getModel();var l=sap.ui.getCore().getModel("AIWListWCModel").getData();var o=new sap.ui.model.Filter("Arbpl","EQ",e);var n=new sap.ui.model.Filter("Werks","EQ",t);r.BusyDialog.open();s.read("/ChangeRequestSet",{filters:[o,n],urlParameters:{$expand:"Workcenter,WCCapa,WCCost,ValueWC,ClassWC"},success:function(e){r.BusyDialog.close();if(e.results.length>0){var t=e.results[0].Workcenter.results[0];var a=t;if(a){a.mode="change";a.wc=t.Arbpl;a.wcDesc=t.Txtmi;a.plant=t.Werks;a.plantDesc=t.Plantdesc;a.wcCat=t.Verwe;a.wcCatDesc=t.Ktext;a.person=t.Crveran;a.personDesc=t.Persresptxt;a.usg=t.Planv;a.usgDesc=t.UsageTxt;a.stdVal=t.Vgwts;a.stdValDesc=t.Vgwtx;a.ctrlKey=t.Crsteus;a.ctrlKeyDesc=t.Steutxt;a.wcValueState="None";a.wcDescValueState="None";a.plantValueState="None";a.wcCatValueState="None";a.personResValueState="None";a.usgValueState="None";a.stdValueState="None";a.cntrlKeyValueState="None";a.wcValueStateTxt="";a.wcDescValueStateTxt="";a.plantValueStateTxt="";a.wcCatValueStateTxt="";a.personResValueStateTxt="";a.usgValueStateTxt="";a.stdValueStateTxt="";a.cntrlKeyValueStateTxt="";a.wcEnable=false;a.plEnable=false;a.wcatEnable=false;a.cost=[];a.capacity=[];a.classItems=[];a.characteristics=[];var s=e.results[0].WCCost.results;if(s){if(s.length>0){var o=new sap.ui.model.json.JSONModel;o.setData(s);a.cost=s}}var n=e.results[0].WCCapa.results;if(n){if(n.length>0){var i=new sap.ui.model.json.JSONModel;i.setData(n);a.capacity=n}}var p=e.results[0].ClassWC.results;if(p){if(p.length>0){for(var h=0;h<p.length;h++){p[h].ctEnable=false;p[h].classEnable=false;p[h].ClassTypeDesc=p[h].Artxt;delete p[h].Artxt;p[h].ClassDesc=p[h].Kltxt;delete p[h].Kltxt;delete p[h].Changerequestid;delete p[h].Clint;delete p[h].Service;p[h].classDelEnable=true}a.classItems=p}}var g=e.results[0].ValueWC.results;if(g){if(g.length>0){for(var c=0;c<g.length;c++){g[c].cNameEnable=false;g[c].Textbz=g[c].Atwtb;delete g[c].Ataut;delete g[c].Ataw1;delete g[c].Atawe;delete g[c].Atcod;delete g[c].Atflb;delete g[c].Atflv;delete g[c].Atimb;delete g[c].Atsrt;delete g[c].Atvglart;delete g[c].Atzis;delete g[c].Changerequestid;delete g[c].CharName;delete g[c].Charid;delete g[c].Classtype;delete g[c].Service;delete g[c].Valcnt;g[c].slNo=c+1;g[c].flag=g[c].Class+"-"+g[c].slNo}a.characteristics=g;for(var d=0;d<a.characteristics.length;d++){var u=1;for(var m=0;m<a.characteristics.length;m++){if(d===m){continue}if(a.characteristics[m].Atnam===a.characteristics[d].Atnam){u++}}if(u>1){a.characteristics[d].charDltEnable=true}else{a.characteristics[d].charDltEnable=false}}}}}l.push(a);sap.ui.getCore().getModel("AIWListWCModel").setData(l);sap.ui.getCore().getModel("AIWListWCModel").refresh()}},error:function(e){r.BusyDialog.close();var t=[];if(JSON.parse(e.responseText).error.innererror.errordetails===undefined||JSON.parse(e.responseText).error.innererror.errordetails.length===0){t[0]=JSON.parse(e.responseText).error.message.value}else{for(var s=0;s<JSON.parse(e.responseText).error.innererror.errordetails.length;s++){t[s]=JSON.parse(e.responseText).error.innererror.errordetails[s].message}}var l=t.join("\n");a.show(l,{title:"Error",icon:sap.m.MessageBox.Icon.ERROR,onClose:function(){}})}})},readTaskListDetails:function(e,t){var a=this;var r=this.getView().getModel();var l;var o=sap.ui.getCore().getModel("AIWListGTLModel").getData();var n=sap.ui.getCore().getModel("AIWListETLModel").getData();var i=sap.ui.getCore().getModel("AIWListFTLModel").getData();var l="/ChangeRequestSet";var p=[new sap.ui.model.Filter("Plnnr","EQ",e),new sap.ui.model.Filter("Plnty","EQ",t),new sap.ui.model.Filter("CopyCreate","EQ",false)];if(this.action==="changeGTL"){var h=["GTClass","GTComp","GTInsp","GTList","GTMPack","GTMpackRead","GTOprs","GTPRT","GTRel","GTSpack","GTVal"]}else if(this.action==="changeETL"){var h=["ETClass","ETComp","ETInsp","ETList","ETMPack","ETMpackRead","ETOprs","ETPRT","ETRel","ETSpack","ETVal"]}else if(this.action==="changeFTL"){var h=["FTClass","FTComp","FTInsp","FTList","FTMPack","FTMpackRead","FTOprs","FTPRT","FTRel","FTSpack","FTVal"]}a.BusyDialog.open();r.read(l,{filters:p,urlParameters:{$expand:h},success:function(e){a.BusyDialog.close();if(e.results.length>0){var t=e.results[0];var r=e.results[0].Message;var l,p,h,g,c,d;if(a.action==="changeGTL"){if(t.GTList.results.length>0){var u={mode:"change",validFrm:s.getDateFormat(t.Datuv),grp:e.results[0].Plnnr,header:[],operation:[],component:[],Class:[],Char:[],modeflag:"Chg",typeFlag:"G",MaintPckg:[],KDenable:false};var m=t.GTList.results;if(m.length>0){u.header=m;for(var f=0;f<m.length;f++){u.header[f].PPenable=false;u.header[f].pPlantDesc=m[f].Iwerktxt;u.header[f].usageDesc=m[f].TlUsgTxt;u.header[f].plGrpDesc=m[f].Plnnrgrptxt;u.header[f].statusDesc=m[f].Statustxt;u.header[f].sysCondDesc=m[f].Anlzux;u.header[f].stratDesc=m[f].Strattxt;u.header[f].Plnal=m[f].Tplnal;u.header[f].Verwe=m[f].Tverwe;u.header[f].plEnable=false;u.header[f].valueStateT="None";u.header[f].valueStatePP="None";u.header[f].valueStateU="None";u.header[f].valueStateS="None";u.header[f].tlusg=m[f].Tverwe;u.header[f].Iwerk=m[f].Werks;u.header[f].wc=m[f].Tarbpl;u.header[f].plant=m[f].Wcplant;u.header[f].grp=m[f].Tlgnhdr;u.header[f].Ktext=m[f].Ktext;u.header[f].assmbly=m[f].Istru;u.header[f].assmblyDesc=m[f].Istrux;u.header[f].insPt=m[f].Slwbez;u.header[f].insPtDesc=m[f].Slwbeztxt;u.header[f].vEquiLbl=false;u.header[f].vEqui=false;u.header[f].vEquiDesc=false;u.header[f].vFlocLbl=false;u.header[f].vFloc=false;u.header[f].vFlocDesc=false;u.header[f].bAddComponent=true}var S=new sap.ui.model.json.JSONModel;S.setData(m)}var M=t.GTOprs.results;if(M.length>0){u.operation=M;var v=t.GTRel.results;var T=t.GTSpack.results;var b=t.GTMPack.results;var D=t.GTMpackRead.results;var V=t.GTPRT.results;var C=t.GTInsp.results;for(var E=0;E<M.length;E++){u.operation[E].calcKeyDesc="";u.operation[E].actTypDesc="";u.operation[E].flag=M[E].Tplnal+"-"+M[E].Vornr;u.operation[E].Arbpl=M[E].TlArbpl;u.operation[E].Plnal=M[E].Tplnal;u.operation[E].opState="None";u.operation[E].opDescState="None";u.operation[E].wcState="None";u.operation[E].plantState="None";u.operation[E].ctrlKeyState="None";u.operation[E].Werks=M[E].Werks2gop;u.operation[E].Steus=M[E].Steus2gop;u.operation[E].workPerc=M[E].Prznt;u.operation[E].orderQty=M[E].Bmvrg;u.operation[E].ordQtyUnit=M[E].Bmeih;u.operation[E].netPrice=M[E].Opreis;u.operation[E].currency=M[E].Owaers;u.operation[E].priceUnit=M[E].Opeinh;u.operation[E].costElement=M[E].Sakto2gop;u.operation[E].materialGrp=M[E].Omatkl;u.operation[E].puchGroup=M[E].Oekgrp;u.operation[E].purchOrg=M[E].Ekorg;u.operation[E].Uvorn=M[E].Uvorn;u.operation[E].UvornEnable=false;u.operation[E].equi=M[E].EqunrGop;u.operation[E].floc=M[E].TplnrGop;u.operation[E].OprRel=[];u.operation[E].SrvPckgOvrw=[];u.operation[E].PRT=[];u.operation[E].InspChar=[];if(v.length>0){for(var I in v){if(u.grp===v[I].Tlgnhdr&&u.operation[E].Plnal===v[I].Tplnal&&u.operation[E].Vornr===v[I].Vorn2){var P={Plnal:v[I].Tplnal,Vornr:v[I].Vorn2,OperationOR:v[I].Vornrgrel,Offset:v[I].Dauer,OUn:v[I].Zeinh,RelType:v[I].Aobar,PO:v[I].Gprznt,OI:v[I].Provg,ID:v[I].Gkalid,WrkCtrOR:v[I].Arbplgrel,PlantOR:v[I].Werksgrel,OperationORVS:"None",OffsetVS:"None",OUnVS:"None",RelTypeVS:"None",POVS:"None",OIVS:"None",IDVS:"None",WrkCtrORVS:"None",PlantORVS:"None"};u.operation[E].OprRel.push(P)}}}if(T.length>0){for(var I in T){if(u.grp===T[I].Tlgnhdr&&u.operation[E].Plnal===T[I].Tplnal&&u.operation[E].Vornr===T[I].Vornrr){var y={group:T[I].Tlgnhdr,Plnal:T[I].Tplnal,Vornr:T[I].Vornrr,LineNum:T[I].SrvLine,DelIndSP:s.statusSel(T[I].Del),ActNum:T[I].Srvpos,ShrtTxt:T[I].Ktext1,Qty:T[I].Mengegspk,BUomSP:T[I].Meinsgspk,GrossPrc:T[I].Tbtwr,CurKey:T[I].Waersgspk,Work:T[I].IntWork,UnitOfWork:T[I].Iwein,ActNumVS:"None",ShrtTxtVS:"None",QtyVS:"None",BUomSPVS:"None",GrossPrcVS:"None",CurKeyVS:"None",WorkVS:"None",UnitOfWorkVS:"None",DelIndSPEnabled:false,SPEnabled:true};u.operation[E].SrvPckgOvrw.push(y)}}}if(V.length>0){for(var I in V){if(u.grp===V[I].Tlgnhdr&&u.operation[E].Plnal===V[I].Tplnal&&u.operation[E].Vornr===V[I].Vornrgprt){var O={grp:V[I].Tlgnhdr,Plnal:V[I].Tplnal,Vornr:V[I].Vornrgprt,ItmNum:V[I].Psnfh,ItmCat:V[I].Fhmar,Plant:V[I].Fhwrk,Mat:V[I].Matnrgprt,MatDesc:"",Equi:V[I].EqunrGpt,EquiDesc:"",Mspt:V[I].Eqpnt,MsptDesc:"",doc:V[I].Dokargprt,docDesc:"",docType:V[I].Doknrgprt,docTypeDesc:"",docPart:V[I].Doktlgprt,docVersion:V[I].Dokvrgprt,Othr:V[I].Fhmnr,OthrDesc:"",Qty:V[I].Mgvgw,UOM:V[I].Mgeinh,QtyFrmla:V[I].Mgform,PRTCtrl:V[I].Steuf,PRTCtrlDesc:V[I].Stftxt,StdUsgVal:V[I].Ewvgw,StdUsgUOM:V[I].Eweinh,UsgValFrmla:V[I].Ewform,PRTVS:"None",PlantVS:"None",QtyVS:"None",UOMVS:"None",QtyFrmlaVS:"None",PRTCtrlVS:"None",StdUsgValVS:"None",StdUsgUOMVS:"None",UsgValFrmlaVS:"None"};if(O.ItmCat==="M"){O.PRT=O.Mat;O.title="Material";O.matEnable=true;O.eqEnable=false;O.msptEnable=false;O.docEnable=false;O.othEnable=false;O.Plant=u.operation[E].Werks}else if(O.ItmCat==="E"){O.PRT=O.Equi;O.title="Equipment";O.matEnable=false;O.eqEnable=true;O.msptEnable=false;O.docEnable=false;O.othEnable=false}else if(O.ItmCat==="P"){O.PRT=O.Mspt;O.title="Measuring Point";O.matEnable=false;O.eqEnable=false;O.msptEnable=true;O.docEnable=false;O.othEnable=false}else if(O.ItmCat==="D"){O.PRT=O.doc+"-"+O.docType+"-"+O.docPart+"-"+O.docVersion;O.title="Document";O.matEnable=false;O.eqEnable=false;O.msptEnable=false;O.docEnable=true;O.othEnable=false;O.docType="";O.docTypeDesc="";O.docPart="";O.docVersion=""}else if(O.ItmCat==="O"){O.PRT=O.Othr;O.title="Others";O.matEnable=false;O.eqEnable=false;O.msptEnable=false;O.docEnable=false;O.othEnable=true}u.operation[E].PRT.push(O)}}}if(C.length>0){for(var I in C){if(u.grp===C[I].Tlgnhdr&&u.operation[E].Plnal===C[I].Tplnal&&u.operation[E].Vornr===C[I].Vornrgins){var N={group:C[I].Tlgnhdr,Plnal:C[I].Tplnal,Vornr:C[I].Vornrgins,InspChar:C[I].Merknr,PrstInd:C[I].Vste2gins,QuanChar:s.statusSel(C[I].Quantitat),QualChar:s.statusSel(C[I].QpmkRef),MastInspChar:C[I].Verw2gins,Plant:C[I].Uzae2tlgn,Version:C[I].Ver2tlgni,ShrtTxt:C[I].Kurztext,InspMthd:C[I].Pmth2gins,InspMthdPlnt:C[I].Qwe2tlgni,TolKey:C[I].Toleranzs,VrsnInspMthd:C[I].Pmtversio,SampProc:C[I].Stichprve,SampUOM:C[I].Probemgeh,BaseSampQty:C[I].Pruefeinh,CodeGrp:C[I].Auswmenge,MastInspCharVS:"None",PlantVS:"None",VersionVS:"None",InspMthdVS:"None",InspMthdPlntVS:"None",SampProcVS:"None"};u.operation[E].InspChar.push(N)}}}var k=[];if(D.length>0){for(var L in D){if(u.grp===D[L].Tlgnhdr&&u.operation[E].Plnal===D[L].Tplnal){k.push(D[L])}}}var w=[];if(b.length>0){for(var I in b){if(u.grp===b[I].Tlgnhdr&&u.operation[E].Plnal===b[I].Tplnal&&u.operation[E].Vornr===b[I].Vorn2gmpk){w.push(b[I])}}}var A={};if(k.length>0){A={Plnal:k[0].Tplnal,Vornr:u.operation[E].Vornr,Strat:k[0].Startgmpk,SOp:"",Ltxa1:u.operation[E].Ltxa1,flag:k[0].Tplnal+"-"+u.operation[E].Vornr,MPArr:[]};for(var B in k){var R=k[B];A[R.Paketgmpk]=false}}if(w.length>0){for(var F in w){w[F].Vornr=w[F].Vorn2gmpk;w[F].Strat=w[F].Startgmpk;w[F].Paket=w[F].Paketgmpk;var W=w[F];if(w[F].IsSelected==="X"){A[W.Paketgmpk]=true}}A.MPArr=w}u.MaintPckg.push(A)}var x=new sap.ui.model.json.JSONModel;x.setData(M)}var q=t.GTComp.results;if(q.length>0){u.component=q;for(var U=0;U<q.length;U++){u.component[U].matDesc=q[U].Maktx;u.component[U].slNo=U+1;u.component[U].Plnal=q[U].Tplnal;u.component[U].flag=q[U].Tplnal+"-"+q[U].Vornr+"-"+u.component[U].slNo;u.component[U].hFlag=q[U].Tplnal+"-"+q[U].Vornr;u.component[U].bom=q[U].Stlnrgcmp;u.component[U].bomCat=q[U].Stltygcmp;u.component[U].bomCatDesc=q[U].Stltygcmptxt;u.component[U].altBom=q[U].Stlal}a.cmpData=q;p=new sap.ui.model.json.JSONModel;p.setData(q)}h=t.GTClass.results;if(h){if(h.length>0){for(var _=0;_<h.length;_++){h[_].ctEnable=false;h[_].classEnable=false;h[_].ClassTypeDesc=h[_].Artxt;delete h[_].Artxt;sClassList[_].ClassDesc=sClassList[_].Kltxt;delete sClassList[_].Kltxt;delete h[_].Changerequestid;delete h[_].Clint;delete h[_].Service;h[_].classDelEnable=true;h[_].slNo=_+1;h[_].Plnal=h[_].Tplnal;h[_].flag=h[_].Tplnal+"-"+h[_].slNo}a.cData=h;c=new sap.ui.model.json.JSONModel;c.setData(h);u.Class=h}}g=t.GTVal.results;if(g){if(g.length>0){for(var H=0;H<g.length;H++){g[H].cNameEnable=false;g[H].Textbz=g[H].Atwtb;delete g[H].Ataut;delete g[H].Ataw1;delete g[H].Atawe;delete g[H].Atcod;delete g[H].Atflb;delete g[H].Atflv;delete g[H].Atimb;delete g[H].Atsrt;delete g[H].Atvglart;delete g[H].Atzis;delete g[H].Changerequestid;delete g[H].CharName;delete g[H].Charid;delete g[H].Classtype;delete g[H].Service;delete g[H].Valcnt;g[H].slNo=H+1;g[H].Plnal=g[H].Tplnal;g[H].flag=g[H].Tplnal+"-"+g[H].Class+"-"+g[H].slNo}a.chData=g;d=new sap.ui.model.json.JSONModel;d.setData(g);u.Char=g}for(var F=0;F<u.Char.length;F++){var Q=1;for(var j=0;j<u.Char.length;j++){if(F===j){continue}if(u.Char[j].Atnam===u.Char[F].Atnam){Q++}}if(Q>1){u.Char[F].charDltEnable=true}else{u.Char[F].charDltEnable=false}}}o.push(u);sap.ui.getCore().getModel("AIWListGTLModel").setData(o);sap.ui.getCore().getModel("AIWListGTLModel").setSizeLimit(o.length);sap.ui.getCore().getModel("AIWListGTLModel").refresh()}}else if(a.action==="changeETL"){if(t.ETList.results.length>0){var m=t.ETList.results[0];var K={mode:"change",validFrm:s.getDateFormat(t.Datuv),grp:e.results[0].Plnnr,equipment:e.results[0].ETList.results[0].Eq2tl,equipmentDesc:e.results[0].ETList.results[0].Eqktx,modeflag:"Chg",typeFlag:"E",header:[],operation:[],component:[],MaintPckg:[],KDenable:false};var m=t.ETList.results;if(m.length>0){K.header=m;for(var f=0;f<m.length;f++){K.header[f].pPlantDesc=m[f].Iwerktxt;K.header[f].usageDesc=m[f].TlUsgTxt;K.header[f].plGrpDesc=m[f].Plnnrgrptxt;K.header[f].statusDesc=m[f].Statustxt;K.header[f].sysCondDesc=m[f].Anlzux;K.header[f].stratDesc=m[f].Strattxt;K.header[f].Plnal=m[f].Tplnal;K.header[f].Verwe=m[f].Tverwe;K.header[f].plEnable=false;K.header[f].valueStateT="None";K.header[f].valueStatePP="None";K.header[f].valueStateU="None";K.header[f].valueStateS="None";K.header[f].equipment=m[f].Eq2tl;K.header[f].equipmentDesc=m[f].Eqktx;K.header[f].tlusg=m[f].Tverwe;K.header[f].Iwerk=m[f].Werks;K.header[f].wc=m[f].Tarbpl;K.header[f].plant=m[f].Wcplant;K.header[f].grp=m[f].Tlgnhdr;K.header[f].Ktext=m[f].Ktext;K.header[f].assmbly=m[f].Istru;K.header[f].assmblyDesc=m[f].Istrux;K.header[f].insPt=m[f].Slwbez;K.header[f].insPtDesc=m[f].Slwbeztxt;K.header[f].vEquiLbl=true;K.header[f].vEqui=true;K.header[f].vEquiDesc=true;K.header[f].vFlocLbl=false;K.header[f].vFloc=false;K.header[f].vFlocDesc=false;K.header[f].bAddComponent=true}var S=new sap.ui.model.json.JSONModel;S.setData(K.header)}var M=t.ETOprs.results;if(M.length>0){K.operation=M;var v=t.ETRel.results;var T=t.ETSpack.results;var b=t.ETMPack.results;var D=t.ETMpackRead.results;var V=t.ETPRT.results;var C=t.ETInsp.results;for(var E=0;E<M.length;E++){K.operation[E].calcKeyDesc="";K.operation[E].actTypDesc="";K.operation[E].flag=M[E].Tplnal+"-"+M[E].Vornr;K.operation[E].Arbpl=M[E].TlArbpl;K.operation[E].Plnal=M[E].Tplnal;K.operation[E].opState="None";K.operation[E].opDescState="None";K.operation[E].wcState="None";K.operation[E].plantState="None";K.operation[E].ctrlKeyState="None";K.operation[E].Werks=M[E].Werks2eop;K.operation[E].Steus=M[E].Steus2eop;K.operation[E].workPerc=M[E].Prznt;K.operation[E].orderQty=M[E].Bmvrg;K.operation[E].ordQtyUnit=M[E].Bmeih;K.operation[E].netPrice=M[E].Opreis;K.operation[E].currency=M[E].Owaers;K.operation[E].priceUnit=M[E].Opeinh;K.operation[E].costElement=M[E].Sakto2eop;K.operation[E].materialGrp=M[E].Omatkl;K.operation[E].puchGroup=M[E].Oekgrp;K.operation[E].purchOrg=M[E].Ekorg;K.operation[E].Uvorn=M[E].Uvorn;K.operation[E].UvornEnable=false;K.operation[E].equi=M[E].EqunrEop;K.operation[E].floc=M[E].TplnrEop;K.operation[E].OprRel=[];K.operation[E].SrvPckgOvrw=[];K.operation[E].PRT=[];K.operation[E].InspChar=[];if(v.length>0){for(var I in v){if(K.grp===v[I].Tleqhdr&&K.operation[E].Plnal===v[I].Tplnal&&K.operation[E].Vornr===v[I].Vorn2){var P={Plnal:v[I].Tplnal,Vornr:v[I].Vorn2,OperationOR:v[I].Vornrerel,Offset:v[I].Dauer,OUn:v[I].Zeinh,RelType:v[I].Aobar,PO:v[I].Eprznt,OI:v[I].Provg,ID:v[I].Ekalid,WrkCtrOR:v[I].Arbplerel,PlantOR:v[I].Werkserel,OperationORVS:"None",OffsetVS:"None",OUnVS:"None",RelTypeVS:"None",POVS:"None",OIVS:"None",IDVS:"None",WrkCtrORVS:"None",PlantORVS:"None"};K.operation[E].OprRel.push(P)}}}if(T.length>0){for(var I in T){if(K.grp===T[I].Tleqhdr&&K.operation[E].Plnal===T[I].Tplnal&&K.operation[E].Vornr===T[I].Vornrr){var y={group:T[I].Tleqhdr,Plnal:T[I].Tplnal,Vornr:T[I].Vornrr,LineNum:T[I].SrvLine,DelIndSP:s.statusSel(T[I].Del),ActNum:T[I].Srvpos,ShrtTxt:T[I].Ktext1,Qty:T[I].Mengeespk,BUomSP:T[I].Meinsespk,GrossPrc:T[I].Tbtwr,CurKey:T[I].Waersespk,Work:T[I].IntWork,UnitOfWork:T[I].Iwein,ActNumVS:"None",ShrtTxtVS:"None",QtyVS:"None",BUomSPVS:"None",GrossPrcVS:"None",CurKeyVS:"None",WorkVS:"None",UnitOfWorkVS:"None",DelIndSPEnabled:false};K.operation[E].SrvPckgOvrw.push(y)}}}if(V.length>0){for(var I in V){if(K.grp===V[I].Tleqhdr&&K.operation[E].Plnal===V[I].Tplnal&&K.operation[E].Vornr===V[I].Vornreprt){var O={grp:V[I].Tleqhdr,Plnal:V[I].Tplnal,Vornr:V[I].Vornreprt,ItmNum:V[I].Psnfh,ItmCat:V[I].Fhmar,Plant:V[I].Fhwrk,Mat:V[I].Matnreprt,MatDesc:"",Equi:V[I].EqunrEpt,EquiDesc:"",Mspt:V[I].Eqpnt,MsptDesc:"",doc:V[I].Dokareprt,docDesc:"",docType:V[I].Doknreprt,docTypeDesc:"",docPart:V[I].Doktleprt,docVersion:V[I].Dokvreprt,Othr:V[I].Fhmnr,OthrDesc:"",Qty:V[I].Mgvgw,UOM:V[I].Mgeinh,QtyFrmla:V[I].Mgform,PRTCtrl:V[I].Steuf,PRTCtrlDesc:V[I].Stftxt,StdUsgVal:V[I].Ewvgw,StdUsgUOM:V[I].Eweinh,UsgValFrmla:V[I].Ewform,PRTVS:"None",PlantVS:"None",QtyVS:"None",UOMVS:"None",QtyFrmlaVS:"None",PRTCtrlVS:"None",StdUsgValVS:"None",StdUsgUOMVS:"None",UsgValFrmlaVS:"None"};if(O.ItmCat==="M"){O.PRT=O.Mat;O.title="Material";O.matEnable=true;O.eqEnable=false;O.msptEnable=false;O.docEnable=false;O.othEnable=false;O.Plant=K.operation[E].Werks}else if(O.ItmCat==="E"){O.PRT=O.Equi;O.title="Equipment";O.matEnable=false;O.eqEnable=true;O.msptEnable=false;O.docEnable=false;O.othEnable=false}else if(O.ItmCat==="P"){O.PRT=O.Mspt;O.title="Measuring Point";O.matEnable=false;O.eqEnable=false;O.msptEnable=true;O.docEnable=false;O.othEnable=false}else if(O.ItmCat==="D"){O.PRT=O.doc+"-"+O.docType+"-"+O.docPart+"-"+O.docVersion;O.title="Document";O.matEnable=false;O.eqEnable=false;O.msptEnable=false;O.docEnable=true;O.othEnable=false;O.docType="";O.docTypeDesc="";O.docPart="";O.docVersion=""}else if(O.ItmCat==="O"){O.PRT=O.Othr;O.title="Others";O.matEnable=false;O.eqEnable=false;O.msptEnable=false;O.docEnable=false;O.othEnable=true}K.operation[E].PRT.push(O)}}}if(C.length>0){for(var I in C){if(K.grp===C[I].Tleqhdr&&K.operation[E].Plnal===C[I].Tplnal&&K.operation[E].Vornr===C[I].Vornreins){var N={group:C[I].Tlgnhdr,Plnal:C[I].Tplnal,Vornr:C[I].Vornreins,InspChar:C[I].Merknr,PrstInd:C[I].Vste2eins,QuanChar:s.statusSel(C[I].Quantitat),QualChar:s.statusSel(C[I].QpmkRef),MastInspChar:C[I].Verw2eins,Plant:C[I].Uzae2tlen,Version:C[I].Ver2tleqi,ShrtTxt:C[I].Kurztext,InspMthd:C[I].Pmth2eins,InspMthdPlnt:C[I].Qwe2tleqi,TolKey:C[I].Toleranzs,VrsnInspMthd:C[I].Pmtversio,SampProc:C[I].Stichprve,SampUOM:C[I].Probemgeh,BaseSampQty:C[I].Pruefeinh,CodeGrp:C[I].Auswmenge,MastInspCharVS:"None",PlantVS:"None",VersionVS:"None",InspMthdVS:"None",InspMthdPlntVS:"None",SampProcVS:"None"};K.operation[E].InspChar.push(N)}}}var k=[];if(D.length>0){for(var L in D){if(K.grp===D[L].Tleqhdr&&K.operation[E].Plnal===D[L].Tplnal){k.push(D[L])}}}var w=[];if(b.length>0){for(var I in b){if(K.grp===b[I].Tleqhdr&&K.operation[E].Plnal===b[I].Tplnal&&K.operation[E].Vornr===b[I].Vorn2empk){w.push(b[I])}}}var A={};if(k.length>0){A={Plnal:k[0].Tplnal,Vornr:K.operation[E].Vornr,Strat:k[0].Startempk,SOp:"",Ltxa1:K.operation[E].Ltxa1,flag:k[0].Tplnal+"-"+K.operation[E].Vornr,MPArr:[]};for(var B in k){var R=k[B];A[R.Paketempk]=false}}if(w.length>0){for(var F in w){w[F].Vornr=w[F].Vorn2empk;w[F].Strat=w[F].Startempk;w[F].Paket=w[F].Paketempk;var W=w[F];if(w[F].IsSelected==="X"){A[W.Paketempk]=true}}A.MPArr=w}K.MaintPckg.push(A)}a.oData=K.operation;var x=new sap.ui.model.json.JSONModel;x.setData(K.operation)}}q=t.ETComp.results;if(q.length>0){K.component=q;for(var G=0;G<q.length;G++){K.component[G].matDesc=q[G].Maktx;K.component[G].slNo=G+1;K.component[G].Plnal=q[G].Tplnal;K.component[G].flag=q[G].Tplnal+"-"+q[G].Vornr+"-"+K.component[G].slNo;K.component[G].hFlag=q[G].Tplnal+"-"+q[G].Vornr;K.component[G].bom=q[G].Stlnrecmp;K.component[G].bomCat=q[G].Stltyecmp;K.component[G].bomCatDesc=q[G].Stltyecmptxt;K.component[G].altBom=q[G].Stlal}a.cmpData=q;p=new sap.ui.model.json.JSONModel;p.setData(q)}h=t.ETClass.results;if(h){if(h.length>0){for(var _=0;_<h.length;_++){h[_].ctEnable=false;h[_].classEnable=false;h[_].ClassTypeDesc=h[_].Artxt;delete h[_].Artxt;sClassList[_].ClassDesc=sClassList[_].Kltxt;delete sClassList[_].Kltxt;delete h[_].Changerequestid;delete h[_].Clint;delete h[_].Service;h[_].classDelEnable=true;h[_].slNo=_+1;h[_].Plnal=h[_].Tplnal;h[_].flag=h[_].Tplnal+"-"+h[_].slNo}a.cData=h;c=new sap.ui.model.json.JSONModel;c.setData(h);K.Class=h}}g=t.ETVal.results;if(g){if(g.length>0){for(var H=0;H<g.length;H++){g[H].cNameEnable=false;g[H].Textbz=g[H].Atwtb;delete g[H].Ataut;delete g[H].Ataw1;delete g[H].Atawe;delete g[H].Atcod;delete g[H].Atflb;delete g[H].Atflv;delete g[H].Atimb;delete g[H].Atsrt;delete g[H].Atvglart;delete g[H].Atzis;delete g[H].Changerequestid;delete g[H].CharName;delete g[H].Charid;delete g[H].Classtype;delete g[H].Service;delete g[H].Valcnt;g[H].slNo=H+1;g[H].Plnal=g[H].Tplnal;g[H].flag=g[H].Tplnal+"-"+g[H].Class+"-"+g[H].slNo}a.chData=g;d=new sap.ui.model.json.JSONModel;d.setData(g);K.Char=g}for(var F=0;F<K.Char.length;F++){var Q=1;for(var j=0;j<K.Char.length;j++){if(F===j){continue}if(K.Char[j].Atnam===K.Char[F].Atnam){Q++}}if(Q>1){K.Char[F].charDltEnable=true}else{K.Char[F].charDltEnable=false}}}n.push(K);sap.ui.getCore().getModel("AIWListETLModel").setData(n);sap.ui.getCore().getModel("AIWListETLModel").setSizeLimit(n.length);sap.ui.getCore().getModel("AIWListETLModel").refresh()}else if(a.action==="changeFTL"){if(t.FTList.results.length>0){var m=t.FTList.results[0];var J={mode:"change",validFrm:s.getDateFormat(t.Datuv),grp:e.results[0].Plnnr,floc:e.results[0].FTList.results[0].Fl2tl,flocDesc:e.results[0].FTList.results[0].Pltxt,modeflag:"Chg",typeFlag:"F",header:[],operation:[],component:[],MaintPckg:[],KDenable:false};var m=t.FTList.results;if(m.length>0){J.header=m;for(var f=0;f<m.length;f++){J.header[f].pPlantDesc=m[f].Iwerktxt;J.header[f].usageDesc=m[f].TlUsgTxt;J.header[f].plGrpDesc=m[f].Plnnrgrptxt;J.header[f].statusDesc=m[f].Statustxt;J.header[f].sysCondDesc=m[f].Anlzux;J.header[f].stratDesc=m[f].Strattxt;J.header[f].Plnal=m[f].Tplnal;J.header[f].Verwe=m[f].Tverwe;J.header[f].plEnable=false;J.header[f].valueStateT="None";J.header[f].valueStatePP="None";J.header[f].valueStateU="None";J.header[f].valueStateS="None";J.header[f].floc=m[f].Fl2tl;J.header[f].flocDesc=m[f].Pltxt;J.header[f].tlusg=m[f].Tverwe;J.header[f].Iwerk=m[f].Werks;J.header[f].wc=m[f].Tarbpl;J.header[f].plant=m[f].Wcplant;J.header[f].grp=m[f].Tlgnhdr;J.header[f].Ktext=m[f].Ktext;J.header[f].assmbly=m[f].Istru;J.header[f].assmblyDesc=m[f].Istrux;J.header[f].insPt=m[f].Slwbez;J.header[f].insPtDesc=m[f].Slwbeztxt;J.header[f].vEquiLbl=false;J.header[f].vEqui=false;J.header[f].vEquiDesc=false;J.header[f].vFlocLbl=true;J.header[f].vFloc=true;J.header[f].vFlocDesc=true;J.header[f].bAddComponent=true}var S=new sap.ui.model.json.JSONModel;S.setData(J.header)}var M=t.FTOprs.results;if(M.length>0){J.operation=M;var v=t.FTRel.results;var T=t.FTSpack.results;var b=t.FTMPack.results;var D=t.FTMpackRead.results;var V=t.FTPRT.results;var C=t.FTInsp.results;for(var E=0;E<M.length;E++){J.operation[E].calcKeyDesc="";J.operation[E].actTypDesc="";J.operation[E].flag=M[E].Tplnal+"-"+M[E].Vornr;J.operation[E].Arbpl=M[E].TlArbpl;J.operation[E].Plnal=M[E].Tplnal;J.operation[E].opState="None";J.operation[E].opDescState="None";J.operation[E].wcState="None";J.operation[E].plantState="None";J.operation[E].ctrlKeyState="None";J.operation[E].Werks=M[E].Werks2fop;J.operation[E].Steus=M[E].Steus2fop;J.operation[E].workPerc=M[E].Prznt;J.operation[E].orderQty=M[E].Bmvrg;J.operation[E].ordQtyUnit=M[E].Bmeih;J.operation[E].netPrice=M[E].Opreis;J.operation[E].currency=M[E].Owaers;J.operation[E].priceUnit=M[E].Opeinh;J.operation[E].costElement=M[E].Sakto2fop;J.operation[E].materialGrp=M[E].Omatkl;J.operation[E].puchGroup=M[E].Oekgrp;J.operation[E].purchOrg=M[E].Ekorg;J.operation[E].Uvorn=M[E].Uvorn;J.operation[E].UvornEnable=false;J.operation[E].equi=M[E].EqunrFop;J.operation[E].floc=M[E].TplnrFop;J.operation[E].OprRel=[];J.operation[E].SrvPckgOvrw=[];J.operation[E].PRT=[];J.operation[E].InspChar=[];if(v.length>0){for(var I in v){if(J.grp===v[I].Tlflhdr&&J.operation[E].Plnal===v[I].Tplnal&&J.operation[E].Vornr===v[I].Vorn2){var P={Plnal:v[I].Tplnal,Vornr:v[I].Vorn2,OperationOR:v[I].Vornrfrel,Offset:v[I].Dauer,OUn:v[I].Zeinh,RelType:v[I].Aobar,PO:v[I].Fprznt,OI:v[I].Provg,ID:v[I].Fkalid,WrkCtrOR:v[I].Arbplfrel,PlantOR:v[I].Werksfrel,OperationORVS:"None",OffsetVS:"None",OUnVS:"None",RelTypeVS:"None",POVS:"None",OIVS:"None",IDVS:"None",WrkCtrORVS:"None",PlantORVS:"None"};J.operation[E].OprRel.push(P)}}}if(T.length>0){for(var I in T){if(J.grp===T[I].Tlflhdr&&J.operation[E].Plnal===T[I].Tplnal&&J.operation[E].Vornr===T[I].Vornrr){var y={group:T[I].Tlflhdr,Plnal:T[I].Tplnal,Vornr:T[I].Vornrr,LineNum:T[I].SrvLine,DelIndSP:s.statusSel(T[I].Del),ActNum:T[I].Srvpos,ShrtTxt:T[I].Ktext1,Qty:T[I].Mengefspk,BUomSP:T[I].Meinsfspk,GrossPrc:T[I].Tbtwr,CurKey:T[I].Waersfspk,Work:T[I].IntWork,UnitOfWork:T[I].Iwein,ActNumVS:"None",ShrtTxtVS:"None",QtyVS:"None",BUomSPVS:"None",GrossPrcVS:"None",CurKeyVS:"None",WorkVS:"None",UnitOfWorkVS:"None",DelIndSPEnabled:false};J.operation[E].SrvPckgOvrw.push(y)}}}if(V.length>0){for(var I in V){if(J.grp===V[I].Tlflhdr&&J.operation[E].Plnal===V[I].Tplnal&&J.operation[E].Vornr===V[I].Vorn2){var O={grp:V[I].Tlflhdr,Plnal:V[I].Tplnal,Vornr:V[I].Vornrfprt,ItmNum:V[I].Psnfh,ItmCat:V[I].Fhmar,Plant:V[I].Fhwrk,Mat:V[I].Matnrfprt,MatDesc:"",Equi:V[I].EqunrFpt,EquiDesc:"",Mspt:V[I].Eqpnt,MsptDesc:"",doc:V[I].Dokarfprt,docDesc:"",docType:V[I].Doknrfprt,docTypeDesc:"",docPart:V[I].Doktlfprt,docVersion:V[I].Dokvrfprt,Othr:V[I].Fhmnr,OthrDesc:"",Qty:V[I].Mgvgw,UOM:V[I].Mgeinh,QtyFrmla:V[I].Mgform,PRTCtrl:V[I].Steuf,PRTCtrlDesc:V[I].Stftxt,StdUsgVal:V[I].Ewvgw,StdUsgUOM:V[I].Eweinh,UsgValFrmla:V[I].Ewform,PRTVS:"None",PlantVS:"None",QtyVS:"None",UOMVS:"None",QtyFrmlaVS:"None",PRTCtrlVS:"None",StdUsgValVS:"None",StdUsgUOMVS:"None",UsgValFrmlaVS:"None"};if(O.ItmCat==="M"){O.PRT=O.Mat;O.title="Material";O.matEnable=true;O.eqEnable=false;O.msptEnable=false;O.docEnable=false;O.othEnable=false;O.Plant=J.operation[E].Werks}else if(O.ItmCat==="E"){O.PRT=O.Equi;O.title="Equipment";O.matEnable=false;O.eqEnable=true;O.msptEnable=false;O.docEnable=false;O.othEnable=false}else if(O.ItmCat==="P"){O.PRT=O.Mspt;O.title="Measuring Point";O.matEnable=false;O.eqEnable=false;O.msptEnable=true;O.docEnable=false;O.othEnable=false}else if(O.ItmCat==="D"){O.PRT=O.doc+"-"+O.docType+"-"+O.docPart+"-"+O.docVersion;O.title="Document";O.matEnable=false;O.eqEnable=false;O.msptEnable=false;O.docEnable=true;O.othEnable=false;O.docType="";O.docTypeDesc="";O.docPart="";O.docVersion=""}else if(O.ItmCat==="O"){O.PRT=O.Othr;O.title="Others";O.matEnable=false;O.eqEnable=false;O.msptEnable=false;O.docEnable=false;O.othEnable=true}J.operation[E].PRT.push(O)}}}if(C.length>0){for(var I in C){if(J.grp===C[I].Tlflhdr&&J.operation[E].Plnal===C[I].Tplnal&&J.operation[E].Vornr===C[I].Vornrfins){var N={group:C[I].Tlflhdr,Plnal:C[I].Tplnal,Vornr:C[I].Vornrfins,InspChar:C[I].Merknr,PrstInd:C[I].Vste2fins,QuanChar:s.statusSel(C[I].Quantitat),QualChar:s.statusSel(C[I].QpmkRef),MastInspChar:C[I].Verw2fins,Plant:C[I].Uzae2tlfn,Version:C[I].Ver2tlfli,ShrtTxt:C[I].Kurztext,InspMthd:C[I].Pmth2fins,InspMthdPlnt:C[I].Qwe2tlfli,TolKey:C[I].Toleranzs,VrsnInspMthd:C[I].Pmtversio,SampProc:C[I].Stichprve,SampUOM:C[I].Probemgeh,BaseSampQty:C[I].Pruefeinh,CodeGrp:C[I].Auswmenge,MastInspCharVS:"None",PlantVS:"None",VersionVS:"None",InspMthdVS:"None",InspMthdPlntVS:"None",SampProcVS:"None"};J.operation[E].InspChar.push(N)}}}var k=[];if(D.length>0){for(var L in D){if(J.grp===D[L].Tlflhdr&&J.operation[E].Plnal===D[L].Tplnal){k.push(D[L])}}}var w=[];if(b.length>0){for(var I in b){if(J.grp===b[I].Tlflhdr&&J.operation[E].Plnal===b[I].Tplnal&&J.operation[E].Vornr===b[I].Vorn2fmpk){w.push(b[I])}}}var A={};if(k.length>0){A={Plnal:k[0].Tplnal,Vornr:J.operation[E].Vornr,Strat:k[0].Startfmpk,SOp:"",Ltxa1:J.operation[E].Ltxa1,flag:k[0].Tplnal+"-"+J.operation[E].Vornr,MPArr:[]};for(var B in k){var R=k[B];A[R.Paketfmpk]=false}}if(w.length>0){for(var F in w){w[F].Vornr=w[F].Vorn2fmpk;w[F].Strat=w[F].Startfmpk;w[F].Paket=w[F].Paketfmpk;var W=w[F];if(w[F].IsSelected==="X"){A[W.Paketfmpk]=true}}A.MPArr=w}J.MaintPckg.push(A)}a.oData=J.operation;var x=new sap.ui.model.json.JSONModel;x.setData(J.operation)}q=t.FTComp.results;if(q.length>0){J.component=q;for(var B=0;B<q.length;B++){J.component[B].matDesc=q[B].Maktx;J.component[B].slNo=G+1;J.component[B].Plnal=q[B].Tplnal;J.component[B].flag=q[B].Tplnal+"-"+q[B].Vornr+"-"+J.component[B].slNo;J.component[B].hFlag=q[B].Tplnal+"-"+q[B].Vornr;J.component[B].bom=q[B].Stlnrfcmp;J.component[B].bomCat=q[B].Stltyfcmp;J.component[B].bomCatDesc=q[B].Stltyfcmptxt;J.component[B].altBom=q[B].Stlal}a.cmpData=q;p=new sap.ui.model.json.JSONModel;p.setData(J.component)}h=t.FTClass.results;if(h){if(h.length>0){for(var _=0;_<h.length;_++){h[_].ctEnable=false;h[_].classEnable=false;h[_].ClassTypeDesc=h[_].Artxt;delete h[_].Artxt;sClassList[_].ClassDesc=sClassList[_].Kltxt;delete sClassList[_].Kltxt;delete h[_].Changerequestid;delete h[_].Clint;delete h[_].Service;h[_].classDelEnable=true;h[_].slNo=_+1;h[_].Plnal=h[_].Tplnal;h[_].flag=h[_].Tplnal+"-"+h[_].slNo}a.cData=h;c=new sap.ui.model.json.JSONModel;c.setData(h);J.Class=h}}g=t.FTVal.results;if(g){if(g.length>0){for(var H=0;H<g.length;H++){g[H].cNameEnable=false;g[H].Textbz=g[H].Atwtb;delete g[H].Ataut;delete g[H].Ataw1;delete g[H].Atawe;delete g[H].Atcod;delete g[H].Atflb;delete g[H].Atflv;delete g[H].Atimb;delete g[H].Atsrt;delete g[H].Atvglart;delete g[H].Atzis;delete g[H].Changerequestid;delete g[H].CharName;delete g[H].Charid;delete g[H].Classtype;delete g[H].Service;delete g[H].Valcnt;g[H].slNo=H+1;g[H].Plnal=g[H].Tplnal;g[H].flag=g[H].Tplnal+"-"+g[H].Class+"-"+g[H].slNo}a.chData=g;d=new sap.ui.model.json.JSONModel;d.setData(g);J.Char=g}for(var F=0;F<J.Char.length;F++){var Q=1;for(var j=0;j<J.Char.length;j++){if(F===j){continue}if(J.Char[j].Atnam===J.Char[F].Atnam){Q++}}if(Q>1){J.Char[F].charDltEnable=true}else{J.Char[F].charDltEnable=false}}}i.push(J);sap.ui.getCore().getModel("AIWListFTLModel").setData(i);sap.ui.getCore().getModel("AIWListFTLModel").setSizeLimit(i.length);sap.ui.getCore().getModel("AIWListFTLModel").refresh()}}}},error:function(e){a.BusyDialog.close()}})},onDonePress:function(){var e=r.getInstance().getPreviousHash();if(e!==undefined){history.go(-1)}var t=sap.ui.getCore().getModel("refreshModel");t.setProperty("/refreshSearch",true);this.selectedIndices=[]},getDateFormat:function(e){if(e!==""&&e!==null){var t="";var a=new Date(e);var r=a.getFullYear();var s=a.getMonth();if(s<10){s=s+1;if(s.length===1){s="0"+s}}else{s=s+1}var l=a.getDate();if(l<10){l="0"+l}var o=a.getHours();if(o<10){o="0"+o}var n=a.getMinutes();if(n<10){n="0"+n}var i=a.getSeconds();if(i<10){i="0"+i}t=s+"/"+l+"/"+r;return t}else if(e===null){return""}},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var a="";if(this.action.indexOf("bom")>-1){a=this.getResourceBundle().getText("ImportSuccessBOM")}else if(this.action.indexOf("TL")>-1){a=this.getResourceBundle().getText("ImportSuccessTL")}else if(this.action.indexOf("OL")>-1){a=this.getResourceBundle().getText("ImportSuccessOL")}else if(this.action.indexOf("WC")>-1){a=this.getResourceBundle().getText("ImportSuccessWC")}else if(this.action.indexOf("On")>-1){a=this.getResourceBundle().getText("ImportSuccessON")}else if(this.action.indexOf("Equi")>-1){a=this.getResourceBundle().getText("ImportSuccessEQ")}else if(this.action.indexOf("Floc")>-1){a=this.getResourceBundle().getText("ImportSuccessFL")}else if(this.action.indexOf("Mspt")>-1){a=this.getResourceBundle().getText("ImportSuccessMS")}else if(this.action.indexOf("Mpmi")>-1){a=this.getResourceBundle().getText("ImportSuccessMP")}e.push({type:"Success",title:a+" "+t,message:a+" "+t});var r,s=this._getMessagePopover();sap.ui.getCore().getMessageManager().removeAllMessages();for(var l=0;l<e.length;l++){r=new c({message:e[l].message,type:e[l].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(r)}s.toggle(this.getView().byId("idBtnMsgPopOver"));this.getView().byId("idBtnMsgPopOver").setText(e.length);this.getView().byId("idBtnMsgPopOver").setEnabled(true)},createMessagePopover2:function(e,t){var a=[];var r,s=this._getMessagePopover();if(typeof e==="string"){a.push({type:t,title:e,message:e})}else if(Array.isArray(e)){a=e;for(var l=0;l<a.length;l++){a[l].message=a[l].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var l=0;l<a.length;l++){r=new c({message:a[l].message,type:a[l].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(r)}s.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(a.length+"")},onDeleteSearchPress:function(e){var t=this.getView().byId("savedSearch").getSelectedKey();var a=this.getView().byId("saveSearchEAM").getValue();var r=this.ObjFlag;var s=this.getView().getModel("hanaSearch");var l=this.getView().byId("idPanel");var o=this.getView().byId("searchResults");var n=this.getView().byId("sColListItem");p.deleteSavedSearch(this.getView().byId("savedSearch"),a,r,s,this,l,o,n)},onSaveAction:function(e){var t=this;var a=e.getParameter("item").getKey();var r=this.getView().byId("saveSearchEAM").getValue();var s=this.getView().byId("srchMethod");var l=this.getView().byId("idPanel");var o=this.getView().byId("savedSearch");var n=l.getContent();p.onFnSavePress(a,this.ObjFlag,s,n,r,this.getView().getModel("hanaSearch"),this,o)},onSaveSearchChange:function(e){var t=this.getView().byId("srchMethod");var a=this.getView().byId("idPanel");var r=this.getView().byId("searchResults");var s=this.getView().byId("sColListItem");if(e.getSource().getSelectedKey()===""){a.destroyContent();r.destroyColumns();r.destroyItems();s.destroyCells();r.setModel();if(this._oTPC){this._oTPC.destroyPersoService();this._oTPC.destroy()}this.getView().byId("saveSearchEAM").setValue();this.readSearchOperators(this.getView().getModel("hanaSearch"),this.getView().byId("srchMethod").getSelectedItem().getAdditionalText())}else{this.getView().byId("saveSearchEAM").setValue(e.getSource().getSelectedItem().getText());p.readSavedSearch(this.getView().getModel("hanaSearch"),this,this.ObjFlag,e.getSource().getSelectedKey(),t,a)}},readDOIList:function(e){var t=this.getView().getModel("valueHelp2");var a=this;var r=[new sap.ui.model.Filter("Entity","EQ",e)];t.read("/DOIListSet",{filters:r,success:function(t){var r=new sap.ui.model.json.JSONModel;var s=t.results;var l=[];for(var o=0;o<s.length;o++){var n=new Object;var i=t.results[o].Property;n["SupFlVal"]="";n["instLoc"]=false;n["maintenance"]=false;n["Label"]=t.results[o].Label;n["property"]=t.results[o].Property;n["currentVal"]="";n["doiIcon"]=true;n[t.results[o].Property]="";if(t.results[o].Property==="Maintplant"){n["locEnable"]=false;n["maintEnable"]=false}else{n["locEnable"]=true;n["maintEnable"]=true}l.push(n)}if(e==="EQUI"){a.DOIarrayEQ=l}if(e==="FUNCLOC"){a.DOIarrayFL=l}},error:function(e){}})}})});