sap.ui.define(["ugiaiwui/mdg/aiw/request/controller/BaseController","sap/ui/model/json/JSONModel","ugiaiwui/mdg/aiw/request/model/formatter","sap/ui/core/routing/History","ugiaiwui/mdg/aiw/library/js/ValueHelpProvider","sap/ui/core/message/Message","sap/m/BusyDialog","ugiaiwui/mdg/aiw/request/util/ValueHelpRequest"],function(e,t,r,a,s,n,o,i){"use strict";return e.extend("ugiaiwui.mdg.aiw.request.controller.TLInspCharDetail",{formatter:r,onInit:function(){var e,r=new t({busy:true,delay:0});this.getRouter().getRoute("tlInspChar").attachPatternMatched(this._onObjectMatched,this);e=this.getView().getBusyIndicatorDelay();this.setModel(r,"objectView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){r.setProperty("/delay",e)});var a=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()));var s=a.getModel();s.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.getView().setModel(s);var n=a.getModel("NewModel");this.getView().setModel(n,"valueHelp");var o=a.getModel("NewModel2");this.getView().setModel(o,"valueHelp2")},onNavBack:function(){window.history.go(-1)},_onObjectMatched:function(e){var t=new sap.ui.model.json.JSONModel;var r=sap.ui.getCore().getModel("tlDetailModel");t.setData(r.getProperty(decodeURIComponent(e.getParameter("arguments").itemPath)));this.setModel(t,"icModel");this.getView().bindElement({path:decodeURIComponent(e.getParameter("arguments").itemPath),model:"icModel"})},onLiveChange:function(e){if(e.getSource().getValue()===" "){e.getSource().setValue("")}e.getSource().setValueState("None")},onMastInspCharVH:function(e){var t=this;var r=t.getView().getModel("valueHelp2");var a=this.getModel("icModel");var n=a.getData();var o={title:"Master Insp. Charac.",noDataText:"{i18n>LOAD}"+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"Plant"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Mstr Insp. Charac."})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Version"})]})],items:{path:"/TLInspCharVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Zaehler}"}),new sap.m.Text({text:"{Mkmnr}"}),new sap.m.Text({text:"{Version}"})]})},confirm:function(e){n.MastInspChar=e.getParameter("selectedItem").getCells()[1].getText();n.ShrtTxt=e.getParameter("selectedItem").getCells()[1].getText();n.Plant=e.getParameter("selectedItem").getCells()[0].getText();n.Version=e.getParameter("selectedItem").getCells()[2].getText();n.MastInspCharVS="None";n.VersionVS="None";n.InspMthdPlntVS="None";a.refresh();t.readInspChar(n.Plant,n.MastInspChar,n.Version)}};var i="/TLInspCharVHSet";var l=[];var g=[new sap.m.Text({text:"{Zaehler}"}),new sap.m.Text({text:"{Mkmnr}"}),new sap.m.Text({text:"{Version}"})];var p=s.getValueHelp(r,i,g,l,o,"Mkmnr","Zaehler");p.open();p.setModel(t.getView().getModel("i18n"),"i18n")},readInspChar:function(e,t,r){var a=this;var s=this.getModel("icModel");var n=s.getData();var o=a.getView().getModel("valueHelp2");var i="/TLPresetIndSet(Werks='"+e+"',Mic='"+t+"',Version='"+r+"')";o.read(i,{success:function(e){n.QualChar=e.Qualitat;n.QuanChar=e.Quantitat;s.refresh()},error:function(e){var t=JSON.parse(e.responseText);var r=t.error.message.value;a.showMessage(r)}})},onMastInspCharChange:function(e){var t=this;var r=e.getSource();var a=this.getModel("icModel");var s=a.getData();var n=r.getValue();var o=n.replace(/^[ ]+|[ ]+$/g,"");var i=t.getView().getModel("valueHelp2");if(o!==""){o=o.toUpperCase();var l=[new sap.ui.model.Filter("Mkmnr","EQ",o)];i.read("/TLInspCharVHSet",{filters:l,success:function(e){if(e.results.length>0){s.MastInspChar=e.results[0].Mkmnr;s.ShrtTxt=e.results[0].Mkmnr;s.MastInspCharVS="None";a.refresh();t.readInspChar(s.Plant,s.MastInspChar,s.Version)}else{s.MastInspCharVS="Error";a.refresh()}},error:function(e){s.MastInspCharVS="Error";a.refresh()}})}else{s.MastInspCharVS="None";a.refresh()}},onICPlantChange:function(e){var t=this;var r=e.getSource();var a=this.getModel("icModel");var s=a.getData();var n=r.getValue();var o=n.replace(/^[ ]+|[ ]+$/g,"");var i=t.getView().getModel("valueHelp2");if(o!==""){o=o.toUpperCase();var l=[new sap.ui.model.Filter("Zaehler","EQ",o)];i.read("/TLInspCharVHSet",{filters:l,success:function(e){if(e.results.length>0){s.Plant=e.results[0].Zaehler;s.PlantVS="None";a.refresh()}else{s.PlantVS="Error";a.refresh()}},error:function(e){s.PlantVS="Error";a.refresh()}})}else{s.PlantVS="None";a.refresh()}},onICVersionChange:function(e){var t=this;var r=e.getSource();var a=this.getModel("icModel");var s=a.getData();var n=r.getValue();var o=n.replace(/^[ ]+|[ ]+$/g,"");var i=t.getView().getModel("valueHelp2");if(o!==""){o=o.toUpperCase();var l=[new sap.ui.model.Filter("Version","EQ",o)];i.read("/TLInspCharVHSet",{filters:l,success:function(e){if(e.results.length>0){s.Version=e.results[0].Version;s.VersionVS="None";a.refresh()}else{s.VersionVS="Error";a.refresh()}},error:function(e){s.VersionVS="Error";a.refresh()}})}else{s.VersionVS="None";a.refresh()}},onSampProcVH:function(e){var t=this;var r=this.getModel("icModel");var a=r.getData();var n={title:"Sample Procedure",noDataText:t.getView().getModel("i18n").getProperty("LOAD")+"...",items:{path:"/TLSampPrcVHSet",template:new sap.m.StandardListItem({title:"{Stichprver}",description:"{Kurztext}"})},confirm:function(e){a.SampProc=e.getParameters().selectedItem.getProperty("title");a.SampProcVS="None";r.refresh()}};var o="/TLSampPrcVHSet";var i=t.getView().getModel("valueHelp2");var l=s.getSelectDialog(i,o,[],n,"Stichprver","Kurztext");l.open()},onSampProcChange:function(e){var t=this;var r=f.getSource();var a=this.getModel("icModel");var s=a.getData();var n=r.getParent().getBindingContextPath();var o=r.getValue();var i=o.replace(/^[ ]+|[ ]+$/g,"");var l=t.getView().getModel("valueHelp2");if(i!==""){i=i.toUpperCase();var g=[new sap.ui.model.Filter("Stichprver","EQ",i)];l.read("/TLSampPrcVHSet",{filters:g,success:function(e){if(e.results.length>0){s.SampProc=e.results[0].Stichprver;s.SampProcVS="None";a.refresh()}else{s.SampProcVS="Error";a.refresh()}},error:function(e){s.SampProcVS="Error";a.refresh()}})}else{s.SampProcVS="None";a.refresh()}},onInspMthdVH:function(e){var t=this;var r=this.getModel("icModel");var a=r.getData();var n={title:"Inspection Method",noDataText:t.getView().getModel("i18n").getProperty("LOAD")+"...",columns:[new sap.m.Column({header:[new sap.m.Text({text:"{i18n>PLANT}"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Insp. Method"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Version"})]}),new sap.m.Column({demandPopin:true,minScreenWidth:"Tablet",header:[new sap.m.Text({text:"Short Text"})]})],items:{path:"/TLInspMethVHSet",template:new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Pmtnr}"}),new sap.m.Text({text:"{Version}"}),new sap.m.Text({text:"{Kurztext}"})]})},confirm:function(e){a.InspMthd=e.getParameter("selectedItem").getCells()[1].getText();a.VrsnInspMthd=e.getParameter("selectedItem").getCells()[2].getText();a.InspMthdVS="None";r.refresh()},search:function(e){if(e.getSource().getBinding("items")){var t=e.getParameter("value");e.getSource().getBinding("items").filter(!t?[]:[new sap.ui.model.Filter([new sap.ui.model.Filter("Pmtnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Kurztext",sap.ui.model.FilterOperator.Contains,t)],false)])}}};var o="/TLInspMethVHSet";var i=[];var l=t.getView().getModel("valueHelp2");var g=[new sap.m.Text({text:"{Werks}"}),new sap.m.Text({text:"{Pmtnr}"}),new sap.m.Text({text:"{Version}"}),new sap.m.Text({text:"{Kurztext}"})];var p=s.getValueHelp(l,o,g,i,n,"Pmtnr","Kurztext");p.open();p.setModel(t.getView().getModel("i18n"),"i18n")},InspMthdPlntChange:function(e,t){var r=f.getSource();var t=this;var a=this.getModel("icModel");var s=a.getData();var n=r.getValue();var o=n.replace(/^[ ]+|[ ]+$/g,"");var i=t.getView().getModel("valueHelp2");if(o!==""){o=o.toUpperCase();var l=[new sap.ui.model.Filter("Pmtnr","EQ",o)];i.read("/TLInspMethVHSet",{filters:l,success:function(e){if(e.results.length>0){s.InspMthdPlnt=e.results[0].Pmtnr;s.VrsnInspMthd=e.results[0].Version;s.InspMthdPlntVS="None";a.refresh()}else{s.InspMthdPlntVS="Error";a.refresh()}},error:function(e){s.InspMthdPlntVS="Error";a.refresh()}})}else{s.InspMthdPlntVS="None";a.refresh()}},onInspCharDonePress:function(){var e=this;var t=this.getModel("icModel");var r=t.getData();if(r.MastInspChar===""||r.MastInspCharVS==="Error"){var a="Enter Master Inspection Characteristic";this.createMessagePopover(aMsg,"Error");return}window.history.go(-1)},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment("ugieamui.mdg.eam.lib.popover.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},handleMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},createMessagePopover:function(e,t){var r=[];var a,s=this._getMessagePopover();if(typeof e==="string"){r.push({type:t,title:e,message:e})}else if(Array.isArray(e)){r=e;for(var o=0;o<r.length;o++){r[o].message=r[o].title}}sap.ui.getCore().getMessageManager().removeAllMessages();for(var o=0;o<r.length;o++){a=new n({message:r[o].message,type:r[o].type,target:"/Dummy",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(a)}s.toggle(this.getView().byId("idMessagePopover"));this.getView().byId("idMessagePopover").setEnabled(true);this.getView().byId("idMessagePopover").setText(r.length+"")}})});